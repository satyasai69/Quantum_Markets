(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,174429,(e,t,r)=>{"use strict";function i(e){if(!Number.isSafeInteger(e)||e<0)throw Error(`positive integer expected, not ${e}`)}function n(e){if("boolean"!=typeof e)throw Error(`boolean expected, not ${e}`)}function s(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function a(e,...t){if(!s(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function o(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.wrapConstructor");i(e.outputLen),i(e.blockLen)}function l(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function c(e,t){a(e);let r=t.outputLen;if(e.length<r)throw Error(`digestInto() expects output buffer of length at least ${r}`)}Object.defineProperty(r,"__esModule",{value:!0}),r.output=r.exists=r.hash=r.bytes=r.bool=r.number=r.isBytes=void 0,r.number=i,r.bool=n,r.isBytes=s,r.bytes=a,r.hash=o,r.exists=l,r.output=c,r.default={number:i,bool:n,bytes:a,hash:o,exists:l,output:c}},635138,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.add5L=r.add5H=r.add4H=r.add4L=r.add3H=r.add3L=r.add=r.rotlBL=r.rotlBH=r.rotlSL=r.rotlSH=r.rotr32L=r.rotr32H=r.rotrBL=r.rotrBH=r.rotrSL=r.rotrSH=r.shrSL=r.shrSH=r.toBig=r.split=r.fromBig=void 0;let i=BigInt(0x100000000-1),n=BigInt(32);function s(e,t=!1){return t?{h:Number(e&i),l:Number(e>>n&i)}:{h:0|Number(e>>n&i),l:0|Number(e&i)}}function a(e,t=!1){let r=new Uint32Array(e.length),i=new Uint32Array(e.length);for(let n=0;n<e.length;n++){let{h:a,l:o}=s(e[n],t);[r[n],i[n]]=[a,o]}return[r,i]}r.fromBig=s,r.split=a;let o=(e,t)=>BigInt(e>>>0)<<n|BigInt(t>>>0);r.toBig=o;let l=(e,t,r)=>e>>>r;r.shrSH=l;let c=(e,t,r)=>e<<32-r|t>>>r;r.shrSL=c;let d=(e,t,r)=>e>>>r|t<<32-r;r.rotrSH=d;let u=(e,t,r)=>e<<32-r|t>>>r;r.rotrSL=u;let h=(e,t,r)=>e<<64-r|t>>>r-32;r.rotrBH=h;let p=(e,t,r)=>e>>>r-32|t<<64-r;r.rotrBL=p;let f=(e,t)=>t;r.rotr32H=f;let y=(e,t)=>e;r.rotr32L=y;let g=(e,t,r)=>e<<r|t>>>32-r;r.rotlSH=g;let m=(e,t,r)=>t<<r|e>>>32-r;r.rotlSL=m;let w=(e,t,r)=>t<<r-32|e>>>64-r;r.rotlBH=w;let b=(e,t,r)=>e<<r-32|t>>>64-r;function v(e,t,r,i){let n=(t>>>0)+(i>>>0);return{h:e+r+(n/0x100000000|0)|0,l:0|n}}r.rotlBL=b,r.add=v;let E=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0);r.add3L=E;let _=(e,t,r,i)=>t+r+i+(e/0x100000000|0)|0;r.add3H=_;let A=(e,t,r,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0);r.add4L=A;let S=(e,t,r,i,n)=>t+r+i+n+(e/0x100000000|0)|0;r.add4H=S;let x=(e,t,r,i,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0)+(n>>>0);r.add5L=x;let I=(e,t,r,i,n,s)=>t+r+i+n+s+(e/0x100000000|0)|0;r.add5H=I,r.default={fromBig:s,split:a,toBig:o,shrSH:l,shrSL:c,rotrSH:d,rotrSL:u,rotrBH:h,rotrBL:p,rotr32H:f,rotr32L:y,rotlSH:g,rotlSL:m,rotlBH:w,rotlBL:b,add:v,add3L:E,add3H:_,add4L:A,add4H:S,add5H:I,add5L:x}},581918,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.crypto=void 0,r.crypto="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0},857024,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.randomBytes=r.wrapXOFConstructorWithOpts=r.wrapConstructorWithOpts=r.wrapConstructor=r.checkOpts=r.Hash=r.concatBytes=r.toBytes=r.utf8ToBytes=r.asyncLoop=r.nextTick=r.hexToBytes=r.bytesToHex=r.byteSwap32=r.byteSwapIfBE=r.byteSwap=r.isLE=r.rotl=r.rotr=r.createView=r.u32=r.u8=r.isBytes=void 0;let i=e.r(581918),n=e.r(174429);r.isBytes=function(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name},r.u8=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength),r.u32=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),r.createView=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),r.rotr=(e,t)=>e<<32-t|e>>>t,r.rotl=(e,t)=>e<<t|e>>>32-t>>>0,r.isLE=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],r.byteSwap=e=>e<<24&0xff000000|e<<8&0xff0000|e>>>8&65280|e>>>24&255,r.byteSwapIfBE=r.isLE?e=>e:e=>(0,r.byteSwap)(e),r.byteSwap32=function(e){for(let t=0;t<e.length;t++)e[t]=(0,r.byteSwap)(e[t])};let s=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));r.bytesToHex=function(e){(0,n.bytes)(e);let t="";for(let r=0;r<e.length;r++)t+=s[e[r]];return t};function a(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}async function o(e,t,i){let n=Date.now();for(let s=0;s<e;s++){i(s);let e=Date.now()-n;e>=0&&e<t||(await (0,r.nextTick)(),n+=e)}}function l(e){if("string"!=typeof e)throw Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function c(e){return"string"==typeof e&&(e=l(e)),(0,n.bytes)(e),e}r.hexToBytes=function(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);let t=e.length,r=t/2;if(t%2)throw Error("padded hex string expected, got unpadded hex of length "+t);let i=new Uint8Array(r);for(let t=0,n=0;t<r;t++,n+=2){let r=a(e.charCodeAt(n)),s=a(e.charCodeAt(n+1));if(void 0===r||void 0===s)throw Error('hex string expected, got non-hex character "'+(e[n]+e[n+1])+'" at index '+n);i[t]=16*r+s}return i},r.nextTick=async()=>{},r.asyncLoop=o,r.utf8ToBytes=l,r.toBytes=c,r.concatBytes=function(...e){let t=0;for(let r=0;r<e.length;r++){let i=e[r];(0,n.bytes)(i),t+=i.length}let r=new Uint8Array(t);for(let t=0,i=0;t<e.length;t++){let n=e[t];r.set(n,i),i+=n.length}return r},r.Hash=class{clone(){return this._cloneInto()}};let d={}.toString;r.checkOpts=function(e,t){if(void 0!==t&&"[object Object]"!==d.call(t))throw Error("Options should be object or undefined");return Object.assign(e,t)},r.wrapConstructor=function(e){let t=t=>e().update(c(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t},r.wrapConstructorWithOpts=function(e){let t=(t,r)=>e(r).update(c(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t},r.wrapXOFConstructorWithOpts=function(e){let t=(t,r)=>e(r).update(c(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t},r.randomBytes=function(e=32){if(i.crypto&&"function"==typeof i.crypto.getRandomValues)return i.crypto.getRandomValues(new Uint8Array(e));throw Error("crypto.getRandomValues must be defined")}},13959,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shake256=r.shake128=r.keccak_512=r.keccak_384=r.keccak_256=r.keccak_224=r.sha3_512=r.sha3_384=r.sha3_256=r.sha3_224=r.Keccak=r.keccakP=void 0;let i=e.r(174429),n=e.r(635138),s=e.r(857024),a=[],o=[],l=[],c=BigInt(0),d=BigInt(1),u=BigInt(2),h=BigInt(7),p=BigInt(256),f=BigInt(113);for(let e=0,t=d,r=1,i=0;e<24;e++){[r,i]=[i,(2*r+3*i)%5],a.push(2*(5*i+r)),o.push((e+1)*(e+2)/2%64);let n=c;for(let e=0;e<7;e++)(t=(t<<d^(t>>h)*f)%p)&u&&(n^=d<<(d<<BigInt(e))-d);l.push(n)}let[y,g]=(0,n.split)(l,!0),m=(e,t,r)=>r>32?(0,n.rotlBH)(e,t,r):(0,n.rotlSH)(e,t,r),w=(e,t,r)=>r>32?(0,n.rotlBL)(e,t,r):(0,n.rotlSL)(e,t,r);function b(e,t=24){let r=new Uint32Array(10);for(let i=24-t;i<24;i++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){let i=(t+8)%10,n=(t+2)%10,s=r[n],a=r[n+1],o=m(s,a,1)^r[i],l=w(s,a,1)^r[i+1];for(let r=0;r<50;r+=10)e[t+r]^=o,e[t+r+1]^=l}let t=e[2],n=e[3];for(let r=0;r<24;r++){let i=o[r],s=m(t,n,i),l=w(t,n,i),c=a[r];t=e[c],n=e[c+1],e[c]=s,e[c+1]=l}for(let t=0;t<50;t+=10){for(let i=0;i<10;i++)r[i]=e[t+i];for(let i=0;i<10;i++)e[t+i]^=~r[(i+2)%10]&r[(i+4)%10]}e[0]^=y[i],e[1]^=g[i]}r.fill(0)}r.keccakP=b;class v extends s.Hash{constructor(e,t,r,n=!1,a=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=n,this.rounds=a,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,(0,i.number)(r),0>=this.blockLen||this.blockLen>=200)throw Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=(0,s.u32)(this.state)}keccak(){s.isLE||(0,s.byteSwap32)(this.state32),b(this.state32,this.rounds),s.isLE||(0,s.byteSwap32)(this.state32),this.posOut=0,this.pos=0}update(e){(0,i.exists)(this);let{blockLen:t,state:r}=this,n=(e=(0,s.toBytes)(e)).length;for(let i=0;i<n;){let s=Math.min(t-this.pos,n-i);for(let t=0;t<s;t++)r[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:r,blockLen:i}=this;e[r]^=t,(128&t)!=0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){(0,i.exists)(this,!1),(0,i.bytes)(e),this.finish();let t=this.state,{blockLen:r}=this;for(let i=0,n=e.length;i<n;){this.posOut>=r&&this.keccak();let s=Math.min(r-this.posOut,n-i);e.set(t.subarray(this.posOut,this.posOut+s),i),this.posOut+=s,i+=s}return e}xofInto(e){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return(0,i.number)(e),this.xofInto(new Uint8Array(e))}digestInto(e){if((0,i.output)(e,this),this.finished)throw Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){let{blockLen:t,suffix:r,outputLen:i,rounds:n,enableXOF:s}=this;return e||(e=new v(t,r,i,s,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=i,e.enableXOF=s,e.destroyed=this.destroyed,e}}r.Keccak=v;let E=(e,t,r)=>(0,s.wrapConstructor)(()=>new v(t,e,r));r.sha3_224=E(6,144,28),r.sha3_256=E(6,136,32),r.sha3_384=E(6,104,48),r.sha3_512=E(6,72,64),r.keccak_224=E(1,144,28),r.keccak_256=E(1,136,32),r.keccak_384=E(1,104,48),r.keccak_512=E(1,72,64);let _=(e,t,r)=>(0,s.wrapXOFConstructorWithOpts)((i={})=>new v(t,e,void 0===i.dkLen?r:i.dkLen,!0));r.shake128=_(31,168,16),r.shake256=_(31,136,32)},321629,(e,t,r)=>{var i=e.i(467034);let{keccak_256:n}=e.r(13959);function s(e){return i.Buffer.allocUnsafe(e).fill(0)}function a(e,t){let r=e.toString(16);r.length%2!=0&&(r="0"+r);let n=r.match(/.{1,2}/g).map(e=>parseInt(e,16));for(;n.length<t;)n.unshift(0);return i.Buffer.from(n)}function o(e,t,r){let i=s(t);return(e=l(e),r)?e.length<t?(e.copy(i),i):e.slice(0,t):e.length<t?(e.copy(i,t-e.length),i):e.slice(-t)}function l(e){if(!i.Buffer.isBuffer(e))if(Array.isArray(e))e=i.Buffer.from(e);else if("string"==typeof e){var t;e=c(e)?i.Buffer.from((t=d(e)).length%2?"0"+t:t,"hex"):i.Buffer.from(e)}else if("number"==typeof e)e=intToBuffer(e);else if(null==e)e=i.Buffer.allocUnsafe(0);else if("bigint"==typeof e)e=a(e);else if(e.toArray)e=i.Buffer.from(e.toArray());else throw Error("invalid type");return e}function c(e){return"string"==typeof e&&e.match(/^0x[0-9A-Fa-f]*$/)}function d(e){return"string"==typeof e&&e.startsWith("0x")?e.slice(2):e}t.exports={zeros:s,setLength:o,setLengthRight:function(e,t){return o(e,t,!0)},isHexString:c,stripHexPrefix:d,toBuffer:l,bufferToHex:function(e){return"0x"+(e=l(e)).toString("hex")},keccak:function(e,t){if(e=l(e),t||(t=256),256!==t)throw Error("unsupported");return i.Buffer.from(n(new Uint8Array(e)))},bitLengthFromBigInt:function(e){return e.toString(2).length},bufferBEFromBigInt:a,twosFromBigInt:function(e,t){return(e<0n?(~e&(1n<<BigInt(t))-1n)+1n:e)&(1n<<BigInt(t))-1n}}},132144,(e,t,r)=>{var i=e.i(467034);let n=e.r(321629);function s(e){if(e.startsWith("int["))return"int256"+e.slice(3);if("int"===e)return"int256";if(e.startsWith("uint["))return"uint256"+e.slice(4);if("uint"===e)return"uint256";if(e.startsWith("fixed["))return"fixed128x128"+e.slice(5);else if("fixed"===e)return"fixed128x128";else if(e.startsWith("ufixed["))return"ufixed128x128"+e.slice(6);else if("ufixed"===e)return"ufixed128x128";return e}function a(e){return Number.parseInt(/^\D+(\d+)$/.exec(e)[1],10)}function o(e){var t=/^\D+(\d+)x(\d+)$/.exec(e);return[Number.parseInt(t[1],10),Number.parseInt(t[2],10)]}function l(e){var t=e.match(/(.*)\[(.*?)\]$/);return t?""===t[2]?"dynamic":Number.parseInt(t[2],10):null}function c(e){var t=typeof e;if("string"===t||"number"===t)return BigInt(e);if("bigint"===t)return e;throw Error("Argument is not a number")}function d(e,t){if("address"===e)return d("uint160",c(t));if("bool"===e)return d("uint8",+!!t);if("string"===e)return d("bytes",new i.Buffer(t,"utf8"));if((p=e).lastIndexOf("]")===p.length-1){if(void 0===t.length)throw Error("Not an array?");if("dynamic"!==(r=l(e))&&0!==r&&t.length>r)throw Error("Elements exceed array size: "+r);for(h in u=[],e=e.slice(0,e.lastIndexOf("[")),"string"==typeof t&&(t=JSON.parse(t)),t)u.push(d(e,t[h]));if("dynamic"===r){var r,s,u,h,p,f=d("uint256",t.length);u.unshift(f)}return i.Buffer.concat(u)}else if("bytes"===e)return t=new i.Buffer(t),u=i.Buffer.concat([d("uint256",t.length),t]),t.length%32!=0&&(u=i.Buffer.concat([u,n.zeros(32-t.length%32)])),u;else if(e.startsWith("bytes")){if((r=a(e))<1||r>32)throw Error("Invalid bytes<N> width: "+r);return n.setLengthRight(t,32)}else if(e.startsWith("uint")){if((r=a(e))%8||r<8||r>256)throw Error("Invalid uint<N> width: "+r);s=c(t);let i=n.bitLengthFromBigInt(s);if(i>r)throw Error("Supplied uint exceeds width: "+r+" vs "+i);if(s<0)throw Error("Supplied uint is negative");return n.bufferBEFromBigInt(s,32)}else if(e.startsWith("int")){if((r=a(e))%8||r<8||r>256)throw Error("Invalid int<N> width: "+r);s=c(t);let i=n.bitLengthFromBigInt(s);if(i>r)throw Error("Supplied int exceeds width: "+r+" vs "+i);let o=n.twosFromBigInt(s,256);return n.bufferBEFromBigInt(o,32)}else if(e.startsWith("ufixed")){if(r=o(e),(s=c(t))<0)throw Error("Supplied ufixed is negative");return d("uint256",s*BigInt(2)**BigInt(r[1]))}else if(e.startsWith("fixed"))return r=o(e),d("int256",c(t)*BigInt(2)**BigInt(r[1]));throw Error("Unsupported or invalid type: "+e)}function u(e,t){if(e.length!==t.length)throw Error("Number of types are not matching the values");for(var r,o,l=[],d=0;d<e.length;d++){var u=s(e[d]),h=t[d];if("bytes"===u)l.push(h);else if("string"===u)l.push(new i.Buffer(h,"utf8"));else if("bool"===u)l.push(new i.Buffer(h?"01":"00","hex"));else if("address"===u)l.push(n.setLength(h,20));else if(u.startsWith("bytes")){if((r=a(u))<1||r>32)throw Error("Invalid bytes<N> width: "+r);l.push(n.setLengthRight(h,r))}else if(u.startsWith("uint")){if((r=a(u))%8||r<8||r>256)throw Error("Invalid uint<N> width: "+r);o=c(h);let e=n.bitLengthFromBigInt(o);if(e>r)throw Error("Supplied uint exceeds width: "+r+" vs "+e);l.push(n.bufferBEFromBigInt(o,r/8))}else if(u.startsWith("int")){if((r=a(u))%8||r<8||r>256)throw Error("Invalid int<N> width: "+r);o=c(h);let e=n.bitLengthFromBigInt(o);if(e>r)throw Error("Supplied int exceeds width: "+r+" vs "+e);let t=n.twosFromBigInt(o,r);l.push(n.bufferBEFromBigInt(t,r/8))}else throw Error("Unsupported or invalid type: "+u)}return i.Buffer.concat(l)}t.exports={rawEncode:function(e,t){var r=[],n=[],a=32*e.length;for(var o in e){var c=s(e[o]),u=d(c,t[o]);"string"===c||"bytes"===c||"dynamic"===l(c)?(r.push(d("uint256",a)),n.push(u),a+=u.length):r.push(u)}return i.Buffer.concat(r.concat(n))},solidityPack:u,soliditySHA3:function(e,t){return n.keccak(u(e,t))}}},980423,(e,t,r)=>{var i=e.i(467034);let n=e.r(321629),s=e.r(132144),a={type:"object",properties:{types:{type:"object",additionalProperties:{type:"array",items:{type:"object",properties:{name:{type:"string"},type:{type:"string"}},required:["name","type"]}}},primaryType:{type:"string"},domain:{type:"object"},message:{type:"object"}},required:["types","primaryType","domain","message"]},o={encodeData(e,t,r,a=!0){let o=["bytes32"],l=[this.hashType(e,r)];if(a){let c=(e,t,o)=>{if(void 0!==r[t])return["bytes32",null==o?"0x0000000000000000000000000000000000000000000000000000000000000000":n.keccak(this.encodeData(t,o,r,a))];if(void 0===o)throw Error(`missing value for field ${e} of type ${t}`);if("bytes"===t)return["bytes32",n.keccak(o)];if("string"===t)return"string"==typeof o&&(o=i.Buffer.from(o,"utf8")),["bytes32",n.keccak(o)];if(t.lastIndexOf("]")===t.length-1){let r=t.slice(0,t.lastIndexOf("[")),i=o.map(t=>c(e,r,t));return["bytes32",n.keccak(s.rawEncode(i.map(([e])=>e),i.map(([,e])=>e)))]}return[t,o]};for(let i of r[e]){let[e,r]=c(i.name,i.type,t[i.name]);o.push(e),l.push(r)}}else for(let s of r[e]){let e=t[s.name];if(void 0!==e)if("bytes"===s.type)o.push("bytes32"),e=n.keccak(e),l.push(e);else if("string"===s.type)o.push("bytes32"),"string"==typeof e&&(e=i.Buffer.from(e,"utf8")),e=n.keccak(e),l.push(e);else if(void 0!==r[s.type])o.push("bytes32"),e=n.keccak(this.encodeData(s.type,e,r,a)),l.push(e);else if(s.type.lastIndexOf("]")===s.type.length-1)throw Error("Arrays currently unimplemented in encodeData");else o.push(s.type),l.push(e)}return s.rawEncode(o,l)},encodeType(e,t){let r="",i=this.findTypeDependencies(e,t).filter(t=>t!==e);for(let n of i=[e].concat(i.sort())){if(!t[n])throw Error("No type definition specified: "+n);r+=n+"("+t[n].map(({name:e,type:t})=>t+" "+e).join(",")+")"}return r},findTypeDependencies(e,t,r=[]){if(e=e.match(/^\w*/)[0],r.includes(e)||void 0===t[e])return r;for(let i of(r.push(e),t[e]))for(let e of this.findTypeDependencies(i.type,t,r))r.includes(e)||r.push(e);return r},hashStruct(e,t,r,i=!0){return n.keccak(this.encodeData(e,t,r,i))},hashType(e,t){return n.keccak(this.encodeType(e,t))},sanitizeData(e){let t={};for(let r in a.properties)e[r]&&(t[r]=e[r]);return t.types&&(t.types=Object.assign({EIP712Domain:[]},t.types)),t},hash(e,t=!0){let r=this.sanitizeData(e),s=[i.Buffer.from("1901","hex")];return s.push(this.hashStruct("EIP712Domain",r.domain,r.types,t)),"EIP712Domain"!==r.primaryType&&s.push(this.hashStruct(r.primaryType,r.message,r.types,t)),n.keccak(i.Buffer.concat(s))}};t.exports={TYPED_MESSAGE_SCHEMA:a,TypedDataUtils:o,hashForSignTypedDataLegacy:function(e){return function(e){let t=Error("Expect argument to be non-empty array");if("object"!=typeof e||!e.length)throw t;let r=e.map(function(e){return"bytes"===e.type?n.toBuffer(e.value):e.value}),i=e.map(function(e){return e.type}),a=e.map(function(e){if(!e.name)throw t;return e.type+" "+e.name});return s.soliditySHA3(["bytes32","bytes32"],[s.soliditySHA3(Array(e.length).fill("string"),a),s.soliditySHA3(i,r)])}(e.data)},hashForSignTypedData_v3:function(e){return o.hash(e.data,!1)},hashForSignTypedData_v4:function(e){return o.hash(e.data)}}},927509,(e,t,r)=>{"use strict";var i=Object.prototype.hasOwnProperty,n="~";function s(){}function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,i,s){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new a(r,i||e,s),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function c(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(n=!1)),c.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)i.call(e,t)&&r.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},c.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,a=Array(s);i<s;i++)a[i]=r[i].fn;return a},c.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},c.prototype.emit=function(e,t,r,i,s,a){var o=n?n+e:e;if(!this._events[o])return!1;var l,c,d=this._events[o],u=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,r),!0;case 4:return d.fn.call(d.context,t,r,i),!0;case 5:return d.fn.call(d.context,t,r,i,s),!0;case 6:return d.fn.call(d.context,t,r,i,s,a),!0}for(c=1,l=Array(u-1);c<u;c++)l[c-1]=arguments[c];d.fn.apply(d.context,l)}else{var h,p=d.length;for(c=0;c<p;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),u){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,r);break;case 4:d[c].fn.call(d[c].context,t,r,i);break;default:if(!l)for(h=1,l=Array(u-1);h<u;h++)l[h-1]=arguments[h];d[c].fn.apply(d[c].context,l)}}return!0},c.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},c.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},c.prototype.removeListener=function(e,t,r,i){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return l(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||l(this,s);else{for(var o=0,c=[],d=a.length;o<d;o++)(a[o].fn!==t||i&&!a[o].once||r&&a[o].context!==r)&&c.push(a[o]);c.length?this._events[s]=1===c.length?c[0]:c:l(this,s)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&l(this,t)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,t.exports=c},614595,(e,t,r)=>{"use strict";var i=e.r(271645),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=i.useSyncExternalStore,a=i.useRef,o=i.useEffect,l=i.useMemo,c=i.useDebugValue;r.useSyncExternalStoreWithSelector=function(e,t,r,i,d){var u=a(null);if(null===u.current){var h={hasValue:!1,value:null};u.current=h}else h=u.current;var p=s(e,(u=l(function(){function e(e){if(!o){if(o=!0,s=e,e=i(e),void 0!==d&&h.hasValue){var t=h.value;if(d(t,e))return a=t}return a=e}if(t=a,n(s,e))return t;var r=i(e);return void 0!==d&&d(t,r)?(s=e,t):(s=e,a=r)}var s,a,o=!1,l=void 0===r?null:r;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]},[t,r,i,d]))[0],u[1]);return o(function(){h.hasValue=!0,h.value=p},[p]),c(p),p}},313027,(e,t,r)=>{"use strict";t.exports=e.r(614595)},102232,(e,t,r)=>{"use strict";let i=e.r(71187);t.exports=d;let n=function(){function e(e){return void 0!==e&&e}try{if("undefined"!=typeof globalThis)return globalThis;return Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch(t){return e(self)||e(window)||e(this)||{}}}().console||{};function s(e,t){return"silent"===e?1/0:t.levels.values[e]}let a=Symbol("pino.logFuncs"),o=Symbol("pino.hierarchy"),l={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function c(e,t){let r={logger:t,parent:e[o]};t[o]=r}function d(e){var t,r,i;let o,f,y;(e=e||{}).browser=e.browser||{};let g=e.browser.transmit;if(g&&"function"!=typeof g.send)throw Error("pino: transmit option must have a send function");let v=e.browser.write||n;e.browser.write&&(e.browser.asObject=!0);let E=e.serializers||{},_=(t=e.browser.serialize,Array.isArray(t)?t.filter(function(e){return"!stdSerializers.err"!==e}):!0===t&&Object.keys(E)),A=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(A=!1);let S=Object.keys(e.customLevels||{}),x=["error","fatal","warn","info","debug","trace"].concat(S);"function"==typeof v&&x.forEach(function(e){v[e]=v}),(!1===e.enabled||e.browser.disabled)&&(e.level="silent");let I=e.level||"info",k=Object.create(v);k.log||(k.log=m),o={},x.forEach(e=>{o[e]=v[e]?v[e]:n[e]||n[l[e]||"log"]||m}),k[a]=o,c({},k),Object.defineProperty(k,"levelVal",{get:function(){return s(this.level,this)}}),Object.defineProperty(k,"level",{get:function(){return this._level},set:function(e){if("silent"!==e&&!this.levels.values[e])throw Error("unknown level "+e);this._level=e,u(this,T,k,"error"),u(this,T,k,"fatal"),u(this,T,k,"warn"),u(this,T,k,"info"),u(this,T,k,"debug"),u(this,T,k,"trace"),S.forEach(e=>{u(this,T,k,e)})}});let T={transmit:g,serialize:_,asObject:e.browser.asObject,asObjectBindingsOnly:e.browser.asObjectBindingsOnly,formatters:e.browser.formatters,levels:x,timestamp:"function"==typeof(r=e).timestamp?r.timestamp:!1===r.timestamp?w:b,messageKey:e.messageKey||"msg",onChild:e.onChild||m};function C(t,r,i){if(!r)throw Error("missing bindings for child Pino");i=i||{},_&&r.serializers&&(i.serializers=r.serializers);let n=i.serializers;if(_&&n){var s=Object.assign({},E,n),a=!0===e.browser.serialize?Object.keys(s):_;delete r.serializers,h([r],a,s,this._stdErrSerialize)}function o(e){this._childLevel=(0|e._childLevel)+1,this.bindings=r,s&&(this.serializers=s,this._serialize=a),g&&(this._logEvent=p([].concat(e._logEvent.bindings,r)))}o.prototype=this;let l=new o(this);return c(this,l),l.child=function(...e){return C.call(this,t,...e)},l.level=i.level||this.level,t.onChild(l),l}return f=e.customLevels||{},k.levels={values:Object.assign({},d.levels.values,f),labels:Object.assign({},d.levels.labels,(y={},Object.keys(i=f).forEach(function(e){y[i[e]]=e}),y))},k.level=I,k.isLevelEnabled=function(e){return!!this.levels.values[e]&&this.levels.values[e]>=this.levels.values[this.level]},k.setMaxListeners=k.getMaxListeners=k.emit=k.addListener=k.on=k.prependListener=k.once=k.prependOnceListener=k.removeListener=k.removeAllListeners=k.listeners=k.listenerCount=k.eventNames=k.write=k.flush=m,k.serializers=E,k._serialize=_,k._stdErrSerialize=A,k.child=function(...e){return C.call(this,T,...e)},g&&(k._logEvent=p()),k}function u(e,t,r,l){var c,d,u,f,y,g,w;if(Object.defineProperty(e,l,{value:s(e.level,r)>s(l,r)?m:r[a][l],writable:!0,enumerable:!0,configurable:!0}),e[l]===m){if(!t.transmit)return;let i=s(t.transmit.level||e.level,r);if(s(l,r)<i)return}e[l]=(c=e,d=t,u=r,f=l,y=c[a][f],function(){let e=d.timestamp(),t=Array(arguments.length),r=Object.getPrototypeOf&&Object.getPrototypeOf(this)===n?n:this;for(var a=0;a<t.length;a++)t[a]=arguments[a];var o=!1;if(d.serialize&&(h(t,this._serialize,this.serializers,this._stdErrSerialize),o=!0),d.asObject||d.formatters?y.call(r,...function(e,t,r,n,s){let{level:a,log:o=e=>e}=s.formatters||{},l=r.slice(),c=l[0],d={},u=(0|e._childLevel)+1;if(u<1&&(u=1),n&&(d.time=n),a?Object.assign(d,a(t,e.levels.values[t])):d.level=e.levels.values[t],s.asObjectBindingsOnly){if(null!==c&&"object"==typeof c)for(;u--&&"object"==typeof l[0];)Object.assign(d,l.shift());return[o(d),...l]}if(null!==c&&"object"==typeof c){for(;u--&&"object"==typeof l[0];)Object.assign(d,l.shift());c=l.length?i(l.shift(),l):void 0}else"string"==typeof c&&(c=i(l.shift(),l));return void 0!==c&&(d[s.messageKey]=c),[o(d)]}(this,f,t,e,d)):y.apply(r,t),d.transmit){let r=d.transmit.level||c._level,i=s(r,u),n=s(f,u);if(n<i)return;!function(e,t,r,i=!1){let n=t.send,s=t.ts,a=t.methodLevel,o=t.methodValue,l=t.val,c=e._logEvent.bindings;i||h(r,e._serialize||Object.keys(e.serializers),e.serializers,void 0===e._stdErrSerialize||e._stdErrSerialize),e._logEvent.ts=s,e._logEvent.messages=r.filter(function(e){return -1===c.indexOf(e)}),e._logEvent.level.label=a,e._logEvent.level.value=o,n(a,e._logEvent,l),e._logEvent=p(c)}(this,{ts:e,methodLevel:f,methodValue:n,transmitLevel:r,transmitValue:u.levels.values[d.transmit.level||c._level],send:d.transmit.send,val:s(c._level,u)},t,o)}});let b=function(e){let t=[];e.bindings&&t.push(e.bindings);let r=e[o];for(;r.parent;)(r=r.parent).logger.bindings&&t.push(r.logger.bindings);return t.reverse()}(e);0!==b.length&&(e[l]=(g=b,w=e[l],function(){return w.apply(this,[...g,...arguments])}))}function h(e,t,r,i){for(let n in e)if(i&&e[n]instanceof Error)e[n]=d.stdSerializers.err(e[n]);else if("object"==typeof e[n]&&!Array.isArray(e[n])&&t)for(let i in e[n])t.indexOf(i)>-1&&i in r&&(e[n][i]=r[i](e[n][i]))}function p(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function f(e){let t={type:e.constructor.name,msg:e.message,stack:e.stack};for(let r in e)void 0===t[r]&&(t[r]=e[r]);return t}function y(){return{}}function g(e){return e}function m(){}function w(){return!1}function b(){return Date.now()}d.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},d.stdSerializers={mapHttpRequest:y,mapHttpResponse:y,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:y,res:y,err:f,errWithCause:f},d.stdTimeFunctions=Object.assign({},{nullTime:w,epochTime:b,unixTime:function(){return Math.round(Date.now()/1e3)},isoTime:function(){return new Date(Date.now()).toISOString()}}),t.exports.default=d,t.exports.pino=d},968399,902737,544508,746725,835696,914189,294316,83733,233137,397701,700020,998348,825720,341650,140407,402155,684653,813581,877891,652265,22357,952744,605083,101852,255743,601893,35889,526599,635307,610760,e=>{"use strict";let t,r,i,n,s,a,o,l,c,d,u,h,p,f,y,g,m,w,b,v,E,_,A,S,x,I,k,T,C,P,O,R,N,M,U,D,L,j,B,W;var F=e.i(843476),H=e.i(271645),q=e.i(902910),z=e.i(877225),$=e.i(771567);e.i(63398),e.i(944406),e.i(31557),e.i(733821);var K=e.i(422233),V=e.i(33867),J=e.i(840796);e.s([],964092),e.i(964092);var Z=e.i(194820),G=e.i(932763),Y=e.i(654544);let Q=Y.default.getRandomValues.bind(Y.default);function X(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new V.JOSENotSupported(`Unsupported JWE Algorithm: ${e}`)}}let ee=e=>Q(new Uint8Array(X(e)>>3)),et=(e,t)=>{if(t.length<<3!==X(e))throw new V.JWEInvalid("Invalid Initialization Vector length")},er=(e,t)=>{let r=e.byteLength<<3;if(r!==t)throw new V.JWEInvalid(`Invalid Content Encryption Key length. Expected ${t} bits, got ${r} bits`)};function ei(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function en(e,t){return e.name===t}function es(e){return parseInt(e.name.slice(4),10)}function ea(e,t){if(t.length&&!t.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){let r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw TypeError(e)}}function eo(e,t,...r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!en(e.algorithm,"AES-GCM"))throw ei("AES-GCM");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw ei(r,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!en(e.algorithm,"AES-KW"))throw ei("AES-KW");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw ei(r,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw ei("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!en(e.algorithm,"PBKDF2"))throw ei("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!en(e.algorithm,"RSA-OAEP"))throw ei("RSA-OAEP");let r=parseInt(t.slice(9),10)||1;if(es(e.algorithm.hash)!==r)throw ei(`SHA-${r}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}ea(e,r)}function el(e,t,...r){if(r.length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor&&t.constructor.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let ec=(e,...t)=>el("Key must be ",e,...t);function ed(e,t,...r){return el(`Key for the ${e} algorithm must be `,t,...r)}let eu=e=>(0,Y.isCryptoKey)(e),eh=["CryptoKey"];async function ep(e,t,r,i,n,s){let a,o;if(!(t instanceof Uint8Array))throw TypeError(ec(t,"Uint8Array"));let l=parseInt(e.slice(1,4),10),c=await Y.default.subtle.importKey("raw",t.subarray(l>>3),"AES-CBC",!1,["decrypt"]),d=await Y.default.subtle.importKey("raw",t.subarray(0,l>>3),{hash:`SHA-${l<<1}`,name:"HMAC"},!1,["sign"]),u=(0,G.concat)(s,i,r,(0,G.uint64be)(s.length<<3)),h=new Uint8Array((await Y.default.subtle.sign("HMAC",d,u)).slice(0,l>>3));try{a=((e,t)=>{if(!(e instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw TypeError("Second argument must be a buffer");if(e.length!==t.length)throw TypeError("Input buffers must have the same length");let r=e.length,i=0,n=-1;for(;++n<r;)i|=e[n]^t[n];return 0===i})(n,h)}catch(e){}if(!a)throw new V.JWEDecryptionFailed;try{o=new Uint8Array(await Y.default.subtle.decrypt({iv:i,name:"AES-CBC"},c,r))}catch(e){}if(!o)throw new V.JWEDecryptionFailed;return o}async function ef(e,t,r,i,n,s){let a;t instanceof Uint8Array?a=await Y.default.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt"]):(eo(t,e,"decrypt"),a=t);try{return new Uint8Array(await Y.default.subtle.decrypt({additionalData:s,iv:i,name:"AES-GCM",tagLength:128},a,(0,G.concat)(r,n)))}catch(e){throw new V.JWEDecryptionFailed}}let ey=async(e,t,r,i,n,s)=>{if(!(0,Y.isCryptoKey)(t)&&!(t instanceof Uint8Array))throw TypeError(ec(t,...eh,"Uint8Array"));switch(et(e,i),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&er(t,parseInt(e.slice(-3),10)),ep(e,t,r,i,n,s);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&er(t,parseInt(e.slice(1,4),10)),ef(e,t,r,i,n,s);default:throw new V.JOSENotSupported("Unsupported JWE Content Encryption Algorithm")}},eg=async()=>{throw new V.JOSENotSupported('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `inflateRaw` decrypt option to provide Inflate Raw implementation.')},em=async()=>{throw new V.JOSENotSupported('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `deflateRaw` encrypt option to provide Deflate Raw implementation.')},ew=(...e)=>{let t,r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0};var eb=e.i(763162);let ev=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]];function eE(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${t}`)}function e_(e,t,r){if((0,Y.isCryptoKey)(e))return eo(e,t,r),e;if(e instanceof Uint8Array)return Y.default.subtle.importKey("raw",e,"AES-KW",!0,[r]);throw TypeError(ec(e,...eh,"Uint8Array"))}let eA=async(e,t,r)=>{let i=await e_(t,e,"wrapKey");eE(i,e);let n=await Y.default.subtle.importKey("raw",r,...ev);return new Uint8Array(await Y.default.subtle.wrapKey("raw",n,i,"AES-KW"))},eS=async(e,t,r)=>{let i=await e_(t,e,"unwrapKey");eE(i,e);let n=await Y.default.subtle.unwrapKey("raw",r,i,"AES-KW",...ev);return new Uint8Array(await Y.default.subtle.exportKey("raw",n))};async function ex(e,t,r,i,n=new Uint8Array(0),s=new Uint8Array(0)){let a;if(!(0,Y.isCryptoKey)(e))throw TypeError(ec(e,...eh));if(eo(e,"ECDH"),!(0,Y.isCryptoKey)(t))throw TypeError(ec(t,...eh));eo(t,"ECDH","deriveBits");let o=(0,G.concat)((0,G.lengthAndInput)(G.encoder.encode(r)),(0,G.lengthAndInput)(n),(0,G.lengthAndInput)(s),(0,G.uint32be)(i));a="X25519"===e.algorithm.name?256:"X448"===e.algorithm.name?448:Math.ceil(parseInt(e.algorithm.namedCurve.substr(-3),10)/8)<<3;let l=new Uint8Array(await Y.default.subtle.deriveBits({name:e.algorithm.name,public:e},t,a));return(0,G.concatKdf)(l,i,o)}async function eI(e){if(!(0,Y.isCryptoKey)(e))throw TypeError(ec(e,...eh));return Y.default.subtle.generateKey(e.algorithm,!0,["deriveBits"])}function ek(e){if(!(0,Y.isCryptoKey)(e))throw TypeError(ec(e,...eh));return["P-256","P-384","P-521"].includes(e.algorithm.namedCurve)||"X25519"===e.algorithm.name||"X448"===e.algorithm.name}async function eT(e,t,r,i){if(!(e instanceof Uint8Array)||e.length<8)throw new V.JWEInvalid("PBES2 Salt Input must be 8 or more octets");let n=(0,G.p2s)(t,e),s=parseInt(t.slice(13,16),10),a={hash:`SHA-${t.slice(8,11)}`,iterations:r,name:"PBKDF2",salt:n},o=await function(e,t){if(e instanceof Uint8Array)return Y.default.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits"]);if((0,Y.isCryptoKey)(e))return eo(e,t,"deriveBits","deriveKey"),e;throw TypeError(ec(e,...eh,"Uint8Array"))}(i,t);if(o.usages.includes("deriveBits"))return new Uint8Array(await Y.default.subtle.deriveBits(a,o,s));if(o.usages.includes("deriveKey"))return Y.default.subtle.deriveKey(a,o,{length:s,name:"AES-KW"},!1,["wrapKey","unwrapKey"]);throw TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')}let eC=async(e,t,r,i=2048,n=Q(new Uint8Array(16)))=>{let s=await eT(n,e,i,t);return{encryptedKey:await eA(e.slice(-6),s,r),p2c:i,p2s:(0,Z.encode)(n)}},eP=async(e,t,r,i,n)=>{let s=await eT(n,e,i,t);return eS(e.slice(-6),s,r)};function eO(e){switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new V.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}let eR=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}},eN=async(e,t,r)=>{if(!(0,Y.isCryptoKey)(t))throw TypeError(ec(t,...eh));if(eo(t,e,"encrypt","wrapKey"),eR(e,t),t.usages.includes("encrypt"))return new Uint8Array(await Y.default.subtle.encrypt(eO(e),t,r));if(t.usages.includes("wrapKey")){let i=await Y.default.subtle.importKey("raw",r,...ev);return new Uint8Array(await Y.default.subtle.wrapKey("raw",i,t,eO(e)))}throw TypeError('RSA-OAEP key "usages" must include "encrypt" or "wrapKey" for this operation')},eM=async(e,t,r)=>{if(!(0,Y.isCryptoKey)(t))throw TypeError(ec(t,...eh));if(eo(t,e,"decrypt","unwrapKey"),eR(e,t),t.usages.includes("decrypt"))return new Uint8Array(await Y.default.subtle.decrypt(eO(e),t,r));if(t.usages.includes("unwrapKey")){let i=await Y.default.subtle.unwrapKey("raw",r,t,eO(e),...ev);return new Uint8Array(await Y.default.subtle.exportKey("raw",i))}throw TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')};function eU(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new V.JOSENotSupported(`Unsupported JWE Algorithm: ${e}`)}}let eD=e=>Q(new Uint8Array(eU(e)>>3)),eL=(e,t)=>{let r=(e.match(/.{1,64}/g)||[]).join("\n");return`-----BEGIN ${t}-----
${r}
-----END ${t}-----`},ej=async(e,t,r)=>{if(!(0,Y.isCryptoKey)(r))throw TypeError(ec(r,...eh));if(!r.extractable)throw TypeError("CryptoKey is not extractable");if(r.type!==e)throw TypeError(`key is not a ${e} key`);return eL((0,Z.encodeBase64)(new Uint8Array(await Y.default.subtle.exportKey(t,r))),`${e.toUpperCase()} KEY`)},eB=(e,t,r=0)=>{0===r&&(t.unshift(t.length),t.unshift(6));let i=e.indexOf(t[0],r);if(-1===i)return!1;let n=e.subarray(i,i+t.length);return n.length===t.length&&(n.every((e,r)=>e===t[r])||eB(e,t,i+1))},eW=e=>{switch(!0){case eB(e,[42,134,72,206,61,3,1,7]):return"P-256";case eB(e,[43,129,4,0,34]):return"P-384";case eB(e,[43,129,4,0,35]):return"P-521";case eB(e,[43,101,110]):return"X25519";case eB(e,[43,101,111]):return"X448";case eB(e,[43,101,112]):return"Ed25519";case eB(e,[43,101,113]):return"Ed448";default:throw new V.JOSENotSupported("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},eF=async(e,t,r,i,n)=>{var s;let a,o,l=new Uint8Array(atob(r.replace(e,"")).split("").map(e=>e.charCodeAt(0))),c="spki"===t;switch(i){case"PS256":case"PS384":case"PS512":a={name:"RSA-PSS",hash:`SHA-${i.slice(-3)}`},o=c?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":a={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${i.slice(-3)}`},o=c?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":a={name:"RSA-OAEP",hash:`SHA-${parseInt(i.slice(-3),10)||1}`},o=c?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":a={name:"ECDSA",namedCurve:"P-256"},o=c?["verify"]:["sign"];break;case"ES384":a={name:"ECDSA",namedCurve:"P-384"},o=c?["verify"]:["sign"];break;case"ES512":a={name:"ECDSA",namedCurve:"P-521"},o=c?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let e=eW(l);a=e.startsWith("P-")?{name:"ECDH",namedCurve:e}:{name:e},o=c?[]:["deriveBits"];break}case"EdDSA":a={name:eW(l)},o=c?["verify"]:["sign"];break;default:throw new V.JOSENotSupported('Invalid or unsupported "alg" (Algorithm) value')}return Y.default.subtle.importKey(t,l,a,null!=(s=null==n?void 0:n.extractable)&&s,o)};function eH(e){let t=[],r=0;for(;r<e.length;){let i=eq(e.subarray(r));t.push(i),r+=i.byteLength}return t}function eq(e){let t=0,r=31&e[0];if(t++,31===r){for(r=0;e[t]>=128;)r=128*r+e[t]-128,t++;r=128*r+e[t]-128,t++}let i=0;if(e[t]<128)i=e[t],t++;else if(128===i){for(i=0;0!==e[t+i]||0!==e[t+i+1];){if(i>e.byteLength)throw TypeError("invalid indefinite form length");i++}let r=t+i+2;return{byteLength:r,contents:e.subarray(t,t+i),raw:e.subarray(0,r)}}else{let r=127&e[t];t++,i=0;for(let n=0;n<r;n++)i=256*i+e[t],t++}let n=t+i;return{byteLength:n,contents:e.subarray(t,n),raw:e.subarray(0,n)}}let ez=async e=>{var t,r;if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:i,keyUsages:n}=function(e){let t,r;switch(e.kty){case"oct":switch(e.alg){case"HS256":case"HS384":case"HS512":t={name:"HMAC",hash:`SHA-${e.alg.slice(-3)}`},r=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":throw new V.JOSENotSupported(`${e.alg} keys cannot be imported as CryptoKey instances`);case"A128GCM":case"A192GCM":case"A256GCM":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":t={name:"AES-GCM"},r=["encrypt","decrypt"];break;case"A128KW":case"A192KW":case"A256KW":t={name:"AES-KW"},r=["wrapKey","unwrapKey"];break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":t={name:"PBKDF2"},r=["deriveBits"];break;default:throw new V.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new V.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new V.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"EdDSA":t={name:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new V.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new V.JOSENotSupported('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e),s=[i,null!=(t=e.ext)&&t,null!=(r=e.key_ops)?r:n];if("PBKDF2"===i.name)return Y.default.subtle.importKey("raw",(0,Z.decode)(e.k),...s);let a={...e};return delete a.alg,delete a.use,Y.default.subtle.importKey("jwk",a,...s)};async function e$(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PUBLIC KEY-----"))throw TypeError('"spki" must be SPKI formatted string');return eF(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",e,t,r)}async function eK(e,t,r){let i;if("string"!=typeof e||0!==e.indexOf("-----BEGIN CERTIFICATE-----"))throw TypeError('"x509" must be X.509 formatted string');try{let t,r;r=e.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\s)/g,""),i=eL((t=eH(eH(eq((0,Z.decodeBase64)(r)).contents)[0].contents),(0,Z.encodeBase64)(t[160===t[0].raw[0]?6:5].raw)),"PUBLIC KEY")}catch(e){throw TypeError("Failed to parse the X.509 certificate",{cause:e})}return eF(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",i,t,r)}async function eV(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PRIVATE KEY-----"))throw TypeError('"pkcs8" must be PKCS#8 formatted string');return eF(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,"pkcs8",e,t,r)}async function eJ(e,t,r){var i;if(!(0,eb.default)(e))throw TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');if(null!=r||(r=!0!==e.ext),r)return ez({...e,alg:t,ext:null!=(i=e.ext)&&i});return(0,Z.decode)(e.k);case"RSA":if(void 0!==e.oth)throw new V.JOSENotSupported('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return ez({...e,alg:t});default:throw new V.JOSENotSupported('Unsupported "kty" (Key Type) Parameter value')}}let eZ=(e,t,r)=>{if(e.startsWith("HS")||"dir"===e||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)){if(!(t instanceof Uint8Array)){if(!eu(t))throw TypeError(ed(e,t,...eh,"Uint8Array"));if("secret"!==t.type)throw TypeError(`${eh.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}}else{if(!eu(t))throw TypeError(ed(e,t,...eh));if("secret"===t.type)throw TypeError(`${eh.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${eh.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${eh.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${eh.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${eh.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)}};async function eG(e,t,r,i,n){if(!(r instanceof Uint8Array))throw TypeError(ec(r,"Uint8Array"));let s=parseInt(e.slice(1,4),10),a=await Y.default.subtle.importKey("raw",r.subarray(s>>3),"AES-CBC",!1,["encrypt"]),o=await Y.default.subtle.importKey("raw",r.subarray(0,s>>3),{hash:`SHA-${s<<1}`,name:"HMAC"},!1,["sign"]),l=new Uint8Array(await Y.default.subtle.encrypt({iv:i,name:"AES-CBC"},a,t)),c=(0,G.concat)(n,i,l,(0,G.uint64be)(n.length<<3));return{ciphertext:l,tag:new Uint8Array((await Y.default.subtle.sign("HMAC",o,c)).slice(0,s>>3))}}async function eY(e,t,r,i,n){let s;r instanceof Uint8Array?s=await Y.default.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"]):(eo(r,e,"encrypt"),s=r);let a=new Uint8Array(await Y.default.subtle.encrypt({additionalData:n,iv:i,name:"AES-GCM",tagLength:128},s,t)),o=a.slice(-16);return{ciphertext:a.slice(0,-16),tag:o}}let eQ=async(e,t,r,i,n)=>{if(!(0,Y.isCryptoKey)(r)&&!(r instanceof Uint8Array))throw TypeError(ec(r,...eh,"Uint8Array"));switch(et(e,i),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return r instanceof Uint8Array&&er(r,parseInt(e.slice(-3),10)),eG(e,t,r,i,n);case"A128GCM":case"A192GCM":case"A256GCM":return r instanceof Uint8Array&&er(r,parseInt(e.slice(1,4),10)),eY(e,t,r,i,n);default:throw new V.JOSENotSupported("Unsupported JWE Content Encryption Algorithm")}};async function eX(e,t,r,i){let n=e.slice(0,7);i||(i=ee(n));let{ciphertext:s,tag:a}=await eQ(n,r,t,i,new Uint8Array(0));return{encryptedKey:s,iv:(0,Z.encode)(i),tag:(0,Z.encode)(a)}}async function e0(e,t,r,i,n){return ey(e.slice(0,7),t,r,i,n,new Uint8Array(0))}async function e1(e,t,r,i,n){switch(eZ(e,t,"decrypt"),e){case"dir":if(void 0!==r)throw new V.JWEInvalid("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==r)throw new V.JWEInvalid("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let n,s;if(!(0,eb.default)(i.epk))throw new V.JWEInvalid('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!ek(t))throw new V.JOSENotSupported("ECDH with the provided key is not allowed or not supported by your javascript runtime");let a=await eJ(i.epk,e);if(void 0!==i.apu){if("string"!=typeof i.apu)throw new V.JWEInvalid('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{n=(0,Z.decode)(i.apu)}catch(e){throw new V.JWEInvalid("Failed to base64url decode the apu")}}if(void 0!==i.apv){if("string"!=typeof i.apv)throw new V.JWEInvalid('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{s=(0,Z.decode)(i.apv)}catch(e){throw new V.JWEInvalid("Failed to base64url decode the apv")}}let o=await ex(a,t,"ECDH-ES"===e?i.enc:e,"ECDH-ES"===e?eU(i.enc):parseInt(e.slice(-5,-2),10),n,s);if("ECDH-ES"===e)return o;if(void 0===r)throw new V.JWEInvalid("JWE Encrypted Key missing");return eS(e.slice(-6),o,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===r)throw new V.JWEInvalid("JWE Encrypted Key missing");return eM(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let s;if(void 0===r)throw new V.JWEInvalid("JWE Encrypted Key missing");if("number"!=typeof i.p2c)throw new V.JWEInvalid('JOSE Header "p2c" (PBES2 Count) missing or invalid');let a=(null==n?void 0:n.maxPBES2Count)||1e4;if(i.p2c>a)throw new V.JWEInvalid('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof i.p2s)throw new V.JWEInvalid('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{s=(0,Z.decode)(i.p2s)}catch(e){throw new V.JWEInvalid("Failed to base64url decode the p2s")}return eP(e,t,r,i.p2c,s)}case"A128KW":case"A192KW":case"A256KW":if(void 0===r)throw new V.JWEInvalid("JWE Encrypted Key missing");return eS(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let n,s;if(void 0===r)throw new V.JWEInvalid("JWE Encrypted Key missing");if("string"!=typeof i.iv)throw new V.JWEInvalid('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof i.tag)throw new V.JWEInvalid('JOSE Header "tag" (Authentication Tag) missing or invalid');try{n=(0,Z.decode)(i.iv)}catch(e){throw new V.JWEInvalid("Failed to base64url decode the iv")}try{s=(0,Z.decode)(i.tag)}catch(e){throw new V.JWEInvalid("Failed to base64url decode the tag")}return e0(e,t,r,n,s)}default:throw new V.JOSENotSupported('Invalid or unsupported "alg" (JWE Algorithm) header value')}}let e2=function(e,t,r,i,n){let s;if(void 0!==n.crit&&void 0===i.crit)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!i||void 0===i.crit)return new Set;if(!Array.isArray(i.crit)||0===i.crit.length||i.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let a of(s=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,i.crit)){if(!s.has(a))throw new V.JOSENotSupported(`Extension Header Parameter "${a}" is not recognized`);if(void 0===n[a])throw new e(`Extension Header Parameter "${a}" is missing`);if(s.get(a)&&void 0===i[a])throw new e(`Extension Header Parameter "${a}" MUST be integrity protected`)}return new Set(i.crit)},e3=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};async function e5(e,t,r){var i;let n,s,a,o,l,c,d;if(!(0,eb.default)(e))throw new V.JWEInvalid("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new V.JWEInvalid("JOSE Header missing");if("string"!=typeof e.iv)throw new V.JWEInvalid("JWE Initialization Vector missing or incorrect type");if("string"!=typeof e.ciphertext)throw new V.JWEInvalid("JWE Ciphertext missing or incorrect type");if("string"!=typeof e.tag)throw new V.JWEInvalid("JWE Authentication Tag missing or incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new V.JWEInvalid("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new V.JWEInvalid("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new V.JWEInvalid("JWE AAD incorrect type");if(void 0!==e.header&&!(0,eb.default)(e.header))throw new V.JWEInvalid("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!(0,eb.default)(e.unprotected))throw new V.JWEInvalid("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{let t=(0,Z.decode)(e.protected);n=JSON.parse(G.decoder.decode(t))}catch(e){throw new V.JWEInvalid("JWE Protected Header is invalid")}if(!ew(n,e.header,e.unprotected))throw new V.JWEInvalid("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let u={...n,...e.header,...e.unprotected};if(e2(V.JWEInvalid,new Map,null==r?void 0:r.crit,n,u),void 0!==u.zip){if(!n||!n.zip)throw new V.JWEInvalid('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==u.zip)throw new V.JOSENotSupported('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:h,enc:p}=u;if("string"!=typeof h||!h)throw new V.JWEInvalid("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof p||!p)throw new V.JWEInvalid("missing JWE Encryption Algorithm (enc) in JWE Header");let f=r&&e3("keyManagementAlgorithms",r.keyManagementAlgorithms),y=r&&e3("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(f&&!f.has(h))throw new V.JOSEAlgNotAllowed('"alg" (Algorithm) Header Parameter not allowed');if(y&&!y.has(p))throw new V.JOSEAlgNotAllowed('"enc" (Encryption Algorithm) Header Parameter not allowed');if(void 0!==e.encrypted_key)try{s=(0,Z.decode)(e.encrypted_key)}catch(e){throw new V.JWEInvalid("Failed to base64url decode the encrypted_key")}let g=!1;"function"==typeof t&&(t=await t(n,e),g=!0);try{a=await e1(h,t,s,u,r)}catch(e){if(e instanceof TypeError||e instanceof V.JWEInvalid||e instanceof V.JOSENotSupported)throw e;a=eD(p)}try{o=(0,Z.decode)(e.iv)}catch(e){throw new V.JWEInvalid("Failed to base64url decode the iv")}try{l=(0,Z.decode)(e.tag)}catch(e){throw new V.JWEInvalid("Failed to base64url decode the tag")}let m=G.encoder.encode(null!=(i=e.protected)?i:"");c=void 0!==e.aad?(0,G.concat)(m,G.encoder.encode("."),G.encoder.encode(e.aad)):m;try{d=(0,Z.decode)(e.ciphertext)}catch(e){throw new V.JWEInvalid("Failed to base64url decode the ciphertext")}let w=await ey(p,a,d,o,l,c);"DEF"===u.zip&&(w=await ((null==r?void 0:r.inflateRaw)||eg)(w));let b={plaintext:w};if(void 0!==e.protected&&(b.protectedHeader=n),void 0!==e.aad)try{b.additionalAuthenticatedData=(0,Z.decode)(e.aad)}catch(e){throw new V.JWEInvalid("Failed to base64url decode the aad")}return(void 0!==e.unprotected&&(b.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(b.unprotectedHeader=e.header),g)?{...b,key:t}:b}async function e8(e,t,r){if(e instanceof Uint8Array&&(e=G.decoder.decode(e)),"string"!=typeof e)throw new V.JWEInvalid("Compact JWE must be a string or Uint8Array");let{0:i,1:n,2:s,3:a,4:o,length:l}=e.split(".");if(5!==l)throw new V.JWEInvalid("Invalid Compact JWE");let c=await e5({ciphertext:a,iv:s||void 0,protected:i||void 0,tag:o||void 0,encrypted_key:n||void 0},t,r),d={plaintext:c.plaintext,protectedHeader:c.protectedHeader};return"function"==typeof t?{...d,key:c.key}:d}async function e6(e,t,r){if(!(0,eb.default)(e))throw new V.JWEInvalid("General JWE must be an object");if(!Array.isArray(e.recipients)||!e.recipients.every(eb.default))throw new V.JWEInvalid("JWE Recipients missing or incorrect type");if(!e.recipients.length)throw new V.JWEInvalid("JWE Recipients has no members");for(let i of e.recipients)try{return await e5({aad:e.aad,ciphertext:e.ciphertext,encrypted_key:i.encrypted_key,header:i.header,iv:e.iv,protected:e.protected,tag:e.tag,unprotected:e.unprotected},t,r)}catch(e){}throw new V.JWEDecryptionFailed}let e4=async e=>{if(e instanceof Uint8Array)return{kty:"oct",k:(0,Z.encode)(e)};if(!(0,Y.isCryptoKey)(e))throw TypeError(ec(e,...eh,"Uint8Array"));if(!e.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:t,key_ops:r,alg:i,use:n,...s}=await Y.default.subtle.exportKey("jwk",e);return s};async function e7(e){return ej("public","spki",e)}async function e9(e){return ej("private","pkcs8",e)}async function te(e){return e4(e)}async function tt(e,t,r,i,n={}){let s,a,o;switch(eZ(e,r,"encrypt"),e){case"dir":o=r;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!ek(r))throw new V.JOSENotSupported("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:l,apv:c}=n,{epk:d}=n;d||(d=(await eI(r)).privateKey);let{x:u,y:h,crv:p,kty:f}=await te(d),y=await ex(r,d,"ECDH-ES"===e?t:e,"ECDH-ES"===e?eU(t):parseInt(e.slice(-5,-2),10),l,c);if(a={epk:{x:u,crv:p,kty:f}},"EC"===f&&(a.epk.y=h),l&&(a.apu=(0,Z.encode)(l)),c&&(a.apv=(0,Z.encode)(c)),"ECDH-ES"===e){o=y;break}o=i||eD(t);let g=e.slice(-6);s=await eA(g,y,o);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":o=i||eD(t),s=await eN(e,r,o);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{o=i||eD(t);let{p2c:l,p2s:c}=n;({encryptedKey:s,...a}=await eC(e,r,o,l,c));break}case"A128KW":case"A192KW":case"A256KW":o=i||eD(t),s=await eA(e,r,o);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{o=i||eD(t);let{iv:l}=n;({encryptedKey:s,...a}=await eX(e,r,o,l));break}default:throw new V.JOSENotSupported('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:o,encryptedKey:s,parameters:a}}let tr=Symbol();class ti{constructor(e){if(!(e instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this._plaintext=e}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._sharedUnprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}async encrypt(e,t){let r,i,n,s,a,o,l;if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new V.JWEInvalid("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!ew(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new V.JWEInvalid("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let c={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(e2(V.JWEInvalid,new Map,null==t?void 0:t.crit,this._protectedHeader,c),void 0!==c.zip){if(!this._protectedHeader||!this._protectedHeader.zip)throw new V.JWEInvalid('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==c.zip)throw new V.JOSENotSupported('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:d,enc:u}=c;if("string"!=typeof d||!d)throw new V.JWEInvalid('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof u||!u)throw new V.JWEInvalid('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if("dir"===d){if(this._cek)throw TypeError("setContentEncryptionKey cannot be called when using Direct Encryption")}else if("ECDH-ES"===d&&this._cek)throw TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");{let n;({cek:i,encryptedKey:r,parameters:n}=await tt(d,u,e,this._cek,this._keyManagementParameters)),n&&(t&&tr in t?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...n}:this.setUnprotectedHeader(n):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...n}:this.setProtectedHeader(n))}if(this._iv||(this._iv=ee(u)),s=this._protectedHeader?G.encoder.encode((0,Z.encode)(JSON.stringify(this._protectedHeader))):G.encoder.encode(""),this._aad?(a=(0,Z.encode)(this._aad),n=(0,G.concat)(s,G.encoder.encode("."),G.encoder.encode(a))):n=s,"DEF"===c.zip){let e=await ((null==t?void 0:t.deflateRaw)||em)(this._plaintext);({ciphertext:o,tag:l}=await eQ(u,e,i,this._iv,n))}else({ciphertext:o,tag:l}=await eQ(u,this._plaintext,i,this._iv,n));let h={ciphertext:(0,Z.encode)(o),iv:(0,Z.encode)(this._iv),tag:(0,Z.encode)(l)};return r&&(h.encrypted_key=(0,Z.encode)(r)),a&&(h.aad=a),this._protectedHeader&&(h.protected=G.decoder.decode(s)),this._sharedUnprotectedHeader&&(h.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(h.header=this._unprotectedHeader),h}}class tn{constructor(e,t,r){this.parent=e,this.key=t,this.options=r}setUnprotectedHeader(e){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addRecipient(...e){return this.parent.addRecipient(...e)}encrypt(...e){return this.parent.encrypt(...e)}done(){return this.parent}}class ts{constructor(e){this._recipients=[],this._plaintext=e}addRecipient(e,t){let r=new tn(this,e,{crit:null==t?void 0:t.crit});return this._recipients.push(r),r}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}async encrypt(e){var t,r,i;let n;if(!this._recipients.length)throw new V.JWEInvalid("at least one recipient must be added");if(e={deflateRaw:null==e?void 0:e.deflateRaw},1===this._recipients.length){let[t]=this._recipients,r=await new ti(this._plaintext).setAdditionalAuthenticatedData(this._aad).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(t.unprotectedHeader).encrypt(t.key,{...t.options,...e}),i={ciphertext:r.ciphertext,iv:r.iv,recipients:[{}],tag:r.tag};return r.aad&&(i.aad=r.aad),r.protected&&(i.protected=r.protected),r.unprotected&&(i.unprotected=r.unprotected),r.encrypted_key&&(i.recipients[0].encrypted_key=r.encrypted_key),r.header&&(i.recipients[0].header=r.header),i}for(let e=0;e<this._recipients.length;e++){let t=this._recipients[e];if(!ew(this._protectedHeader,this._unprotectedHeader,t.unprotectedHeader))throw new V.JWEInvalid("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let r={...this._protectedHeader,...this._unprotectedHeader,...t.unprotectedHeader},{alg:i}=r;if("string"!=typeof i||!i)throw new V.JWEInvalid('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("dir"===i||"ECDH-ES"===i)throw new V.JWEInvalid('"dir" and "ECDH-ES" alg may only be used with a single recipient');if("string"!=typeof r.enc||!r.enc)throw new V.JWEInvalid('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(n){if(n!==r.enc)throw new V.JWEInvalid('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients')}else n=r.enc;if(e2(V.JWEInvalid,new Map,t.options.crit,this._protectedHeader,r),void 0!==r.zip&&(!this._protectedHeader||!this._protectedHeader.zip))throw new V.JWEInvalid('JWE "zip" (Compression Algorithm) Header MUST be integrity protected')}let s=eD(n),a={ciphertext:"",iv:"",recipients:[],tag:""};for(let o=0;o<this._recipients.length;o++){let l=this._recipients[o],c={};a.recipients.push(c);let d=({...this._protectedHeader,...this._unprotectedHeader,...l.unprotectedHeader}).alg.startsWith("PBES2")?2048+o:void 0;if(0===o){let t=await new ti(this._plaintext).setAdditionalAuthenticatedData(this._aad).setContentEncryptionKey(s).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(l.unprotectedHeader).setKeyManagementParameters({p2c:d}).encrypt(l.key,{...l.options,...e,[tr]:!0});a.ciphertext=t.ciphertext,a.iv=t.iv,a.tag=t.tag,t.aad&&(a.aad=t.aad),t.protected&&(a.protected=t.protected),t.unprotected&&(a.unprotected=t.unprotected),c.encrypted_key=t.encrypted_key,t.header&&(c.header=t.header);continue}let{encryptedKey:u,parameters:h}=await tt((null==(t=l.unprotectedHeader)?void 0:t.alg)||(null==(r=this._protectedHeader)?void 0:r.alg)||(null==(i=this._unprotectedHeader)?void 0:i.alg),n,l.key,s,{p2c:d});c.encrypted_key=(0,Z.encode)(u),(l.unprotectedHeader||h)&&(c.header={...l.unprotectedHeader,...h})}return a}}function ta(e,t){let r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"EdDSA":return{name:t.name};default:throw new V.JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}function to(e,t,r){if((0,Y.isCryptoKey)(t))return!function(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!en(e.algorithm,"HMAC"))throw ei("HMAC");let r=parseInt(t.slice(2),10);if(es(e.algorithm.hash)!==r)throw ei(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!en(e.algorithm,"RSASSA-PKCS1-v1_5"))throw ei("RSASSA-PKCS1-v1_5");let r=parseInt(t.slice(2),10);if(es(e.algorithm.hash)!==r)throw ei(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!en(e.algorithm,"RSA-PSS"))throw ei("RSA-PSS");let r=parseInt(t.slice(2),10);if(es(e.algorithm.hash)!==r)throw ei(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw ei("Ed25519 or Ed448");break;case"ES256":case"ES384":case"ES512":{if(!en(e.algorithm,"ECDSA"))throw ei("ECDSA");let r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw ei(r,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}ea(e,r)}(t,e,r),t;if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(ec(t,...eh));return Y.default.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}throw TypeError(ec(t,...eh,"Uint8Array"))}let tl=async(e,t,r,i)=>{let n=await to(e,t,"verify");eR(e,n);let s=ta(e,n.algorithm);try{return await Y.default.subtle.verify(s,n,r,i)}catch(e){return!1}};async function tc(e,t,r){var i;let n,s;if(!(0,eb.default)(e))throw new V.JWSInvalid("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new V.JWSInvalid('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new V.JWSInvalid("JWS Protected Header incorrect type");if(void 0===e.payload)throw new V.JWSInvalid("JWS Payload missing");if("string"!=typeof e.signature)throw new V.JWSInvalid("JWS Signature missing or incorrect type");if(void 0!==e.header&&!(0,eb.default)(e.header))throw new V.JWSInvalid("JWS Unprotected Header incorrect type");let a={};if(e.protected)try{let t=(0,Z.decode)(e.protected);a=JSON.parse(G.decoder.decode(t))}catch(e){throw new V.JWSInvalid("JWS Protected Header is invalid")}if(!ew(a,e.header))throw new V.JWSInvalid("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let o={...a,...e.header},l=e2(V.JWSInvalid,new Map([["b64",!0]]),null==r?void 0:r.crit,a,o),c=!0;if(l.has("b64")&&"boolean"!=typeof(c=a.b64))throw new V.JWSInvalid('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:d}=o;if("string"!=typeof d||!d)throw new V.JWSInvalid('JWS "alg" (Algorithm) Header Parameter missing or invalid');let u=r&&e3("algorithms",r.algorithms);if(u&&!u.has(d))throw new V.JOSEAlgNotAllowed('"alg" (Algorithm) Header Parameter not allowed');if(c){if("string"!=typeof e.payload)throw new V.JWSInvalid("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new V.JWSInvalid("JWS Payload must be a string or an Uint8Array instance");let h=!1;"function"==typeof t&&(t=await t(a,e),h=!0),eZ(d,t,"verify");let p=(0,G.concat)(G.encoder.encode(null!=(i=e.protected)?i:""),G.encoder.encode("."),"string"==typeof e.payload?G.encoder.encode(e.payload):e.payload);try{n=(0,Z.decode)(e.signature)}catch(e){throw new V.JWSInvalid("Failed to base64url decode the signature")}if(!await tl(d,t,n,p))throw new V.JWSSignatureVerificationFailed;if(c)try{s=(0,Z.decode)(e.payload)}catch(e){throw new V.JWSInvalid("Failed to base64url decode the payload")}else s="string"==typeof e.payload?G.encoder.encode(e.payload):e.payload;let f={payload:s};return(void 0!==e.protected&&(f.protectedHeader=a),void 0!==e.header&&(f.unprotectedHeader=e.header),h)?{...f,key:t}:f}async function td(e,t,r){if(e instanceof Uint8Array&&(e=G.decoder.decode(e)),"string"!=typeof e)throw new V.JWSInvalid("Compact JWS must be a string or Uint8Array");let{0:i,1:n,2:s,length:a}=e.split(".");if(3!==a)throw new V.JWSInvalid("Invalid Compact JWS");let o=await tc({payload:n,protected:i,signature:s},t,r),l={payload:o.payload,protectedHeader:o.protectedHeader};return"function"==typeof t?{...l,key:o.key}:l}async function tu(e,t,r){if(!(0,eb.default)(e))throw new V.JWSInvalid("General JWS must be an object");if(!Array.isArray(e.signatures)||!e.signatures.every(eb.default))throw new V.JWSInvalid("JWS Signatures missing or incorrect type");for(let i of e.signatures)try{return await tc({header:i.header,payload:e.payload,protected:i.protected,signature:i.signature},t,r)}catch(e){}throw new V.JWSSignatureVerificationFailed}let th=e=>Math.floor(e.getTime()/1e3),tp=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i,tf=e=>{let t=tp.exec(e);if(!t)throw TypeError("Invalid time period format");let r=parseFloat(t[1]);switch(t[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(r);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(60*r);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(3600*r);case"day":case"days":case"d":return Math.round(86400*r);case"week":case"weeks":case"w":return Math.round(604800*r);default:return Math.round(0x1e187e0*r)}},ty=e=>e.toLowerCase().replace(/^application\//,""),tg=(e,t,r={})=>{var i,n;let s,a,{typ:o}=r;if(o&&("string"!=typeof e.typ||ty(e.typ)!==ty(o)))throw new V.JWTClaimValidationFailed('unexpected "typ" JWT header value',"typ","check_failed");try{s=JSON.parse(G.decoder.decode(t))}catch(e){}if(!(0,eb.default)(s))throw new V.JWTInvalid("JWT Claims Set must be a top-level JSON object");let{requiredClaims:l=[],issuer:c,subject:d,audience:u,maxTokenAge:h}=r;for(let e of(void 0!==h&&l.push("iat"),void 0!==u&&l.push("aud"),void 0!==d&&l.push("sub"),void 0!==c&&l.push("iss"),new Set(l.reverse())))if(!(e in s))throw new V.JWTClaimValidationFailed(`missing required "${e}" claim`,e,"missing");if(c&&!(Array.isArray(c)?c:[c]).includes(s.iss))throw new V.JWTClaimValidationFailed('unexpected "iss" claim value',"iss","check_failed");if(d&&s.sub!==d)throw new V.JWTClaimValidationFailed('unexpected "sub" claim value',"sub","check_failed");if(u&&(i=s.aud,n="string"==typeof u?[u]:u,"string"==typeof i?!n.includes(i):!(Array.isArray(i)&&n.some(Set.prototype.has.bind(new Set(i))))))throw new V.JWTClaimValidationFailed('unexpected "aud" claim value',"aud","check_failed");switch(typeof r.clockTolerance){case"string":a=tf(r.clockTolerance);break;case"number":a=r.clockTolerance;break;case"undefined":a=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:p}=r,f=th(p||new Date);if((void 0!==s.iat||h)&&"number"!=typeof s.iat)throw new V.JWTClaimValidationFailed('"iat" claim must be a number',"iat","invalid");if(void 0!==s.nbf){if("number"!=typeof s.nbf)throw new V.JWTClaimValidationFailed('"nbf" claim must be a number',"nbf","invalid");if(s.nbf>f+a)throw new V.JWTClaimValidationFailed('"nbf" claim timestamp check failed',"nbf","check_failed")}if(void 0!==s.exp){if("number"!=typeof s.exp)throw new V.JWTClaimValidationFailed('"exp" claim must be a number',"exp","invalid");if(s.exp<=f-a)throw new V.JWTExpired('"exp" claim timestamp check failed',"exp","check_failed")}if(h){let e=f-s.iat;if(e-a>("number"==typeof h?h:tf(h)))throw new V.JWTExpired('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(e<0-a)throw new V.JWTClaimValidationFailed('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return s};async function tm(e,t,r){var i;let n=await td(e,t,r);if((null==(i=n.protectedHeader.crit)?void 0:i.includes("b64"))&&!1===n.protectedHeader.b64)throw new V.JWTInvalid("JWTs MUST NOT use unencoded payload");let s={payload:tg(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return"function"==typeof t?{...s,key:n.key}:s}async function tw(e,t,r){let i=await e8(e,t,r),n=tg(i.protectedHeader,i.plaintext,r),{protectedHeader:s}=i;if(void 0!==s.iss&&s.iss!==n.iss)throw new V.JWTClaimValidationFailed('replicated "iss" claim header parameter mismatch',"iss","mismatch");if(void 0!==s.sub&&s.sub!==n.sub)throw new V.JWTClaimValidationFailed('replicated "sub" claim header parameter mismatch',"sub","mismatch");if(void 0!==s.aud&&JSON.stringify(s.aud)!==JSON.stringify(n.aud))throw new V.JWTClaimValidationFailed('replicated "aud" claim header parameter mismatch',"aud","mismatch");let a={payload:n,protectedHeader:s};return"function"==typeof t?{...a,key:i.key}:a}class tb{constructor(e){this._flattened=new ti(e)}setContentEncryptionKey(e){return this._flattened.setContentEncryptionKey(e),this}setInitializationVector(e){return this._flattened.setInitializationVector(e),this}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}setKeyManagementParameters(e){return this._flattened.setKeyManagementParameters(e),this}async encrypt(e,t){let r=await this._flattened.encrypt(e,t);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}}let tv=async(e,t,r)=>{let i=await to(e,t,"sign");return eR(e,i),new Uint8Array(await Y.default.subtle.sign(ta(e,i.algorithm),i,r))};class tE{constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){let r;if(!this._protectedHeader&&!this._unprotectedHeader)throw new V.JWSInvalid("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!ew(this._protectedHeader,this._unprotectedHeader))throw new V.JWSInvalid("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let i={...this._protectedHeader,...this._unprotectedHeader},n=e2(V.JWSInvalid,new Map([["b64",!0]]),null==t?void 0:t.crit,this._protectedHeader,i),s=!0;if(n.has("b64")&&"boolean"!=typeof(s=this._protectedHeader.b64))throw new V.JWSInvalid('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:a}=i;if("string"!=typeof a||!a)throw new V.JWSInvalid('JWS "alg" (Algorithm) Header Parameter missing or invalid');eZ(a,e,"sign");let o=this._payload;s&&(o=G.encoder.encode((0,Z.encode)(o))),r=this._protectedHeader?G.encoder.encode((0,Z.encode)(JSON.stringify(this._protectedHeader))):G.encoder.encode("");let l=(0,G.concat)(r,G.encoder.encode("."),o),c=await tv(a,e,l),d={signature:(0,Z.encode)(c),payload:""};return s&&(d.payload=G.decoder.decode(o)),this._unprotectedHeader&&(d.header=this._unprotectedHeader),this._protectedHeader&&(d.protected=G.decoder.decode(r)),d}}class t_{constructor(e){this._flattened=new tE(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){let r=await this._flattened.sign(e,t);if(void 0===r.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}class tA{constructor(e,t,r){this.parent=e,this.key=t,this.options=r}setProtectedHeader(e){if(this.protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this.protectedHeader=e,this}setUnprotectedHeader(e){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addSignature(...e){return this.parent.addSignature(...e)}sign(...e){return this.parent.sign(...e)}done(){return this.parent}}class tS{constructor(e){this._signatures=[],this._payload=e}addSignature(e,t){let r=new tA(this,e,t);return this._signatures.push(r),r}async sign(){if(!this._signatures.length)throw new V.JWSInvalid("at least one signature must be added");let e={signatures:[],payload:""};for(let t=0;t<this._signatures.length;t++){let r=this._signatures[t],i=new tE(this._payload);i.setProtectedHeader(r.protectedHeader),i.setUnprotectedHeader(r.unprotectedHeader);let{payload:n,...s}=await i.sign(r.key,r.options);if(0===t)e.payload=n;else if(e.payload!==n)throw new V.JWSInvalid("inconsistent use of JWS Unencoded Payload (RFC7797)");e.signatures.push(s)}return e}}class tx{constructor(e){if(!(0,eb.default)(e))throw TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:e}:this._payload={...this._payload,nbf:th(new Date)+tf(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:e}:this._payload={...this._payload,exp:th(new Date)+tf(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:th(new Date)}:this._payload={...this._payload,iat:e},this}}class tI extends tx{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){var r;let i=new t_(G.encoder.encode(JSON.stringify(this._payload)));if(i.setProtectedHeader(this._protectedHeader),Array.isArray(null==(r=this._protectedHeader)?void 0:r.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new V.JWTInvalid("JWTs MUST NOT use unencoded payload");return i.sign(e,t)}}class tk extends tx{setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(e,t){let r=new tb(G.encoder.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),r.setProtectedHeader(this._protectedHeader),this._iv&&r.setInitializationVector(this._iv),this._cek&&r.setContentEncryptionKey(this._cek),this._keyManagementParameters&&r.setKeyManagementParameters(this._keyManagementParameters),r.encrypt(e,t)}}var tT=e.i(797481);let tC=(e,t)=>{if("string"!=typeof e||!e)throw new V.JWKInvalid(`${t} missing or invalid`)};async function tP(e,t){let r;if(!(0,eb.default)(e))throw TypeError("JWK must be an object");if(null!=t||(t="sha256"),"sha256"!==t&&"sha384"!==t&&"sha512"!==t)throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(e.kty){case"EC":tC(e.crv,'"crv" (Curve) Parameter'),tC(e.x,'"x" (X Coordinate) Parameter'),tC(e.y,'"y" (Y Coordinate) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":tC(e.crv,'"crv" (Subtype of Key Pair) Parameter'),tC(e.x,'"x" (Public Key) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x};break;case"RSA":tC(e.e,'"e" (Exponent) Parameter'),tC(e.n,'"n" (Modulus) Parameter'),r={e:e.e,kty:e.kty,n:e.n};break;case"oct":tC(e.k,'"k" (Key Value) Parameter'),r={k:e.k,kty:e.kty};break;default:throw new V.JOSENotSupported('"kty" (Key Type) Parameter missing or unsupported')}let i=G.encoder.encode(JSON.stringify(r));return(0,Z.encode)(await (0,tT.default)(t,i))}async function tO(e,t){null!=t||(t="sha256");let r=await tP(e,t);return`urn:ietf:params:oauth:jwk-thumbprint:sha-${t.slice(-3)}:${r}`}async function tR(e,t){let r={...e,...null==t?void 0:t.header};if(!(0,eb.default)(r.jwk))throw new V.JWSInvalid('"jwk" (JSON Web Key) Header Parameter must be a JSON object');let i=await eJ({...r.jwk,ext:!0},r.alg,!0);if(i instanceof Uint8Array||"public"!==i.type)throw new V.JWSInvalid('"jwk" (JSON Web Key) Header Parameter must be a public key');return i}function tN(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(tM)}function tM(e){return(0,eb.default)(e)}class tU{constructor(e){if(this._cached=new WeakMap,!tN(e))throw new V.JWKSInvalid("JSON Web Key Set malformed");this._jwks=function(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}(e)}async getKey(e,t){let{alg:r,kid:i}={...e,...null==t?void 0:t.header},n=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new V.JOSENotSupported('Unsupported "alg" value for a JSON Web Key Set')}}(r),s=this._jwks.keys.filter(e=>{let t=n===e.kty;if(t&&"string"==typeof i&&(t=i===e.kid),t&&"string"==typeof e.alg&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t&&"EdDSA"===r&&(t="Ed25519"===e.crv||"Ed448"===e.crv),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv}return t}),{0:a,length:o}=s;if(0===o)throw new V.JWKSNoMatchingKey;if(1!==o){let e=new V.JWKSMultipleMatchingKeys,{_cached:t}=this;throw e[Symbol.asyncIterator]=async function*(){for(let e of s)try{yield await tD(t,e,r)}catch(e){continue}},e}return tD(this._cached,a,r)}}async function tD(e,t,r){let i=e.get(t)||e.set(t,{}).get(t);if(void 0===i[r]){let e=await eJ({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new V.JWKSInvalid("JSON Web Key Set members must be public keys");i[r]=e}return i[r]}function tL(e){let t=new tU(e);return async function(e,r){return t.getKey(e,r)}}let tj=async(e,t,r)=>{let i,n,s=!1;"function"==typeof AbortController&&(i=new AbortController,n=setTimeout(()=>{s=!0,i.abort()},t));let a=await fetch(e.href,{signal:i?i.signal:void 0,redirect:"manual",headers:r.headers}).catch(e=>{if(s)throw new V.JWKSTimeout;throw e});if(void 0!==n&&clearTimeout(n),200!==a.status)throw new V.JOSEError("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await a.json()}catch(e){throw new V.JOSEError("Failed to parse the JSON Web Key Set HTTP response as JSON")}};class tB extends tU{constructor(e,t){if(super({keys:[]}),this._jwks=void 0,!(e instanceof URL))throw TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:null==t?void 0:t.agent,headers:null==t?void 0:t.headers},this._timeoutDuration="number"==typeof(null==t?void 0:t.timeoutDuration)?null==t?void 0:t.timeoutDuration:5e3,this._cooldownDuration="number"==typeof(null==t?void 0:t.cooldownDuration)?null==t?void 0:t.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof(null==t?void 0:t.cacheMaxAge)?null==t?void 0:t.cacheMaxAge:6e5}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(e,t){this._jwks&&this.fresh()||await this.reload();try{return await super.getKey(e,t)}catch(r){if(r instanceof V.JWKSNoMatchingKey&&!1===this.coolingDown())return await this.reload(),super.getKey(e,t);throw r}}async reload(){this._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this._pendingFetch=void 0),this._pendingFetch||(this._pendingFetch=tj(this._url,this._timeoutDuration,this._options).then(e=>{if(!tN(e))throw new V.JWKSInvalid("JSON Web Key Set malformed");this._jwks={keys:e.keys},this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(e=>{throw this._pendingFetch=void 0,e})),await this._pendingFetch}}function tW(e,t){let r=new tB(e,t);return async function(e,t){return r.getKey(e,t)}}class tF extends tx{encode(){let e=Z.encode(JSON.stringify({alg:"none"})),t=Z.encode(JSON.stringify(this._payload));return`${e}.${t}.`}static decode(e,t){let r;if("string"!=typeof e)throw new V.JWTInvalid("Unsecured JWT must be a string");let{0:i,1:n,2:s,length:a}=e.split(".");if(3!==a||""!==s)throw new V.JWTInvalid("Invalid Unsecured JWT");try{if(r=JSON.parse(G.decoder.decode(Z.decode(i))),"none"!==r.alg)throw Error()}catch(e){throw new V.JWTInvalid("Invalid Unsecured JWT")}return{payload:tg(r,Z.decode(n),t),header:r}}}function tH(e){let t;if("string"==typeof e){let r=e.split(".");(3===r.length||5===r.length)&&([t]=r)}else if("object"==typeof e&&e)if("protected"in e)t=e.protected;else throw TypeError("Token does not contain a Protected Header");try{if("string"!=typeof t||!t)throw Error();let e=JSON.parse(G.decoder.decode((0,J.decode)(t)));if(!(0,eb.default)(e))throw Error();return e}catch(e){throw TypeError("Invalid Token or Protected Header formatting")}}var tq=e.i(576951);async function tz(e,t){var r;let i,n,s;switch(e){case"HS256":case"HS384":case"HS512":i=parseInt(e.slice(-3),10),n={name:"HMAC",hash:`SHA-${i}`,length:i},s=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return Q(new Uint8Array((i=parseInt(e.slice(-3),10))>>3));case"A128KW":case"A192KW":case"A256KW":n={name:"AES-KW",length:i=parseInt(e.slice(1,4),10)},s=["wrapKey","unwrapKey"];break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":n={name:"AES-GCM",length:i=parseInt(e.slice(1,4),10)},s=["encrypt","decrypt"];break;default:throw new V.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return Y.default.subtle.generateKey(n,null!=(r=null==t?void 0:t.extractable)&&r,s)}function t$(e){var t;let r=null!=(t=null==e?void 0:e.modulusLength)?t:2048;if("number"!=typeof r||r<2048)throw new V.JOSENotSupported("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return r}async function tK(e,t){var r,i,n;let s,a;switch(e){case"PS256":case"PS384":case"PS512":s={name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:t$(t)},a=["sign","verify"];break;case"RS256":case"RS384":case"RS512":s={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:t$(t)},a=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":s={name:"RSA-OAEP",hash:`SHA-${parseInt(e.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:t$(t)},a=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":s={name:"ECDSA",namedCurve:"P-256"},a=["sign","verify"];break;case"ES384":s={name:"ECDSA",namedCurve:"P-384"},a=["sign","verify"];break;case"ES512":s={name:"ECDSA",namedCurve:"P-521"},a=["sign","verify"];break;case"EdDSA":a=["sign","verify"];let o=null!=(r=null==t?void 0:t.crv)?r:"Ed25519";switch(o){case"Ed25519":case"Ed448":s={name:o};break;default:throw new V.JOSENotSupported("Invalid or unsupported crv option provided")}break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{a=["deriveKey","deriveBits"];let e=null!=(i=null==t?void 0:t.crv)?i:"P-256";switch(e){case"P-256":case"P-384":case"P-521":s={name:"ECDH",namedCurve:e};break;case"X25519":case"X448":s={name:e};break;default:throw new V.JOSENotSupported("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new V.JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return Y.default.subtle.generateKey(s,null!=(n=null==t?void 0:t.extractable)&&n,a)}async function tV(e,t){return tK(e,t)}async function tJ(e,t){return tz(e,t)}e.s(["CompactEncrypt",()=>tb,"CompactSign",()=>t_,"EmbeddedJWK",()=>tR,"EncryptJWT",()=>tk,"FlattenedEncrypt",()=>ti,"FlattenedSign",()=>tE,"GeneralEncrypt",()=>ts,"GeneralSign",()=>tS,"SignJWT",()=>tI,"UnsecuredJWT",()=>tF,"base64url",0,J,"calculateJwkThumbprint",()=>tP,"calculateJwkThumbprintUri",()=>tO,"compactDecrypt",()=>e8,"compactVerify",()=>td,"createLocalJWKSet",()=>tL,"createRemoteJWKSet",()=>tW,"cryptoRuntime",0,"WebCryptoAPI","decodeJwt",()=>tq.decodeJwt,"decodeProtectedHeader",()=>tH,"errors",0,V,"exportJWK",()=>te,"exportPKCS8",()=>e9,"exportSPKI",()=>e7,"flattenedDecrypt",()=>e5,"flattenedVerify",()=>tc,"generalDecrypt",()=>e6,"generalVerify",()=>tu,"generateKeyPair",()=>tV,"generateSecret",()=>tJ,"importJWK",()=>eJ,"importPKCS8",()=>eV,"importSPKI",()=>e$,"importX509",()=>eK,"jwtDecrypt",()=>tw,"jwtVerify",()=>tm],563703),e.i(563703);var tZ=e.i(199220),tG=e.i(379688),tY=e.i(437206),tQ=e.i(625356),tX=e.i(263588),t0=e.i(286505),t1=e.i(432317);class t2{constructor(e,t){this.scope=e,this.module=t}storeObject(e,t){this.setItem(e,JSON.stringify(t))}loadObject(e){let t=this.getItem(e);return t?JSON.parse(t):void 0}setItem(e,t){localStorage.setItem(this.scopedKey(e),t)}getItem(e){return localStorage.getItem(this.scopedKey(e))}removeItem(e){localStorage.removeItem(this.scopedKey(e))}clear(){let e=this.scopedKey(""),t=[];for(let r=0;r<localStorage.length;r++){let i=localStorage.key(r);"string"==typeof i&&i.startsWith(e)&&t.push(i)}t.forEach(e=>localStorage.removeItem(e))}scopedKey(e){return`-${this.scope}${this.module?`:${this.module}`:""}:${e}`}static clearAll(){new t2("CBWSDK").clear(),new t2("walletlink").clear()}}var t3=e.i(467034);let t5=-32602,t8=-32603,t6=4001,t4=4100,t7=4200,t9=4900,re={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."},4902:{standard:"EIP-3085",message:"Unrecognized chain ID."}},rt="Unspecified error message.";function rr(e,t=rt){if(e&&Number.isInteger(e)){var r;let t=e.toString();if(rn(re,t))return re[t].message;if((r=e)>=-32099&&r<=-32e3)return"Unspecified server error."}return t}function ri(e){return e&&"object"==typeof e&&!Array.isArray(e)?Object.assign({},e):e}function rn(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function rs(e,t){return"object"==typeof e&&null!==e&&t in e&&"string"==typeof e[t]}let ra=e=>rp(t5,e),ro=e=>rp(t8,e),rl=e=>rf(t6,e),rc=e=>rf(t4,e),rd=e=>rf(t7,e),ru=e=>rf(t9,e),rh=e=>{if(!e||"object"!=typeof e||Array.isArray(e))throw Error("Ethereum Provider custom errors must provide single object argument.");let{code:t,message:r,data:i}=e;if(!r||"string"!=typeof r)throw Error('"message" must be a nonempty string');return new rm(t,r,i)};function rp(e,t){let[r,i]=ry(t);return new rg(e,r||rr(e),i)}function rf(e,t){let[r,i]=ry(t);return new rm(e,r||rr(e),i)}function ry(e){if(e){if("string"==typeof e)return[e];else if("object"==typeof e&&!Array.isArray(e)){let{message:t,data:r}=e;if(t&&"string"!=typeof t)throw Error("Must specify string message.");return[t||void 0,r]}}return[]}class rg extends Error{constructor(e,t,r){if(!Number.isInteger(e))throw Error('"code" must be an integer.');if(!t||"string"!=typeof t)throw Error('"message" must be a nonempty string.');super(t),this.code=e,void 0!==r&&(this.data=r)}}class rm extends rg{constructor(e,t,r){if(!function(e){return Number.isInteger(e)&&e>=1e3&&e<=4999}(e))throw Error('"code" must be an integer such that: 1000 <= code <= 4999');super(e,t,r)}}function rw(e){return Math.floor(e)}let rb=/^[0-9]*$/,rv=/^[a-f0-9]*$/;function rE(e){return r_(crypto.getRandomValues(new Uint8Array(e)))}function r_(e){return[...e].map(e=>e.toString(16).padStart(2,"0")).join("")}function rA(e){return new Uint8Array(e.match(/.{1,2}/g).map(e=>Number.parseInt(e,16)))}function rS(e,t=!1){let r=e.toString("hex");return t?`0x${r}`:r}function rx(e){return rS(rM(e),!0)}function rI(e){return e.toString(10)}function rk(e){return`0x${BigInt(e).toString(16)}`}function rT(e){return e.startsWith("0x")||e.startsWith("0X")}function rC(e){return rT(e)?e.slice(2):e}function rP(e){return rT(e)?`0x${e.slice(2)}`:`0x${e}`}function rO(e){if("string"!=typeof e)return!1;let t=rC(e).toLowerCase();return rv.test(t)}function rR(e,t=!1){let r=function(e,t=!1){if("string"==typeof e){let r=rC(e).toLowerCase();if(rv.test(r))return t?`0x${r}`:r}throw ra(`"${String(e)}" is not a hexadecimal string`)}(e,!1);return r.length%2==1&&(r=`0${r}`),t?`0x${r}`:r}function rN(e){if("string"==typeof e){let t=rC(e).toLowerCase();if(rO(t)&&40===t.length)return rP(t)}throw ra(`Invalid Ethereum address: ${String(e)}`)}function rM(e){if(t3.Buffer.isBuffer(e))return e;if("string"==typeof e){if(rO(e)){let t=rR(e,!1);return t3.Buffer.from(t,"hex")}return t3.Buffer.from(e,"utf8")}throw ra(`Not binary data: ${String(e)}`)}function rU(e){if("number"==typeof e&&Number.isInteger(e))return rw(e);if("string"==typeof e){if(rb.test(e))return rw(Number(e));if(rO(e))return rw(Number(BigInt(rR(e,!0))))}throw ra(`Not an integer: ${String(e)}`)}function rD(e){if(null!==e&&("bigint"==typeof e||function(e){if(null==e||"function"!=typeof e.constructor)return!1;let{constructor:t}=e;return"function"==typeof t.config&&"number"==typeof t.EUCLID}(e)))return BigInt(e.toString(10));if("number"==typeof e)return BigInt(rU(e));if("string"==typeof e){if(rb.test(e))return BigInt(e);if(rO(e))return BigInt(rR(e,!0))}throw ra(`Not an integer: ${String(e)}`)}async function rL(){return crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"])}async function rj(e,t){return crypto.subtle.deriveKey({name:"ECDH",public:t},e,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function rB(e,t){let r=crypto.getRandomValues(new Uint8Array(12)),i=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},e,new TextEncoder().encode(t));return{iv:r,cipherText:i}}async function rW(e,{iv:t,cipherText:r}){let i=await crypto.subtle.decrypt({name:"AES-GCM",iv:t},e,r);return new TextDecoder().decode(i)}function rF(e){switch(e){case"public":return"spki";case"private":return"pkcs8"}}async function rH(e,t){let r=rF(e);return r_(new Uint8Array(await crypto.subtle.exportKey(r,t)))}async function rq(e,t){let r=rF(e),i=rA(t).buffer;return await crypto.subtle.importKey(r,new Uint8Array(i),{name:"ECDH",namedCurve:"P-256"},!0,"private"===e?["deriveKey"]:[])}async function rz(e,t){return rB(t,JSON.stringify(e,(e,t)=>t instanceof Error?Object.assign(Object.assign({},t.code?{code:t.code}:{}),{message:t.message}):t))}async function r$(e,t){return JSON.parse(await rW(t,e))}let rK={storageKey:"ownPrivateKey",keyType:"private"},rV={storageKey:"ownPublicKey",keyType:"public"},rJ={storageKey:"peerPublicKey",keyType:"public"};class rZ{constructor(){this.storage=new t2("CBWSDK","SCWKeyManager"),this.ownPrivateKey=null,this.ownPublicKey=null,this.peerPublicKey=null,this.sharedSecret=null}async getOwnPublicKey(){return await this.loadKeysIfNeeded(),this.ownPublicKey}async getSharedSecret(){return await this.loadKeysIfNeeded(),this.sharedSecret}async setPeerPublicKey(e){this.sharedSecret=null,this.peerPublicKey=e,await this.storeKey(rJ,e),await this.loadKeysIfNeeded()}async clear(){this.ownPrivateKey=null,this.ownPublicKey=null,this.peerPublicKey=null,this.sharedSecret=null,this.storage.removeItem(rV.storageKey),this.storage.removeItem(rK.storageKey),this.storage.removeItem(rJ.storageKey)}async generateKeyPair(){let e=await rL();this.ownPrivateKey=e.privateKey,this.ownPublicKey=e.publicKey,await this.storeKey(rK,e.privateKey),await this.storeKey(rV,e.publicKey)}async loadKeysIfNeeded(){null===this.ownPrivateKey&&(this.ownPrivateKey=await this.loadKey(rK)),null===this.ownPublicKey&&(this.ownPublicKey=await this.loadKey(rV)),(null===this.ownPrivateKey||null===this.ownPublicKey)&&await this.generateKeyPair(),null===this.peerPublicKey&&(this.peerPublicKey=await this.loadKey(rJ)),null===this.sharedSecret&&null!==this.ownPrivateKey&&null!==this.peerPublicKey&&(this.sharedSecret=await rj(this.ownPrivateKey,this.peerPublicKey))}async loadKey(e){let t=this.storage.getItem(e.storageKey);return t?rq(e.keyType,t):null}async storeKey(e,t){let r=await rH(e.keyType,t);this.storage.setItem(e.storageKey,r)}}let rG="4.3.2",rY="@coinbase/wallet-sdk";async function rQ(e,t){let r=Object.assign(Object.assign({},e),{jsonrpc:"2.0",id:crypto.randomUUID()}),i=await window.fetch(t,{method:"POST",body:JSON.stringify(r),mode:"cors",headers:{"Content-Type":"application/json","X-Cbw-Sdk-Version":rG,"X-Cbw-Sdk-Platform":rY}}),{result:n,error:s}=await i.json();if(s)throw s;return n}let rX="accounts",r0="activeChain",r1="availableChains",r2="walletCapabilities";class r3{constructor(e){var t,r,i;this.metadata=e.metadata,this.communicator=e.communicator,this.callback=e.callback,this.keyManager=new rZ,this.storage=new t2("CBWSDK","SCWStateManager"),this.accounts=null!=(t=this.storage.loadObject(rX))?t:[],this.chain=this.storage.loadObject(r0)||{id:null!=(i=null==(r=e.metadata.appChainIds)?void 0:r[0])?i:1},this.handshake=this.handshake.bind(this),this.request=this.request.bind(this),this.createRequestMessage=this.createRequestMessage.bind(this),this.decryptResponseMessage=this.decryptResponseMessage.bind(this)}async handshake(e){var t,r,i,n;await (null==(r=(t=this.communicator).waitForPopupLoaded)?void 0:r.call(t));let s=await this.createRequestMessage({handshake:{method:e.method,params:Object.assign({},this.metadata,null!=(i=e.params)?i:{})}}),a=await this.communicator.postRequestAndWaitForResponse(s);if("failure"in a.content)throw a.content.failure;let o=await rq("public",a.sender);await this.keyManager.setPeerPublicKey(o);let l=(await this.decryptResponseMessage(a)).result;if("error"in l)throw l.error;if("eth_requestAccounts"===e.method){let e=l.value;this.accounts=e,this.storage.storeObject(rX,e),null==(n=this.callback)||n.call(this,"accountsChanged",e)}}async request(e){var t;if(0===this.accounts.length)if("wallet_sendCalls"===e.method)return this.sendRequestToPopup(e);else throw rc();switch(e.method){case"eth_requestAccounts":return null==(t=this.callback)||t.call(this,"connect",{chainId:rk(this.chain.id)}),this.accounts;case"eth_accounts":return this.accounts;case"eth_coinbase":return this.accounts[0];case"net_version":return this.chain.id;case"eth_chainId":return rk(this.chain.id);case"wallet_getCapabilities":return this.storage.loadObject(r2);case"wallet_switchEthereumChain":return this.handleSwitchChainRequest(e);case"eth_ecRecover":case"personal_sign":case"wallet_sign":case"personal_ecRecover":case"eth_signTransaction":case"eth_sendTransaction":case"eth_signTypedData_v1":case"eth_signTypedData_v3":case"eth_signTypedData_v4":case"eth_signTypedData":case"wallet_addEthereumChain":case"wallet_watchAsset":case"wallet_sendCalls":case"wallet_showCallsStatus":case"wallet_grantPermissions":return this.sendRequestToPopup(e);default:if(!this.chain.rpcUrl)throw ro("No RPC URL set for chain");return rQ(e,this.chain.rpcUrl)}}async sendRequestToPopup(e){var t,r;await (null==(r=(t=this.communicator).waitForPopupLoaded)?void 0:r.call(t));let i=await this.sendEncryptedRequest(e),n=(await this.decryptResponseMessage(i)).result;if("error"in n)throw n.error;return n.value}async cleanup(){var e,t;this.storage.clear(),await this.keyManager.clear(),this.accounts=[],this.chain={id:null!=(t=null==(e=this.metadata.appChainIds)?void 0:e[0])?t:1}}async handleSwitchChainRequest(e){var t;let r=e.params;if(!r||!(null==(t=r[0])?void 0:t.chainId))throw ra();let i=rU(r[0].chainId);if(this.updateChain(i))return null;let n=await this.sendRequestToPopup(e);return null===n&&this.updateChain(i),n}async sendEncryptedRequest(e){let t=await this.keyManager.getSharedSecret();if(!t)throw rc("No valid session found, try requestAccounts before other methods");let r=await rz({action:e,chainId:this.chain.id},t),i=await this.createRequestMessage({encrypted:r});return this.communicator.postRequestAndWaitForResponse(i)}async createRequestMessage(e){let t=await rH("public",await this.keyManager.getOwnPublicKey());return{id:crypto.randomUUID(),sender:t,content:e,timestamp:new Date}}async decryptResponseMessage(e){var t,r;let i=e.content;if("failure"in i)throw i.failure;let n=await this.keyManager.getSharedSecret();if(!n)throw rc("Invalid session");let s=await r$(i.encrypted,n),a=null==(t=s.data)?void 0:t.chains;if(a){let e=Object.entries(a).map(([e,t])=>({id:Number(e),rpcUrl:t}));this.storage.storeObject(r1,e),this.updateChain(this.chain.id,e)}let o=null==(r=s.data)?void 0:r.capabilities;return o&&this.storage.storeObject(r2,o),s}updateChain(e,t){var r;let i=null!=t?t:this.storage.loadObject(r1),n=null==i?void 0:i.find(t=>t.id===e);return!!n&&(n!==this.chain&&(this.chain=n,this.storage.storeObject(r0,n),null==(r=this.callback)||r.call(this,"chainChanged",rk(n.id))),!0)}}var r5=e.i(980423);let r8="Addresses";function r6(e){return void 0!==e.errorMessage}class r4{constructor(e){this.secret=e}async encrypt(e){let t=this.secret;if(64!==t.length)throw Error("secret must be 256 bits");let r=crypto.getRandomValues(new Uint8Array(12)),i=await crypto.subtle.importKey("raw",rA(t),{name:"aes-gcm"},!1,["encrypt","decrypt"]),n=new TextEncoder,s=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r},i,n.encode(e)),a=s.slice(s.byteLength-16),o=s.slice(0,s.byteLength-16),l=new Uint8Array(a),c=new Uint8Array(o);return r_(new Uint8Array([...r,...l,...c]))}async decrypt(e){let t=this.secret;if(64!==t.length)throw Error("secret must be 256 bits");return new Promise((r,i)=>{!async function(){let n=await crypto.subtle.importKey("raw",rA(t),{name:"aes-gcm"},!1,["encrypt","decrypt"]),s=rA(e),a=s.slice(0,12),o=s.slice(12,28),l=new Uint8Array([...s.slice(28),...o]),c={name:"AES-GCM",iv:new Uint8Array(a)};try{let e=await window.crypto.subtle.decrypt(c,n,l),t=new TextDecoder;r(t.decode(e))}catch(e){i(e)}}()})}}class r7{constructor(e,t,r){this.linkAPIUrl=e,this.sessionId=t;const i=`${t}:${r}`;this.auth=`Basic ${btoa(i)}`}async markUnseenEventsAsSeen(e){return Promise.all(e.map(e=>fetch(`${this.linkAPIUrl}/events/${e.eventId}/seen`,{method:"POST",headers:{Authorization:this.auth}}))).catch(e=>console.error("Unabled to mark event as failed:",e))}async fetchUnseenEvents(){var e;let t=await fetch(`${this.linkAPIUrl}/events?unseen=true`,{headers:{Authorization:this.auth}});if(t.ok){let{events:r,error:i}=await t.json();if(i)throw Error(`Check unseen events failed: ${i}`);let n=null!=(e=null==r?void 0:r.filter(e=>"Web3Response"===e.event).map(e=>({type:"Event",sessionId:this.sessionId,eventId:e.id,event:e.event,data:e.data})))?e:[];return this.markUnseenEventsAsSeen(n),n}throw Error(`Check unseen events failed: ${t.status}`)}}(C_=CB||(CB={}))[C_.DISCONNECTED=0]="DISCONNECTED",C_[C_.CONNECTING=1]="CONNECTING",C_[C_.CONNECTED=2]="CONNECTED";class r9{setConnectionStateListener(e){this.connectionStateListener=e}setIncomingDataListener(e){this.incomingDataListener=e}constructor(e,t=WebSocket){this.WebSocketClass=t,this.webSocket=null,this.pendingData=[],this.url=e.replace(/^http/,"ws")}async connect(){if(this.webSocket)throw Error("webSocket object is not null");return new Promise((e,t)=>{var r;let i;try{this.webSocket=i=new this.WebSocketClass(this.url)}catch(e){t(e);return}null==(r=this.connectionStateListener)||r.call(this,CB.CONNECTING),i.onclose=e=>{var r;this.clearWebSocket(),t(Error(`websocket error ${e.code}: ${e.reason}`)),null==(r=this.connectionStateListener)||r.call(this,CB.DISCONNECTED)},i.onopen=t=>{var r;e(),null==(r=this.connectionStateListener)||r.call(this,CB.CONNECTED),this.pendingData.length>0&&([...this.pendingData].forEach(e=>this.sendData(e)),this.pendingData=[])},i.onmessage=e=>{var t,r;if("h"===e.data)null==(t=this.incomingDataListener)||t.call(this,{type:"Heartbeat"});else try{let t=JSON.parse(e.data);null==(r=this.incomingDataListener)||r.call(this,t)}catch(e){}}})}disconnect(){var e;let{webSocket:t}=this;if(t){this.clearWebSocket(),null==(e=this.connectionStateListener)||e.call(this,CB.DISCONNECTED),this.connectionStateListener=void 0,this.incomingDataListener=void 0;try{t.close()}catch(e){}}}sendData(e){let{webSocket:t}=this;if(!t){this.pendingData.push(e),this.connect();return}t.send(e)}clearWebSocket(){let{webSocket:e}=this;e&&(this.webSocket=null,e.onclose=null,e.onerror=null,e.onmessage=null,e.onopen=null)}}class ie{constructor({session:e,linkAPIUrl:t,listener:r}){this.destroyed=!1,this.lastHeartbeatResponse=0,this.nextReqId=rw(1),this._connected=!1,this._linked=!1,this.shouldFetchUnseenEventsOnConnect=!1,this.requestResolutions=new Map,this.handleSessionMetadataUpdated=e=>{e&&new Map([["__destroyed",this.handleDestroyed],["EthereumAddress",this.handleAccountUpdated],["WalletUsername",this.handleWalletUsernameUpdated],["AppVersion",this.handleAppVersionUpdated],["ChainId",t=>e.JsonRpcUrl&&this.handleChainUpdated(t,e.JsonRpcUrl)]]).forEach((t,r)=>{let i=e[r];void 0!==i&&t(i)})},this.handleDestroyed=e=>{var t;"1"===e&&(null==(t=this.listener)||t.resetAndReload())},this.handleAccountUpdated=async e=>{var t;let r=await this.cipher.decrypt(e);null==(t=this.listener)||t.accountUpdated(r)},this.handleMetadataUpdated=async(e,t)=>{var r;let i=await this.cipher.decrypt(t);null==(r=this.listener)||r.metadataUpdated(e,i)},this.handleWalletUsernameUpdated=async e=>{this.handleMetadataUpdated("walletUsername",e)},this.handleAppVersionUpdated=async e=>{this.handleMetadataUpdated("AppVersion",e)},this.handleChainUpdated=async(e,t)=>{var r;let i=await this.cipher.decrypt(e),n=await this.cipher.decrypt(t);null==(r=this.listener)||r.chainUpdated(i,n)},this.session=e,this.cipher=new r4(e.secret),this.listener=r;const i=new r9(`${t}/rpc`,WebSocket);i.setConnectionStateListener(async e=>{let t=!1;switch(e){case CB.DISCONNECTED:if(!this.destroyed){let e=async()=>{await new Promise(e=>setTimeout(e,5e3)),this.destroyed||i.connect().catch(()=>{e()})};e()}break;case CB.CONNECTED:t=await this.handleConnected(),this.updateLastHeartbeat(),setInterval(()=>{this.heartbeat()},1e4),this.shouldFetchUnseenEventsOnConnect&&this.fetchUnseenEventsAPI();case CB.CONNECTING:}this.connected!==t&&(this.connected=t)}),i.setIncomingDataListener(e=>{var t;switch(e.type){case"Heartbeat":this.updateLastHeartbeat();return;case"IsLinkedOK":case"Linked":{let t="IsLinkedOK"===e.type?e.linked:void 0;this.linked=t||e.onlineGuests>0;break}case"GetSessionConfigOK":case"SessionConfigUpdated":this.handleSessionMetadataUpdated(e.metadata);break;case"Event":this.handleIncomingEvent(e)}void 0!==e.id&&(null==(t=this.requestResolutions.get(e.id))||t(e))}),this.ws=i,this.http=new r7(t,e.id,e.key)}connect(){if(this.destroyed)throw Error("instance is destroyed");this.ws.connect()}async destroy(){this.destroyed||(await this.makeRequest({type:"SetSessionConfig",id:rw(this.nextReqId++),sessionId:this.session.id,metadata:{__destroyed:"1"}},{timeout:1e3}),this.destroyed=!0,this.ws.disconnect(),this.listener=void 0)}get connected(){return this._connected}set connected(e){this._connected=e}get linked(){return this._linked}set linked(e){var t,r;this._linked=e,e&&(null==(t=this.onceLinked)||t.call(this)),null==(r=this.listener)||r.linkedUpdated(e)}setOnceLinked(e){return new Promise(t=>{this.linked?e().then(t):this.onceLinked=()=>{e().then(t),this.onceLinked=void 0}})}async handleIncomingEvent(e){var t;if("Event"!==e.type||"Web3Response"!==e.event)return;let r=JSON.parse(await this.cipher.decrypt(e.data));if("WEB3_RESPONSE"!==r.type)return;let{id:i,response:n}=r;null==(t=this.listener)||t.handleWeb3ResponseMessage(i,n)}async checkUnseenEvents(){if(!this.connected){this.shouldFetchUnseenEventsOnConnect=!0;return}await new Promise(e=>setTimeout(e,250));try{await this.fetchUnseenEventsAPI()}catch(e){console.error("Unable to check for unseen events",e)}}async fetchUnseenEventsAPI(){this.shouldFetchUnseenEventsOnConnect=!1,(await this.http.fetchUnseenEvents()).forEach(e=>this.handleIncomingEvent(e))}async publishEvent(e,t,r=!1){let i=await this.cipher.encrypt(JSON.stringify(Object.assign(Object.assign({},t),{origin:location.origin,location:location.href,relaySource:"coinbaseWalletExtension"in window&&window.coinbaseWalletExtension?"injected_sdk":"sdk"}))),n={type:"PublishEvent",id:rw(this.nextReqId++),sessionId:this.session.id,event:e,data:i,callWebhook:r};return this.setOnceLinked(async()=>{let e=await this.makeRequest(n);if("Fail"===e.type)throw Error(e.error||"failed to publish event");return e.eventId})}sendData(e){this.ws.sendData(JSON.stringify(e))}updateLastHeartbeat(){this.lastHeartbeatResponse=Date.now()}heartbeat(){if(Date.now()-this.lastHeartbeatResponse>2e4)return void this.ws.disconnect();try{this.ws.sendData("h")}catch(e){}}async makeRequest(e,t={timeout:6e4}){let r,i=e.id;return this.sendData(e),Promise.race([new Promise((e,n)=>{r=window.setTimeout(()=>{n(Error(`request ${i} timed out`))},t.timeout)}),new Promise(e=>{this.requestResolutions.set(i,t=>{clearTimeout(r),e(t),this.requestResolutions.delete(i)})})])}async handleConnected(){return"Fail"!==(await this.makeRequest({type:"HostSession",id:rw(this.nextReqId++),sessionId:this.session.id,sessionKey:this.session.key})).type&&(this.sendData({type:"IsLinked",id:rw(this.nextReqId++),sessionId:this.session.id}),this.sendData({type:"GetSessionConfig",id:rw(this.nextReqId++),sessionId:this.session.id}),!0)}}class it{constructor(){this._nextRequestId=0,this.callbacks=new Map}makeRequestId(){this._nextRequestId=(this._nextRequestId+1)%0x7fffffff;let e=this._nextRequestId,t=rP(e.toString(16));return this.callbacks.get(t)&&this.callbacks.delete(t),e}}function ir(e,...t){if(!(e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function ii(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}let is=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),ia=(e,t)=>e<<32-t|e>>>t;new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];let io=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function il(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}(e)),ir(e),e}class ic{clone(){return this._cloneInto()}}let id=(e,t,r)=>e&t^~e&r,iu=(e,t,r)=>e&t^e&r^t&r;class ih extends ic{constructor(e,t,r,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=is(this.buffer)}update(e){ii(this);let{view:t,buffer:r,blockLen:i}=this,n=(e=il(e)).length;for(let s=0;s<n;){let a=Math.min(i-this.pos,n-s);if(a===i){let t=is(e);for(;i<=n-s;s+=i)this.process(t,s);continue}r.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ii(this);ir(e);let t=this.outputLen;if(e.length<t)throw Error(`digestInto() expects output buffer of length at least ${t}`);this.finished=!0;let{buffer:r,view:i,blockLen:n,isLE:s}=this,{pos:a}=this;r[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>n-a&&(this.process(i,0),a=0);for(let e=a;e<n;e++)r[e]=0;!function(e,t,r,i){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,i);let n=BigInt(32),s=BigInt(0xffffffff),a=Number(r>>n&s),o=Number(r&s),l=4*!!i,c=4*!i;e.setUint32(t+l,a,i),e.setUint32(t+c,o,i)}(i,n-8,BigInt(8*this.length),s),this.process(i,0);let o=is(e),l=this.outputLen;if(l%4)throw Error("_sha2: outputLen should be aligned to 32bit");let c=l/4,d=this.get();if(c>d.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)o.setUint32(4*e,d[e],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:i,finished:n,destroyed:s,pos:a}=this;return e.length=i,e.pos=a,e.finished=n,e.destroyed=s,i%t&&e.buffer.set(r),e}}let ip=new Uint32Array([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),iy=new Uint32Array([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),ig=new Uint32Array(64);class im extends ih{constructor(){super(64,32,8,!1),this.A=0|iy[0],this.B=0|iy[1],this.C=0|iy[2],this.D=0|iy[3],this.E=0|iy[4],this.F=0|iy[5],this.G=0|iy[6],this.H=0|iy[7]}get(){let{A:e,B:t,C:r,D:i,E:n,F:s,G:a,H:o}=this;return[e,t,r,i,n,s,a,o]}set(e,t,r,i,n,s,a,o){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|i,this.E=0|n,this.F=0|s,this.G=0|a,this.H=0|o}process(e,t){for(let r=0;r<16;r++,t+=4)ig[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=ig[e-15],r=ig[e-2],i=ia(t,7)^ia(t,18)^t>>>3,n=ia(r,17)^ia(r,19)^r>>>10;ig[e]=n+ig[e-7]+i+ig[e-16]|0}let{A:r,B:i,C:n,D:s,E:a,F:o,G:l,H:c}=this;for(let e=0;e<64;e++){let t=c+(ia(a,6)^ia(a,11)^ia(a,25))+id(a,o,l)+ip[e]+ig[e]|0,d=(ia(r,2)^ia(r,13)^ia(r,22))+iu(r,i,n)|0;c=l,l=o,o=a,a=s+t|0,s=n,n=i,i=r,r=t+d|0}r=r+this.A|0,i=i+this.B|0,n=n+this.C|0,s=s+this.D|0,a=a+this.E|0,o=o+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(r,i,n,s,a,o,l,c)}roundClean(){ig.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}let iw=(CA=()=>new im,(h=e=>CA().update(il(e)).digest()).outputLen=(p=CA()).outputLen,h.blockLen=p.blockLen,h.create=()=>CA(),h),ib="session:id",iv="session:secret",iE="session:linked";class i_{constructor(e,t,r,i=!1){this.storage=e,this.id=t,this.secret=r,this.key=function(e){ir(e);let t="";for(let r=0;r<e.length;r++)t+=io[e[r]];return t}(iw(`${t}, ${r} WalletLink`)),this._linked=!!i}static create(e){return new i_(e,rE(16),rE(32)).save()}static load(e){let t=e.getItem(ib),r=e.getItem(iE),i=e.getItem(iv);return t&&i?new i_(e,t,i,"1"===r):null}get linked(){return this._linked}set linked(e){this._linked=e,this.persistLinked()}save(){return this.storage.setItem(ib,this.id),this.storage.setItem(iv,this.secret),this.persistLinked(),this}persistLinked(){this.storage.setItem(iE,this._linked?"1":"0")}}function iA(){var e,t;return null!=(t=null==(e=null==window?void 0:window.matchMedia)?void 0:e.call(window,"(prefers-color-scheme: dark)").matches)&&t}function iS(){let e=document.createElement("style");e.type="text/css",e.appendChild(document.createTextNode('@namespace svg "http://www.w3.org/2000/svg";.-cbwsdk-css-reset,.-cbwsdk-css-reset *{animation:none;animation-delay:0;animation-direction:normal;animation-duration:0;animation-fill-mode:none;animation-iteration-count:1;animation-name:none;animation-play-state:running;animation-timing-function:ease;backface-visibility:visible;background:0;background-attachment:scroll;background-clip:border-box;background-color:rgba(0,0,0,0);background-image:none;background-origin:padding-box;background-position:0 0;background-position-x:0;background-position-y:0;background-repeat:repeat;background-size:auto auto;border:0;border-style:none;border-width:medium;border-color:inherit;border-bottom:0;border-bottom-color:inherit;border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-style:none;border-bottom-width:medium;border-collapse:separate;border-image:none;border-left:0;border-left-color:inherit;border-left-style:none;border-left-width:medium;border-radius:0;border-right:0;border-right-color:inherit;border-right-style:none;border-right-width:medium;border-spacing:0;border-top:0;border-top-color:inherit;border-top-left-radius:0;border-top-right-radius:0;border-top-style:none;border-top-width:medium;box-shadow:none;box-sizing:border-box;caption-side:top;clear:none;clip:auto;color:inherit;columns:auto;column-count:auto;column-fill:balance;column-gap:normal;column-rule:medium none currentColor;column-rule-color:currentColor;column-rule-style:none;column-rule-width:none;column-span:1;column-width:auto;counter-increment:none;counter-reset:none;direction:ltr;empty-cells:show;float:none;font:normal;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,sans-serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:normal;height:auto;hyphens:none;letter-spacing:normal;line-height:normal;list-style:none;list-style-image:none;list-style-position:outside;list-style-type:disc;margin:0;margin-bottom:0;margin-left:0;margin-right:0;margin-top:0;opacity:1;orphans:0;outline:0;outline-color:invert;outline-style:none;outline-width:medium;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;perspective:none;perspective-origin:50% 50%;pointer-events:auto;position:static;quotes:"\\201C" "\\201D" "\\2018" "\\2019";tab-size:8;table-layout:auto;text-align:inherit;text-align-last:auto;text-decoration:none;text-decoration-color:inherit;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-shadow:none;text-transform:none;transform:none;transform-style:flat;transition:none;transition-delay:0s;transition-duration:0s;transition-property:none;transition-timing-function:ease;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:0;word-spacing:normal;z-index:auto}.-cbwsdk-css-reset strong{font-weight:bold}.-cbwsdk-css-reset *{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,sans-serif;line-height:1}.-cbwsdk-css-reset [class*=container]{margin:0;padding:0}.-cbwsdk-css-reset style{display:none}')),document.documentElement.appendChild(e)}function ix(){for(var e,t,r=0,i="";r<arguments.length;)(e=arguments[r++])&&(t=function e(t){var r,i,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t)if(Array.isArray(t))for(r=0;r<t.length;r++)t[r]&&(i=e(t[r]))&&(n&&(n+=" "),n+=i);else for(r in t)t[r]&&(n&&(n+=" "),n+=r);return n}(e))&&(i&&(i+=" "),i+=t);return i}var iI=e.i(928020),ik=e.i(698920);class iT{constructor(){this.items=new Map,this.nextItemKey=0,this.root=null,this.darkMode=iA()}attach(e){this.root=document.createElement("div"),this.root.className="-cbwsdk-snackbar-root",e.appendChild(this.root),this.render()}presentItem(e){let t=this.nextItemKey++;return this.items.set(t,e),this.render(),()=>{this.items.delete(t),this.render()}}clear(){this.items.clear(),this.render()}render(){this.root&&(0,iI.render)((0,iI.h)("div",null,(0,iI.h)(iC,{darkMode:this.darkMode},Array.from(this.items.entries()).map(([e,t])=>(0,iI.h)(iP,Object.assign({},t,{key:e}))))),this.root)}}let iC=e=>(0,iI.h)("div",{class:ix("-cbwsdk-snackbar-container")},(0,iI.h)("style",null,".-cbwsdk-css-reset .-gear-container{margin-left:16px !important;margin-right:9px !important;display:flex;align-items:center;justify-content:center;width:24px;height:24px;transition:opacity .25s}.-cbwsdk-css-reset .-gear-container *{user-select:none}.-cbwsdk-css-reset .-gear-container svg{opacity:0;position:absolute}.-cbwsdk-css-reset .-gear-icon{height:12px;width:12px;z-index:10000}.-cbwsdk-css-reset .-cbwsdk-snackbar{align-items:flex-end;display:flex;flex-direction:column;position:fixed;right:0;top:0;z-index:2147483647}.-cbwsdk-css-reset .-cbwsdk-snackbar *{user-select:none}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance{display:flex;flex-direction:column;margin:8px 16px 0 16px;overflow:visible;text-align:left;transform:translateX(0);transition:opacity .25s,transform .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header:hover .-gear-container svg{opacity:1}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header{display:flex;align-items:center;background:#fff;overflow:hidden;border:1px solid #e7ebee;box-sizing:border-box;border-radius:8px;cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header-cblogo{margin:8px 8px 8px 8px}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header *{cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header-message{color:#000;font-size:13px;line-height:1.5;user-select:none}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu{background:#fff;transition:opacity .25s ease-in-out,transform .25s linear,visibility 0s;visibility:hidden;border:1px solid #e7ebee;box-sizing:border-box;border-radius:8px;opacity:0;flex-direction:column;padding-left:8px;padding-right:8px}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item:last-child{margin-bottom:8px !important}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item:hover{background:#f5f7f8;border-radius:6px;transition:background .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item:hover span{color:#050f19;transition:color .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item:hover svg path{fill:#000;transition:fill .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item{visibility:inherit;height:35px;margin-top:8px;margin-bottom:0;display:flex;flex-direction:row;align-items:center;padding:8px;cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item *{visibility:inherit;cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-is-red:hover{background:rgba(223,95,103,.2);transition:background .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-is-red:hover *{cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-is-red:hover svg path{fill:#df5f67;transition:fill .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-is-red:hover span{color:#df5f67;transition:color .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-info{color:#aaa;font-size:13px;margin:0 8px 0 32px;position:absolute}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-hidden{opacity:0;text-align:left;transform:translateX(25%);transition:opacity .5s linear}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-expanded .-cbwsdk-snackbar-instance-menu{opacity:1;display:flex;transform:translateY(8px);visibility:visible}"),(0,iI.h)("div",{class:"-cbwsdk-snackbar"},e.children)),iP=({autoExpand:e,message:t,menuItems:r})=>{let[i,n]=(0,ik.useState)(!0),[s,a]=(0,ik.useState)(null!=e&&e);return(0,ik.useEffect)(()=>{let e=[window.setTimeout(()=>{n(!1)},1),window.setTimeout(()=>{a(!0)},1e4)];return()=>{e.forEach(window.clearTimeout)}}),(0,iI.h)("div",{class:ix("-cbwsdk-snackbar-instance",i&&"-cbwsdk-snackbar-instance-hidden",s&&"-cbwsdk-snackbar-instance-expanded")},(0,iI.h)("div",{class:"-cbwsdk-snackbar-instance-header",onClick:()=>{a(!s)}},(0,iI.h)("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEuNDkyIDEwLjQxOWE4LjkzIDguOTMgMCAwMTguOTMtOC45M2gxMS4xNjNhOC45MyA4LjkzIDAgMDE4LjkzIDguOTN2MTEuMTYzYTguOTMgOC45MyAwIDAxLTguOTMgOC45M0gxMC40MjJhOC45MyA4LjkzIDAgMDEtOC45My04LjkzVjEwLjQxOXoiIGZpbGw9IiMxNjUyRjAiLz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTEwLjQxOSAwSDIxLjU4QzI3LjMzNSAwIDMyIDQuNjY1IDMyIDEwLjQxOVYyMS41OEMzMiAyNy4zMzUgMjcuMzM1IDMyIDIxLjU4MSAzMkgxMC40MkM0LjY2NSAzMiAwIDI3LjMzNSAwIDIxLjU4MVYxMC40MkMwIDQuNjY1IDQuNjY1IDAgMTAuNDE5IDB6bTAgMS40ODhhOC45MyA4LjkzIDAgMDAtOC45MyA4LjkzdjExLjE2M2E4LjkzIDguOTMgMCAwMDguOTMgOC45M0gyMS41OGE4LjkzIDguOTMgMCAwMDguOTMtOC45M1YxMC40MmE4LjkzIDguOTMgMCAwMC04LjkzLTguOTNIMTAuNDJ6IiBmaWxsPSIjZmZmIi8+PHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xNS45OTggMjYuMDQ5Yy01LjU0OSAwLTEwLjA0Ny00LjQ5OC0xMC4wNDctMTAuMDQ3IDAtNS41NDggNC40OTgtMTAuMDQ2IDEwLjA0Ny0xMC4wNDYgNS41NDggMCAxMC4wNDYgNC40OTggMTAuMDQ2IDEwLjA0NiAwIDUuNTQ5LTQuNDk4IDEwLjA0Ny0xMC4wNDYgMTAuMDQ3eiIgZmlsbD0iI2ZmZiIvPjxwYXRoIGQ9Ik0xMi43NjIgMTQuMjU0YzAtLjgyMi42NjctMS40ODkgMS40ODktMS40ODloMy40OTdjLjgyMiAwIDEuNDg4LjY2NiAxLjQ4OCAxLjQ4OXYzLjQ5N2MwIC44MjItLjY2NiAxLjQ4OC0xLjQ4OCAxLjQ4OGgtMy40OTdhMS40ODggMS40ODggMCAwMS0xLjQ4OS0xLjQ4OHYtMy40OTh6IiBmaWxsPSIjMTY1MkYwIi8+PC9zdmc+",class:"-cbwsdk-snackbar-instance-header-cblogo"})," ",(0,iI.h)("div",{class:"-cbwsdk-snackbar-instance-header-message"},t),(0,iI.h)("div",{class:"-gear-container"},!s&&(0,iI.h)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,iI.h)("circle",{cx:"12",cy:"12",r:"12",fill:"#F5F7F8"})),(0,iI.h)("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDYuNzV2LTEuNWwtMS43Mi0uNTdjLS4wOC0uMjctLjE5LS41Mi0uMzItLjc3bC44MS0xLjYyLTEuMDYtMS4wNi0xLjYyLjgxYy0uMjQtLjEzLS41LS4yNC0uNzctLjMyTDYuNzUgMGgtMS41bC0uNTcgMS43MmMtLjI3LjA4LS41My4xOS0uNzcuMzJsLTEuNjItLjgxLTEuMDYgMS4wNi44MSAxLjYyYy0uMTMuMjQtLjI0LjUtLjMyLjc3TDAgNS4yNXYxLjVsMS43Mi41N2MuMDguMjcuMTkuNTMuMzIuNzdsLS44MSAxLjYyIDEuMDYgMS4wNiAxLjYyLS44MWMuMjQuMTMuNS4yMy43Ny4zMkw1LjI1IDEyaDEuNWwuNTctMS43MmMuMjctLjA4LjUyLS4xOS43Ny0uMzJsMS42Mi44MSAxLjA2LTEuMDYtLjgxLTEuNjJjLjEzLS4yNC4yMy0uNS4zMi0uNzdMMTIgNi43NXpNNiA4LjVhMi41IDIuNSAwIDAxMC01IDIuNSAyLjUgMCAwMTAgNXoiIGZpbGw9IiMwNTBGMTkiLz48L3N2Zz4=",class:"-gear-icon",title:"Expand"}))),r&&r.length>0&&(0,iI.h)("div",{class:"-cbwsdk-snackbar-instance-menu"},r.map((e,t)=>(0,iI.h)("div",{class:ix("-cbwsdk-snackbar-instance-menu-item",e.isRed&&"-cbwsdk-snackbar-instance-menu-item-is-red"),onClick:e.onClick,key:t},(0,iI.h)("svg",{width:e.svgWidth,height:e.svgHeight,viewBox:"0 0 10 11",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,iI.h)("path",{"fill-rule":e.defaultFillRule,"clip-rule":e.defaultClipRule,d:e.path,fill:"#AAAAAA"})),(0,iI.h)("span",{class:ix("-cbwsdk-snackbar-instance-menu-item-info",e.isRed&&"-cbwsdk-snackbar-instance-menu-item-info-is-red")},e.info)))))},iO="M5.00008 0.96875C6.73133 0.96875 8.23758 1.94375 9.00008 3.375L10.0001 2.375V5.5H9.53133H7.96883H6.87508L7.80633 4.56875C7.41258 3.3875 6.31258 2.53125 5.00008 2.53125C3.76258 2.53125 2.70633 3.2875 2.25633 4.36875L0.812576 3.76875C1.50008 2.125 3.11258 0.96875 5.00008 0.96875ZM2.19375 6.43125C2.5875 7.6125 3.6875 8.46875 5 8.46875C6.2375 8.46875 7.29375 7.7125 7.74375 6.63125L9.1875 7.23125C8.5 8.875 6.8875 10.0312 5 10.0312C3.26875 10.0312 1.7625 9.05625 1 7.625L0 8.625V5.5H0.46875H2.03125H3.125L2.19375 6.43125Z";class iR{constructor(){this.attached=!1,this.snackbar=new iT}attach(){if(this.attached)throw Error("Coinbase Wallet SDK UI is already attached");let e=document.documentElement,t=document.createElement("div");t.className="-cbwsdk-css-reset",e.appendChild(t),this.snackbar.attach(t),this.attached=!0,iS()}showConnecting(e){let t;return t=e.isUnlinkedErrorState?{autoExpand:!0,message:"Connection lost",menuItems:[{isRed:!1,info:"Reset connection",svgWidth:"10",svgHeight:"11",path:"M5.00008 0.96875C6.73133 0.96875 8.23758 1.94375 9.00008 3.375L10.0001 2.375V5.5H9.53133H7.96883H6.87508L7.80633 4.56875C7.41258 3.3875 6.31258 2.53125 5.00008 2.53125C3.76258 2.53125 2.70633 3.2875 2.25633 4.36875L0.812576 3.76875C1.50008 2.125 3.11258 0.96875 5.00008 0.96875ZM2.19375 6.43125C2.5875 7.6125 3.6875 8.46875 5 8.46875C6.2375 8.46875 7.29375 7.7125 7.74375 6.63125L9.1875 7.23125C8.5 8.875 6.8875 10.0312 5 10.0312C3.26875 10.0312 1.7625 9.05625 1 7.625L0 8.625V5.5H0.46875H2.03125H3.125L2.19375 6.43125Z",defaultFillRule:"evenodd",defaultClipRule:"evenodd",onClick:e.onResetConnection}]}:{message:"Confirm on phone",menuItems:[{isRed:!0,info:"Cancel transaction",svgWidth:"11",svgHeight:"11",path:"M10.3711 1.52346L9.21775 0.370117L5.37109 4.21022L1.52444 0.370117L0.371094 1.52346L4.2112 5.37012L0.371094 9.21677L1.52444 10.3701L5.37109 6.53001L9.21775 10.3701L10.3711 9.21677L6.53099 5.37012L10.3711 1.52346Z",defaultFillRule:"inherit",defaultClipRule:"inherit",onClick:e.onCancel},{isRed:!1,info:"Reset connection",svgWidth:"10",svgHeight:"11",path:iO,defaultFillRule:"evenodd",defaultClipRule:"evenodd",onClick:e.onResetConnection}]},this.snackbar.presentItem(t)}}class iN{constructor(){this.root=null,this.darkMode=iA()}attach(){let e=document.documentElement;this.root=document.createElement("div"),this.root.className="-cbwsdk-css-reset",e.appendChild(this.root),iS()}present(e){this.render(e)}clear(){this.render(null)}render(e){!this.root||((0,iI.render)(null,this.root),e&&(0,iI.render)((0,iI.h)(iM,Object.assign({},e,{onDismiss:()=>{this.clear()},darkMode:this.darkMode})),this.root))}}let iM=({title:e,buttonText:t,darkMode:r,onButtonClick:i,onDismiss:n})=>(0,iI.h)(iC,{darkMode:r},(0,iI.h)("div",{class:"-cbwsdk-redirect-dialog"},(0,iI.h)("style",null,".-cbwsdk-css-reset .-cbwsdk-redirect-dialog-backdrop{position:fixed;top:0;left:0;right:0;bottom:0;transition:opacity .25s;background-color:rgba(10,11,13,.5)}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-backdrop-hidden{opacity:0}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box{display:block;position:fixed;top:50%;left:50%;transform:translate(-50%, -50%);padding:20px;border-radius:8px;background-color:#fff;color:#0a0b0d}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box p{display:block;font-weight:400;font-size:14px;line-height:20px;padding-bottom:12px;color:#5b636e}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box button{appearance:none;border:none;background:none;color:#0052ff;padding:0;text-decoration:none;display:block;font-weight:600;font-size:16px;line-height:24px}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box.dark{background-color:#0a0b0d;color:#fff}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box.dark button{color:#0052ff}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box.light{background-color:#fff;color:#0a0b0d}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box.light button{color:#0052ff}"),(0,iI.h)("div",{class:"-cbwsdk-redirect-dialog-backdrop",onClick:n}),(0,iI.h)("div",{class:ix("-cbwsdk-redirect-dialog-box",r?"dark":"light")},(0,iI.h)("p",null,e),(0,iI.h)("button",{onClick:i},t)))),iU="https://www.walletlink.org";class iD{constructor(){this.attached=!1,this.redirectDialog=new iN}attach(){if(this.attached)throw Error("Coinbase Wallet SDK UI is already attached");this.redirectDialog.attach(),this.attached=!0}redirectToCoinbaseWallet(e){let t=new URL("https://go.cb-w.com/walletlink");t.searchParams.append("redirect_url",function(){try{if(function(){try{return null!==window.frameElement}catch(e){return!1}}()&&window.top)return window.top.location;return window.location}catch(e){return window.location}}().href),e&&t.searchParams.append("wl_url",e);let r=document.createElement("a");r.target="cbw-opener",r.href=t.href,r.rel="noreferrer noopener",r.click()}openCoinbaseWalletDeeplink(e){this.redirectDialog.present({title:"Redirecting to Coinbase Wallet...",buttonText:"Open",onButtonClick:()=>{this.redirectToCoinbaseWallet(e)}}),setTimeout(()=>{this.redirectToCoinbaseWallet(e)},99)}showConnecting(e){return()=>{this.redirectDialog.clear()}}}class iL{constructor(e){this.chainCallbackParams={chainId:"",jsonRpcUrl:""},this.isMobileWeb=function(){var e;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(null==(e=null==window?void 0:window.navigator)?void 0:e.userAgent)}(),this.linkedUpdated=e=>{this.isLinked=e;let t=this.storage.getItem(r8);if(e&&(this._session.linked=e),this.isUnlinkedErrorState=!1,t){let r=t.split(" "),i="true"===this.storage.getItem("IsStandaloneSigning");""===r[0]||e||!this._session.linked||i||(this.isUnlinkedErrorState=!0)}},this.metadataUpdated=(e,t)=>{this.storage.setItem(e,t)},this.chainUpdated=(e,t)=>{(this.chainCallbackParams.chainId!==e||this.chainCallbackParams.jsonRpcUrl!==t)&&(this.chainCallbackParams={chainId:e,jsonRpcUrl:t},this.chainCallback&&this.chainCallback(t,Number.parseInt(e,10)))},this.accountUpdated=e=>{this.accountsCallback&&this.accountsCallback([e]),iL.accountRequestCallbackIds.size>0&&(Array.from(iL.accountRequestCallbackIds.values()).forEach(t=>{this.invokeCallback(t,{method:"requestEthereumAccounts",result:[e]})}),iL.accountRequestCallbackIds.clear())},this.resetAndReload=this.resetAndReload.bind(this),this.linkAPIUrl=e.linkAPIUrl,this.storage=e.storage,this.metadata=e.metadata,this.accountsCallback=e.accountsCallback,this.chainCallback=e.chainCallback;const{session:t,ui:r,connection:i}=this.subscribe();this._session=t,this.connection=i,this.relayEventManager=new it,this.ui=r,this.ui.attach()}subscribe(){let e=i_.load(this.storage)||i_.create(this.storage),{linkAPIUrl:t}=this,r=new ie({session:e,linkAPIUrl:t,listener:this}),i=this.isMobileWeb?new iD:new iR;return r.connect(),{session:e,ui:i,connection:r}}resetAndReload(){this.connection.destroy().then(()=>{let e=i_.load(this.storage);(null==e?void 0:e.id)===this._session.id&&t2.clearAll(),document.location.reload()}).catch(e=>{})}signEthereumTransaction(e){return this.sendRequest({method:"signEthereumTransaction",params:{fromAddress:e.fromAddress,toAddress:e.toAddress,weiValue:rI(e.weiValue),data:rS(e.data,!0),nonce:e.nonce,gasPriceInWei:e.gasPriceInWei?rI(e.gasPriceInWei):null,maxFeePerGas:e.gasPriceInWei?rI(e.gasPriceInWei):null,maxPriorityFeePerGas:e.gasPriceInWei?rI(e.gasPriceInWei):null,gasLimit:e.gasLimit?rI(e.gasLimit):null,chainId:e.chainId,shouldSubmit:!1}})}signAndSubmitEthereumTransaction(e){return this.sendRequest({method:"signEthereumTransaction",params:{fromAddress:e.fromAddress,toAddress:e.toAddress,weiValue:rI(e.weiValue),data:rS(e.data,!0),nonce:e.nonce,gasPriceInWei:e.gasPriceInWei?rI(e.gasPriceInWei):null,maxFeePerGas:e.maxFeePerGas?rI(e.maxFeePerGas):null,maxPriorityFeePerGas:e.maxPriorityFeePerGas?rI(e.maxPriorityFeePerGas):null,gasLimit:e.gasLimit?rI(e.gasLimit):null,chainId:e.chainId,shouldSubmit:!0}})}submitEthereumTransaction(e,t){return this.sendRequest({method:"submitEthereumTransaction",params:{signedTransaction:rS(e,!0),chainId:t}})}getWalletLinkSession(){return this._session}sendRequest(e){let t=null,r=rE(8),i=i=>{this.publishWeb3RequestCanceledEvent(r),this.handleErrorResponse(r,e.method,i),null==t||t()};return new Promise((n,s)=>{t=this.ui.showConnecting({isUnlinkedErrorState:this.isUnlinkedErrorState,onCancel:i,onResetConnection:this.resetAndReload}),this.relayEventManager.callbacks.set(r,e=>{if(null==t||t(),r6(e))return s(Error(e.errorMessage));n(e)}),this.publishWeb3RequestEvent(r,e)})}publishWeb3RequestEvent(e,t){let r={type:"WEB3_REQUEST",id:e,request:t};this.publishEvent("Web3Request",r,!0).then(e=>{}).catch(e=>{this.handleWeb3ResponseMessage(r.id,{method:t.method,errorMessage:e.message})}),this.isMobileWeb&&this.openCoinbaseWalletDeeplink(t.method)}openCoinbaseWalletDeeplink(e){if(this.ui instanceof iD)switch(e){case"requestEthereumAccounts":case"switchEthereumChain":return;default:window.addEventListener("blur",()=>{window.addEventListener("focus",()=>{this.connection.checkUnseenEvents()},{once:!0})},{once:!0}),this.ui.openCoinbaseWalletDeeplink()}}publishWeb3RequestCanceledEvent(e){this.publishEvent("Web3RequestCanceled",{type:"WEB3_REQUEST_CANCELED",id:e},!1).then()}publishEvent(e,t,r){return this.connection.publishEvent(e,t,r)}handleWeb3ResponseMessage(e,t){if("requestEthereumAccounts"===t.method){iL.accountRequestCallbackIds.forEach(e=>this.invokeCallback(e,t)),iL.accountRequestCallbackIds.clear();return}this.invokeCallback(e,t)}handleErrorResponse(e,t,r){var i;let n=null!=(i=null==r?void 0:r.message)?i:"Unspecified error message.";this.handleWeb3ResponseMessage(e,{method:t,errorMessage:n})}invokeCallback(e,t){let r=this.relayEventManager.callbacks.get(e);r&&(r(t),this.relayEventManager.callbacks.delete(e))}requestEthereumAccounts(){let{appName:e,appLogoUrl:t}=this.metadata,r={method:"requestEthereumAccounts",params:{appName:e,appLogoUrl:t}},i=rE(8);return new Promise((e,t)=>{this.relayEventManager.callbacks.set(i,r=>{if(r6(r))return t(Error(r.errorMessage));e(r)}),iL.accountRequestCallbackIds.add(i),this.publishWeb3RequestEvent(i,r)})}watchAsset(e,t,r,i,n,s){let a={method:"watchAsset",params:{type:e,options:{address:t,symbol:r,decimals:i,image:n},chainId:s}},o=null,l=rE(8),c=e=>{this.publishWeb3RequestCanceledEvent(l),this.handleErrorResponse(l,a.method,e),null==o||o()};return o=this.ui.showConnecting({isUnlinkedErrorState:this.isUnlinkedErrorState,onCancel:c,onResetConnection:this.resetAndReload}),new Promise((e,t)=>{this.relayEventManager.callbacks.set(l,r=>{if(null==o||o(),r6(r))return t(Error(r.errorMessage));e(r)}),this.publishWeb3RequestEvent(l,a)})}addEthereumChain(e,t,r,i,n,s){let a={method:"addEthereumChain",params:{chainId:e,rpcUrls:t,blockExplorerUrls:i,chainName:n,iconUrls:r,nativeCurrency:s}},o=null,l=rE(8),c=e=>{this.publishWeb3RequestCanceledEvent(l),this.handleErrorResponse(l,a.method,e),null==o||o()};return o=this.ui.showConnecting({isUnlinkedErrorState:this.isUnlinkedErrorState,onCancel:c,onResetConnection:this.resetAndReload}),new Promise((e,t)=>{this.relayEventManager.callbacks.set(l,r=>{if(null==o||o(),r6(r))return t(Error(r.errorMessage));e(r)}),this.publishWeb3RequestEvent(l,a)})}switchEthereumChain(e,t){let r={method:"switchEthereumChain",params:Object.assign({chainId:e},{address:t})},i=null,n=rE(8),s=e=>{this.publishWeb3RequestCanceledEvent(n),this.handleErrorResponse(n,r.method,e),null==i||i()};return i=this.ui.showConnecting({isUnlinkedErrorState:this.isUnlinkedErrorState,onCancel:s,onResetConnection:this.resetAndReload}),new Promise((e,t)=>{this.relayEventManager.callbacks.set(n,r=>(null==i||i(),r6(r)&&r.errorCode)?t(rh({code:r.errorCode,message:"Unrecognized chain ID. Try adding the chain using addEthereumChain first."})):r6(r)?t(Error(r.errorMessage)):void e(r)),this.publishWeb3RequestEvent(n,r)})}}iL.accountRequestCallbackIds=new Set;let ij="DefaultChainId",iB="DefaultJsonRpcUrl";class iW{constructor(e){this._relay=null,this._addresses=[],this.metadata=e.metadata,this._storage=new t2("walletlink",iU),this.callback=e.callback||null;const t=this._storage.getItem(r8);if(t){const e=t.split(" ");""!==e[0]&&(this._addresses=e.map(e=>rN(e)))}this.initializeRelay()}getSession(){let{id:e,secret:t}=this.initializeRelay().getWalletLinkSession();return{id:e,secret:t}}async handshake(){await this._eth_requestAccounts()}get selectedAddress(){return this._addresses[0]||void 0}get jsonRpcUrl(){var e;return null!=(e=this._storage.getItem(iB))?e:void 0}set jsonRpcUrl(e){this._storage.setItem(iB,e)}updateProviderInfo(e,t){var r;this.jsonRpcUrl=e;let i=this.getChainId();this._storage.setItem(ij,t.toString(10)),rU(t)!==i&&(null==(r=this.callback)||r.call(this,"chainChanged",rk(t)))}async watchAsset(e){let t=Array.isArray(e)?e[0]:e;if(!t.type)throw ra("Type is required");if((null==t?void 0:t.type)!=="ERC20")throw ra(`Asset of type '${t.type}' is not supported`);if(!(null==t?void 0:t.options))throw ra("Options are required");if(!(null==t?void 0:t.options.address))throw ra("Address is required");let r=this.getChainId(),{address:i,symbol:n,image:s,decimals:a}=t.options,o=this.initializeRelay(),l=await o.watchAsset(t.type,i,n,a,s,null==r?void 0:r.toString());return!r6(l)&&!!l.result}async addEthereumChain(e){var t,r;let i=e[0];if((null==(t=i.rpcUrls)?void 0:t.length)===0)throw ra("please pass in at least 1 rpcUrl");if(!i.chainName||""===i.chainName.trim())throw ra("chainName is a required field");if(!i.nativeCurrency)throw ra("nativeCurrency is a required field");let n=Number.parseInt(i.chainId,16);if(n===this.getChainId())return!1;let s=this.initializeRelay(),{rpcUrls:a=[],blockExplorerUrls:o=[],chainName:l,iconUrls:c=[],nativeCurrency:d}=i,u=await s.addEthereumChain(n.toString(),a,c,o,l,d);if(r6(u))return!1;if((null==(r=u.result)?void 0:r.isApproved)===!0)return this.updateProviderInfo(a[0],n),null;throw ro("unable to add ethereum chain")}async switchEthereumChain(e){let t=Number.parseInt(e[0].chainId,16),r=this.initializeRelay(),i=await r.switchEthereumChain(t.toString(10),this.selectedAddress||void 0);if(r6(i))throw i;let n=i.result;return n.isApproved&&n.rpcUrl.length>0&&this.updateProviderInfo(n.rpcUrl,t),null}async cleanup(){this.callback=null,this._relay&&this._relay.resetAndReload(),this._storage.clear()}_setAddresses(e,t){var r;if(!Array.isArray(e))throw Error("addresses is not an array");let i=e.map(e=>rN(e));JSON.stringify(i)!==JSON.stringify(this._addresses)&&(this._addresses=i,null==(r=this.callback)||r.call(this,"accountsChanged",i),this._storage.setItem(r8,i.join(" ")))}async request(e){let t=e.params||[];switch(e.method){case"eth_accounts":return[...this._addresses];case"eth_coinbase":return this.selectedAddress||null;case"net_version":return this.getChainId().toString(10);case"eth_chainId":return rk(this.getChainId());case"eth_requestAccounts":return this._eth_requestAccounts();case"eth_ecRecover":case"personal_ecRecover":return this.ecRecover(e);case"personal_sign":return this.personalSign(e);case"eth_signTransaction":return this._eth_signTransaction(t);case"eth_sendRawTransaction":return this._eth_sendRawTransaction(t);case"eth_sendTransaction":return this._eth_sendTransaction(t);case"eth_signTypedData_v1":case"eth_signTypedData_v3":case"eth_signTypedData_v4":case"eth_signTypedData":return this.signTypedData(e);case"wallet_addEthereumChain":return this.addEthereumChain(t);case"wallet_switchEthereumChain":return this.switchEthereumChain(t);case"wallet_watchAsset":return this.watchAsset(t);default:if(!this.jsonRpcUrl)throw ro("No RPC URL set for chain");return rQ(e,this.jsonRpcUrl)}}_ensureKnownAddress(e){let t=rN(e);if(!this._addresses.map(e=>rN(e)).includes(t))throw Error("Unknown Ethereum address")}_prepareTransactionParams(e){let t=e.from?rN(e.from):this.selectedAddress;if(!t)throw Error("Ethereum address is unavailable");this._ensureKnownAddress(t);let r=e.to?rN(e.to):null,i=null!=e.value?rD(e.value):BigInt(0),n=e.data?rM(e.data):t3.Buffer.alloc(0),s=null!=e.nonce?rU(e.nonce):null,a=null!=e.gasPrice?rD(e.gasPrice):null,o=null!=e.maxFeePerGas?rD(e.maxFeePerGas):null,l=null!=e.maxPriorityFeePerGas?rD(e.maxPriorityFeePerGas):null;return{fromAddress:t,toAddress:r,weiValue:i,data:n,nonce:s,gasPriceInWei:a,maxFeePerGas:o,maxPriorityFeePerGas:l,gasLimit:null!=e.gas?rD(e.gas):null,chainId:e.chainId?rU(e.chainId):this.getChainId()}}async ecRecover(e){let{method:t,params:r}=e;if(!Array.isArray(r))throw ra();let i=this.initializeRelay(),n=await i.sendRequest({method:"ethereumAddressFromSignedMessage",params:{message:rx(r[0]),signature:rx(r[1]),addPrefix:"personal_ecRecover"===t}});if(r6(n))throw n;return n.result}getChainId(){var e;return Number.parseInt(null!=(e=this._storage.getItem(ij))?e:"1",10)}async _eth_requestAccounts(){var e,t;if(this._addresses.length>0)return null==(e=this.callback)||e.call(this,"connect",{chainId:rk(this.getChainId())}),this._addresses;let r=this.initializeRelay(),i=await r.requestEthereumAccounts();if(r6(i))throw i;if(!i.result)throw Error("accounts received is empty");return this._setAddresses(i.result),null==(t=this.callback)||t.call(this,"connect",{chainId:rk(this.getChainId())}),this._addresses}async personalSign({params:e}){if(!Array.isArray(e))throw ra();let t=e[1],r=e[0];this._ensureKnownAddress(t);let i=this.initializeRelay(),n=await i.sendRequest({method:"signEthereumMessage",params:{address:rN(t),message:rx(r),addPrefix:!0,typedDataJson:null}});if(r6(n))throw n;return n.result}async _eth_signTransaction(e){let t=this._prepareTransactionParams(e[0]||{}),r=this.initializeRelay(),i=await r.signEthereumTransaction(t);if(r6(i))throw i;return i.result}async _eth_sendRawTransaction(e){let t=rM(e[0]),r=this.initializeRelay(),i=await r.submitEthereumTransaction(t,this.getChainId());if(r6(i))throw i;return i.result}async _eth_sendTransaction(e){let t=this._prepareTransactionParams(e[0]||{}),r=this.initializeRelay(),i=await r.signAndSubmitEthereumTransaction(t);if(r6(i))throw i;return i.result}async signTypedData(e){let{method:t,params:r}=e;if(!Array.isArray(r))throw ra();let i=r[+("eth_signTypedData_v1"===t)],n=r[+("eth_signTypedData_v1"!==t)];this._ensureKnownAddress(i);let s=this.initializeRelay(),a=await s.sendRequest({method:"signEthereumMessage",params:{address:rN(i),message:rS(({eth_signTypedData_v1:r5.default.hashForSignTypedDataLegacy,eth_signTypedData_v3:r5.default.hashForSignTypedData_v3,eth_signTypedData_v4:r5.default.hashForSignTypedData_v4,eth_signTypedData:r5.default.hashForSignTypedData_v4})[t]({data:function(e){if("string"==typeof e)return JSON.parse(e);if("object"==typeof e)return e;throw ra(`Not a JSON string or an object: ${String(e)}`)}(n)}),!0),typedDataJson:JSON.stringify(n,null,2),addPrefix:!1}});if(r6(a))throw a;return a.result}initializeRelay(){return this._relay||(this._relay=new iL({linkAPIUrl:iU,storage:this._storage,metadata:this.metadata,accountsCallback:this._setAddresses.bind(this),chainCallback:this.updateProviderInfo.bind(this)})),this._relay}}let iF="SignerType",iH=new t2("CBWSDK","SignerConfigurator");async function iq(e){let{communicator:t,metadata:r,handshakeRequest:i,callback:n}=e;iz(t,r,n).catch(()=>{});let s={id:crypto.randomUUID(),event:"selectSignerType",data:Object.assign(Object.assign({},e.preference),{handshakeRequest:i})},{data:a}=await t.postRequestAndWaitForResponse(s);return a}async function iz(e,t,r){await e.onMessage(({event:e})=>"WalletLinkSessionRequest"===e);let i=new iW({metadata:t,callback:r});e.postMessage({event:"WalletLinkUpdate",data:{session:i.getSession()}}),await i.handshake(),e.postMessage({event:"WalletLinkUpdate",data:{connected:!0}})}let i$=`Coinbase Wallet SDK requires the Cross-Origin-Opener-Policy header to not be set to 'same-origin'. This is to ensure that the SDK can communicate with the Coinbase Smart Wallet app.

Please see https://www.smartwallet.dev/guides/tips/popup-tips#cross-origin-opener-policy for more information.`,{checkCrossOriginOpenerPolicy:iK,getCrossOriginOpenerPolicy:iV}={getCrossOriginOpenerPolicy:()=>void 0===f?"undefined":f,checkCrossOriginOpenerPolicy:async()=>{if("undefined"==typeof window){f="non-browser-env";return}try{let e=`${window.location.origin}${window.location.pathname}`,t=await fetch(e,{method:"HEAD"});if(!t.ok)throw Error(`HTTP error! status: ${t.status}`);let r=t.headers.get("Cross-Origin-Opener-Policy");f=null!=r?r:"null","same-origin"===f&&console.error(i$)}catch(e){console.error("Error checking Cross-Origin-Opener-Policy:",e.message),f="error"}}},iJ={isRed:!1,info:"Retry",svgWidth:"10",svgHeight:"11",path:iO,defaultFillRule:"evenodd",defaultClipRule:"evenodd"},iZ=null;class iG{constructor({url:e="https://keys.coinbase.com/connect",metadata:t,preference:r}){this.popup=null,this.listeners=new Map,this.postMessage=async e=>{(await this.waitForPopupLoaded()).postMessage(e,this.url.origin)},this.postRequestAndWaitForResponse=async e=>{let t=this.onMessage(({requestId:t})=>t===e.id);return this.postMessage(e),await t},this.onMessage=async e=>new Promise((t,r)=>{let i=r=>{if(r.origin!==this.url.origin)return;let n=r.data;e(n)&&(t(n),window.removeEventListener("message",i),this.listeners.delete(i))};window.addEventListener("message",i),this.listeners.set(i,{reject:r})}),this.disconnect=()=>{var e;(e=this.popup)&&!e.closed&&e.close(),this.popup=null,this.listeners.forEach(({reject:e},t)=>{e(rl("Request rejected")),window.removeEventListener("message",t)}),this.listeners.clear()},this.waitForPopupLoaded=async()=>this.popup&&!this.popup.closed?(this.popup.focus(),this.popup):(this.popup=await function(e){let t=(window.innerWidth-420)/2+window.screenX,r=(window.innerHeight-540)/2+window.screenY;function i(){let i=`wallet_${crypto.randomUUID()}`,n=window.open(e,i,`width=420, height=540, left=${t}, top=${r}`);return(null==n||n.focus(),n)?n:null}var n=e;for(let[e,t]of Object.entries({sdkName:rY,sdkVersion:rG,origin:window.location.origin,coop:iV()}))n.searchParams.append(e,t.toString());let s=i();if(!s){let e=function(){if(!iZ){let e=document.createElement("div");e.className="-cbwsdk-css-reset",document.body.appendChild(e),(iZ=new iT).attach(e)}return iZ}();return new Promise((t,r)=>{e.presentItem({autoExpand:!0,message:"Popup was blocked. Try again.",menuItems:[Object.assign(Object.assign({},iJ),{onClick:()=>{(s=i())?t(s):r(ro("Popup window was blocked")),e.clear()}})]})})}return Promise.resolve(s)}(this.url),this.onMessage(({event:e})=>"PopupUnload"===e).then(this.disconnect).catch(()=>{}),this.onMessage(({event:e})=>"PopupLoaded"===e).then(e=>{this.postMessage({requestId:e.id,data:{version:rG,metadata:this.metadata,preference:this.preference,location:window.location.toString()}})}).then(()=>{if(!this.popup)throw ro();return this.popup})),this.url=new URL(e),this.metadata=t,this.preference=r}}var iY=e.i(927509);iY.default;var iQ=iY;class iX extends iQ.default{}var i0=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(e);n<i.length;n++)0>t.indexOf(i[n])&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]]);return r};class i1 extends iX{constructor(e){var{metadata:t}=e,r=e.preference,{keysUrl:i}=r,n=i0(r,["keysUrl"]);super(),this.signer=null,this.isCoinbaseWallet=!0,this.metadata=t,this.preference=n,this.communicator=new iG({url:i,metadata:t,preference:n});const s=iH.getItem(iF);s&&(this.signer=this.initSigner(s))}async request(e){try{if(!function(e){if(!e||"object"!=typeof e||Array.isArray(e))throw ra({message:"Expected a single, non-array, object argument.",data:e});let{method:t,params:r}=e;if("string"!=typeof t||0===t.length)throw ra({message:"'args.method' must be a non-empty string.",data:e});if(void 0!==r&&!Array.isArray(r)&&("object"!=typeof r||null===r))throw ra({message:"'args.params' must be an object or array if provided.",data:e});switch(t){case"eth_sign":case"eth_signTypedData_v2":case"eth_subscribe":case"eth_unsubscribe":throw rd()}}(e),!this.signer)switch(e.method){case"eth_requestAccounts":{let t=await this.requestSignerSelection(e),r=this.initSigner(t);await r.handshake(e),this.signer=r,iH.setItem(iF,t);break}case"wallet_sendCalls":{let t=this.initSigner("scw");await t.handshake({method:"handshake"});let r=await t.request(e);return await t.cleanup(),r}case"wallet_getCallsStatus":return rQ(e,"https://rpc.wallet.coinbase.com");case"net_version":return 1;case"eth_chainId":return rk(1);default:throw rc("Must call 'eth_requestAccounts' before other methods")}return await this.signer.request(e)}catch(i){let e,t,{code:r}=i;return r===t4&&this.disconnect(),Promise.reject((e=function(e,{shouldIncludeStack:t=!1}={}){var r,i;let n={};if(e&&"object"==typeof e&&!Array.isArray(e)&&rn(e,"code")&&Number.isInteger(r=e.code)&&(re[r.toString()]||(i=r)>=-32099&&i<=-32e3))n.code=e.code,e.message&&"string"==typeof e.message?(n.message=e.message,rn(e,"data")&&(n.data=e.data)):(n.message=rr(n.code),n.data={originalError:ri(e)});else n.code=t8,n.message=rs(e,"message")?e.message:rt,n.data={originalError:ri(e)};return t&&(n.stack=rs(e,"stack")?e.stack:void 0),n}(function(e){var t;if("string"==typeof e)return{message:e,code:t8};if(r6(e)){let r=e.errorMessage,i=null!=(t=e.errorCode)?t:r.match(/(denied|rejected)/i)?t6:void 0;return Object.assign(Object.assign({},e),{message:r,code:i,data:{method:e.method}})}return e}(i),{shouldIncludeStack:!0}),(t=new URL("https://docs.cloud.coinbase.com/wallet-sdk/docs/errors")).searchParams.set("version",rG),t.searchParams.set("code",e.code.toString()),t.searchParams.set("message",e.message),Object.assign(Object.assign({},e),{docUrl:t.href})))}}async enable(){return console.warn('.enable() has been deprecated. Please use .request({ method: "eth_requestAccounts" }) instead.'),await this.request({method:"eth_requestAccounts"})}async disconnect(){var e;await (null==(e=this.signer)?void 0:e.cleanup()),this.signer=null,t2.clearAll(),this.emit("disconnect",ru("User initiated disconnection"))}requestSignerSelection(e){return iq({communicator:this.communicator,preference:this.preference,metadata:this.metadata,handshakeRequest:e,callback:this.emit.bind(this)})}initSigner(e){return function(e){let{signerType:t,metadata:r,communicator:i,callback:n}=e;switch(t){case"scw":return new r3({metadata:r,callback:n,communicator:i});case"walletlink":return new iW({metadata:r,callback:n})}}({signerType:e,metadata:this.metadata,communicator:this.communicator,callback:this.emit.bind(this)})}}let i2={options:"all"};function i3(e){new t2("CBWSDK").setItem("VERSION",rG),iK();let t={metadata:{appName:e.appName||"Dapp",appLogoUrl:e.appLogoUrl||"",appChainIds:e.appChainIds||[]},preference:Object.assign(i2,null!=(r=e.preference)?r:{})};var r,i=t.preference;if(i){if(!["all","smartWalletOnly","eoaOnly"].includes(i.options))throw Error(`Invalid options: ${i.options}`);if(i.attribution&&void 0!==i.attribution.auto&&void 0!==i.attribution.dataSuffix)throw Error("Attribution cannot contain both auto and dataSuffix properties")}let n=null;return{getProvider:()=>{var e;let r;return n||(n=null!=(e=function({metadata:e,preference:t}){var r,i;let{appName:n,appLogoUrl:s,appChainIds:a}=e;if("smartWalletOnly"!==t.options){let e=globalThis.coinbaseWalletExtension;if(e)return null==(r=e.setAppInfo)||r.call(e,n,s,a,t),e}let o=function(){var e,t;try{let r=globalThis;return null!=(e=r.ethereum)?e:null==(t=r.top)?void 0:t.ethereum}catch(e){return}}();if(null==o?void 0:o.isCoinbaseBrowser)return null==(i=o.setAppInfo)||i.call(o,n,s,a,t),o}(r={metadata:t.metadata,preference:t.preference}))?e:new i1(r)),n}}}var i5=e.i(740382),i8=e.i(447187),i6=e.i(33750),i4=e.i(675107),i7=e.i(796516),i9=e.i(823838),ne=e.i(880841),nt=e.i(656450),nr=e.i(320065);let ni="/api/v1/sessions",nn="/api/v1/sessions/logout",ns="/api/v1/siwe/init",na="/api/v1/siwe/authenticate",no="/api/v1/siwe/link",nl="/api/v1/siwe/link_smart_wallet",nc="/api/v1/siwe/unlink",nd="/api/v1/siwe/transfer",nu="/api/v1/siws/init",nh="/api/v1/siws/authenticate",np="/api/v1/siws/link",nf="/api/v1/siws/unlink",ny="/api/v1/siws/transfer",ng="/api/v1/farcaster/init",nm="/api/v1/farcaster/authenticate",nw="/api/v1/farcaster/link",nb="/api/v1/farcaster/status",nv="/api/v1/farcaster/unlink",nE="/api/v1/farcaster/transfer",n_="/api/v1/passwordless/init",nA="/api/v1/passwordless/authenticate",nS="/api/v1/passwordless/link",nx="/api/v1/passwordless/unlink",nI="/api/v1/passwordless/update",nk="/api/v1/passwordless/transfer",nT="/api/v1/passwordless_sms/init",nC="/api/v1/passwordless_sms/link",nP="/api/v1/passwordless_sms/unlink",nO="/api/v1/passwordless_sms/authenticate",nR="/api/v1/passwordless_sms/update",nN="/api/v1/passwordless_sms/transfer",nM="/api/v1/oauth/init",nU="/api/v1/oauth/authenticate",nD="/api/v1/oauth/link",nL="/api/v1/oauth/unlink",nj="/api/v1/oauth/transfer",nB="/api/v1/passkeys/link/init",nW="/api/v1/passkeys/authenticate/init",nF="/api/v1/passkeys/register/init",nH="/api/v1/passkeys/link",nq="/api/v1/passkeys/authenticate",nz="/api/v1/passkeys/register",n$="/api/v1/telegram/authenticate",nK="/api/v1/telegram/link",nV="/api/v1/telegram/unlink",nJ="/api/v1/telegram/transfer",nZ="/api/v1/mfa/passwordless_sms/init",nG="/api/v1/mfa/passkeys/init",nY="/api/v1/users/me/accept_terms",nQ="/api/v1/analytics_events",nX="/api/v1/custom_jwt_account/authenticate",n0="/api/v1/custom_jwt_account/link",n1="/api/v1/guest/authenticate",n2="/api/v1/plugins/moonpay_on_ramp/sign",n3="/api/v1/funding/coinbase_on_ramp/init",n5="/api/v1/funding/coinbase_on_ramp/status",n8="/api/v1/wallets/revoke",n6="/api/v1/users/me",n4="/api/v1/scan/transaction";e.s(["$",()=>nd,"A",()=>nn,"B",()=>nQ,"C",()=>n1,"D",()=>nZ,"E",()=>nG,"F",()=>nY,"G",()=>nx,"H",()=>nP,"I",()=>nc,"J",()=>nf,"K",()=>nL,"L",()=>nv,"M",()=>nV,"N",()=>n8,"O",()=>n2,"P",()=>n3,"Q",()=>n5,"R",()=>ns,"S",()=>na,"T",()=>no,"U",()=>nl,"V",()=>nu,"W",()=>nh,"X",()=>nj,"Y",()=>ny,"Z",()=>nJ,"_",()=>nE,"a",()=>nS,"a0",()=>nN,"a1",()=>nk,"a2",()=>np,"a3",()=>n6,"a4",()=>n4,"a5",()=>"api/v2/farcaster/init","a6",()=>"api/v2/farcaster/authenticate","a8",()=>"/api/v1/recovery/oauth/authenticate","a9",()=>"/api/v1/recovery/oauth/init_icloud","aa",()=>"/api/v1/recovery/oauth/init","b",()=>n_,"c",()=>nw,"d",()=>ng,"e",()=>nb,"f",()=>nm,"g",()=>nD,"h",()=>nM,"i",()=>nz,"j",()=>nq,"k",()=>nH,"l",()=>nF,"m",()=>nW,"n",()=>nB,"o",()=>nU,"p",()=>nA,"q",()=>nO,"r",()=>nC,"s",()=>nT,"t",()=>nR,"u",()=>nI,"v",()=>n$,"w",()=>nK,"x",()=>nX,"y",()=>n0,"z",()=>ni],902737);var n7=e.i(166953),n9=e.i(945367),se=e.i(997053),st=e.i(197845),sr=e.i(768834);function si(e){"function"==typeof queueMicrotask?queueMicrotask(e):Promise.resolve().then(e).catch(e=>setTimeout(()=>{throw e}))}function sn(){let e=[],t={addEventListener:(e,r,i,n)=>(e.addEventListener(r,i,n),t.add(()=>e.removeEventListener(r,i,n))),requestAnimationFrame(...e){let r=requestAnimationFrame(...e);return t.add(()=>cancelAnimationFrame(r))},nextFrame:(...e)=>t.requestAnimationFrame(()=>t.requestAnimationFrame(...e)),setTimeout(...e){let r=setTimeout(...e);return t.add(()=>clearTimeout(r))},microTask(...e){let r={current:!0};return si(()=>{r.current&&e[0]()}),t.add(()=>{r.current=!1})},style(e,t,r){let i=e.style.getPropertyValue(t);return Object.assign(e.style,{[t]:r}),this.add(()=>{Object.assign(e.style,{[t]:i})})},group(e){let t=sn();return e(t),this.add(()=>t.dispose())},add:t=>(e.includes(t)||e.push(t),()=>{let r=e.indexOf(t);if(r>=0)for(let t of e.splice(r,1))t()}),dispose(){for(let t of e.splice(0))t()}};return t}function ss(){let[e]=(0,H.useState)(sn);return(0,H.useEffect)(()=>()=>e.dispose(),[e]),e}e.s(["disposables",()=>sn],544508),e.s(["useDisposables",()=>ss],746725);var sa=Object.defineProperty,so=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?sa(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};let sl=new class{constructor(){so(this,"current",this.detect()),so(this,"handoffState","pending"),so(this,"currentId",0)}set(e){this.current!==e&&(this.handoffState="pending",this.currentId=0,this.current=e)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return"server"===this.current}get isClient(){return"client"===this.current}detect(){return"undefined"==typeof window||"undefined"==typeof document?"server":"client"}handoff(){"pending"===this.handoffState&&(this.handoffState="complete")}get isHandoffComplete(){return"complete"===this.handoffState}},sc=(e,t)=>{sl.isServer?(0,H.useEffect)(e,t):(0,H.useLayoutEffect)(e,t)};function sd(e){let t=(0,H.useRef)(e);return sc(()=>{t.current=e},[e]),t}e.s(["useIsoMorphicEffect",()=>sc],835696);let su=function(e){let t=sd(e);return H.default.useCallback((...e)=>t.current(...e),[t])};function sh(){let e=(0,H.useRef)(!1);return sc(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function sp(){let e,t=(e="undefined"==typeof document,"useSyncExternalStore"in H&&(0,H.useSyncExternalStore)(()=>()=>{},()=>!1,()=>!e)),[r,i]=H.useState(sl.isHandoffComplete);return r&&!1===sl.isHandoffComplete&&i(!1),H.useEffect(()=>{!0!==r&&i(!0)},[r]),H.useEffect(()=>sl.handoff(),[]),!t&&r}e.s(["useEvent",()=>su],914189);let sf=Symbol();function sy(e,t=!0){return Object.assign(e,{[sf]:t})}function sg(...e){let t=(0,H.useRef)(e);(0,H.useEffect)(()=>{t.current=e},[e]);let r=su(e=>{for(let r of t.current)null!=r&&("function"==typeof r?r(e):r.current=e)});return e.every(e=>null==e||(null==e?void 0:e[sf]))?void 0:r}e.s(["optionalRef",()=>sy,"useSyncRefs",()=>sg],294316);var sm=e.i(247167);void 0!==sm.default&&"undefined"!=typeof globalThis&&"undefined"!=typeof Element&&(null==(CW=null==sm.default?void 0:sm.default.env)?void 0:CW.NODE_ENV)==="test"&&void 0===(null==(CF=null==Element?void 0:Element.prototype)?void 0:CF.getAnimations)&&(Element.prototype.getAnimations=function(){return console.warn(["Headless UI has polyfilled `Element.prototype.getAnimations` for your tests.","Please install a proper polyfill e.g. `jsdom-testing-mocks`, to silence these warnings.","","Example usage:","```js","import { mockAnimationsApi } from 'jsdom-testing-mocks'","mockAnimationsApi()","```"].join(`
`)),[]});var sw=((y=sw||{})[y.None=0]="None",y[y.Closed=1]="Closed",y[y.Enter=2]="Enter",y[y.Leave=4]="Leave",y);function sb(e){let t={};for(let r in e)!0===e[r]&&(t[`data-${r}`]="");return t}function sv(e,t,r,i){let[n,s]=(0,H.useState)(r),{hasFlag:a,addFlag:o,removeFlag:l}=function(e=0){let[t,r]=(0,H.useState)(e),i=(0,H.useCallback)(e=>r(e),[]),n=(0,H.useCallback)(e=>r(t=>t|e),[]),s=(0,H.useCallback)(e=>(t&e)===e,[t]);return{flags:t,setFlag:i,addFlag:n,hasFlag:s,removeFlag:(0,H.useCallback)(e=>r(t=>t&~e),[]),toggleFlag:(0,H.useCallback)(e=>r(t=>t^e),[])}}(e&&n?3:0),c=(0,H.useRef)(!1),d=(0,H.useRef)(!1);return sc(()=>{var n;if(e){if(r&&s(!0),!t){r&&o(3);return}return null==(n=null==i?void 0:i.start)||n.call(i,r),function(e,{prepare:t,run:r,done:i,inFlight:n}){let s=sn();return function(e,{inFlight:t,prepare:r}){if(null!=t&&t.current)return r();let i=e.style.transition;e.style.transition="none",r(),e.offsetHeight,e.style.transition=i}(e,{prepare:t,inFlight:n}),s.nextFrame(()=>{r(),s.requestAnimationFrame(()=>{s.add(function(e,t){var r,i;let n=sn();if(!e)return n.dispose;let s=!1;n.add(()=>{s=!0});let a=null!=(i=null==(r=e.getAnimations)?void 0:r.call(e).filter(e=>e instanceof CSSTransition))?i:[];return 0===a.length?t():Promise.allSettled(a.map(e=>e.finished)).then(()=>{s||t()}),n.dispose}(e,i))})}),s.dispose}(t,{inFlight:c,prepare(){d.current?d.current=!1:d.current=c.current,c.current=!0,d.current||(r?(o(3),l(4)):(o(4),l(2)))},run(){d.current?r?(l(3),o(4)):(l(4),o(3)):r?l(1):o(1)},done(){var e,n,a,o;d.current&&(null!=(o=null==(a=(n=t).getAnimations)?void 0:a.call(n))?o:[]).some(e=>e instanceof CSSTransition&&"finished"!==e.playState)||(c.current=!1,l(7),r||s(!1),null==(e=null==i?void 0:i.end)||e.call(i,r))}})}},[e,r,t,ss()]),e?[n,{closed:a(1),enter:a(2),leave:a(4),transition:a(2)||a(4)}]:[r,{closed:void 0,enter:void 0,leave:void 0,transition:void 0}]}e.s(["transitionDataAttributes",()=>sb,"useTransition",()=>sv],83733);let sE=(0,H.createContext)(null);sE.displayName="OpenClosedContext";var s_=((g=s_||{})[g.Open=1]="Open",g[g.Closed=2]="Closed",g[g.Closing=4]="Closing",g[g.Opening=8]="Opening",g);function sA(){return(0,H.useContext)(sE)}function sS({value:e,children:t}){return H.default.createElement(sE.Provider,{value:e},t)}function sx({children:e}){return H.default.createElement(sE.Provider,{value:null},e)}function sI(...e){return Array.from(new Set(e.flatMap(e=>"string"==typeof e?e.split(" "):[]))).filter(Boolean).join(" ")}function sk(e,t,...r){if(e in t){let i=t[e];return"function"==typeof i?i(...r):i}let i=Error(`Tried to handle "${e}" but there is no handler defined. Only defined handlers are: ${Object.keys(t).map(e=>`"${e}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,sk),i}e.s(["OpenClosedProvider",()=>sS,"ResetOpenClosedProvider",()=>sx,"State",()=>s_,"useOpenClosed",()=>sA],233137),e.s(["match",()=>sk],397701);var sT=((m=sT||{})[m.None=0]="None",m[m.RenderStrategy=1]="RenderStrategy",m[m.Static=2]="Static",m),sC=((w=sC||{})[w.Unmount=0]="Unmount",w[w.Hidden=1]="Hidden",w);function sP(){let e,t,r=(e=(0,H.useRef)([]),t=(0,H.useCallback)(t=>{for(let r of e.current)null!=r&&("function"==typeof r?r(t):r.current=t)},[]),(...r)=>{if(!r.every(e=>null==e))return e.current=r,t});return(0,H.useCallback)(e=>(function({ourProps:e,theirProps:t,slot:r,defaultTag:i,features:n,visible:s=!0,name:a,mergeRefs:o}){o=null!=o?o:sR;let l=sN(t,e);if(s)return sO(l,r,i,a,o);let c=null!=n?n:0;if(2&c){let{static:e=!1,...t}=l;if(e)return sO(t,r,i,a,o)}if(1&c){let{unmount:e=!0,...t}=l;return sk(+!e,{0:()=>null,1:()=>sO({...t,hidden:!0,style:{display:"none"}},r,i,a,o)})}return sO(l,r,i,a,o)})({mergeRefs:r,...e}),[r])}function sO(e,t={},r,i,n){let{as:s=r,children:a,refName:o="ref",...l}=sL(e,["unmount","static"]),c=void 0!==e.ref?{[o]:e.ref}:{},d="function"==typeof a?a(t):a;"className"in l&&l.className&&"function"==typeof l.className&&(l.className=l.className(t)),l["aria-labelledby"]&&l["aria-labelledby"]===l.id&&(l["aria-labelledby"]=void 0);let u={};if(t){let e=!1,r=[];for(let[i,n]of Object.entries(t))"boolean"==typeof n&&(e=!0),!0===n&&r.push(i.replace(/([A-Z])/g,e=>`-${e.toLowerCase()}`));if(e)for(let e of(u["data-headlessui-state"]=r.join(" "),r))u[`data-${e}`]=""}if(sj(s)&&(Object.keys(sD(l)).length>0||Object.keys(sD(u)).length>0))if(!(0,H.isValidElement)(d)||Array.isArray(d)&&d.length>1||sj(d.type)){if(Object.keys(sD(l)).length>0)throw Error(['Passing props on "Fragment"!',"",`The current component <${i} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(sD(l)).concat(Object.keys(sD(u))).map(e=>`  - ${e}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(e=>`  - ${e}`).join(`
`)].join(`
`))}else{var h;let e=d.props,t=null==e?void 0:e.className,r="function"==typeof t?(...e)=>sI(t(...e),l.className):sI(t,l.className),i=sN(d.props,sD(sL(l,["ref"])));for(let e in u)e in i&&delete u[e];return(0,H.cloneElement)(d,Object.assign({},i,u,c,{ref:n((h=d,H.default.version.split(".")[0]>="19"?h.props.ref:h.ref),c.ref)},r?{className:r}:{}))}return(0,H.createElement)(s,Object.assign({},sL(l,["ref"]),!sj(s)&&c,!sj(s)&&u),d)}function sR(...e){return e.every(e=>null==e)?void 0:t=>{for(let r of e)null!=r&&("function"==typeof r?r(t):r.current=t)}}function sN(...e){if(0===e.length)return{};if(1===e.length)return e[0];let t={},r={};for(let i of e)for(let e in i)e.startsWith("on")&&"function"==typeof i[e]?(null!=r[e]||(r[e]=[]),r[e].push(i[e])):t[e]=i[e];if(t.disabled||t["aria-disabled"])for(let e in r)/^(on(?:Click|Pointer|Mouse|Key)(?:Down|Up|Press)?)$/.test(e)&&(r[e]=[e=>{var t;return null==(t=null==e?void 0:e.preventDefault)?void 0:t.call(e)}]);for(let e in r)Object.assign(t,{[e](t,...i){for(let n of r[e]){if((t instanceof Event||(null==t?void 0:t.nativeEvent)instanceof Event)&&t.defaultPrevented)return;n(t,...i)}}});return t}function sM(...e){if(0===e.length)return{};if(1===e.length)return e[0];let t={},r={};for(let i of e)for(let e in i)e.startsWith("on")&&"function"==typeof i[e]?(null!=r[e]||(r[e]=[]),r[e].push(i[e])):t[e]=i[e];for(let e in r)Object.assign(t,{[e](...t){for(let i of r[e])null==i||i(...t)}});return t}function sU(e){var t;return Object.assign((0,H.forwardRef)(e),{displayName:null!=(t=e.displayName)?t:e.name})}function sD(e){let t=Object.assign({},e);for(let e in t)void 0===t[e]&&delete t[e];return t}function sL(e,t=[]){let r=Object.assign({},e);for(let e of t)e in r&&delete r[e];return r}function sj(e){return e===H.Fragment||e===Symbol.for("react.fragment")}function sB(e){var t;return!!(e.enter||e.enterFrom||e.enterTo||e.leave||e.leaveFrom||e.leaveTo)||!sj(null!=(t=e.as)?t:s$)||1===H.default.Children.count(e.children)}e.s(["RenderFeatures",()=>sT,"RenderStrategy",()=>sC,"compact",()=>sD,"forwardRefWithAs",()=>sU,"isFragment",()=>sj,"mergeProps",()=>sM,"useRender",()=>sP],700020);let sW=(0,H.createContext)(null);sW.displayName="TransitionContext";var sF=((b=sF||{}).Visible="visible",b.Hidden="hidden",b);let sH=(0,H.createContext)(null);function sq(e){return"children"in e?sq(e.children):e.current.filter(({el:e})=>null!==e.current).filter(({state:e})=>"visible"===e).length>0}function sz(e,t){let r=sd(e),i=(0,H.useRef)([]),n=sh(),s=ss(),a=su((e,t=sC.Hidden)=>{let a=i.current.findIndex(({el:t})=>t===e);-1!==a&&(sk(t,{[sC.Unmount](){i.current.splice(a,1)},[sC.Hidden](){i.current[a].state="hidden"}}),s.microTask(()=>{var e;!sq(i)&&n.current&&(null==(e=r.current)||e.call(r))}))}),o=su(e=>{let t=i.current.find(({el:t})=>t===e);return t?"visible"!==t.state&&(t.state="visible"):i.current.push({el:e,state:"visible"}),()=>a(e,sC.Unmount)}),l=(0,H.useRef)([]),c=(0,H.useRef)(Promise.resolve()),d=(0,H.useRef)({enter:[],leave:[]}),u=su((e,r,i)=>{l.current.splice(0),t&&(t.chains.current[r]=t.chains.current[r].filter(([t])=>t!==e)),null==t||t.chains.current[r].push([e,new Promise(e=>{l.current.push(e)})]),null==t||t.chains.current[r].push([e,new Promise(e=>{Promise.all(d.current[r].map(([e,t])=>t)).then(()=>e())})]),"enter"===r?c.current=c.current.then(()=>null==t?void 0:t.wait.current).then(()=>i(r)):i(r)}),h=su((e,t,r)=>{Promise.all(d.current[t].splice(0).map(([e,t])=>t)).then(()=>{var e;null==(e=l.current.shift())||e()}).then(()=>r(t))});return(0,H.useMemo)(()=>({children:i,register:o,unregister:a,onStart:u,onStop:h,wait:c,chains:d}),[o,a,i,u,h,d,c])}sH.displayName="NestingContext";let s$=H.Fragment,sK=sT.RenderStrategy,sV=sU(function(e,t){let{show:r,appear:i=!1,unmount:n=!0,...s}=e,a=(0,H.useRef)(null),o=sg(...sB(e)?[a,t]:null===t?[]:[t]);sp();let l=sA();if(void 0===r&&null!==l&&(r=(l&s_.Open)===s_.Open),void 0===r)throw Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[c,d]=(0,H.useState)(r?"visible":"hidden"),u=sz(()=>{r||d("hidden")}),[h,p]=(0,H.useState)(!0),f=(0,H.useRef)([r]);sc(()=>{!1!==h&&f.current[f.current.length-1]!==r&&(f.current.push(r),p(!1))},[f,r]);let y=(0,H.useMemo)(()=>({show:r,appear:i,initial:h}),[r,i,h]);sc(()=>{r?d("visible"):sq(u)||null===a.current||d("hidden")},[r,u]);let g={unmount:n},m=su(()=>{var t;h&&p(!1),null==(t=e.beforeEnter)||t.call(e)}),w=su(()=>{var t;h&&p(!1),null==(t=e.beforeLeave)||t.call(e)}),b=sP();return H.default.createElement(sH.Provider,{value:u},H.default.createElement(sW.Provider,{value:y},b({ourProps:{...g,as:H.Fragment,children:H.default.createElement(sJ,{ref:o,...g,...s,beforeEnter:m,beforeLeave:w})},theirProps:{},defaultTag:H.Fragment,features:sK,visible:"visible"===c,name:"Transition"})))}),sJ=sU(function(e,t){var r,i;let{transition:n=!0,beforeEnter:s,afterEnter:a,beforeLeave:o,afterLeave:l,enter:c,enterFrom:d,enterTo:u,entered:h,leave:p,leaveFrom:f,leaveTo:y,...g}=e,[m,w]=(0,H.useState)(null),b=(0,H.useRef)(null),v=sB(e),E=sg(...v?[b,t,w]:null===t?[]:[t]),_=null==(r=g.unmount)||r?sC.Unmount:sC.Hidden,{show:A,appear:S,initial:x}=function(){let e=(0,H.useContext)(sW);if(null===e)throw Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}(),[I,k]=(0,H.useState)(A?"visible":"hidden"),T=function(){let e=(0,H.useContext)(sH);if(null===e)throw Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}(),{register:C,unregister:P}=T;sc(()=>C(b),[C,b]),sc(()=>{if(_===sC.Hidden&&b.current)return A&&"visible"!==I?void k("visible"):sk(I,{hidden:()=>P(b),visible:()=>C(b)})},[I,b,C,P,A,_]);let O=sp();sc(()=>{if(v&&O&&"visible"===I&&null===b.current)throw Error("Did you forget to passthrough the `ref` to the actual DOM node?")},[b,I,O,v]);let R=x&&!S,N=S&&A&&x,M=(0,H.useRef)(!1),U=sz(()=>{M.current||(k("hidden"),P(b))},T),D=su(e=>{M.current=!0,U.onStart(b,e?"enter":"leave",e=>{"enter"===e?null==s||s():"leave"===e&&(null==o||o())})}),L=su(e=>{let t=e?"enter":"leave";M.current=!1,U.onStop(b,t,e=>{"enter"===e?null==a||a():"leave"===e&&(null==l||l())}),"leave"!==t||sq(U)||(k("hidden"),P(b))});(0,H.useEffect)(()=>{v&&n||(D(A),L(A))},[A,v,n]);let[,j]=sv(!(!n||!v||!O||R),m,A,{start:D,end:L}),B=sD({ref:E,className:(null==(i=sI(g.className,N&&c,N&&d,j.enter&&c,j.enter&&j.closed&&d,j.enter&&!j.closed&&u,j.leave&&p,j.leave&&!j.closed&&f,j.leave&&j.closed&&y,!j.transition&&A&&h))?void 0:i.trim())||void 0,...sb(j)}),W=0;"visible"===I&&(W|=s_.Open),"hidden"===I&&(W|=s_.Closed),A&&"hidden"===I&&(W|=s_.Opening),A||"visible"!==I||(W|=s_.Closing);let F=sP();return H.default.createElement(sH.Provider,{value:U},H.default.createElement(sS,{value:W},F({ourProps:B,theirProps:g,defaultTag:s$,features:sK,visible:"visible"===I,name:"Transition.Child"})))}),sZ=sU(function(e,t){let r=null!==(0,H.useContext)(sW),i=null!==sA();return H.default.createElement(H.default.Fragment,null,!r&&i?H.default.createElement(sV,{ref:t,...e}):H.default.createElement(sJ,{ref:t,...e}))}),sG=Object.assign(sV,{Child:sZ,Root:sV});var sY=((v=sY||{}).Space=" ",v.Enter="Enter",v.Escape="Escape",v.Backspace="Backspace",v.Delete="Delete",v.ArrowLeft="ArrowLeft",v.ArrowUp="ArrowUp",v.ArrowRight="ArrowRight",v.ArrowDown="ArrowDown",v.Home="Home",v.End="End",v.PageUp="PageUp",v.PageDown="PageDown",v.Tab="Tab",v);function sQ(e,t,r,i){let n=sd(r);(0,H.useEffect)(()=>{function r(e){n.current(e)}return(e=null!=e?e:window).addEventListener(t,r,i),()=>e.removeEventListener(t,r,i)},[e,t,i])}e.s(["Keys",()=>sY],998348);class sX extends Map{constructor(e){super(),this.factory=e}get(e){let t=super.get(e);return void 0===t&&(t=this.factory(e),this.set(e,t)),t}}var s0=Object.defineProperty,s1=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},s2=(e,t,r)=>(s1(e,t,"read from private field"),r?r.call(e):t.get(e)),s3=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},s5=(e,t,r,i)=>(s1(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r);class s8{constructor(e){s3(this,CH,{}),s3(this,Cq,new sX(()=>new Set)),s3(this,Cz,new Set),((e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?s0(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(this,"disposables",sn()),s5(this,CH,e),sl.isServer&&this.disposables.microTask(()=>{this.dispose()})}dispose(){this.disposables.dispose()}get state(){return s2(this,CH)}subscribe(e,t){if(sl.isServer)return()=>{};let r={selector:e,callback:t,current:e(s2(this,CH))};return s2(this,Cz).add(r),this.disposables.add(()=>{s2(this,Cz).delete(r)})}on(e,t){return sl.isServer?()=>{}:(s2(this,Cq).get(e).add(t),this.disposables.add(()=>{s2(this,Cq).get(e).delete(t)}))}send(e){let t=this.reduce(s2(this,CH),e);if(t!==s2(this,CH)){for(let e of(s5(this,CH,t),s2(this,Cz))){let t=e.selector(s2(this,CH));s6(e.current,t)||(e.current=t,e.callback(t))}for(let t of s2(this,Cq).get(e.type))t(s2(this,CH),e)}}}function s6(e,t){return!!Object.is(e,t)||"object"==typeof e&&null!==e&&"object"==typeof t&&null!==t&&(Array.isArray(e)&&Array.isArray(t)?e.length===t.length&&s4(e[Symbol.iterator](),t[Symbol.iterator]()):e instanceof Map&&t instanceof Map||e instanceof Set&&t instanceof Set?e.size===t.size&&s4(e.entries(),t.entries()):!!(s7(e)&&s7(t))&&s4(Object.entries(e)[Symbol.iterator](),Object.entries(t)[Symbol.iterator]()))}function s4(e,t){for(;;){let r=e.next(),i=t.next();if(r.done&&i.done)return!0;if(r.done||i.done||!Object.is(r.value,i.value))return!1}}function s7(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;let t=Object.getPrototypeOf(e);return null===t||null===Object.getPrototypeOf(t)}function s9(e){let[t,r]=e(),i=sn();return(...e)=>{t(...e),i.dispose(),i.microTask(r)}}CH=new WeakMap,Cq=new WeakMap,Cz=new WeakMap,e.s(["Machine",()=>s8,"batch",()=>s9,"shallowEqual",()=>s6],825720);var ae=Object.defineProperty,at=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?ae(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r},ar=((E=ar||{})[E.Push=0]="Push",E[E.Pop=1]="Pop",E);let ai={0(e,t){let r=t.id,i=e.stack,n=e.stack.indexOf(r);if(-1!==n){let t=e.stack.slice();return t.splice(n,1),t.push(r),i=t,{...e,stack:i}}return{...e,stack:[...e.stack,r]}},1(e,t){let r=t.id,i=e.stack.indexOf(r);if(-1===i)return e;let n=e.stack.slice();return n.splice(i,1),{...e,stack:n}}};class an extends s8{constructor(){super(...arguments),at(this,"actions",{push:e=>this.send({type:0,id:e}),pop:e=>this.send({type:1,id:e})}),at(this,"selectors",{isTop:(e,t)=>e.stack[e.stack.length-1]===t,inStack:(e,t)=>e.stack.includes(t)})}static new(){return new an({stack:[]})}reduce(e,t){return sk(t.type,ai,e,t)}}let as=new sX(()=>an.new());e.s(["ActionTypes",()=>ar,"stackMachines",()=>as],341650);var aa=e.i(313027);function ao(e,t,r=s6){return(0,aa.useSyncExternalStoreWithSelector)(su(t=>e.subscribe(al,t)),su(()=>e.state),su(()=>e.state),su(t),r)}function al(e){return e}function ac(e,t){let r=(0,H.useId)(),i=as.get(t),[n,s]=ao(i,(0,H.useCallback)(e=>[i.selectors.isTop(e,r),i.selectors.inStack(e,r)],[i,r]));return sc(()=>{if(e)return i.actions.push(r),()=>i.actions.pop(r)},[i,e,r]),!!e&&(!s||n)}function ad(e){var t;return sl.isServer?null:null==e?document:null!=(t=null==e?void 0:e.ownerDocument)?t:document}function au(e){var t,r;return sl.isServer?null:null==e?document:null!=(r=null==(t=null==e?void 0:e.getRootNode)?void 0:t.call(e))?r:document}function ah(e){var t,r;return null!=(r=null==(t=au(e))?void 0:t.activeElement)?r:null}function ap(e){return ah(e)===e}e.s(["useSlice",()=>ao],140407),e.s(["getActiveElement",()=>ah,"getOwnerDocument",()=>ad,"getRootNode",()=>au,"isActiveElement",()=>ap],402155);let af=new Map,ay=new Map;function ag(e){var t;let r=null!=(t=ay.get(e))?t:0;return ay.set(e,r+1),0!==r||(af.set(e,{"aria-hidden":e.getAttribute("aria-hidden"),inert:e.inert}),e.setAttribute("aria-hidden","true"),e.inert=!0),()=>(function(e){var t;let r=null!=(t=ay.get(e))?t:1;if(1===r?ay.delete(e):ay.set(e,r-1),1!==r)return;let i=af.get(e);i&&(null===i["aria-hidden"]?e.removeAttribute("aria-hidden"):e.setAttribute("aria-hidden",i["aria-hidden"]),e.inert=i.inert,af.delete(e))})(e)}function am(e,{allowed:t,disallowed:r}={}){let i=ac(e,"inert-others");sc(()=>{var e,n;if(!i)return;let s=sn();for(let t of null!=(e=null==r?void 0:r())?e:[])t&&s.add(ag(t));let a=null!=(n=null==t?void 0:t())?n:[];for(let e of a){if(!e)continue;let t=ad(e);if(!t)continue;let r=e.parentElement;for(;r&&r!==t.body;){for(let e of r.children)a.some(t=>e.contains(t))||s.add(ag(e));r=r.parentElement}}return s.dispose},[i,t,r])}function aw(e){return"object"==typeof e&&null!==e&&"nodeType"in e}function ab(e){return aw(e)&&"tagName"in e}function av(e){return ab(e)&&"accessKey"in e}function aE(e){return ab(e)&&"tabIndex"in e}function a_(e){return ab(e)&&"style"in e}function aA(e){return av(e)&&"IFRAME"===e.nodeName}function aS(e){return av(e)&&"INPUT"===e.nodeName}function ax(e){return av(e)&&"LABEL"===e.nodeName}function aI(e){return av(e)&&"FIELDSET"===e.nodeName}function ak(e){return av(e)&&"LEGEND"===e.nodeName}function aT(e){return!!ab(e)&&e.matches('a[href],audio[controls],button,details,embed,iframe,img[usemap],input:not([type="hidden"]),label,select,textarea,video[controls]')}function aC(e,t,r){let i=sd(e=>{let t=e.getBoundingClientRect();0===t.x&&0===t.y&&0===t.width&&0===t.height&&r()});(0,H.useEffect)(()=>{if(!e)return;let r=null===t?null:av(t)?t:t.current;if(!r)return;let n=sn();if("undefined"!=typeof ResizeObserver){let e=new ResizeObserver(()=>i.current(r));e.observe(r),n.add(()=>e.disconnect())}if("undefined"!=typeof IntersectionObserver){let e=new IntersectionObserver(()=>i.current(r));e.observe(r),n.add(()=>e.disconnect())}return()=>n.dispose()},[t,i,e])}e.s(["useInertOthers",()=>am],684653),e.s(["hasInlineStyle",()=>a_,"isElement",()=>ab,"isHTMLElement",()=>av,"isHTMLFieldSetElement",()=>aI,"isHTMLIframeElement",()=>aA,"isHTMLInputElement",()=>aS,"isHTMLLabelElement",()=>ax,"isHTMLLegendElement",()=>ak,"isHTMLorSVGElement",()=>aE,"isInteractiveElement",()=>aT,"isNode",()=>aw],813581),e.s(["useOnDisappear",()=>aC],877891);let aP=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","details>summary","textarea:not([disabled])"].map(e=>`${e}:not([tabindex='-1'])`).join(","),aO=["[data-autofocus]"].map(e=>`${e}:not([tabindex='-1'])`).join(",");var aR=((_=aR||{})[_.First=1]="First",_[_.Previous=2]="Previous",_[_.Next=4]="Next",_[_.Last=8]="Last",_[_.WrapAround=16]="WrapAround",_[_.NoScroll=32]="NoScroll",_[_.AutoFocus=64]="AutoFocus",_),aN=((A=aN||{})[A.Error=0]="Error",A[A.Overflow=1]="Overflow",A[A.Success=2]="Success",A[A.Underflow=3]="Underflow",A),aM=((S=aM||{})[S.Previous=-1]="Previous",S[S.Next=1]="Next",S);function aU(e=document.body){return null==e?[]:Array.from(e.querySelectorAll(aP)).sort((e,t)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(t.tabIndex||Number.MAX_SAFE_INTEGER)))}var aD=((x=aD||{})[x.Strict=0]="Strict",x[x.Loose=1]="Loose",x);function aL(e,t=0){var r;return e!==(null==(r=ad(e))?void 0:r.body)&&sk(t,{0:()=>e.matches(aP),1(){let t=e;for(;null!==t;){if(t.matches(aP))return!0;t=t.parentElement}return!1}})}function aj(e){sn().nextFrame(()=>{let t=ah(e);t&&aE(t)&&!aL(t,0)&&aW(e)})}var aB=((I=aB||{})[I.Keyboard=0]="Keyboard",I[I.Mouse=1]="Mouse",I);function aW(e){null==e||e.focus({preventScroll:!0})}function aF(e,t=e=>e){return e.slice().sort((e,r)=>{let i=t(e),n=t(r);if(null===i||null===n)return 0;let s=i.compareDocumentPosition(n);return s&Node.DOCUMENT_POSITION_FOLLOWING?-1:s&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function aH(e,t,r=null===e?document.body:au(e)){return aq(aU(r),t,{relativeTo:e})}function aq(e,t,{sorted:r=!0,relativeTo:i=null,skipElements:n=[]}={}){var s,a,o;let l=Array.isArray(e)?e.length>0?au(e[0]):document:au(e),c=Array.isArray(e)?r?aF(e):e:64&t?function(e=document.body){return null==e?[]:Array.from(e.querySelectorAll(aO)).sort((e,t)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(t.tabIndex||Number.MAX_SAFE_INTEGER)))}(e):aU(e);n.length>0&&c.length>1&&(c=c.filter(e=>!n.some(t=>null!=t&&"current"in t?(null==t?void 0:t.current)===e:t===e))),i=null!=i?i:null==l?void 0:l.activeElement;let d=(()=>{if(5&t)return 1;if(10&t)return -1;throw Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),u=(()=>{if(1&t)return 0;if(2&t)return Math.max(0,c.indexOf(i))-1;if(4&t)return Math.max(0,c.indexOf(i))+1;if(8&t)return c.length-1;throw Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),h=32&t?{preventScroll:!0}:{},p=0,f=c.length,y;do{if(p>=f||p+f<=0)return 0;let e=u+p;if(16&t)e=(e+f)%f;else{if(e<0)return 3;if(e>=f)return 1}null==(y=c[e])||y.focus(h),p+=d}while(y!==ah(y))return 6&t&&null!=(o=null==(a=null==(s=y)?void 0:s.matches)?void 0:a.call(s,"textarea,input"))&&o&&y.select(),2}function az(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function a$(){return az()||/Android/gi.test(window.navigator.userAgent)}function aK(e,t,r,i){let n=sd(r);(0,H.useEffect)(()=>{if(e)return document.addEventListener(t,r,i),()=>document.removeEventListener(t,r,i);function r(e){n.current(e)}},[e,t,i])}function aV(e,t,r,i){let n=sd(r);(0,H.useEffect)(()=>{if(e)return window.addEventListener(t,r,i),()=>window.removeEventListener(t,r,i);function r(e){n.current(e)}},[e,t,i])}function aJ(e,t,r){let i=sd(r),n=(0,H.useCallback)(function(e,r){if(e.defaultPrevented)return;let n=r(e);if(null!==n&&n.getRootNode().contains(n)&&n.isConnected){for(let r of function e(t){return"function"==typeof t?e(t()):Array.isArray(t)||t instanceof Set?t:[t]}(t))if(null!==r&&(r.contains(n)||e.composed&&e.composedPath().includes(r)))return;return aL(n,aD.Loose)||-1===n.tabIndex||e.preventDefault(),i.current(e,n)}},[i,t]),s=(0,H.useRef)(null);aK(e,"pointerdown",e=>{var t,r;a$()||(s.current=(null==(r=null==(t=e.composedPath)?void 0:t.call(e))?void 0:r[0])||e.target)},!0),aK(e,"pointerup",e=>{if(a$()||!s.current)return;let t=s.current;return s.current=null,n(e,()=>t)},!0);let a=(0,H.useRef)({x:0,y:0});aK(e,"touchstart",e=>{a.current.x=e.touches[0].clientX,a.current.y=e.touches[0].clientY},!0),aK(e,"touchend",e=>{let t={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY};if(!(Math.abs(t.x-a.current.x)>=30||Math.abs(t.y-a.current.y)>=30))return n(e,()=>aE(e.target)?e.target:null)},!0),aV(e,"blur",e=>n(e,()=>aA(window.document.activeElement)?window.document.activeElement:null),!0)}function aZ(...e){return(0,H.useMemo)(()=>ad(...e),[...e])}"undefined"!=typeof window&&"undefined"!=typeof document&&(document.addEventListener("keydown",e=>{e.metaKey||e.altKey||e.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")},!0),document.addEventListener("click",e=>{1===e.detail?delete document.documentElement.dataset.headlessuiFocusVisible:0===e.detail&&(document.documentElement.dataset.headlessuiFocusVisible="")},!0)),e.s(["Focus",()=>aR,"FocusResult",()=>aN,"FocusableMode",()=>aD,"focusElement",()=>aW,"focusFrom",()=>aH,"focusIn",()=>aq,"focusableSelector",()=>aP,"isFocusableElement",()=>aL,"restoreFocusIfNecessary",()=>aj,"sortByDomNode",()=>aF],652265),e.s(["useDocumentEvent",()=>aK],22357),e.s(["useOutsideClick",()=>aJ],952744),e.s(["useOwnerDocument",()=>aZ],605083);var aG=((k=aG||{})[k.None=1]="None",k[k.Focusable=2]="Focusable",k[k.Hidden=4]="Hidden",k);let aY=sU(function(e,t){var r;let{features:i=1,...n}=e,s={ref:t,"aria-hidden":(2&i)==2||(null!=(r=n["aria-hidden"])?r:void 0),hidden:(4&i)==4||void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(4&i)==4&&(2&i)!=2&&{display:"none"}}};return sP()({ourProps:s,theirProps:n,slot:{},defaultTag:"span",name:"Hidden"})}),aQ=(0,H.createContext)(null);function aX({children:e,node:t}){let[r,i]=(0,H.useState)(null),n=a0(null!=t?t:r);return H.default.createElement(aQ.Provider,{value:n},e,null===n&&H.default.createElement(aY,{features:aG.Hidden,ref:e=>{var t,r;if(e){for(let n of null!=(r=null==(t=ad(e))?void 0:t.querySelectorAll("html > *, body > *"))?r:[])if(n!==document.body&&n!==document.head&&ab(n)&&null!=n&&n.contains(e)){i(n);break}}}}))}function a0(e=null){var t;return null!=(t=(0,H.useContext)(aQ))?t:e}function a1(e){let t={};for(let r of e)Object.assign(t,r(t));return t}let a2=(CS=()=>new Map,Cx={PUSH(e,t){var r;let i=null!=(r=this.get(e))?r:{doc:e,count:0,d:sn(),meta:new Set,computedMeta:{}};return i.count++,i.meta.add(t),i.computedMeta=a1(i.meta),this.set(e,i),this},POP(e,t){let r=this.get(e);return r&&(r.count--,r.meta.delete(t),r.computedMeta=a1(r.meta)),this},SCROLL_PREVENT(e){let t,r={doc:e.doc,d:e.d,meta:()=>e.computedMeta},i=[az()?{before({doc:e,d:t,meta:r}){function i(e){for(let t of r().containers)for(let r of t())if(r.contains(e))return!0;return!1}t.microTask(()=>{var r;if("auto"!==window.getComputedStyle(e.documentElement).scrollBehavior){let r=sn();r.style(e.documentElement,"scrollBehavior","auto"),t.add(()=>t.microTask(()=>r.dispose()))}let n=null!=(r=window.scrollY)?r:window.pageYOffset,s=null;t.addEventListener(e,"click",t=>{if(aE(t.target))try{let r=t.target.closest("a");if(!r)return;let{hash:n}=new URL(r.href),a=e.querySelector(n);aE(a)&&!i(a)&&(s=a)}catch{}},!0),t.group(r=>{t.addEventListener(e,"touchstart",e=>{if(r.dispose(),aE(e.target)&&a_(e.target))if(i(e.target)){let t=e.target;for(;t.parentElement&&i(t.parentElement);)t=t.parentElement;r.style(t,"overscrollBehavior","contain")}else r.style(e.target,"touchAction","none")})}),t.addEventListener(e,"touchmove",e=>{if(aE(e.target)&&!aS(e.target))if(i(e.target)){let t=e.target;for(;t.parentElement&&""!==t.dataset.headlessuiPortal&&!(t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth);)t=t.parentElement;""===t.dataset.headlessuiPortal&&e.preventDefault()}else e.preventDefault()},{passive:!1}),t.add(()=>{var e;n!==(null!=(e=window.scrollY)?e:window.pageYOffset)&&window.scrollTo(0,n),s&&s.isConnected&&(s.scrollIntoView({block:"nearest"}),s=null)})})}}:{},{before({doc:e}){var r;let i=e.documentElement;t=Math.max(0,(null!=(r=e.defaultView)?r:window).innerWidth-i.clientWidth)},after({doc:e,d:r}){let i=e.documentElement,n=Math.max(0,i.clientWidth-i.offsetWidth),s=Math.max(0,t-n);r.style(i,"paddingRight",`${s}px`)}},{before({doc:e,d:t}){t.style(e.documentElement,"overflow","hidden")}}];i.forEach(({before:e})=>null==e?void 0:e(r)),i.forEach(({after:e})=>null==e?void 0:e(r))},SCROLL_ALLOW({d:e}){e.dispose()},TEARDOWN({doc:e}){this.delete(e)}},T=CS(),C=new Set,{getSnapshot:()=>T,subscribe:e=>(C.add(e),()=>C.delete(e)),dispatch(e,...t){let r=Cx[e].call(T,...t);r&&(T=r,C.forEach(e=>e()))}});function a3(e,t,r=()=>[document.body]){!function(e,t,r=()=>({containers:[]})){let i=(0,H.useSyncExternalStore)(a2.subscribe,a2.getSnapshot,a2.getSnapshot),n=t?i.get(t):void 0;n&&n.count,sc(()=>{if(!(!t||!e))return a2.dispatch("PUSH",t,r),()=>a2.dispatch("POP",t,r)},[e,t])}(ac(e,"scroll-lock"),t,e=>{var t;return{containers:[...null!=(t=e.containers)?t:[],r]}})}function a5(e){return(0,H.useMemo)(()=>e,Object.values(e))}a2.subscribe(()=>{let e=a2.getSnapshot(),t=new Map;for(let[r]of e)t.set(r,r.documentElement.style.overflow);for(let r of e.values()){let e="hidden"===t.get(r.doc),i=0!==r.count;(i&&!e||!i&&e)&&a2.dispatch(r.count>0?"SCROLL_PREVENT":"SCROLL_ALLOW",r),0===r.count&&a2.dispatch("TEARDOWN",r)}}),e.s(["useScrollLock",()=>a3],101852),e.s(["useSlot",()=>a5],255743);let a8=(0,H.createContext)(()=>{});function a6({value:e,children:t}){return H.default.createElement(a8.Provider,{value:e},t)}let a4=(0,H.createContext)(!1);function a7(e){return H.default.createElement(a4.Provider,{value:e.force},e.children)}let a9=(0,H.createContext)(void 0);function oe(){return(0,H.useContext)(a9)}e.s(["useDisabled",()=>oe],601893);let ot=(0,H.createContext)(null);function or(){let[e,t]=(0,H.useState)([]);return[e.length>0?e.join(" "):void 0,(0,H.useMemo)(()=>function(e){let r=su(e=>(t(t=>[...t,e]),()=>t(t=>{let r=t.slice(),i=r.indexOf(e);return -1!==i&&r.splice(i,1),r}))),i=(0,H.useMemo)(()=>({register:r,slot:e.slot,name:e.name,props:e.props,value:e.value}),[r,e.slot,e.name,e.props,e.value]);return H.default.createElement(ot.Provider,{value:i},e.children)},[t])]}ot.displayName="DescriptionContext";let oi=Object.assign(sU(function(e,t){let r=(0,H.useId)(),i=oe(),{id:n=`headlessui-description-${r}`,...s}=e,a=function e(){let t=(0,H.useContext)(ot);if(null===t){let t=Error("You used a <Description /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(t,e),t}return t}(),o=sg(t);sc(()=>a.register(n),[n,a.register]);let l=a5({...a.slot,disabled:i||!1}),c={ref:o,...a.props,id:n};return sP()({ourProps:c,theirProps:s,slot:l,defaultTag:"p",name:a.name||"Description"})}),{});function on(e){let t=su(e),r=(0,H.useRef)(!1);(0,H.useEffect)(()=>(r.current=!1,()=>{r.current=!0,si(()=>{r.current&&t()})}),[t])}e.s(["Description",()=>oi,"useDescriptions",()=>or],35889),e.s(["useOnUnmount",()=>on],526599);var os=((P=os||{})[P.Forwards=0]="Forwards",P[P.Backwards=1]="Backwards",P);function oa(e,t){let r=(0,H.useRef)([]),i=su(e);(0,H.useEffect)(()=>{let e=[...r.current];for(let[n,s]of t.entries())if(r.current[n]!==s){let n=i(t,e);return r.current=t,n}},[i,...t])}let oo=[];function ol(){"loading"!==document.readyState&&((()=>{function e(e){if(!aE(e.target)||e.target===document.body||oo[0]===e.target)return;let t=e.target;t=t.closest(aP),oo.unshift(null!=t?t:e.target),(oo=oo.filter(e=>null!=e&&e.isConnected)).splice(10)}window.addEventListener("click",e,{capture:!0}),window.addEventListener("mousedown",e,{capture:!0}),window.addEventListener("focus",e,{capture:!0}),document.body.addEventListener("click",e,{capture:!0}),document.body.addEventListener("mousedown",e,{capture:!0}),document.body.addEventListener("focus",e,{capture:!0})})(),document.removeEventListener("DOMContentLoaded",ol))}function oc(e){if(!e)return new Set;if("function"==typeof e)return new Set(e());let t=new Set;for(let r of e.current)ab(r.current)&&t.add(r.current);return t}"undefined"!=typeof window&&"undefined"!=typeof document&&(document.addEventListener("DOMContentLoaded",ol),ol());var od=((O=od||{})[O.None=0]="None",O[O.InitialFocus=1]="InitialFocus",O[O.TabLock=2]="TabLock",O[O.FocusLock=4]="FocusLock",O[O.RestoreFocus=8]="RestoreFocus",O[O.AutoFocus=16]="AutoFocus",O);let ou=Object.assign(sU(function(e,t){let r,i=(0,H.useRef)(null),n=sg(i,t),{initialFocus:s,initialFocusFallback:a,containers:o,features:l=15,...c}=e;sp()||(l=0);let d=aZ(i.current);!function(e,{ownerDocument:t}){let r=!!(8&e),i=function(e=!0){let t=(0,H.useRef)(oo.slice());return oa(([e],[r])=>{!0===r&&!1===e&&si(()=>{t.current.splice(0)}),!1===r&&!0===e&&(t.current=oo.slice())},[e,oo,t]),su(()=>{var e;return null!=(e=t.current.find(e=>null!=e&&e.isConnected))?e:null})}(r);oa(()=>{r||ap(null==t?void 0:t.body)&&aW(i())},[r]),on(()=>{r&&aW(i())})}(l,{ownerDocument:d});let u=function(e,{ownerDocument:t,container:r,initialFocus:i,initialFocusFallback:n}){let s=(0,H.useRef)(null),a=ac(!!(1&e),"focus-trap#initial-focus"),o=sh();return oa(()=>{if(0===e)return;if(!a){null!=n&&n.current&&aW(n.current);return}let l=r.current;l&&si(()=>{if(!o.current)return;let r=null==t?void 0:t.activeElement;if(null!=i&&i.current){if((null==i?void 0:i.current)===r){s.current=r;return}}else if(l.contains(r)){s.current=r;return}if(null!=i&&i.current)aW(i.current);else{if(16&e){if(aq(l,aR.First|aR.AutoFocus)!==aN.Error)return}else if(aq(l,aR.First)!==aN.Error)return;if(null!=n&&n.current&&(aW(n.current),(null==t?void 0:t.activeElement)===n.current))return;console.warn("There are no focusable elements inside the <FocusTrap />")}s.current=null==t?void 0:t.activeElement})},[n,a,e]),s}(l,{ownerDocument:d,container:i,initialFocus:s,initialFocusFallback:a});!function(e,{ownerDocument:t,container:r,containers:i,previousActiveElement:n}){let s=sh(),a=!!(4&e);sQ(null==t?void 0:t.defaultView,"focus",e=>{if(!a||!s.current)return;let t=oc(i);av(r.current)&&t.add(r.current);let o=n.current;if(!o)return;let l=e.target;av(l)?oh(t,l)?(n.current=l,aW(l)):(e.preventDefault(),e.stopPropagation(),aW(o)):aW(n.current)},!0)}(l,{ownerDocument:d,container:i,containers:o,previousActiveElement:u});let h=(r=(0,H.useRef)(0),aV(!0,"keydown",e=>{"Tab"===e.key&&(r.current=+!!e.shiftKey)},!0),r),p=su(e=>{if(!av(i.current))return;let t=i.current;sk(h.current,{[os.Forwards]:()=>{aq(t,aR.First,{skipElements:[e.relatedTarget,a]})},[os.Backwards]:()=>{aq(t,aR.Last,{skipElements:[e.relatedTarget,a]})}})}),f=ac(!!(2&l),"focus-trap#tab-lock"),y=ss(),g=(0,H.useRef)(!1),m=sP();return H.default.createElement(H.default.Fragment,null,f&&H.default.createElement(aY,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:p,features:aG.Focusable}),m({ourProps:{ref:n,onKeyDown(e){"Tab"==e.key&&(g.current=!0,y.requestAnimationFrame(()=>{g.current=!1}))},onBlur(e){if(!(4&l))return;let t=oc(o);av(i.current)&&t.add(i.current);let r=e.relatedTarget;aE(r)&&"true"!==r.dataset.headlessuiFocusGuard&&(oh(t,r)||(g.current?aq(i.current,sk(h.current,{[os.Forwards]:()=>aR.Next,[os.Backwards]:()=>aR.Previous})|aR.WrapAround,{relativeTo:e.target}):aE(e.target)&&aW(e.target)))}},theirProps:c,defaultTag:"div",name:"FocusTrap"}),f&&H.default.createElement(aY,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:p,features:aG.Focusable}))}),{features:od});function oh(e,t){for(let r of e)if(r.contains(t))return!0;return!1}var op=e.i(174080);let of=H.Fragment,oy=sU(function(e,t){let{ownerDocument:r=null,...i}=e,n=(0,H.useRef)(null),s=sg(sy(e=>{n.current=e}),t),a=aZ(n.current),o=function(e){let t=(0,H.useContext)(a4),r=(0,H.useContext)(om),[i,n]=(0,H.useState)(()=>{var i;if(!t&&null!==r)return null!=(i=r.current)?i:null;if(sl.isServer)return null;let n=null==e?void 0:e.getElementById("headlessui-portal-root");if(n)return n;if(null===e)return null;let s=e.createElement("div");return s.setAttribute("id","headlessui-portal-root"),e.body.appendChild(s)});return(0,H.useEffect)(()=>{null!==i&&(null!=e&&e.body.contains(i)||null==e||e.body.appendChild(i))},[i,e]),(0,H.useEffect)(()=>{t||null!==r&&n(r.current)},[r,n,t]),i}(null!=r?r:a),l=(0,H.useContext)(ow),c=ss(),d=sP();return on(()=>{var e;o&&o.childNodes.length<=0&&(null==(e=o.parentElement)||e.removeChild(o))}),o?(0,op.createPortal)(H.default.createElement("div",{"data-headlessui-portal":"",ref:e=>{c.dispose(),l&&e&&c.add(l.register(e))}},d({ourProps:{ref:s},theirProps:i,slot:{},defaultTag:of,name:"Portal"})),o):null}),og=H.Fragment,om=(0,H.createContext)(null),ow=(0,H.createContext)(null);function ob(){let e=(0,H.useContext)(ow),t=(0,H.useRef)([]),r=su(r=>(t.current.push(r),e&&e.register(r),()=>i(r))),i=su(r=>{let i=t.current.indexOf(r);-1!==i&&t.current.splice(i,1),e&&e.unregister(r)}),n=(0,H.useMemo)(()=>({register:r,unregister:i,portals:t}),[r,i,t]);return[t,(0,H.useMemo)(()=>function({children:e}){return H.default.createElement(ow.Provider,{value:n},e)},[n])]}let ov=sU(function(e,t){let r=sg(t),{enabled:i=!0,ownerDocument:n,...s}=e,a=sP();return i?H.default.createElement(oy,{...s,ownerDocument:n,ref:r}):a({ourProps:{ref:r},theirProps:s,slot:{},defaultTag:of,name:"Portal"})}),oE=sU(function(e,t){let{target:r,...i}=e,n={ref:sg(t)},s=sP();return H.default.createElement(om.Provider,{value:r},s({ourProps:n,theirProps:i,defaultTag:og,name:"Popover.Group"}))}),o_=Object.assign(ov,{Group:oE});e.s(["Portal",()=>o_,"PortalGroup",()=>oE,"useNestedPortals",()=>ob],635307);var oA=((R=oA||{})[R.Open=0]="Open",R[R.Closed=1]="Closed",R),oS=((N=oS||{})[N.SetTitleId=0]="SetTitleId",N);let ox={0:(e,t)=>e.titleId===t.id?e:{...e,titleId:t.id}},oI=(0,H.createContext)(null);function ok(e){let t=(0,H.useContext)(oI);if(null===t){let t=Error(`<${e} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,ok),t}return t}function oT(e,t){return sk(t.type,ox,e,t)}oI.displayName="DialogContext";let oC=sU(function(e,t){let r=(0,H.useId)(),{id:i=`headlessui-dialog-${r}`,open:n,onClose:s,initialFocus:a,role:o="dialog",autoFocus:l=!0,__demoMode:c=!1,unmount:d=!1,...u}=e,h=(0,H.useRef)(!1);o="dialog"===o||"alertdialog"===o?o:(h.current||(h.current=!0,console.warn(`Invalid role [${o}] passed to <Dialog />. Only \`dialog\` and and \`alertdialog\` are supported. Using \`dialog\` instead.`)),"dialog");let p=sA();void 0===n&&null!==p&&(n=(p&s_.Open)===s_.Open);let f=(0,H.useRef)(null),y=sg(f,t),g=aZ(f.current),m=+!n,[w,b]=(0,H.useReducer)(oT,{titleId:null,descriptionId:null,panelRef:(0,H.createRef)()}),v=su(()=>s(!1)),E=su(e=>b({type:0,id:e})),_=!!sp()&&0===m,[A,S]=ob(),x=a0(),{resolveContainers:I}=function({defaultContainers:e=[],portals:t,mainTreeNode:r}={}){let i=su(()=>{var i,n;let s=ad(r),a=[];for(let t of e)null!==t&&(ab(t)?a.push(t):"current"in t&&ab(t.current)&&a.push(t.current));if(null!=t&&t.current)for(let e of t.current)a.push(e);for(let e of null!=(i=null==s?void 0:s.querySelectorAll("html > *, body > *"))?i:[])e!==document.body&&e!==document.head&&ab(e)&&"headlessui-portal-root"!==e.id&&(r&&(e.contains(r)||e.contains(null==(n=null==r?void 0:r.getRootNode())?void 0:n.host))||a.some(t=>e.contains(t))||a.push(e));return a});return{resolveContainers:i,contains:su(e=>i().some(t=>t.contains(e)))}}({mainTreeNode:x,portals:A,defaultContainers:[{get current(){var k;return null!=(k=w.panelRef.current)?k:f.current}}]}),T=null!==p&&(p&s_.Closing)===s_.Closing;am(!c&&!T&&_,{allowed:su(()=>{var e,t;return[null!=(t=null==(e=f.current)?void 0:e.closest("[data-headlessui-portal]"))?t:null]}),disallowed:su(()=>{var e;return[null!=(e=null==x?void 0:x.closest("body > *:not(#headlessui-portal-root)"))?e:null]})});let C=as.get(null);sc(()=>{if(_)return C.actions.push(i),()=>C.actions.pop(i)},[C,i,_]);let P=ao(C,(0,H.useCallback)(e=>C.selectors.isTop(e,i),[C,i]));aJ(P,I,e=>{e.preventDefault(),v()}),function(e,t="undefined"!=typeof document?document.defaultView:null,r){let i=ac(e,"escape");sQ(t,"keydown",e=>{i&&(e.defaultPrevented||e.key===sY.Escape&&r(e))})}(P,null==g?void 0:g.defaultView,e=>{e.preventDefault(),e.stopPropagation(),document.activeElement&&"blur"in document.activeElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur(),v()}),a3(!c&&!T&&_,g,I),aC(_,f,v);let[O,R]=or(),N=(0,H.useMemo)(()=>[{dialogState:m,close:v,setTitleId:E,unmount:d},w],[m,v,E,d,w]),M=a5({open:0===m}),U={ref:y,id:i,role:o,tabIndex:-1,"aria-modal":c?void 0:0===m||void 0,"aria-labelledby":w.titleId,"aria-describedby":O,unmount:d},D=!function(){var e;let[t]=(0,H.useState)(()=>"undefined"!=typeof window&&"function"==typeof window.matchMedia?window.matchMedia("(pointer: coarse)"):null),[r,i]=(0,H.useState)(null!=(e=null==t?void 0:t.matches)&&e);return sc(()=>{if(t)return t.addEventListener("change",e),()=>t.removeEventListener("change",e);function e(e){i(e.matches)}},[t]),r}(),L=od.None;_&&!c&&(L|=od.RestoreFocus,L|=od.TabLock,l&&(L|=od.AutoFocus),D&&(L|=od.InitialFocus));let j=sP();return H.default.createElement(sx,null,H.default.createElement(a7,{force:!0},H.default.createElement(o_,null,H.default.createElement(oI.Provider,{value:N},H.default.createElement(oE,{target:f},H.default.createElement(a7,{force:!1},H.default.createElement(R,{slot:M},H.default.createElement(S,null,H.default.createElement(ou,{initialFocus:a,initialFocusFallback:f,containers:I,features:L},H.default.createElement(a6,{value:v},j({ourProps:U,theirProps:u,slot:M,defaultTag:oP,features:oO,visible:0===m,name:"Dialog"})))))))))))}),oP="div",oO=sT.RenderStrategy|sT.Static,oR=sU(function(e,t){let{transition:r=!1,open:i,...n}=e,s=sA(),a=e.hasOwnProperty("open")||null!==s,o=e.hasOwnProperty("onClose");if(!a&&!o)throw Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!a)throw Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!o)throw Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(!s&&"boolean"!=typeof e.open)throw Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${e.open}`);if("function"!=typeof e.onClose)throw Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${e.onClose}`);return(void 0!==i||r)&&!n.static?H.default.createElement(aX,null,H.default.createElement(sG,{show:i,transition:r,unmount:n.unmount},H.default.createElement(oC,{ref:t,...n}))):H.default.createElement(aX,null,H.default.createElement(oC,{ref:t,open:i,...n}))}),oN=sU(function(e,t){let r=(0,H.useId)(),{id:i=`headlessui-dialog-panel-${r}`,transition:n=!1,...s}=e,[{dialogState:a,unmount:o},l]=ok("Dialog.Panel"),c=sg(t,l.panelRef),d=a5({open:0===a}),u=su(e=>{e.stopPropagation()}),h=n?sZ:H.Fragment,p=sP();return H.default.createElement(h,{...n?{unmount:o}:{}},p({ourProps:{ref:c,id:i,onClick:u},theirProps:s,slot:d,defaultTag:"div",name:"Dialog.Panel"}))}),oM=Object.assign(oR,{Panel:oN,Title:(sU(function(e,t){let{transition:r=!1,...i}=e,[{dialogState:n,unmount:s}]=ok("Dialog.Backdrop"),a=a5({open:0===n}),o=r?sZ:H.Fragment,l=sP();return H.default.createElement(o,{...r?{unmount:s}:{}},l({ourProps:{ref:t,"aria-hidden":!0},theirProps:i,slot:a,defaultTag:"div",name:"Dialog.Backdrop"}))}),sU(function(e,t){let r=(0,H.useId)(),{id:i=`headlessui-dialog-title-${r}`,...n}=e,[{dialogState:s,setTitleId:a}]=ok("Dialog.Title"),o=sg(t);(0,H.useEffect)(()=>(a(i),()=>a(null)),[i,a]);let l=a5({open:0===s});return sP()({ourProps:{ref:o,id:i},theirProps:n,slot:l,defaultTag:"h2",name:"Dialog.Title"})})),Description:oi});var oU=e.i(219298),oD=e.i(277945),oL=e.i(648512),oj=e.i(36610),oB=e.i(275221);let oW="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function oF(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function oH(e,...t){if(!(e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function oq(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function oz(e,t){oH(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)}function o$(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function oK(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function oV(e,t){return e<<32-t|e>>>t}let oJ=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0]?e=>e:function(e){for(let r=0;r<e.length;r++){var t;e[r]=(t=e[r])<<24&0xff000000|t<<8&0xff0000|t>>>8&65280|t>>>24&255}return e};function oZ(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}(e)),oH(e),e}class oG{}function oY(e){let t=t=>e().update(oZ(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function oQ(e=32){if(oW&&"function"==typeof oW.getRandomValues)return oW.getRandomValues(new Uint8Array(e));if(oW&&"function"==typeof oW.randomBytes)return Uint8Array.from(oW.randomBytes(e));throw Error("crypto.getRandomValues must be defined")}class oX extends oG{constructor(e,t,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=oK(this.buffer)}update(e){oq(this),oH(e=oZ(e));let{view:t,buffer:r,blockLen:i}=this,n=e.length;for(let s=0;s<n;){let a=Math.min(i-this.pos,n-s);if(a===i){let t=oK(e);for(;i<=n-s;s+=i)this.process(t,s);continue}r.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){oq(this),oz(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:i,isLE:n}=this,{pos:s}=this;t[s++]=128,o$(this.buffer.subarray(s)),this.padOffset>i-s&&(this.process(r,0),s=0);for(let e=s;e<i;e++)t[e]=0;!function(e,t,r,i){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,i);let n=BigInt(32),s=BigInt(0xffffffff),a=Number(r>>n&s),o=Number(r&s),l=4*!!i,c=4*!i;e.setUint32(t+l,a,i),e.setUint32(t+c,o,i)}(r,i-8,BigInt(8*this.length),n),this.process(r,0);let a=oK(e),o=this.outputLen;if(o%4)throw Error("_sha2: outputLen should be aligned to 32bit");let l=o/4,c=this.get();if(l>c.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<l;e++)a.setUint32(4*e,c[e],n)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:i,finished:n,destroyed:s,pos:a}=this;return e.destroyed=s,e.finished=n,e.length=i,e.pos=a,i%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}let o0=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),o1=Uint32Array.from([0xc1059ed8,0x367cd507,0x3070dd17,0xf70e5939,0xffc00b31,0x68581511,0x64f98fa7,0xbefa4fa4]),o2=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),o3=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),o5=BigInt(0x100000000-1),o8=BigInt(32);function o6(e,t=!1){let r=e.length,i=new Uint32Array(r),n=new Uint32Array(r);for(let s=0;s<r;s++){let{h:r,l:a}=function(e,t=!1){return t?{h:Number(e&o5),l:Number(e>>o8&o5)}:{h:0|Number(e>>o8&o5),l:0|Number(e&o5)}}(e[s],t);[i[s],n[s]]=[r,a]}return[i,n]}let o4=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),o7=new Uint32Array(64);class o9 extends oX{constructor(e=32){super(64,e,8,!1),this.A=0|o0[0],this.B=0|o0[1],this.C=0|o0[2],this.D=0|o0[3],this.E=0|o0[4],this.F=0|o0[5],this.G=0|o0[6],this.H=0|o0[7]}get(){let{A:e,B:t,C:r,D:i,E:n,F:s,G:a,H:o}=this;return[e,t,r,i,n,s,a,o]}set(e,t,r,i,n,s,a,o){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|i,this.E=0|n,this.F=0|s,this.G=0|a,this.H=0|o}process(e,t){for(let r=0;r<16;r++,t+=4)o7[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=o7[e-15],r=o7[e-2],i=oV(t,7)^oV(t,18)^t>>>3,n=oV(r,17)^oV(r,19)^r>>>10;o7[e]=n+o7[e-7]+i+o7[e-16]|0}let{A:r,B:i,C:n,D:s,E:a,F:o,G:l,H:c}=this;for(let e=0;e<64;e++){var d,u,h,p;let t=c+(oV(a,6)^oV(a,11)^oV(a,25))+((d=a)&o^~d&l)+o4[e]+o7[e]|0,f=(oV(r,2)^oV(r,13)^oV(r,22))+((u=r)&(h=i)^u&(p=n)^h&p)|0;c=l,l=o,o=a,a=s+t|0,s=n,n=i,i=r,r=t+f|0}r=r+this.A|0,i=i+this.B|0,n=n+this.C|0,s=s+this.D|0,a=a+this.E|0,o=o+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(r,i,n,s,a,o,l,c)}roundClean(){o$(o7)}destroy(){this.set(0,0,0,0,0,0,0,0),o$(this.buffer)}}let le=o6(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),lt=le[0],lr=le[1],li=new Uint32Array(80),ln=new Uint32Array(80),ls=oY(()=>new o9);class la extends oG{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,function(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.createHasher");oF(e.outputLen),oF(e.blockLen)}(e);const r=oZ(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,n=new Uint8Array(i);n.set(r.length>i?e.create().update(r).digest():r);for(let e=0;e<n.length;e++)n[e]^=54;this.iHash.update(n),this.oHash=e.create();for(let e=0;e<n.length;e++)n[e]^=106;this.oHash.update(n),o$(n)}update(e){return oq(this),this.iHash.update(e),this}digestInto(e){oq(this),oH(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:r,finished:i,destroyed:n,blockLen:s,outputLen:a}=this;return e.finished=i,e.destroyed=n,e.blockLen=s,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let lo=(e,t,r)=>new la(e,t).update(r).digest();lo.create=(e,t)=>new la(e,t);let ll=BigInt(0),lc=BigInt(1);function ld(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function lu(e){if(!ld(e))throw Error("Uint8Array expected")}function lh(e,t){if("boolean"!=typeof t)throw Error(e+" boolean expected, got "+t)}function lp(e){let t=e.toString(16);return 1&t.length?"0"+t:t}function lf(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);return""===e?ll:BigInt("0x"+e)}let ly="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,lg=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function lm(e){if(lu(e),ly)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=lg[e[r]];return t}function lw(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}function lb(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);if(ly)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw Error("hex string expected, got unpadded hex of length "+t);let i=new Uint8Array(r);for(let t=0,n=0;t<r;t++,n+=2){let r=lw(e.charCodeAt(n)),s=lw(e.charCodeAt(n+1));if(void 0===r||void 0===s)throw Error('hex string expected, got non-hex character "'+(e[n]+e[n+1])+'" at index '+n);i[t]=16*r+s}return i}function lv(e){return lf(lm(e))}function lE(e){return lu(e),lf(lm(Uint8Array.from(e).reverse()))}function l_(e,t){return lb(e.toString(16).padStart(2*t,"0"))}function lA(e,t){return l_(e,t).reverse()}function lS(e,t,r){let i;if("string"==typeof t)try{i=lb(t)}catch(t){throw Error(e+" must be hex string or Uint8Array, cause: "+t)}else if(ld(t))i=Uint8Array.from(t);else throw Error(e+" must be hex string or Uint8Array");let n=i.length;if("number"==typeof r&&n!==r)throw Error(e+" of length "+r+" expected, got "+n);return i}function lx(...e){let t=0;for(let r=0;r<e.length;r++){let i=e[r];lu(i),t+=i.length}let r=new Uint8Array(t);for(let t=0,i=0;t<e.length;t++){let n=e[t];r.set(n,i),i+=n.length}return r}let lI=e=>"bigint"==typeof e&&ll<=e;function lk(e,t,r){return lI(e)&&lI(t)&&lI(r)&&t<=e&&e<r}function lT(e,t,r,i){if(!lk(t,r,i))throw Error("expected valid "+e+": "+r+" <= n < "+i+", got "+t)}let lC=e=>(lc<<BigInt(e))-lc,lP=e=>new Uint8Array(e),lO={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||ld(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function lR(e,t,r={}){let i=(t,r,i)=>{let n=lO[r];if("function"!=typeof n)throw Error("invalid validator function");let s=e[t];if((!i||void 0!==s)&&!n(s,e))throw Error("param "+String(t)+" is invalid. Expected "+r+", got "+s)};for(let[e,r]of Object.entries(t))i(e,r,!1);for(let[e,t]of Object.entries(r))i(e,t,!0);return e}function lN(e){let t=new WeakMap;return(r,...i)=>{let n=t.get(r);if(void 0!==n)return n;let s=e(r,...i);return t.set(r,s),s}}let lM=BigInt(0),lU=BigInt(1),lD=BigInt(2),lL=BigInt(3),lj=BigInt(4),lB=BigInt(5),lW=BigInt(8);function lF(e,t){let r=e%t;return r>=lM?r:t+r}function lH(e,t,r){let i=e;for(;t-- >lM;)i*=i,i%=r;return i}function lq(e,t){if(e===lM)throw Error("invert: expected non-zero number");if(t<=lM)throw Error("invert: expected positive modulus, got "+t);let r=lF(e,t),i=t,n=lM,s=lU,a=lU,o=lM;for(;r!==lM;){let e=i/r,t=i%r,l=n-a*e,c=s-o*e;i=r,r=t,n=a,s=o,a=l,o=c}if(i!==lU)throw Error("invert: does not exist");return lF(n,t)}function lz(e,t){let r=(e.ORDER+lU)/lj,i=e.pow(t,r);if(!e.eql(e.sqr(i),t))throw Error("Cannot find square root");return i}function l$(e,t){let r=(e.ORDER-lB)/lW,i=e.mul(t,lD),n=e.pow(i,r),s=e.mul(t,n),a=e.mul(e.mul(s,lD),n),o=e.mul(s,e.sub(a,e.ONE));if(!e.eql(e.sqr(o),t))throw Error("Cannot find square root");return o}let lK=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function lV(e){return lR(e,lK.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"}))}function lJ(e,t,r=!1){let i=Array(t.length).fill(r?e.ZERO:void 0),n=t.reduce((t,r,n)=>e.is0(r)?t:(i[n]=t,e.mul(t,r)),e.ONE),s=e.inv(n);return t.reduceRight((t,r,n)=>e.is0(r)?t:(i[n]=e.mul(t,i[n]),e.mul(t,r)),s),i}function lZ(e,t){let r=(e.ORDER-lU)/lD,i=e.pow(t,r),n=e.eql(i,e.ONE),s=e.eql(i,e.ZERO),a=e.eql(i,e.neg(e.ONE));if(!n&&!s&&!a)throw Error("invalid Legendre symbol result");return n?1:s?0:-1}function lG(e,t){void 0!==t&&oF(t);let r=void 0!==t?t:e.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function lY(e,t,r=!1,i={}){let n;if(e<=lM)throw Error("invalid field: expected ORDER > 0, got "+e);let{nBitLength:s,nByteLength:a}=lG(e,t);if(a>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let o=Object.freeze({ORDER:e,isLE:r,BITS:s,BYTES:a,MASK:lC(s),ZERO:lM,ONE:lU,create:t=>lF(t,e),isValid:t=>{if("bigint"!=typeof t)throw Error("invalid field element: expected bigint, got "+typeof t);return lM<=t&&t<e},is0:e=>e===lM,isOdd:e=>(e&lU)===lU,neg:t=>lF(-t,e),eql:(e,t)=>e===t,sqr:t=>lF(t*t,e),add:(t,r)=>lF(t+r,e),sub:(t,r)=>lF(t-r,e),mul:(t,r)=>lF(t*r,e),pow:(e,t)=>(function(e,t,r){if(r<lM)throw Error("invalid exponent, negatives unsupported");if(r===lM)return e.ONE;if(r===lU)return t;let i=e.ONE,n=t;for(;r>lM;)r&lU&&(i=e.mul(i,n)),n=e.sqr(n),r>>=lU;return i})(o,e,t),div:(t,r)=>lF(t*lq(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>lq(t,e),sqrt:i.sqrt||(t=>(n||(n=e%lj===lL?lz:e%lW===lB?l$:function(e){if(e<BigInt(3))throw Error("sqrt is not defined for small field");let t=e-lU,r=0;for(;t%lD===lM;)t/=lD,r++;let i=lD,n=lY(e);for(;1===lZ(n,i);)if(i++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===r)return lz;let s=n.pow(i,t),a=(t+lU)/lD;return function(e,i){if(e.is0(i))return i;if(1!==lZ(e,i))throw Error("Cannot find square root");let n=r,o=e.mul(e.ONE,s),l=e.pow(i,t),c=e.pow(i,a);for(;!e.eql(l,e.ONE);){if(e.is0(l))return e.ZERO;let t=1,r=e.sqr(l);for(;!e.eql(r,e.ONE);)if(t++,r=e.sqr(r),t===n)throw Error("Cannot find square root");let i=lU<<BigInt(n-t-1),s=e.pow(o,i);n=t,o=e.sqr(s),l=e.mul(l,o),c=e.mul(c,s)}return c}}(e)),n(o,t))),toBytes:e=>r?lA(e,a):l_(e,a),fromBytes:e=>{if(e.length!==a)throw Error("Field.fromBytes: expected "+a+" bytes, got "+e.length);return r?lE(e):lv(e)},invertBatch:e=>lJ(o,e),cmov:(e,t,r)=>r?t:e});return Object.freeze(o)}function lQ(e){if("bigint"!=typeof e)throw Error("field order must be bigint");return Math.ceil(e.toString(2).length/8)}function lX(e){let t=lQ(e);return t+Math.ceil(t/2)}let l0=BigInt(0),l1=BigInt(1);function l2(e,t){let r=t.negate();return e?r:t}function l3(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw Error("invalid window size, expected [1.."+t+"], got W="+e)}function l5(e,t){l3(e,t);let r=Math.ceil(t/e)+1,i=2**(e-1),n=2**e;return{windows:r,windowSize:i,mask:lC(e),maxNumber:n,shiftBy:BigInt(e)}}function l8(e,t,r){let{windowSize:i,mask:n,maxNumber:s,shiftBy:a}=r,o=Number(e&n),l=e>>a;o>i&&(o-=s,l+=l1);let c=t*i,d=c+Math.abs(o)-1,u=0===o;return{nextN:l,offset:d,isZero:u,isNeg:o<0,isNegF:t%2!=0,offsetF:c}}let l6=new WeakMap,l4=new WeakMap;function l7(e){return l4.get(e)||1}function l9(e){return lV(e.Fp),lR(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...lG(e.n,e.nBitLength),...e,...{p:e.Fp.ORDER}})}function ce(e){void 0!==e.lowS&&lh("lowS",e.lowS),void 0!==e.prehash&&lh("prehash",e.prehash)}let ct={Err:class extends Error{constructor(e=""){super(e)}},_tlv:{encode:(e,t)=>{let{Err:r}=ct;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(1&t.length)throw new r("tlv.encode: unpadded data");let i=t.length/2,n=lp(i);if(n.length/2&128)throw new r("tlv.encode: long form length too big");let s=i>127?lp(n.length/2|128):"";return lp(e)+s+n+t},decode(e,t){let{Err:r}=ct,i=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[i++]!==e)throw new r("tlv.decode: wrong tlv");let n=t[i++],s=0;if(128&n){let e=127&n;if(!e)throw new r("tlv.decode(long): indefinite length not supported");if(e>4)throw new r("tlv.decode(long): byte length is too big");let a=t.subarray(i,i+e);if(a.length!==e)throw new r("tlv.decode: length bytes not complete");if(0===a[0])throw new r("tlv.decode(long): zero leftmost byte");for(let e of a)s=s<<8|e;if(i+=e,s<128)throw new r("tlv.decode(long): not minimal encoding")}else s=n;let a=t.subarray(i,i+s);if(a.length!==s)throw new r("tlv.decode: wrong value length");return{v:a,l:t.subarray(i+s)}}},_int:{encode(e){let{Err:t}=ct;if(e<cr)throw new t("integer: negative integers are not allowed");let r=lp(e);if(8&Number.parseInt(r[0],16)&&(r="00"+r),1&r.length)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=ct;if(128&e[0])throw new t("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("invalid signature integer: unnecessary leading zero");return lv(e)}},toSig(e){let{Err:t,_int:r,_tlv:i}=ct,n=lS("signature",e),{v:s,l:a}=i.decode(48,n);if(a.length)throw new t("invalid signature: left bytes after parsing");let{v:o,l:l}=i.decode(2,s),{v:c,l:d}=i.decode(2,l);if(d.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(o),s:r.decode(c)}},hexFromSig(e){let{_tlv:t,_int:r}=ct,i=t.encode(2,r.encode(e.r)),n=t.encode(2,r.encode(e.s));return t.encode(48,i+n)}},cr=BigInt(0),ci=BigInt(1),cn=BigInt(2),cs=BigInt(3),ca=BigInt(4),co=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),cl=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),cc=BigInt(0),cd=BigInt(1),cu=BigInt(2),ch=(e,t)=>(e+t/cu)/t,cp=lY(co,void 0,void 0,{sqrt:function(e){let t=BigInt(3),r=BigInt(6),i=BigInt(11),n=BigInt(22),s=BigInt(23),a=BigInt(44),o=BigInt(88),l=e*e*e%co,c=l*l*e%co,d=lH(c,t,co)*c%co,u=lH(d,t,co)*c%co,h=lH(u,cu,co)*l%co,p=lH(h,i,co)*h%co,f=lH(p,n,co)*p%co,y=lH(f,a,co)*f%co,g=lH(y,o,co)*y%co,m=lH(g,a,co)*f%co,w=lH(m,t,co)*c%co,b=lH(w,s,co)*p%co,v=lH(b,r,co)*l%co,E=lH(v,cu,co);if(!cp.eql(cp.sqr(E),e))throw Error("Cannot find square root");return E}}),cf=(CI={a:cc,b:BigInt(7),Fp:cp,n:cl,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-cd*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),n=BigInt("0x100000000000000000000000000000000"),s=ch(t*e,cl),a=ch(-r*e,cl),o=lF(e-s*t-a*i,cl),l=lF(-s*r-a*t,cl),c=o>n,d=l>n;if(c&&(o=cl-o),d&&(l=cl-l),o>n||l>n)throw Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:c,k1:o,k2neg:d,k2:l}}}},{...(M=e=>(function(e){let t,r=(lR(t=l9(e),{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})),{Fp:i,n:n,nByteLength:s,nBitLength:a}=r,o=i.BYTES+1,l=2*i.BYTES+1;function c(e){return lF(e,n)}let{ProjectivePoint:d,normPrivateKeyToScalar:u,weierstrassEquation:h,isWithinCurveOrder:p}=function(e){var t;let r=function(e){let t=l9(e);lR(t,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});let{endo:r,Fp:i,a:n}=t;if(r){if(!i.eql(n,i.ZERO))throw Error("invalid endo: CURVE.a must be 0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...t})}(e),{Fp:i}=r,n=lY(r.n,r.nBitLength),s=r.toBytes||((e,t,r)=>{let n=t.toAffine();return lx(Uint8Array.from([4]),i.toBytes(n.x),i.toBytes(n.y))}),a=r.fromBytes||(e=>{let t=e.subarray(1);return{x:i.fromBytes(t.subarray(0,i.BYTES)),y:i.fromBytes(t.subarray(i.BYTES,2*i.BYTES))}});function o(e){let{a:t,b:n}=r,s=i.sqr(e),a=i.mul(s,e);return i.add(i.add(a,i.mul(e,t)),n)}function l(e,t){let r=i.sqr(t),n=o(e);return i.eql(r,n)}if(!l(r.Gx,r.Gy))throw Error("bad curve params: generator point");let c=i.mul(i.pow(r.a,cs),ca),d=i.mul(i.sqr(r.b),BigInt(27));if(i.is0(i.add(c,d)))throw Error("bad curve params: a or b");function u(e){let t,{allowedPrivateKeyLengths:i,nByteLength:n,wrapPrivateKey:s,n:a}=r;if(i&&"bigint"!=typeof e){if(ld(e)&&(e=lm(e)),"string"!=typeof e||!i.includes(e.length))throw Error("invalid private key");e=e.padStart(2*n,"0")}try{t="bigint"==typeof e?e:lv(lS("private key",e,n))}catch(t){throw Error("invalid private key, expected hex or "+n+" bytes, got "+typeof e)}return s&&(t=lF(t,a)),lT("private key",t,ci,a),t}function h(e){if(!(e instanceof y))throw Error("ProjectivePoint expected")}let p=lN((e,t)=>{let{px:r,py:n,pz:s}=e;if(i.eql(s,i.ONE))return{x:r,y:n};let a=e.is0();null==t&&(t=a?i.ONE:i.inv(s));let o=i.mul(r,t),l=i.mul(n,t),c=i.mul(s,t);if(a)return{x:i.ZERO,y:i.ZERO};if(!i.eql(c,i.ONE))throw Error("invZ was invalid");return{x:o,y:l}}),f=lN(e=>{if(e.is0()){if(r.allowInfinityPoint&&!i.is0(e.py))return;throw Error("bad point: ZERO")}let{x:t,y:n}=e.toAffine();if(!i.isValid(t)||!i.isValid(n))throw Error("bad point: x or y not FE");if(!l(t,n))throw Error("bad point: equation left != right");if(!e.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});class y{constructor(e,t,r){if(null==e||!i.isValid(e))throw Error("x required");if(null==t||!i.isValid(t)||i.is0(t))throw Error("y required");if(null==r||!i.isValid(r))throw Error("z required");this.px=e,this.py=t,this.pz=r,Object.freeze(this)}static fromAffine(e){let{x:t,y:r}=e||{};if(!e||!i.isValid(t)||!i.isValid(r))throw Error("invalid affine point");if(e instanceof y)throw Error("projective point not allowed");let n=e=>i.eql(e,i.ZERO);return n(t)&&n(r)?y.ZERO:new y(t,r,i.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){let t=lJ(i,e.map(e=>e.pz));return e.map((e,r)=>e.toAffine(t[r])).map(y.fromAffine)}static fromHex(e){let t=y.fromAffine(a(lS("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return y.BASE.multiply(u(e))}static msm(e,t){return function(e,t,r,i){if(!Array.isArray(r))throw Error("array expected");r.forEach((t,r)=>{if(!(t instanceof e))throw Error("invalid point at index "+r)});if(!Array.isArray(i))throw Error("array of scalars expected");i.forEach((e,r)=>{if(!t.isValid(e))throw Error("invalid scalar at index "+r)});let n=r.length,s=i.length;if(n!==s)throw Error("arrays of points and scalars must have equal length");let a=e.ZERO,o=function(e){let t;for(t=0;e>ll;e>>=lc,t+=1);return t}(BigInt(n)),l=1;o>12?l=o-3:o>4?l=o-2:o>0&&(l=2);let c=lC(l),d=Array(Number(c)+1).fill(a),u=Math.floor((t.BITS-1)/l)*l,h=a;for(let e=u;e>=0;e-=l){d.fill(a);for(let t=0;t<s;t++){let n=Number(i[t]>>BigInt(e)&c);d[n]=d[n].add(r[t])}let t=a;for(let e=d.length-1,r=a;e>0;e--)r=r.add(d[e]),t=t.add(r);if(h=h.add(t),0!==e)for(let e=0;e<l;e++)h=h.double()}return h}(y,n,e,t)}_setWindowSize(e){w.setWindowSize(this,e)}assertValidity(){f(this)}hasEvenY(){let{y:e}=this.toAffine();if(i.isOdd)return!i.isOdd(e);throw Error("Field doesn't support isOdd")}equals(e){h(e);let{px:t,py:r,pz:n}=this,{px:s,py:a,pz:o}=e,l=i.eql(i.mul(t,o),i.mul(s,n)),c=i.eql(i.mul(r,o),i.mul(a,n));return l&&c}negate(){return new y(this.px,i.neg(this.py),this.pz)}double(){let{a:e,b:t}=r,n=i.mul(t,cs),{px:s,py:a,pz:o}=this,l=i.ZERO,c=i.ZERO,d=i.ZERO,u=i.mul(s,s),h=i.mul(a,a),p=i.mul(o,o),f=i.mul(s,a);return f=i.add(f,f),d=i.mul(s,o),d=i.add(d,d),l=i.mul(e,d),c=i.mul(n,p),c=i.add(l,c),l=i.sub(h,c),c=i.add(h,c),c=i.mul(l,c),l=i.mul(f,l),d=i.mul(n,d),p=i.mul(e,p),f=i.sub(u,p),f=i.mul(e,f),f=i.add(f,d),d=i.add(u,u),u=i.add(d,u),u=i.add(u,p),u=i.mul(u,f),c=i.add(c,u),p=i.mul(a,o),p=i.add(p,p),u=i.mul(p,f),l=i.sub(l,u),d=i.mul(p,h),d=i.add(d,d),new y(l,c,d=i.add(d,d))}add(e){h(e);let{px:t,py:n,pz:s}=this,{px:a,py:o,pz:l}=e,c=i.ZERO,d=i.ZERO,u=i.ZERO,p=r.a,f=i.mul(r.b,cs),g=i.mul(t,a),m=i.mul(n,o),w=i.mul(s,l),b=i.add(t,n),v=i.add(a,o);b=i.mul(b,v),v=i.add(g,m),b=i.sub(b,v),v=i.add(t,s);let E=i.add(a,l);return v=i.mul(v,E),E=i.add(g,w),v=i.sub(v,E),E=i.add(n,s),c=i.add(o,l),E=i.mul(E,c),c=i.add(m,w),E=i.sub(E,c),u=i.mul(p,v),c=i.mul(f,w),u=i.add(c,u),c=i.sub(m,u),u=i.add(m,u),d=i.mul(c,u),m=i.add(g,g),m=i.add(m,g),w=i.mul(p,w),v=i.mul(f,v),m=i.add(m,w),w=i.sub(g,w),w=i.mul(p,w),v=i.add(v,w),g=i.mul(m,v),d=i.add(d,g),g=i.mul(E,v),c=i.mul(b,c),c=i.sub(c,g),g=i.mul(b,m),u=i.mul(E,u),new y(c,d,u=i.add(u,g))}subtract(e){return this.add(e.negate())}is0(){return this.equals(y.ZERO)}wNAF(e){return w.wNAFCached(this,e,y.normalizeZ)}multiplyUnsafe(e){let{endo:t,n:n}=r;lT("scalar",e,cr,n);let s=y.ZERO;if(e===cr)return s;if(this.is0()||e===ci)return this;if(!t||w.hasPrecomputes(this))return w.wNAFCachedUnsafe(this,e,y.normalizeZ);let{k1neg:a,k1:o,k2neg:l,k2:c}=t.splitScalar(e),d=s,u=s,h=this;for(;o>cr||c>cr;)o&ci&&(d=d.add(h)),c&ci&&(u=u.add(h)),h=h.double(),o>>=ci,c>>=ci;return a&&(d=d.negate()),l&&(u=u.negate()),u=new y(i.mul(u.px,t.beta),u.py,u.pz),d.add(u)}multiply(e){let t,n,{endo:s,n:a}=r;if(lT("scalar",e,ci,a),s){let{k1neg:r,k1:a,k2neg:o,k2:l}=s.splitScalar(e),{p:c,f:d}=this.wNAF(a),{p:u,f:h}=this.wNAF(l);c=w.constTimeNegate(r,c),u=w.constTimeNegate(o,u),u=new y(i.mul(u.px,s.beta),u.py,u.pz),t=c.add(u),n=d.add(h)}else{let{p:r,f:i}=this.wNAF(e);t=r,n=i}return y.normalizeZ([t,n])[0]}multiplyAndAddUnsafe(e,t,r){let i=y.BASE,n=(e,t)=>t!==cr&&t!==ci&&e.equals(i)?e.multiply(t):e.multiplyUnsafe(t),s=n(this,t).add(n(e,r));return s.is0()?void 0:s}toAffine(e){return p(this,e)}isTorsionFree(){let{h:e,isTorsionFree:t}=r;if(e===ci)return!0;if(t)return t(y,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:e,clearCofactor:t}=r;return e===ci?this:t?t(y,this):this.multiplyUnsafe(r.h)}toRawBytes(e=!0){return lh("isCompressed",e),this.assertValidity(),s(y,this,e)}toHex(e=!0){return lh("isCompressed",e),lm(this.toRawBytes(e))}}y.BASE=new y(r.Gx,r.Gy,i.ONE),y.ZERO=new y(i.ZERO,i.ONE,i.ZERO);let{endo:g,nBitLength:m}=r,w=(t=g?Math.ceil(m/2):m,{constTimeNegate:l2,hasPrecomputes:e=>1!==l7(e),unsafeLadder(e,t,r=y.ZERO){let i=e;for(;t>l0;)t&l1&&(r=r.add(i)),i=i.double(),t>>=l1;return r},precomputeWindow(e,r){let{windows:i,windowSize:n}=l5(r,t),s=[],a=e,o=a;for(let e=0;e<i;e++){o=a,s.push(o);for(let e=1;e<n;e++)o=o.add(a),s.push(o);a=o.double()}return s},wNAF(e,r,i){let n=y.ZERO,s=y.BASE,a=l5(e,t);for(let e=0;e<a.windows;e++){let{nextN:t,offset:o,isZero:l,isNeg:c,isNegF:d,offsetF:u}=l8(i,e,a);i=t,l?s=s.add(l2(d,r[u])):n=n.add(l2(c,r[o]))}return{p:n,f:s}},wNAFUnsafe(e,r,i,n=y.ZERO){let s=l5(e,t);for(let e=0;e<s.windows&&i!==l0;e++){let{nextN:t,offset:a,isZero:o,isNeg:l}=l8(i,e,s);if(i=t,!o){let e=r[a];n=n.add(l?e.negate():e)}}return n},getPrecomputes(e,t,r){let i=l6.get(t);return i||(i=this.precomputeWindow(t,e),1!==e&&l6.set(t,r(i))),i},wNAFCached(e,t,r){let i=l7(e);return this.wNAF(i,this.getPrecomputes(i,e,r),t)},wNAFCachedUnsafe(e,t,r,i){let n=l7(e);return 1===n?this.unsafeLadder(e,t,i):this.wNAFUnsafe(n,this.getPrecomputes(n,e,r),t,i)},setWindowSize(e,r){l3(r,t),l4.set(e,r),l6.delete(e)}});return{CURVE:r,ProjectivePoint:y,normPrivateKeyToScalar:u,weierstrassEquation:o,isWithinCurveOrder:function(e){return lk(e,ci,r.n)}}}({...r,toBytes(e,t,r){let n=t.toAffine(),s=i.toBytes(n.x);return(lh("isCompressed",r),r)?lx(Uint8Array.from([t.hasEvenY()?2:3]),s):lx(Uint8Array.from([4]),s,i.toBytes(n.y))},fromBytes(e){let t=e.length,r=e[0],n=e.subarray(1);if(t===o&&(2===r||3===r)){let e,t=lv(n);if(!lk(t,ci,i.ORDER))throw Error("Point is not on curve");let s=h(t);try{e=i.sqrt(s)}catch(e){throw Error("Point is not on curve"+(e instanceof Error?": "+e.message:""))}return(1&r)==1!=((e&ci)===ci)&&(e=i.neg(e)),{x:t,y:e}}if(t===l&&4===r)return{x:i.fromBytes(n.subarray(0,i.BYTES)),y:i.fromBytes(n.subarray(i.BYTES,2*i.BYTES))};throw Error("invalid Point, expected length of "+o+", or uncompressed "+l+", got "+t)}}),f=(e,t,r)=>lv(e.slice(t,r));class y{constructor(e,t,r){lT("r",e,ci,n),lT("s",t,ci,n),this.r=e,this.s=t,null!=r&&(this.recovery=r),Object.freeze(this)}static fromCompact(e){return new y(f(e=lS("compactSignature",e,2*s),0,s),f(e,s,2*s))}static fromDER(e){let{r:t,s:r}=ct.toSig(lS("DER",e));return new y(t,r)}assertValidity(){}addRecoveryBit(e){return new y(this.r,this.s,e)}recoverPublicKey(e){let{r:t,s,recovery:a}=this,o=w(lS("msgHash",e));if(null==a||![0,1,2,3].includes(a))throw Error("recovery id invalid");let l=2===a||3===a?t+r.n:t;if(l>=i.ORDER)throw Error("recovery id 2 or 3 invalid");let u=(1&a)==0?"02":"03",h=d.fromHex(u+lm(l_(l,i.BYTES))),p=lq(l,n),f=c(-o*p),y=c(s*p),g=d.BASE.multiplyAndAddUnsafe(h,f,y);if(!g)throw Error("point at infinify");return g.assertValidity(),g}hasHighS(){return this.s>n>>ci}normalizeS(){return this.hasHighS()?new y(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return lb(this.toDERHex())}toDERHex(){return ct.hexFromSig(this)}toCompactRawBytes(){return lb(this.toCompactHex())}toCompactHex(){return lm(l_(this.r,s))+lm(l_(this.s,s))}}function g(e){if("bigint"==typeof e)return!1;if(e instanceof d)return!0;let t=lS("key",e).length,n=i.BYTES,a=n+1;if(!r.allowedPrivateKeyLengths&&s!==a)return t===a||t===2*n+1}let m=r.bits2int||function(e){if(e.length>8192)throw Error("input is too large");let t=lv(e),r=8*e.length-a;return r>0?t>>BigInt(r):t},w=r.bits2int_modN||function(e){return c(m(e))},b=lC(a);function v(e){return lT("num < 2^"+a,e,cr,b),l_(e,s)}let E={lowS:r.lowS,prehash:!1},_={lowS:r.lowS,prehash:!1};return d.BASE._setWindowSize(8),{CURVE:r,getPublicKey:function(e,t=!0){return d.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,r=!0){if(!0===g(e))throw Error("first arg must be private key");if(!1===g(t))throw Error("second arg must be public key");return d.fromHex(t).multiply(u(e)).toRawBytes(r)},sign:function(e,t,s=E){let{seed:a,k2sig:o}=function(e,t,s=E){if(["recovered","canonical"].some(e=>e in s))throw Error("sign() legacy options not supported");let{hash:a,randomBytes:o}=r,{lowS:l,prehash:h,extraEntropy:f}=s;null==l&&(l=!0),e=lS("msgHash",e),ce(s),h&&(e=lS("prehashed msgHash",a(e)));let g=w(e),b=u(t),_=[v(b),v(g)];if(null!=f&&!1!==f){let e=!0===f?o(i.BYTES):f;_.push(lS("extraEntropy",e))}return{seed:lx(..._),k2sig:function(e){var t;let r=m(e);if(!p(r))return;let i=lq(r,n),s=d.BASE.multiply(r).toAffine(),a=c(s.x);if(a===cr)return;let o=c(i*c(g+a*b));if(o===cr)return;let u=2*(s.x!==a)|Number(s.y&ci),h=o;return l&&o>n>>ci&&(h=(t=o)>n>>ci?c(-t):t,u^=1),new y(a,h,u)}}}(e,t,s);return(function(e,t,r){if("number"!=typeof e||e<2)throw Error("hashLen must be a number");if("number"!=typeof t||t<2)throw Error("qByteLen must be a number");if("function"!=typeof r)throw Error("hmacFn must be a function");let i=lP(e),n=lP(e),s=0,a=()=>{i.fill(1),n.fill(0),s=0},o=(...e)=>r(n,i,...e),l=(e=lP(0))=>{let t;if(n=o((t=[0],Uint8Array.from(t)),e),i=o(),0!==e.length){let t;n=o((t=[1],Uint8Array.from(t)),e),i=o()}},c=()=>{if(s++>=1e3)throw Error("drbg: tried 1000 values");let e=0,r=[];for(;e<t;){let t=(i=o()).slice();r.push(t),e+=i.length}return lx(...r)};return(e,t)=>{let r;for(a(),l(e);!(r=t(c()));)l();return a(),r}})(r.hash.outputLen,r.nByteLength,r.hmac)(a,o)},verify:function(e,t,i,s=_){let a,o;t=lS("msgHash",t),i=lS("publicKey",i);let{lowS:l,prehash:u,format:h}=s;if(ce(s),"strict"in s)throw Error("options.strict was renamed to lowS");if(void 0!==h&&"compact"!==h&&"der"!==h)throw Error("format must be compact or der");let p="string"==typeof e||ld(e),f=!p&&!h&&"object"==typeof e&&null!==e&&"bigint"==typeof e.r&&"bigint"==typeof e.s;if(!p&&!f)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");try{if(f&&(o=new y(e.r,e.s)),p){try{"compact"!==h&&(o=y.fromDER(e))}catch(e){if(!(e instanceof ct.Err))throw e}o||"der"===h||(o=y.fromCompact(e))}a=d.fromHex(i)}catch(e){return!1}if(!o||l&&o.hasHighS())return!1;u&&(t=r.hash(t));let{r:g,s:m}=o,b=w(t),v=lq(m,n),E=c(b*v),A=c(g*v),S=d.BASE.multiplyAndAddUnsafe(a,E,A)?.toAffine();return!!S&&c(S.x)===g},ProjectivePoint:d,Signature:y,utils:{isValidPrivateKey(e){try{return u(e),!0}catch(e){return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{let e=lX(r.n);return function(e,t,r=!1){let i=e.length,n=lQ(t),s=lX(t);if(i<16||i<s||i>1024)throw Error("expected "+s+"-1024 bytes of input, got "+i);let a=lF(r?lE(e):lv(e),t-lU)+lU;return r?lA(a,n):l_(a,n)}(r.randomBytes(e),r.n)},precompute:(e=8,t=d.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)}}})({...CI,hash:e,hmac:(t,...r)=>lo(e,t,function(...e){let t=0;for(let r=0;r<e.length;r++){let i=e[r];oH(i),t+=i.length}let r=new Uint8Array(t);for(let t=0,i=0;t<e.length;t++){let n=e[t];r.set(n,i),i+=n.length}return r}(...r)),randomBytes:oQ}))(ls),create:M});cf.ProjectivePoint;let cy=(U=[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(e=>e.map(e=>BigInt(e))).map(e=>Array.from(e).reverse()),(e,t)=>{let[r,i,n,s]=U.map(t=>t.reduce((t,r)=>cp.add(cp.mul(t,e),r))),[a,o]=lJ(cp,[i,s],!0);return e=cp.mul(r,a),t=cp.mul(t,cp.mul(n,o)),{x:e,y:t}}),cg=function(e,t){if(lV(e),!e.isValid(t.A)||!e.isValid(t.B)||!e.isValid(t.Z))throw Error("mapToCurveSimpleSWU: invalid opts");let r=function(e,t){let r=e.ORDER,i=cr;for(let e=r-ci;e%cn===cr;e/=cn)i+=ci;let n=i,s=cn<<n-ci-ci,a=s*cn,o=(r-ci)/a,l=(o-ci)/cn,c=a-ci,d=e.pow(t,o),u=e.pow(t,(o+ci)/cn),h=(t,r)=>{let i=d,a=e.pow(r,c),o=e.sqr(a);o=e.mul(o,r);let h=e.mul(t,o);h=e.pow(h,l),h=e.mul(h,a),a=e.mul(h,r),o=e.mul(h,t);let p=e.mul(o,a);h=e.pow(p,s);let f=e.eql(h,e.ONE);a=e.mul(o,u),h=e.mul(p,i),o=e.cmov(a,o,f),p=e.cmov(h,p,f);for(let t=n;t>ci;t--){let r=t-cn;r=cn<<r-ci;let n=e.pow(p,r),s=e.eql(n,e.ONE);a=e.mul(o,i),i=e.mul(i,i),n=e.mul(p,i),o=e.cmov(a,o,s),p=e.cmov(n,p,s)}return{isValid:f,value:o}};if(e.ORDER%ca===cs){let r=(e.ORDER-cs)/ca,i=e.sqrt(e.neg(t));h=(t,n)=>{let s=e.sqr(n),a=e.mul(t,n);s=e.mul(s,a);let o=e.pow(s,r);o=e.mul(o,a);let l=e.mul(o,i),c=e.mul(e.sqr(o),n),d=e.eql(c,t),u=e.cmov(l,o,d);return{isValid:d,value:u}}}return h}(e,t.Z);if(!e.isOdd)throw Error("Fp.isOdd is not implemented!");return i=>{let n,s,a,o,l,c,d,u;n=e.sqr(i),n=e.mul(n,t.Z),s=e.sqr(n),s=e.add(s,n),a=e.add(s,e.ONE),a=e.mul(a,t.B),o=e.cmov(t.Z,e.neg(s),!e.eql(s,e.ZERO)),o=e.mul(o,t.A),s=e.sqr(a),c=e.sqr(o),l=e.mul(c,t.A),s=e.add(s,l),s=e.mul(s,a),c=e.mul(c,o),l=e.mul(c,t.B),s=e.add(s,l),d=e.mul(n,a);let{isValid:h,value:p}=r(s,c);u=e.mul(n,i),u=e.mul(u,p),d=e.cmov(d,a,h),u=e.cmov(u,p,h);let f=e.isOdd(i)===e.isOdd(u);u=e.cmov(e.neg(u),u,f);let y=lJ(e,[o],!0)[0];return{x:d=e.mul(d,y),y:u}}}(cp,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:cp.create(BigInt("-11"))});!function(e,t,r){if("function"!=typeof t)throw Error("mapToCurve() must be defined")}(cf.ProjectivePoint,e=>{let{x:t,y:r}=cg(cp.create(e[0]));return cy(t,r)},cp.ORDER);class cm extends Error{constructor(e,t={}){const r=(()=>{if(t.cause instanceof cm){if(t.cause.details)return t.cause.details;if(t.cause.shortMessage)return t.cause.shortMessage}return t.cause&&"details"in t.cause&&"string"==typeof t.cause.details?t.cause.details:t.cause?.message?t.cause.message:t.details})(),i=t.cause instanceof cm&&t.cause.docsPath||t.docsPath,n=`https://oxlib.sh${i??""}`;super([e||"An error occurred.",...t.metaMessages?["",...t.metaMessages]:[],...r||i?["",r?`Details: ${r}`:void 0,i?`See: ${n}`:void 0]:[]].filter(e=>"string"==typeof e).join("\n"),t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:"ox@0.1.1"}),this.cause=t.cause,this.details=r,this.docs=n,this.docsPath=i,this.shortMessage=e}walk(e){return function e(t,r){return r?.(t)?t:t&&"object"==typeof t&&"cause"in t&&t.cause?e(t.cause,r):r?null:t}(this,e)}}function cw(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}function cb(e,t){if(cC(e)>t)throw new cM({givenSize:cC(e),maxSize:t})}function cv(e,t={}){let{dir:r,size:i=32}=t;if(0===i)return e;let n=e.replace("0x","");if(n.length>2*i)throw new cD({size:Math.ceil(n.length/2),targetSize:i,type:"Hex"});return`0x${n["right"===r?"padEnd":"padStart"](2*i,"0")}`}function cE(e,t,r){return JSON.stringify(e,(e,r)=>"function"==typeof t?t(e,r):"bigint"==typeof r?r.toString()+"#__bigint":r,r)}let c_=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function cA(...e){return`0x${e.reduce((e,t)=>e+t.replace("0x",""),"")}`}function cS(e){return e instanceof Uint8Array?cx(e):Array.isArray(e)?cx(new Uint8Array(e)):e}function cx(e,t={}){let r="";for(let t=0;t<e.length;t++)r+=c_[e[t]];let i=`0x${r}`;return"number"==typeof t.size?(cb(i,t.size),ck(i,t.size)):i}function cI(e,t={}){var r;let i,{signed:n,size:s}=t,a=BigInt(e);s?i=n?(1n<<8n*BigInt(s)-1n)-1n:2n**(8n*BigInt(s))-1n:"number"==typeof e&&(i=BigInt(Number.MAX_SAFE_INTEGER));let o="bigint"==typeof i&&n?-i-1n:0;if(i&&a>i||a<o){let t="bigint"==typeof e?"n":"";throw new cO({max:i?`${i}${t}`:void 0,min:`${o}${t}`,signed:n,size:s,value:`${e}${t}`})}let l=(n&&a<0?(1n<<BigInt(8*s))+BigInt(a):a).toString(16),c=`0x${l}`;return s?(r=c,cv(r,{dir:"left",size:s})):c}function ck(e,t){return cv(e,{dir:"right",size:t})}function cT(e,t,r,i={}){let{strict:n}=i;if("number"==typeof t&&t>0&&t>cC(e)-1)throw new cU({offset:t,position:"start",size:cC(e)});let s=`0x${e.replace("0x","").slice((t??0)*2,(r??e.length)*2)}`;return n&&function(e,t,r){if("number"==typeof t&&"number"==typeof r&&cC(e)!==r-t)throw new cU({offset:r,position:"end",size:cC(e)})}(s,t,r),s}function cC(e){return Math.ceil((e.length-2)/2)}function cP(e){return function(e,t={}){let{dir:r="left"}=t,i=e.replace("0x",""),n=0;for(let e=0;e<i.length-1;e++)if("0"===i["left"===r?e:i.length-e-1].toString())n++;else break;return"0"===(i="left"===r?i.slice(n):i.slice(0,i.length-n))?"0x":"right"===r&&i.length%2==1?`0x${i}0`:`0x${i}`}(e,{dir:"left"})}class cO extends cm{constructor({max:e,min:t,signed:r,size:i,value:n}){super(`Number \`${n}\` is not in safe${i?` ${8*i}-bit`:""}${r?" signed":" unsigned"} integer range ${e?`(\`${t}\` to \`${e}\`)`:`(above \`${t}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class cR extends cm{constructor(e){super(`Value \`${"object"==typeof e?cE(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class cN extends cm{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}class cM extends cm{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed \`${t}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class cU extends cm{constructor({offset:e,position:t,size:r}){super(`Slice ${"start"===t?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}class cD extends cm{constructor({size:e,targetSize:t,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${t}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}let cL=new TextEncoder;function cj(e){var t;return e instanceof Uint8Array?e:"string"==typeof e?cB(e):(t=e)instanceof Uint8Array?t:new Uint8Array(t)}function cB(e,t={}){let{size:r}=t,i=e;r&&(cb(e,r),i=ck(e,r));let n=i.slice(2);n.length%2&&(n=`0${n}`);let s=n.length/2,a=new Uint8Array(s);for(let e=0,t=0;e<s;e++){let r=cw(n.charCodeAt(t++)),i=cw(n.charCodeAt(t++));if(void 0===r||void 0===i)throw new cm(`Invalid byte sequence ("${n[t-2]}${n[t-1]}" in "${n}").`);a[e]=16*r+i}return a}class cW extends cm{constructor(e){super(`Value \`${"object"==typeof e?cE(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class cF extends cm{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed \`${t}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class cH extends cm{constructor({size:e,targetSize:t,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${t}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}let cq=2n**256n-1n;function cz(e,t={}){let{recovered:r}=t;if(void 0===e.r||void 0===e.s||r&&void 0===e.yParity)throw new dt({signature:e});if(e.r<0n||e.r>cq)throw new dr({value:e.r});if(e.s<0n||e.s>cq)throw new di({value:e.s});if("number"==typeof e.yParity&&0!==e.yParity&&1!==e.yParity)throw new dn({value:e.yParity})}function c$(e){return cK(cx(e))}function cK(e){if(130!==e.length&&132!==e.length)throw new de({signature:e});let t=BigInt(cT(e,0,32)),r=BigInt(cT(e,32,64)),i=(()=>{let t=Number(`0x${e.slice(130)}`);if(!Number.isNaN(t))try{return c7(t)}catch{throw new dn({value:t})}})();return void 0===i?{r:t,s:r}:{r:t,s:r,yParity:i}}function cV(e){if(void 0!==e.r&&void 0!==e.s)return cJ(e)}function cJ(e){let t="string"==typeof e?cK(e):e instanceof Uint8Array?c$(e):"string"==typeof e.r?cQ(e):e.v?cY(e):{r:e.r,s:e.s,...void 0!==e.yParity?{yParity:e.yParity}:{}};return cz(t),t}function cZ(e){return cG(cx(e))}function cG(e){let{r:t,s:r}=cf.Signature.fromDER(cS(e).slice(2));return{r:t,s:r}}function cY(e){return{r:e.r,s:e.s,yParity:c7(e.v)}}function cQ(e){let t=(()=>{let t=e.v?Number(e.v):void 0,r=e.yParity?Number(e.yParity):void 0;if("number"==typeof t&&"number"!=typeof r&&(r=c7(t)),"number"!=typeof r)throw new dn({value:e.yParity});return r})();return{r:BigInt(e.r),s:BigInt(e.s),yParity:t}}function cX(e){let[t,r,i]=e;return cJ({r:"0x"===r?0n:BigInt(r),s:"0x"===i?0n:BigInt(i),yParity:"0x"===t?0:Number(t)})}function c0(e){return cB(c1(e))}function c1(e){cz(e);let t=e.r,r=e.s;return cA(cI(t,{size:32}),cI(r,{size:32}),"number"==typeof e.yParity?cI(c9(e.yParity),{size:1}):"0x")}function c2(e){return new cf.Signature(e.r,e.s).toDERRawBytes()}function c3(e){let t=new cf.Signature(e.r,e.s);return`0x${t.toDERHex()}`}function c5(e){return{r:e.r,s:e.s,v:c9(e.yParity)}}function c8(e){let{r:t,s:r,yParity:i}=e;return{r:cI(t,{size:32}),s:cI(r,{size:32}),yParity:0===i?"0x0":"0x1"}}function c6(e){let{r:t,s:r,yParity:i}=e;return[i?"0x01":"0x",0n===t?"0x":cP(cI(t)),0n===r?"0x":cP(cI(r))]}function c4(e,t={}){try{return cz(e,t),!0}catch{return!1}}function c7(e){if(0===e||27===e)return 0;if(1===e||28===e)return 1;if(e>=35)return+(e%2==0);throw new ds({value:e})}function c9(e){if(0===e)return 27;if(1===e)return 28;throw new dn({value:e})}class de extends cm{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${cC(cS(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class dt extends cm{constructor({signature:e}){super(`Signature \`${cE(e)}\` is missing either an \`r\`, \`s\`, or \`yParity\` property.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.MissingPropertiesError"})}}class dr extends cm{constructor({value:e}){super(`Value \`${e}\` is an invalid r value. r must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidRError"})}}class di extends cm{constructor({value:e}){super(`Value \`${e}\` is an invalid s value. s must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSError"})}}class dn extends cm{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class ds extends cm{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}e.s(["InvalidRError",()=>dr,"InvalidSError",()=>di,"InvalidSerializedSizeError",()=>de,"InvalidVError",()=>ds,"InvalidYParityError",()=>dn,"MissingPropertiesError",()=>dt,"assert",()=>cz,"extract",()=>cV,"from",()=>cJ,"fromBytes",()=>c$,"fromDerBytes",()=>cZ,"fromDerHex",()=>cG,"fromHex",()=>cK,"fromLegacy",()=>cY,"fromRpc",()=>cQ,"fromTuple",()=>cX,"toBytes",()=>c0,"toDerBytes",()=>c2,"toDerHex",()=>c3,"toHex",()=>c1,"toLegacy",()=>c5,"toRpc",()=>c8,"toTuple",()=>c6,"vToYParity",()=>c7,"validate",()=>c4,"yParityToV",()=>c9],869859);var da=e.i(869859),da=da;class dl extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){let t=super.get(e);return super.has(e)&&void 0!==t&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){let e=this.keys().next().value;e&&this.delete(e)}return this}}let dc={checksum:new dl(8192)}.checksum,dd=Uint32Array.from([0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0]),du=new Uint32Array(80);(e,t)=>Math.floor(0x100000000*Math.abs(Math.sin(t+1)));let dh=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),dp=Uint8Array.from(Array(16).fill(0).map((e,t)=>t)),df=dp.map(e=>(9*e+5)%16),dy=(()=>{let e=[[dp],[df]];for(let t=0;t<4;t++)for(let r of e)r.push(r[t].map(e=>dh[e]));return e})(),dg=dy[0],dm=dy[1],dw=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(e=>Uint8Array.from(e)),db=dg.map((e,t)=>e.map(e=>dw[t][e])),dv=dm.map((e,t)=>e.map(e=>dw[t][e])),dE=Uint32Array.from([0,0x5a827999,0x6ed9eba1,0x8f1bbcdc,0xa953fd4e]),d_=Uint32Array.from([0x50a28be6,0x5c4dd124,0x6d703ef3,0x7a6d76e9,0]),dA=BigInt(0),dS=BigInt(1),dx=BigInt(2),dI=BigInt(7),dk=BigInt(256),dT=BigInt(113),dC=[],dP=[],dO=[];for(let e=0,t=dS,r=1,i=0;e<24;e++){[r,i]=[i,(2*r+3*i)%5],dC.push(2*(5*i+r)),dP.push((e+1)*(e+2)/2%64);let n=dA;for(let e=0;e<7;e++)(t=(t<<dS^(t>>dI)*dT)%dk)&dx&&(n^=dS<<(dS<<BigInt(e))-dS);dO.push(n)}let dR=o6(dO,!0),dN=dR[0],dM=dR[1],dU=(e,t,r)=>r>32?t<<r-32|e>>>64-r:e<<r|t>>>32-r,dD=(e,t,r)=>r>32?e<<r-32|t>>>64-r:t<<r|e>>>32-r;class dL extends oG{constructor(e,t,r,i=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=i,this.rounds=n,oF(r),!(0<e&&e<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=function(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}(this.state)}clone(){return this._cloneInto()}keccak(){oJ(this.state32),function(e,t=24){let r=new Uint32Array(10);for(let i=24-t;i<24;i++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){let i=(t+8)%10,n=(t+2)%10,s=r[n],a=r[n+1],o=dU(s,a,1)^r[i],l=dD(s,a,1)^r[i+1];for(let r=0;r<50;r+=10)e[t+r]^=o,e[t+r+1]^=l}let t=e[2],n=e[3];for(let r=0;r<24;r++){let i=dP[r],s=dU(t,n,i),a=dD(t,n,i),o=dC[r];t=e[o],n=e[o+1],e[o]=s,e[o+1]=a}for(let t=0;t<50;t+=10){for(let i=0;i<10;i++)r[i]=e[t+i];for(let i=0;i<10;i++)e[t+i]^=~r[(i+2)%10]&r[(i+4)%10]}e[0]^=dN[i],e[1]^=dM[i]}o$(r)}(this.state32,this.rounds),oJ(this.state32),this.posOut=0,this.pos=0}update(e){oq(this),oH(e=oZ(e));let{blockLen:t,state:r}=this,i=e.length;for(let n=0;n<i;){let s=Math.min(t-this.pos,i-n);for(let t=0;t<s;t++)r[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:r,blockLen:i}=this;e[r]^=t,(128&t)!=0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){oq(this,!1),oH(e),this.finish();let t=this.state,{blockLen:r}=this;for(let i=0,n=e.length;i<n;){this.posOut>=r&&this.keccak();let s=Math.min(r-this.posOut,n-i);e.set(t.subarray(this.posOut,this.posOut+s),i),this.posOut+=s,i+=s}return e}xofInto(e){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return oF(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(oz(e,this),this.finished)throw Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,o$(this.state)}_cloneInto(e){let{blockLen:t,suffix:r,outputLen:i,rounds:n,enableXOF:s}=this;return e||(e=new dL(t,r,i,s,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=i,e.enableXOF=s,e.destroyed=this.destroyed,e}}let dj=oY(()=>new dL(136,1,32));function dB(e,t={}){let{as:r="string"==typeof e?"Hex":"Bytes"}=t,i=dj(cj(e));return"Bytes"===r?i:cx(i)}function dW(e,t={}){let{compressed:r}=t,{prefix:i,x:n,y:s}=e;if(!1===r||"bigint"==typeof n&&"bigint"==typeof s){if(4!==i)throw new d$({prefix:i,cause:new dV});return}if(!0===r||"bigint"==typeof n&&void 0===s){if(3!==i&&2!==i)throw new d$({prefix:i,cause:new dK});return}throw new dz({publicKey:e})}function dF(e){let t=(()=>{if(function(e,t={}){let{strict:r=!1}=t;try{return!function(e,t={}){let{strict:r=!1}=t;if(!e||"string"!=typeof e)throw new cR(e);if(r&&!/^0x[0-9a-fA-F]*$/.test(e)||!e.startsWith("0x"))throw new cN(e)}(e,{strict:r}),!0}catch{return!1}}(e))return dH(e);if(function(e){try{if(!(e instanceof Uint8Array)&&(!e||"object"!=typeof e||!("BYTES_PER_ELEMENT"in e)||1!==e.BYTES_PER_ELEMENT||"Uint8Array"!==e.constructor.name))throw new cW(e);return!0}catch{return!1}}(e))return dH(cx(e));let{prefix:t,x:r,y:i}=e;return"bigint"==typeof r&&"bigint"==typeof i?{prefix:t??4,x:r,y:i}:{prefix:t,x:r}})();return dW(t),t}function dH(e){if(132!==e.length&&130!==e.length&&68!==e.length)throw new dJ({publicKey:e});if(130===e.length)return{prefix:4,x:BigInt(cT(e,0,32)),y:BigInt(cT(e,32,64))};if(132===e.length){let t=Number(cT(e,0,1));return{prefix:t,x:BigInt(cT(e,1,33)),y:BigInt(cT(e,33,65))}}return{prefix:Number(cT(e,0,1)),x:BigInt(cT(e,1,33))}}function dq(e,t={}){dW(e);let{prefix:r,x:i,y:n}=e,{includePrefix:s=!0}=t;return cA(s?cI(r,{size:1}):"0x",cI(i,{size:32}),"bigint"==typeof n?cI(n,{size:32}):"0x")}class dz extends cm{constructor({publicKey:e}){super(`Value \`${cE(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class d$ extends cm{constructor({prefix:e,cause:t}){super(`Prefix "${e}" is invalid.`,{cause:t}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class dK extends cm{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class dV extends cm{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}class dJ extends cm{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${cC(cS(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}}let dZ=/^0x[a-fA-F0-9]{40}$/;function dG(e,t={}){let{strict:r=!0}=t;if(!dZ.test(e))throw new dQ({address:e,cause:new dX});if(r){if(e.toLowerCase()===e)return;if(dY(e)!==e)throw new dQ({address:e,cause:new d0})}}function dY(e){if(dc.has(e))return dc.get(e);dG(e,{strict:!1});let t=e.substring(2).toLowerCase(),r=dB(function(e,t={}){let{size:r}=t,i=cL.encode(e);if("number"==typeof r){var n;if(i.length>r)throw new cF({givenSize:i.length,maxSize:r});return n=i,function(e,t={}){let{dir:r,size:i=32}=t;if(0===i)return e;if(e.length>i)throw new cH({size:e.length,targetSize:i,type:"Bytes"});let n=new Uint8Array(i);for(let t=0;t<i;t++){let s="right"===r;n[s?t:i-t-1]=e[s?t:e.length-t-1]}return n}(n,{dir:"right",size:r})}return i}(t),{as:"Bytes"}),i=t.split("");for(let e=0;e<40;e+=2)r[e>>1]>>4>=8&&i[e]&&(i[e]=i[e].toUpperCase()),(15&r[e>>1])>=8&&i[e+1]&&(i[e+1]=i[e+1].toUpperCase());let n=`0x${i.join("")}`;return dc.set(e,n),n}class dQ extends cm{constructor({address:e,cause:t}){super(`Address "${e}" is invalid.`,{cause:t}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class dX extends cm{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class d0 extends cm{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}function d1(e={}){let{as:t="Hex"}=e,r=d5({as:t}),i=d2({privateKey:r});return{privateKey:r,publicKey:i}}function d2(e){let{privateKey:t}=e;return dF(cf.ProjectivePoint.fromPrivateKey(cS(t).slice(2)))}function d3(e){let{as:t="Hex",privateKey:r,publicKey:i}=e,n=cf.ProjectivePoint.fromHex(dq(i).slice(2)).multiply(cf.utils.normPrivateKeyToScalar(cS(r).slice(2))).toRawBytes(!0);return"Hex"===t?cx(n):n}function d5(e={}){let{as:t="Hex"}=e,r=cf.utils.randomPrivateKey();return"Hex"===t?cx(r):r}function d8(e){return function(e,t={}){let r=dB(`0x${dq(e).slice(4)}`).substring(26);return function(e,t={}){let{checksum:r=!1}=t;return(dG(e),r)?dY(e):e}(`0x${r}`,t)}(d6(e))}function d6(e){let{payload:t,signature:r}=e,{r:i,s:n,yParity:s}=r;return dF(new cf.Signature(BigInt(i),BigInt(n)).addRecoveryBit(s).recoverPublicKey(cS(t).substring(2)))}function d4(e){let{extraEntropy:t=!1,hash:r,payload:i,privateKey:n}=e,{r:s,s:a,recovery:o}=cf.sign(cj(i),cj(n),{extraEntropy:"boolean"==typeof t?t:cS(t).slice(2),lowS:!0,...r?{prehash:!0}:{}});return{r:s,s:a,yParity:o}}function d7(e){let{address:t,hash:r,payload:i,publicKey:n,signature:s}=e;if(t){var a;return a=d8({payload:i,signature:s}),dG(t,{strict:!1}),dG(a,{strict:!1}),t.toLowerCase()===a.toLowerCase()}return cf.verify(s,cj(i),function(e,t={}){return cB(dq(e,t))}(n),...r?[{prehash:!0,lowS:!0}]:[])}e.s(["createKeyPair",()=>d1,"getPublicKey",()=>d2,"getSharedSecret",()=>d3,"noble",0,cf,"randomPrivateKey",()=>d5,"recoverAddress",()=>d8,"recoverPublicKey",()=>d6,"sign",()=>d4,"verify",()=>d7],520735);var d9=e.i(520735),d9=d9,ue=e.i(103476),ut=e.i(626335),ur=e.i(425748),ui=e.i(121609);e.i(262265);var un=e.i(773912),us=e.i(120483),ua=e.i(310998),uo=e.i(281223),ul=e.i(5625),uc=e.i(102232),ud=e.i(31794);let uu="custom_context";var uh=Object.defineProperty,up=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?uh(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class uf{constructor(e){up(this,"nodeValue"),up(this,"sizeInBytes"),up(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class uy{constructor(e){up(this,"lengthInNodes"),up(this,"sizeInBytes"),up(this,"head"),up(this,"tail"),up(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){let t=new uf(e);if(t.size>this.maxSizeInBytes)throw Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?this.tail&&(this.tail.next=t):this.head=t,this.tail=t,this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;let e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){let e=[],t=this.head;for(;null!==t;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};let t=e.value;return e=e.next,{done:!1,value:t}}}}}var ug=Object.defineProperty,um=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?ug(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class uw{constructor(e,t=1024e3){um(this,"logs"),um(this,"level"),um(this,"levelValue"),um(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=uc.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new uy(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===uc.levels.values.error?console.error(e):t===uc.levels.values.warn?console.warn(e):t===uc.levels.values.debug?console.debug(e):t===uc.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append((0,ud.safeJsonStringify)({timestamp:new Date().toISOString(),log:e}));let t="string"==typeof e?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new uy(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){let t=this.getLogArray();return t.push((0,ud.safeJsonStringify)({extraMetadata:e})),new Blob(t,{type:"application/json"})}}var ub=Object.defineProperty;class uv{constructor(e,t=1024e3){((e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?ub(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(this,"baseChunkLogger"),this.baseChunkLogger=new uw(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){let t=URL.createObjectURL(this.logsToBlob(e)),r=document.createElement("a");r.href=t,r.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}}var uE=Object.defineProperty;class u_{constructor(e,t=1024e3){((e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?uE(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(this,"baseChunkLogger"),this.baseChunkLogger=new uw(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}}var uA=Object.defineProperty,uS=Object.defineProperties,ux=Object.getOwnPropertyDescriptors,uI=Object.getOwnPropertySymbols,uk=Object.prototype.hasOwnProperty,uT=Object.prototype.propertyIsEnumerable,uC=(e,t,r)=>t in e?uA(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,uP=(e,t)=>{for(var r in t||(t={}))uk.call(t,r)&&uC(e,r,t[r]);if(uI)for(var r of uI(t))uT.call(t,r)&&uC(e,r,t[r]);return e};function uO(e,t=uu){return e[t]||""}function uR(e,t,r=uu){let i=function(e,t,r=uu){let i=uO(e,r);return i.trim()?`${i}/${t}`:t}(e,t,r);return function(e,t,r=uu){return e[r]=t,e}(e.child({context:i}),i,r)}function uN(e){var t,r,i,n;let s,a,o,l;return"u">typeof e.loggerOverride&&"string"!=typeof e.loggerOverride?{logger:e.loggerOverride,chunkLoggerController:null}:"u">typeof window?(l=new uv(null==(i=(r=e).opts)?void 0:i.level,r.maxSizeInBytes),{logger:(0,uc.default)((a=uP({},r.opts),o={level:"trace",browser:uS(uP({},null==(n=r.opts)?void 0:n.browser),ux({write:e=>l.write(e)}))},uS(a,ux(o)))),chunkLoggerController:l}):(s=new u_(null==(t=e.opts)?void 0:t.level,e.maxSizeInBytes),{logger:(0,uc.default)(uS(uP({},e.opts),ux({level:"trace"})),s),chunkLoggerController:s})}function uM(e){let[t,r]=e.split(":");return{namespace:t,reference:r}}function uU(e,t=[]){let r=[];return Object.keys(e).forEach(i=>{if(t.length&&!t.includes(i))return;let n=e[i];r.push(...n.accounts)}),r}function uD(e,t){return e.includes(":")?[e]:t.chains||[]}var uL=Object.defineProperty,uj=Object.defineProperties,uB=Object.getOwnPropertyDescriptors,uW=Object.getOwnPropertySymbols,uF=Object.prototype.hasOwnProperty,uH=Object.prototype.propertyIsEnumerable,uq=(e,t,r)=>t in e?uL(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,uz=(e,t)=>{for(var r in t||(t={}))uF.call(t,r)&&uq(e,r,t[r]);if(uW)for(var r of uW(t))uH.call(t,r)&&uq(e,r,t[r]);return e},u$=(e,t,r)=>uq(e,"symbol"!=typeof t?t+"":t,r);let uK="react-native",uV="node",uJ="browser";function uZ(){return"u">typeof sm.default&&"u">typeof sm.default.versions&&"u">typeof sm.default.versions.node}function uG(){return!(0,oj.getDocument)()&&!!(0,oj.getNavigator)()&&"ReactNative"===navigator.product}function uY(){return!uZ()&&!!(0,oj.getNavigator)()&&!!(0,oj.getDocument)()}function uQ(){return uG()?uK:uZ()?uV:uY()?uJ:"unknown"}function uX(){var t;try{return uG()&&"u">typeof(null==e.g?void 0:e.g.Application)?null==(t=e.g.Application)?void 0:t.applicationId:void 0}catch{return}}function u0(){return(0,oB.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}}function u1(t,r,i){var n;let s,a=function(){if(uQ()===uK&&"u">typeof(null==e.g?void 0:e.g.Platform)){let{OS:t,Version:r}=e.g.Platform;return[t,r].join("-")}let t=(0,oD.detect)();if(null===t)return"unknown";let r=t.os?t.os.replace(" ","").toLowerCase():"unknown";return"browser"===t.type?[r,t.name,t.version].join("-"):[r,t.version].join("-")}(),o=(s=uQ())===uJ?[s,(null==(n=(0,oj.getLocation)())?void 0:n.host)||"unknown"].join(":"):s;return[[t,r].join("-"),["js",i].join("-"),a,o].join("/")}function u2(e,t){return e.filter(e=>t.includes(e)).length===e.length}function u3(e){return Object.fromEntries(e.entries())}function u5(e){return new Map(Object.entries(e))}function u8(e=oL.FIVE_MINUTES,t){let r,i,n,s,a=(0,oL.toMiliseconds)(e||oL.FIVE_MINUTES);return{resolve:e=>{n&&r&&(clearTimeout(n),r(e),s=Promise.resolve(e))},reject:e=>{n&&i&&(clearTimeout(n),i(e))},done:()=>new Promise((e,o)=>{if(s)return e(s);n=setTimeout(()=>{let e=Error(t);s=Promise.reject(e),o(e)},a),r=e,i=o})}}function u6(e,t,r){return new Promise(async(i,n)=>{let s=setTimeout(()=>n(Error(r)),t);try{let t=await e;i(t)}catch(e){n(e)}clearTimeout(s)})}function u4(e,t){if("string"==typeof t&&t.startsWith(`${e}:`))return t;if("topic"===e.toLowerCase()){if("string"!=typeof t)throw Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}if("id"===e.toLowerCase()){if("number"!=typeof t)throw Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw Error(`Unknown expirer target type: ${e}`)}function u7(e){let[t,r]=e.split(":"),i={id:void 0,topic:void 0};if("topic"===t&&"string"==typeof r)i.topic=r;else if("id"===t&&Number.isInteger(Number(r)))i.id=Number(r);else throw Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return i}function u9(e,t){return(0,oL.fromMiliseconds)((t||Date.now())+(0,oL.toMiliseconds)(e))}function he(e){return Date.now()>=(0,oL.toMiliseconds)(e)}function ht(e,t){return`${e}${t?`:${t}`:""}`}function hr(e=[],t=[]){return[...new Set([...e,...t])]}async function hi({id:t,topic:r,wcDeepLink:i}){var n,s;try{if(!i)return;let a="string"==typeof i?JSON.parse(i):i,o=a?.href;if("string"!=typeof o)return;let l=function(e,t,r){let i=`requestId=${t}&sessionTopic=${r}`;e.endsWith("/")&&(e=e.slice(0,-1));let n=`${e}`;if(e.startsWith("https://t.me")){let t=e.includes("?")?"&startapp=":"?startapp=";n=`${n}${t}${function(e,t=!1){let r=t3.Buffer.from(e).toString("base64");return t?r.replace(/[=]/g,""):r}(i,!0)}`}else n=`${n}/wc?${i}`;return n}(o,t,r),c=uQ();if(c===uJ){let e;if(!(null!=(n=(0,oj.getDocument)())&&n.hasFocus()))return void console.warn("Document does not have focus, skipping deeplink.");s=l,e="_self",!function(){try{return window.self!==window.top}catch{return!1}}()?("u">typeof window&&(window.TelegramWebviewProxy||window.Telegram||window.TelegramWebviewProxyProto)||s.startsWith("https://")||s.startsWith("http://"))&&(e="_blank"):e="_top",window.open(s,e,"noreferrer noopener")}else c===uK&&"u">typeof(null==e.g?void 0:e.g.Linking)&&await e.g.Linking.openURL(l)}catch(e){console.error(e)}}async function hn(e,t){let r="";try{if(uY()&&(r=localStorage.getItem(t)))return r;r=await e.getItem(t)}catch(e){console.error(e)}return r}function hs(e,t){if(!e.includes(t))return null;let r=e.split(/([&,?,=])/),i=r.indexOf(t);return r[i+2]}function ha(){return"u">typeof crypto&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function ho(){return"u">typeof sm.default&&"true"===sm.default.env.IS_VITEST}function hl(e){return t3.Buffer.from(e,"base64").toString("utf-8")}class hc{constructor({limit:e}){u$(this,"limit"),u$(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){let e=this.set.values().next().value;e&&this.set.delete(e)}this.set.add(e)}}has(e){return this.set.has(e)}}let hd=BigInt(0x100000000-1),hu=BigInt(32);function hh(e,t=!1){return t?{h:Number(e&hd),l:Number(e>>hu&hd)}:{h:0|Number(e>>hu&hd),l:0|Number(e&hd)}}function hp(e,t=!1){let r=e.length,i=new Uint32Array(r),n=new Uint32Array(r);for(let s=0;s<r;s++){let{h:r,l:a}=hh(e[s],t);[i[s],n[s]]=[r,a]}return[i,n]}let hf=(e,t,r)=>e>>>r,hy=(e,t,r)=>e<<32-r|t>>>r,hg=(e,t,r)=>e>>>r|t<<32-r,hm=(e,t,r)=>e<<32-r|t>>>r,hw=(e,t,r)=>e<<64-r|t>>>r-32,hb=(e,t,r)=>e>>>r-32|t<<64-r;function hv(e,t,r,i){let n=(t>>>0)+(i>>>0);return{h:e+r+(n/0x100000000|0)|0,l:0|n}}let hE=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),h_=(e,t,r,i)=>t+r+i+(e/0x100000000|0)|0,hA=(e,t,r,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0),hS=(e,t,r,i,n)=>t+r+i+n+(e/0x100000000|0)|0,hx=(e,t,r,i,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0)+(n>>>0),hI=(e,t,r,i,n,s)=>t+r+i+n+s+(e/0x100000000|0)|0,hk="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function hT(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function hC(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function hP(e,...t){if(!hT(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function hO(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.createHasher");hC(e.outputLen),hC(e.blockLen)}function hR(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function hN(e,t){hP(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)}function hM(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function hU(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function hD(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function hL(e,t){return e<<32-t|e>>>t}let hj=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function hB(e){return e<<24&0xff000000|e<<8&0xff0000|e>>>8&65280|e>>>24&255}let hW=hj?e=>e:e=>hB(e),hF=hj?e=>e:function(e){for(let t=0;t<e.length;t++)e[t]=hB(e[t]);return e},hH="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,hq=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function hz(e){if(hP(e),hH)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=hq[e[r]];return t}function h$(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}function hK(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);if(hH)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw Error("hex string expected, got unpadded hex of length "+t);let i=new Uint8Array(r);for(let t=0,n=0;t<r;t++,n+=2){let r=h$(e.charCodeAt(n)),s=h$(e.charCodeAt(n+1));if(void 0===r||void 0===s)throw Error('hex string expected, got non-hex character "'+(e[n]+e[n+1])+'" at index '+n);i[t]=16*r+s}return i}function hV(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function hJ(e){return"string"==typeof e&&(e=hV(e)),hP(e),e}function hZ(...e){let t=0;for(let r=0;r<e.length;r++){let i=e[r];hP(i),t+=i.length}let r=new Uint8Array(t);for(let t=0,i=0;t<e.length;t++){let n=e[t];r.set(n,i),i+=n.length}return r}class hG{}function hY(e){let t=t=>e().update(hJ(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function hQ(e=32){if(hk&&"function"==typeof hk.getRandomValues)return hk.getRandomValues(new Uint8Array(e));if(hk&&"function"==typeof hk.randomBytes)return Uint8Array.from(hk.randomBytes(e));throw Error("crypto.getRandomValues must be defined")}let hX=BigInt(0),h0=BigInt(1),h1=BigInt(2),h2=BigInt(7),h3=BigInt(256),h5=BigInt(113),h8=[],h6=[],h4=[];for(let e=0,t=h0,r=1,i=0;e<24;e++){[r,i]=[i,(2*r+3*i)%5],h8.push(2*(5*i+r)),h6.push((e+1)*(e+2)/2%64);let n=hX;for(let e=0;e<7;e++)(t=(t<<h0^(t>>h2)*h5)%h3)&h1&&(n^=h0<<(h0<<BigInt(e))-h0);h4.push(n)}let h7=hp(h4,!0),h9=h7[0],pe=h7[1],pt=(e,t,r)=>r>32?t<<r-32|e>>>64-r:e<<r|t>>>32-r,pr=(e,t,r)=>r>32?e<<r-32|t>>>64-r:t<<r|e>>>32-r;class pi extends hG{constructor(e,t,r,i=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=i,this.rounds=n,hC(r),!(0<e&&e<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=hM(this.state)}clone(){return this._cloneInto()}keccak(){hF(this.state32),function(e,t=24){let r=new Uint32Array(10);for(let i=24-t;i<24;i++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){let i=(t+8)%10,n=(t+2)%10,s=r[n],a=r[n+1],o=pt(s,a,1)^r[i],l=pr(s,a,1)^r[i+1];for(let r=0;r<50;r+=10)e[t+r]^=o,e[t+r+1]^=l}let t=e[2],n=e[3];for(let r=0;r<24;r++){let i=h6[r],s=pt(t,n,i),a=pr(t,n,i),o=h8[r];t=e[o],n=e[o+1],e[o]=s,e[o+1]=a}for(let t=0;t<50;t+=10){for(let i=0;i<10;i++)r[i]=e[t+i];for(let i=0;i<10;i++)e[t+i]^=~r[(i+2)%10]&r[(i+4)%10]}e[0]^=h9[i],e[1]^=pe[i]}hU(r)}(this.state32,this.rounds),hF(this.state32),this.posOut=0,this.pos=0}update(e){hR(this),hP(e=hJ(e));let{blockLen:t,state:r}=this,i=e.length;for(let n=0;n<i;){let s=Math.min(t-this.pos,i-n);for(let t=0;t<s;t++)r[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:r,blockLen:i}=this;e[r]^=t,(128&t)!=0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){hR(this,!1),hP(e),this.finish();let t=this.state,{blockLen:r}=this;for(let i=0,n=e.length;i<n;){this.posOut>=r&&this.keccak();let s=Math.min(r-this.posOut,n-i);e.set(t.subarray(this.posOut,this.posOut+s),i),this.posOut+=s,i+=s}return e}xofInto(e){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return hC(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(hN(e,this),this.finished)throw Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,hU(this.state)}_cloneInto(e){let{blockLen:t,suffix:r,outputLen:i,rounds:n,enableXOF:s}=this;return e||(e=new pi(t,r,i,s,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=i,e.enableXOF=s,e.destroyed=this.destroyed,e}}let pn=hY(()=>new pi(136,1,32));class ps extends hG{constructor(e,t,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=hD(this.buffer)}update(e){hR(this),hP(e=hJ(e));let{view:t,buffer:r,blockLen:i}=this,n=e.length;for(let s=0;s<n;){let a=Math.min(i-this.pos,n-s);if(a===i){let t=hD(e);for(;i<=n-s;s+=i)this.process(t,s);continue}r.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){hR(this),hN(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:i,isLE:n}=this,{pos:s}=this;t[s++]=128,hU(this.buffer.subarray(s)),this.padOffset>i-s&&(this.process(r,0),s=0);for(let e=s;e<i;e++)t[e]=0;(function(e,t,r,i){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,i);let n=BigInt(32),s=BigInt(0xffffffff),a=Number(r>>n&s),o=Number(r&s),l=4*!!i,c=4*!i;e.setUint32(t+l,a,i),e.setUint32(t+c,o,i)})(r,i-8,BigInt(8*this.length),n),this.process(r,0);let a=hD(e),o=this.outputLen;if(o%4)throw Error("_sha2: outputLen should be aligned to 32bit");let l=o/4,c=this.get();if(l>c.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<l;e++)a.setUint32(4*e,c[e],n)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:i,finished:n,destroyed:s,pos:a}=this;return e.destroyed=s,e.finished=n,e.length=i,e.pos=a,i%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}let pa=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),po=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),pl=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),pc=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),pd=new Uint32Array(64);class pu extends ps{constructor(e=32){super(64,e,8,!1),this.A=0|pa[0],this.B=0|pa[1],this.C=0|pa[2],this.D=0|pa[3],this.E=0|pa[4],this.F=0|pa[5],this.G=0|pa[6],this.H=0|pa[7]}get(){let{A:e,B:t,C:r,D:i,E:n,F:s,G:a,H:o}=this;return[e,t,r,i,n,s,a,o]}set(e,t,r,i,n,s,a,o){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|i,this.E=0|n,this.F=0|s,this.G=0|a,this.H=0|o}process(e,t){for(let r=0;r<16;r++,t+=4)pd[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=pd[e-15],r=pd[e-2],i=hL(t,7)^hL(t,18)^t>>>3,n=hL(r,17)^hL(r,19)^r>>>10;pd[e]=n+pd[e-7]+i+pd[e-16]|0}let{A:r,B:i,C:n,D:s,E:a,F:o,G:l,H:c}=this;for(let e=0;e<64;e++){var d,u,h,p;let t=c+(hL(a,6)^hL(a,11)^hL(a,25))+((d=a)&o^~d&l)+pc[e]+pd[e]|0,f=(hL(r,2)^hL(r,13)^hL(r,22))+((u=r)&(h=i)^u&(p=n)^h&p)|0;c=l,l=o,o=a,a=s+t|0,s=n,n=i,i=r,r=t+f|0}r=r+this.A|0,i=i+this.B|0,n=n+this.C|0,s=s+this.D|0,a=a+this.E|0,o=o+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(r,i,n,s,a,o,l,c)}roundClean(){hU(pd)}destroy(){this.set(0,0,0,0,0,0,0,0),hU(this.buffer)}}let ph=hp(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),pp=ph[0],pf=ph[1],py=new Uint32Array(80),pg=new Uint32Array(80);class pm extends ps{constructor(e=64){super(128,e,16,!1),this.Ah=0|pl[0],this.Al=0|pl[1],this.Bh=0|pl[2],this.Bl=0|pl[3],this.Ch=0|pl[4],this.Cl=0|pl[5],this.Dh=0|pl[6],this.Dl=0|pl[7],this.Eh=0|pl[8],this.El=0|pl[9],this.Fh=0|pl[10],this.Fl=0|pl[11],this.Gh=0|pl[12],this.Gl=0|pl[13],this.Hh=0|pl[14],this.Hl=0|pl[15]}get(){let{Ah:e,Al:t,Bh:r,Bl:i,Ch:n,Cl:s,Dh:a,Dl:o,Eh:l,El:c,Fh:d,Fl:u,Gh:h,Gl:p,Hh:f,Hl:y}=this;return[e,t,r,i,n,s,a,o,l,c,d,u,h,p,f,y]}set(e,t,r,i,n,s,a,o,l,c,d,u,h,p,f,y){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|i,this.Ch=0|n,this.Cl=0|s,this.Dh=0|a,this.Dl=0|o,this.Eh=0|l,this.El=0|c,this.Fh=0|d,this.Fl=0|u,this.Gh=0|h,this.Gl=0|p,this.Hh=0|f,this.Hl=0|y}process(e,t){for(let r=0;r<16;r++,t+=4)py[r]=e.getUint32(t),pg[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){let t=0|py[e-15],r=0|pg[e-15],i=hg(t,r,1)^hg(t,r,8)^hf(t,r,7),n=hm(t,r,1)^hm(t,r,8)^hy(t,r,7),s=0|py[e-2],a=0|pg[e-2],o=hg(s,a,19)^hw(s,a,61)^hf(s,a,6),l=hA(n,hm(s,a,19)^hb(s,a,61)^hy(s,a,6),pg[e-7],pg[e-16]),c=hS(l,i,o,py[e-7],py[e-16]);py[e]=0|c,pg[e]=0|l}let{Ah:r,Al:i,Bh:n,Bl:s,Ch:a,Cl:o,Dh:l,Dl:c,Eh:d,El:u,Fh:h,Fl:p,Gh:f,Gl:y,Hh:g,Hl:m}=this;for(let e=0;e<80;e++){let t=hg(d,u,14)^hg(d,u,18)^hw(d,u,41),w=hm(d,u,14)^hm(d,u,18)^hb(d,u,41),b=d&h^~d&f,v=hx(m,w,u&p^~u&y,pf[e],pg[e]),E=hI(v,g,t,b,pp[e],py[e]),_=0|v,A=hg(r,i,28)^hw(r,i,34)^hw(r,i,39),S=hm(r,i,28)^hb(r,i,34)^hb(r,i,39),x=r&n^r&a^n&a,I=i&s^i&o^s&o;g=0|f,m=0|y,f=0|h,y=0|p,h=0|d,p=0|u,({h:d,l:u}=hv(0|l,0|c,0|E,0|_)),l=0|a,c=0|o,a=0|n,o=0|s,n=0|r,s=0|i;let k=hE(_,S,I);r=h_(k,E,A,x),i=0|k}({h:r,l:i}=hv(0|this.Ah,0|this.Al,0|r,0|i)),({h:n,l:s}=hv(0|this.Bh,0|this.Bl,0|n,0|s)),({h:a,l:o}=hv(0|this.Ch,0|this.Cl,0|a,0|o)),({h:l,l:c}=hv(0|this.Dh,0|this.Dl,0|l,0|c)),({h:d,l:u}=hv(0|this.Eh,0|this.El,0|d,0|u)),({h,l:p}=hv(0|this.Fh,0|this.Fl,0|h,0|p)),({h:f,l:y}=hv(0|this.Gh,0|this.Gl,0|f,0|y)),({h:g,l:m}=hv(0|this.Hh,0|this.Hl,0|g,0|m)),this.set(r,i,n,s,a,o,l,c,d,u,h,p,f,y,g,m)}roundClean(){hU(py,pg)}destroy(){hU(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class pw extends pm{constructor(){super(48),this.Ah=0|po[0],this.Al=0|po[1],this.Bh=0|po[2],this.Bl=0|po[3],this.Ch=0|po[4],this.Cl=0|po[5],this.Dh=0|po[6],this.Dl=0|po[7],this.Eh=0|po[8],this.El=0|po[9],this.Fh=0|po[10],this.Fl=0|po[11],this.Gh=0|po[12],this.Gl=0|po[13],this.Hh=0|po[14],this.Hl=0|po[15]}}let pb=Uint32Array.from([0x22312194,0xfc2bf72c,0x9f555fa3,0xc84c64c2,0x2393b86b,0x6f53b151,0x96387719,0x5940eabd,0x96283ee2,0xa88effe3,0xbe5e1e25,0x53863992,0x2b0199fc,0x2c85b8aa,0xeb72ddc,0x81c52ca2]);class pv extends pm{constructor(){super(32),this.Ah=0|pb[0],this.Al=0|pb[1],this.Bh=0|pb[2],this.Bl=0|pb[3],this.Ch=0|pb[4],this.Cl=0|pb[5],this.Dh=0|pb[6],this.Dl=0|pb[7],this.Eh=0|pb[8],this.El=0|pb[9],this.Fh=0|pb[10],this.Fl=0|pb[11],this.Gh=0|pb[12],this.Gl=0|pb[13],this.Hh=0|pb[14],this.Hl=0|pb[15]}}let pE=hY(()=>new pu),p_=hY(()=>new pm),pA=hY(()=>new pw),pS=hY(()=>new pv),px=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),pI=Uint32Array.from([0xf3bcc908,0x6a09e667,0x84caa73b,0xbb67ae85,0xfe94f82b,0x3c6ef372,0x5f1d36f1,0xa54ff53a,0xade682d1,0x510e527f,0x2b3e6c1f,0x9b05688c,0xfb41bd6b,0x1f83d9ab,0x137e2179,0x5be0cd19]),pk=new Uint32Array(32);function pT(e,t,r,i,n,s){let a=n[s],o=n[s+1],l=pk[2*e],c=pk[2*e+1],d=pk[2*t],u=pk[2*t+1],h=pk[2*r],p=pk[2*r+1],f=pk[2*i],y=pk[2*i+1],g=hE(l,d,a);c=h_(g,c,u,o),l=0|g,({Dh:y,Dl:f}={Dh:y^c,Dl:f^l}),({Dh:y,Dl:f}={Dh:f,Dl:y}),({h:p,l:h}=hv(p,h,y,f)),({Bh:u,Bl:d}={Bh:u^p,Bl:d^h}),({Bh:u,Bl:d}={Bh:hg(u,d,24),Bl:hm(u,d,24)}),pk[2*e]=l,pk[2*e+1]=c,pk[2*t]=d,pk[2*t+1]=u,pk[2*r]=h,pk[2*r+1]=p,pk[2*i]=f,pk[2*i+1]=y}function pC(e,t,r,i,n,s){let a=n[s],o=n[s+1],l=pk[2*e],c=pk[2*e+1],d=pk[2*t],u=pk[2*t+1],h=pk[2*r],p=pk[2*r+1],f=pk[2*i],y=pk[2*i+1],g=hE(l,d,a);c=h_(g,c,u,o),l=0|g,({Dh:y,Dl:f}={Dh:y^c,Dl:f^l}),({Dh:y,Dl:f}={Dh:hg(y,f,16),Dl:hm(y,f,16)}),({h:p,l:h}=hv(p,h,y,f)),({Bh:u,Bl:d}={Bh:u^p,Bl:d^h}),({Bh:u,Bl:d}={Bh:hw(u,d,63),Bl:hb(u,d,63)}),pk[2*e]=l,pk[2*e+1]=c,pk[2*t]=d,pk[2*t+1]=u,pk[2*r]=h,pk[2*r+1]=p,pk[2*i]=f,pk[2*i+1]=y}class pP extends hG{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,hC(e),hC(t),this.blockLen=e,this.outputLen=t,this.buffer=new Uint8Array(e),this.buffer32=hM(this.buffer)}update(e){hR(this),hP(e=hJ(e));let{blockLen:t,buffer:r,buffer32:i}=this,n=e.length,s=e.byteOffset,a=e.buffer;for(let o=0;o<n;){this.pos===t&&(hF(i),this.compress(i,0,!1),hF(i),this.pos=0);let l=Math.min(t-this.pos,n-o),c=s+o;if(l===t&&!(c%4)&&o+l<n){let e=new Uint32Array(a,c,Math.floor((n-o)/4));hF(e);for(let r=0;o+t<n;r+=i.length,o+=t)this.length+=t,this.compress(e,r,!1);hF(e);continue}r.set(e.subarray(o,o+l),this.pos),this.pos+=l,this.length+=l,o+=l}return this}digestInto(e){hR(this),hN(e,this);let{pos:t,buffer32:r}=this;this.finished=!0,hU(this.buffer.subarray(t)),hF(r),this.compress(r,0,!0),hF(r);let i=hM(e);this.get().forEach((e,t)=>i[t]=hW(e))}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){let{buffer:t,length:r,finished:i,destroyed:n,outputLen:s,pos:a}=this;return e||(e=new this.constructor({dkLen:s})),e.set(...this.get()),e.buffer.set(t),e.destroyed=n,e.finished=i,e.length=r,e.pos=a,e.outputLen=s,e}clone(){return this._cloneInto()}}class pO extends pP{constructor(e={}){const t=void 0===e.dkLen?64:e.dkLen;super(128,t),this.v0l=0|pI[0],this.v0h=0|pI[1],this.v1l=0|pI[2],this.v1h=0|pI[3],this.v2l=0|pI[4],this.v2h=0|pI[5],this.v3l=0|pI[6],this.v3h=0|pI[7],this.v4l=0|pI[8],this.v4h=0|pI[9],this.v5l=0|pI[10],this.v5h=0|pI[11],this.v6l=0|pI[12],this.v6h=0|pI[13],this.v7l=0|pI[14],this.v7h=0|pI[15],function(e,t={},r,i,n){if(hC(64),e<0||e>64)throw Error("outputLen bigger than keyLen");let{key:s,salt:a,personalization:o}=t;if(void 0!==s&&(s.length<1||s.length>64))throw Error("key length must be undefined or 1..64");if(void 0!==a&&16!==a.length)throw Error("salt must be undefined or 16");if(void 0!==o&&16!==o.length)throw Error("personalization must be undefined or 16")}(t,e,0,0,0);let{key:r,personalization:i,salt:n}=e,s=0;if(void 0!==r&&(s=(r=hJ(r)).length),this.v0l^=this.outputLen|s<<8|0x1010000,void 0!==n){const e=hM(n=hJ(n));this.v4l^=hW(e[0]),this.v4h^=hW(e[1]),this.v5l^=hW(e[2]),this.v5h^=hW(e[3])}if(void 0!==i){const e=hM(i=hJ(i));this.v6l^=hW(e[0]),this.v6h^=hW(e[1]),this.v7l^=hW(e[2]),this.v7h^=hW(e[3])}if(void 0!==r){const e=new Uint8Array(this.blockLen);e.set(r),this.update(e)}}get(){let{v0l:e,v0h:t,v1l:r,v1h:i,v2l:n,v2h:s,v3l:a,v3h:o,v4l:l,v4h:c,v5l:d,v5h:u,v6l:h,v6h:p,v7l:f,v7h:y}=this;return[e,t,r,i,n,s,a,o,l,c,d,u,h,p,f,y]}set(e,t,r,i,n,s,a,o,l,c,d,u,h,p,f,y){this.v0l=0|e,this.v0h=0|t,this.v1l=0|r,this.v1h=0|i,this.v2l=0|n,this.v2h=0|s,this.v3l=0|a,this.v3h=0|o,this.v4l=0|l,this.v4h=0|c,this.v5l=0|d,this.v5h=0|u,this.v6l=0|h,this.v6h=0|p,this.v7l=0|f,this.v7h=0|y}compress(e,t,r){this.get().forEach((e,t)=>pk[t]=e),pk.set(pI,16);let{h:i,l:n}=hh(BigInt(this.length));pk[24]=pI[8]^n,pk[25]=pI[9]^i,r&&(pk[28]=~pk[28],pk[29]=~pk[29]);let s=0;for(let r=0;r<12;r++)pT(0,4,8,12,e,t+2*px[s++]),pC(0,4,8,12,e,t+2*px[s++]),pT(1,5,9,13,e,t+2*px[s++]),pC(1,5,9,13,e,t+2*px[s++]),pT(2,6,10,14,e,t+2*px[s++]),pC(2,6,10,14,e,t+2*px[s++]),pT(3,7,11,15,e,t+2*px[s++]),pC(3,7,11,15,e,t+2*px[s++]),pT(0,5,10,15,e,t+2*px[s++]),pC(0,5,10,15,e,t+2*px[s++]),pT(1,6,11,12,e,t+2*px[s++]),pC(1,6,11,12,e,t+2*px[s++]),pT(2,7,8,13,e,t+2*px[s++]),pC(2,7,8,13,e,t+2*px[s++]),pT(3,4,9,14,e,t+2*px[s++]),pC(3,4,9,14,e,t+2*px[s++]);this.v0l^=pk[0]^pk[16],this.v0h^=pk[1]^pk[17],this.v1l^=pk[2]^pk[18],this.v1h^=pk[3]^pk[19],this.v2l^=pk[4]^pk[20],this.v2h^=pk[5]^pk[21],this.v3l^=pk[6]^pk[22],this.v3h^=pk[7]^pk[23],this.v4l^=pk[8]^pk[24],this.v4h^=pk[9]^pk[25],this.v5l^=pk[10]^pk[26],this.v5h^=pk[11]^pk[27],this.v6l^=pk[12]^pk[28],this.v6h^=pk[13]^pk[29],this.v7l^=pk[14]^pk[30],this.v7h^=pk[15]^pk[31],hU(pk)}destroy(){this.destroyed=!0,hU(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let pR=(Ck=e=>new pO(e),(D=(e,t)=>Ck(t).update(hJ(e)).digest()).outputLen=(L=Ck({})).outputLen,D.blockLen=L.blockLen,D.create=e=>Ck(e),D);function pN(e){let t=`Ethereum Signed Message:
${e.length}`,r=new TextEncoder().encode(t+e);return"0x"+t3.Buffer.from(pn(r)).toString("hex")}async function pM(e,t,r,i,n,s){switch(r.t){case"eip191":var a,o,l;let c;return await (a=e,o=t,l=r.s,c=da.fromHex(l),d9.recoverAddress({payload:pN(o),signature:c}).toLowerCase()===a.toLowerCase());case"eip1271":return await pU(e,t,r.s,i,n,s);default:throw Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}async function pU(e,t,r,i,n,s){let a=uM(i);if(!a.namespace||!a.reference)throw Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{let a="0x1626ba7e",o=r.substring(2),l=(o.length/2).toString(16).padStart(64,"0"),c=(t.startsWith("0x")?t:pN(t)).substring(2),d=a+c+"0000000000000000000000000000000000000000000000000000000000000040"+l+o,u=await fetch(`${s||"https://rpc.walletconnect.org/v1"}/?chainId=${i}&projectId=${n}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Date.now()+Math.floor(1e3*Math.random()),jsonrpc:"2.0",method:"eth_call",params:[{to:e,data:d},"latest"]})}),{result:h}=await u.json();return!!h&&h.slice(0,a.length).toLowerCase()===a.toLowerCase()}catch(e){return console.error("isValidEip1271Signature: ",e),!1}}function pD(e){let t=new Uint8Array(pE(function(e){if(e instanceof Uint8Array)return e;if(Array.isArray(e))return new Uint8Array(e);if("object"==typeof e&&null!=e&&e.data)return new Uint8Array(Object.values(e.data));if("object"==typeof e&&e)return new Uint8Array(Object.values(e));throw Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}(e)));return ue.default.encode(t)}function pL(e){let t=t3.Buffer.from(e,"base64"),r=(0,ut.decode)(t).txn;if(!r)throw Error("Invalid signed transaction: missing 'txn' field");let i=(0,ur.encode)(r),n=t3.Buffer.from("TX"),s=pS(t3.Buffer.concat([n,t3.Buffer.from(i)]));return n7.base32.encode(s).replace(/=+$/,"")}function pj(e){let t=[],r=BigInt(e);for(;r>=BigInt(128);)t.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return t.push(Number(r)),t3.Buffer.from(t)}var pB=Object.defineProperty,pW=Object.defineProperties,pF=Object.getOwnPropertyDescriptors,pH=Object.getOwnPropertySymbols,pq=Object.prototype.hasOwnProperty,pz=Object.prototype.propertyIsEnumerable,p$=(e,t,r)=>t in e?pB(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;let pK=e=>e?.split(":"),pV=e=>{let t=e&&pK(e);if(t)return t[2]+":"+t[3]},pJ=e=>{let t=e&&pK(e);if(t)return t.pop()};async function pZ(e){let{cacao:t,projectId:r}=e,{s:i,p:n}=t,s=pG(n,n.iss),a=pJ(n.iss);return await pM(a,s,i,pV(n.iss),r)}let pG=(e,t)=>{let r=`${e.domain} wants you to sign in with your Ethereum account:`,i=pJ(t);if(!e.aud&&!e.uri)throw Error("Either `aud` or `uri` is required to construct the message");let n=e.statement||void 0,s=`URI: ${e.aud||e.uri}`,a=`Version: ${e.version}`,o=`Chain ID: ${(e=>{let t=e&&pK(e);if(t)return e.includes("did:pkh:")?t[3]:t[1]})(t)}`,l=`Nonce: ${e.nonce}`,c=`Issued At: ${e.iat}`,d=e.exp?`Expiration Time: ${e.exp}`:void 0,u=e.nbf?`Not Before: ${e.nbf}`:void 0,h=e.requestId?`Request ID: ${e.requestId}`:void 0,p=e.resources?`Resources:${e.resources.map(e=>`
- ${e}`).join("")}`:void 0,f=p2(e.resources);return f&&(n=function(e="",t){pY(t);let r="I further authorize the stated URI to perform the following actions on my behalf: ";if(e.includes(r))return e;let i=[],n=0;Object.keys(t.att).forEach(e=>{let r=Object.keys(t.att[e]).map(e=>({ability:e.split("/")[0],action:e.split("/")[1]}));r.sort((e,t)=>e.action.localeCompare(t.action));let s={};r.forEach(e=>{s[e.ability]||(s[e.ability]=[]),s[e.ability].push(e.action)});let a=Object.keys(s).map(t=>(n++,`(${n}) '${t}': '${s[t].join("', '")}' for '${e}'.`));i.push(a.join(", ").replace(".,","."))});let s=i.join(" "),a=`${r}${s}`;return`${e?e+" ":""}${a}`}(n,pX(f))),[r,i,"",n,"",s,a,o,l,c,d,u,h,p].filter(e=>null!=e).join(`
`)};function pY(e){if(!e)throw Error("No recap provided, value is undefined");if(!e.att)throw Error("No `att` property found");let t=Object.keys(e.att);if(!(null!=t&&t.length))throw Error("No resources found in `att` property");t.forEach(t=>{let r=e.att[t];if(Array.isArray(r)||"object"!=typeof r)throw Error(`Resource must be an object: ${t}`);if(!Object.keys(r).length)throw Error(`Resource object is empty: ${t}`);Object.keys(r).forEach(e=>{let t=r[e];if(!Array.isArray(t))throw Error(`Ability limits ${e} must be an array of objects, found: ${t}`);if(!t.length)throw Error(`Value of ${e} is empty array, must be an array with objects`);t.forEach(t=>{if("object"!=typeof t)throw Error(`Ability limits (${e}) must be an array of objects, found: ${t}`)})})})}function pQ(e){return pY(e),`urn:recap:${t3.Buffer.from(JSON.stringify(e)).toString("base64").replace(/=/g,"")}`}function pX(e){var t;let r=(t=e.replace("urn:recap:",""),JSON.parse(t3.Buffer.from(t,"base64").toString("utf-8")));return pY(r),r}function p0(e){var t;let r=pX(e);pY(r);let i=null==(t=r.att)?void 0:t.eip155;return i?Object.keys(i).map(e=>e.split("/")[1]):[]}function p1(e){let t=pX(e);pY(t);let r=[];return Object.values(t.att).forEach(e=>{Object.values(e).forEach(e=>{var t;null!=(t=e?.[0])&&t.chains&&r.push(e[0].chains)})}),[...new Set(r.flat())]}function p2(e){if(!e)return;let t=e?.[e.length-1];return t&&t.includes("urn:recap:")?t:void 0}function p3(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function p5(e){if("boolean"!=typeof e)throw Error(`boolean expected, not ${e}`)}function p8(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function p6(e,...t){if(!p3(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function p4(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function p7(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function p9(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}let fe=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function ft(e){if("string"==typeof e)e=function(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}(e);else if(p3(e))e=fn(e);else throw Error("Uint8Array expected, got "+typeof e);return e}function fr(e,t,r=!0){if(void 0===t)return new Uint8Array(e);if(t.length!==e)throw Error("invalid output length, expected "+e+", got: "+t.length);if(r&&t.byteOffset%4!=0)throw Error("invalid output, must be aligned");return t}function fi(e,t,r,i){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,i);let n=BigInt(32),s=BigInt(0xffffffff),a=Number(r>>n&s),o=Number(r&s),l=4*!!i,c=4*!i;e.setUint32(t+l,a,i),e.setUint32(t+c,o,i)}function fn(e){return Uint8Array.from(e)}let fs=e=>Uint8Array.from(e.split("").map(e=>e.charCodeAt(0))),fa=fs("expand 16-byte k"),fo=fs("expand 32-byte k"),fl=p7(fa),fc=p7(fo);function fd(e,t){return e<<t|e>>>32-t}function fu(e){return e.byteOffset%4==0}let fh=0x100000000-1,fp=new Uint32Array,ff=(e,t)=>255&e[t++]|(255&e[t++])<<8;class fy{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,p6(e=ft(e),32);const t=ff(e,0),r=ff(e,2),i=ff(e,4),n=ff(e,6),s=ff(e,8),a=ff(e,10),o=ff(e,12),l=ff(e,14);this.r[0]=8191&t,this.r[1]=(t>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|n<<9)&8191,this.r[4]=(n>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|a<<2)&8191,this.r[7]=(a>>>11|o<<5)&8065,this.r[8]=(o>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let t=0;t<8;t++)this.pad[t]=ff(e,16+2*t)}process(e,t,r=!1){let{h:i,r:n}=this,s=n[0],a=n[1],o=n[2],l=n[3],c=n[4],d=n[5],u=n[6],h=n[7],p=n[8],f=n[9],y=ff(e,t+0),g=ff(e,t+2),m=ff(e,t+4),w=ff(e,t+6),b=ff(e,t+8),v=ff(e,t+10),E=ff(e,t+12),_=ff(e,t+14),A=i[0]+(8191&y),S=i[1]+((y>>>13|g<<3)&8191),x=i[2]+((g>>>10|m<<6)&8191),I=i[3]+((m>>>7|w<<9)&8191),k=i[4]+((w>>>4|b<<12)&8191),T=i[5]+(b>>>1&8191),C=i[6]+((b>>>14|v<<2)&8191),P=i[7]+((v>>>11|E<<5)&8191),O=i[8]+((E>>>8|_<<8)&8191),R=i[9]+(_>>>5|2048*!r),N=0,M=0+A*s+5*f*S+5*p*x+5*h*I+5*u*k;N=M>>>13,M&=8191,M+=5*d*T+5*c*C+5*l*P+5*o*O+5*a*R,N+=M>>>13,M&=8191;let U=N+A*a+S*s+5*f*x+5*p*I+5*h*k;N=U>>>13,U&=8191,U+=5*u*T+5*d*C+5*c*P+5*l*O+5*o*R,N+=U>>>13,U&=8191;let D=N+A*o+S*a+x*s+5*f*I+5*p*k;N=D>>>13,D&=8191,D+=5*h*T+5*u*C+5*d*P+5*c*O+5*l*R,N+=D>>>13,D&=8191;let L=N+A*l+S*o+x*a+I*s+5*f*k;N=L>>>13,L&=8191,L+=5*p*T+5*h*C+5*u*P+5*d*O+5*c*R,N+=L>>>13,L&=8191;let j=N+A*c+S*l+x*o+I*a+k*s;N=j>>>13,j&=8191,j+=5*f*T+5*p*C+5*h*P+5*u*O+5*d*R,N+=j>>>13,j&=8191;let B=N+A*d+S*c+x*l+I*o+k*a;N=B>>>13,B&=8191,B+=T*s+5*f*C+5*p*P+5*h*O+5*u*R,N+=B>>>13,B&=8191;let W=N+A*u+S*d+x*c+I*l+k*o;N=W>>>13,W&=8191,W+=T*a+C*s+5*f*P+5*p*O+5*h*R,N+=W>>>13,W&=8191;let F=N+A*h+S*u+x*d+I*c+k*l;N=F>>>13,F&=8191,F+=T*o+C*a+P*s+5*f*O+5*p*R,N+=F>>>13,F&=8191;let H=N+A*p+S*h+x*u+I*d+k*c;N=H>>>13,H&=8191,H+=T*l+C*o+P*a+O*s+5*f*R,N+=H>>>13,H&=8191;let q=N+A*f+S*p+x*h+I*u+k*d;N=q>>>13,q&=8191,q+=T*c+C*l+P*o+O*a+R*s,N+=q>>>13,q&=8191,M=8191&(N=(N=(N<<2)+N|0)+M|0),N>>>=13,U+=N,i[0]=M,i[1]=U,i[2]=D,i[3]=L,i[4]=j,i[5]=B,i[6]=W,i[7]=F,i[8]=H,i[9]=q}finalize(){let{h:e,pad:t}=this,r=new Uint16Array(10),i=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=i,i=e[t]>>>13,e[t]&=8191;e[0]+=5*i,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let t=1;t<10;t++)r[t]=e[t]+i,i=r[t]>>>13,r[t]&=8191;r[9]-=8192;let n=(1^i)-1;for(let e=0;e<10;e++)r[e]&=n;n=~n;for(let t=0;t<10;t++)e[t]=e[t]&n|r[t];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+t[0];e[0]=65535&s;for(let r=1;r<8;r++)s=(e[r]+t[r]|0)+(s>>>16)|0,e[r]=65535&s;p9(r)}update(e){p4(this),p6(e=ft(e));let{buffer:t,blockLen:r}=this,i=e.length;for(let n=0;n<i;){let s=Math.min(r-this.pos,i-n);if(s===r){for(;r<=i-n;n+=r)this.process(e,n);continue}t.set(e.subarray(n,n+s),this.pos),this.pos+=s,n+=s,this.pos===r&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){p9(this.h,this.r,this.buffer,this.pad)}digestInto(e){p4(this),function(e,t){p6(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)}(e,this),this.finished=!0;let{buffer:t,h:r}=this,{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let n=0;for(let t=0;t<8;t++)e[n++]=r[t]>>>0,e[n++]=r[t]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}}let fg=(CT=e=>new fy(e),(j=(e,t)=>CT(t).update(ft(e)).digest()).outputLen=(B=CT(new Uint8Array(32))).outputLen,j.blockLen=B.blockLen,j.create=e=>CT(e),j),fm=function(e,t){let{allowShortKeys:r,extendNonceFn:i,counterLength:n,counterRight:s,rounds:a}=function(e,t){if(null==t||"object"!=typeof t)throw Error("options must be defined");return Object.assign(e,t)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw Error("core must be a function");return p8(n),p8(a),p5(s),p5(r),(t,o,l,c,d=0)=>{p6(t),p6(o),p6(l);let u=l.length;if(void 0===c&&(c=new Uint8Array(u)),p6(c),p8(d),d<0||d>=fh)throw Error("arx: counter overflow");if(c.length<u)throw Error(`arx: output (${c.length}) is shorter than data (${u})`);let h=[],p=t.length,f,y;if(32===p)h.push(f=fn(t)),y=fc;else if(16===p&&r)(f=new Uint8Array(32)).set(t),f.set(t,16),y=fl,h.push(f);else throw Error(`arx: invalid 32-byte key, got length=${p}`);fu(o)||h.push(o=fn(o));let g=p7(f);if(i){if(24!==o.length)throw Error("arx: extended nonce must be 24 bytes");i(y,g,p7(o.subarray(0,16)),g),o=o.subarray(16)}let m=16-n;if(m!==o.length)throw Error(`arx: nonce must be ${m} or 16 bytes`);if(12!==m){let e=new Uint8Array(12);e.set(o,s?0:12-o.length),o=e,h.push(o)}return function(e,t,r,i,n,s,a,o){let l=n.length,c=new Uint8Array(64),d=p7(c),u=fu(n)&&fu(s),h=u?p7(n):fp,p=u?p7(s):fp;for(let f=0;f<l;a++){if(e(t,r,i,d,a,o),a>=fh)throw Error("arx: counter overflow");let y=Math.min(64,l-f);if(u&&64===y){let e=f/4;if(f%4!=0)throw Error("arx: invalid block position");for(let t=0,r;t<16;t++)p[r=e+t]=h[r]^d[t];f+=64;continue}for(let e=0,t;e<y;e++)s[t=f+e]=n[t]^c[e];f+=y}}(e,y,g,p7(o),l,c,d,a),p9(...h),c}}(function(e,t,r,i,n,s=20){let a=e[0],o=e[1],l=e[2],c=e[3],d=t[0],u=t[1],h=t[2],p=t[3],f=t[4],y=t[5],g=t[6],m=t[7],w=r[0],b=r[1],v=r[2],E=a,_=o,A=l,S=c,x=d,I=u,k=h,T=p,C=f,P=y,O=g,R=m,N=n,M=w,U=b,D=v;for(let e=0;e<s;e+=2)C=C+(N=fd(N^(E=E+x|0),16))|0,E=E+(x=fd(x^C,12))|0,C=C+(N=fd(N^E,8))|0,x=fd(x^C,7),P=P+(M=fd(M^(_=_+I|0),16))|0,_=_+(I=fd(I^P,12))|0,P=P+(M=fd(M^_,8))|0,I=fd(I^P,7),O=O+(U=fd(U^(A=A+k|0),16))|0,A=A+(k=fd(k^O,12))|0,O=O+(U=fd(U^A,8))|0,k=fd(k^O,7),R=R+(D=fd(D^(S=S+T|0),16))|0,S=S+(T=fd(T^R,12))|0,R=R+(D=fd(D^S,8))|0,T=fd(T^R,7),O=O+(D=fd(D^(E=E+I|0),16))|0,E=E+(I=fd(I^O,12))|0,O=O+(D=fd(D^E,8))|0,I=fd(I^O,7),R=R+(N=fd(N^(_=_+k|0),16))|0,_=_+(k=fd(k^R,12))|0,R=R+(N=fd(N^_,8))|0,k=fd(k^R,7),C=C+(M=fd(M^(A=A+T|0),16))|0,A=A+(T=fd(T^C,12))|0,C=C+(M=fd(M^A,8))|0,T=fd(T^C,7),P=P+(U=fd(U^(S=S+x|0),16))|0,S=S+(x=fd(x^P,12))|0,P=P+(U=fd(U^S,8))|0,x=fd(x^P,7);let L=0;i[L++]=a+E|0,i[L++]=o+_|0,i[L++]=l+A|0,i[L++]=c+S|0,i[L++]=d+x|0,i[L++]=u+I|0,i[L++]=h+k|0,i[L++]=p+T|0,i[L++]=f+C|0,i[L++]=y+P|0,i[L++]=g+O|0,i[L++]=m+R|0,i[L++]=n+N|0,i[L++]=w+M|0,i[L++]=b+U|0,i[L++]=v+D|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),fw=new Uint8Array(16),fb=(e,t)=>{e.update(t);let r=t.length%16;r&&e.update(fw.subarray(r))},fv=new Uint8Array(32);function fE(e,t,r,i,n){var s,a;let o,l,c=e(t,r,fv),d=fg.create(c);n&&fb(d,n),fb(d,i);let u=(s=i.length,a=n?n.length:0,p5(!0),fi(l=new DataView((o=new Uint8Array(16)).buffer,o.byteOffset,o.byteLength),0,BigInt(a),!0),fi(l,8,BigInt(s),!0),o);d.update(u);let h=d.digest();return p9(c,u),h}let f_=((e,t)=>{function r(i,...n){if(p6(i),!fe)throw Error("Non little-endian hardware is not yet supported");if(void 0!==e.nonceLength){let t=n[0];if(!t)throw Error("nonce / iv required");e.varSizeNonce?p6(t):p6(t,e.nonceLength)}let s=e.tagLength;s&&void 0!==n[1]&&p6(n[1]);let a=t(i,...n),o=(e,t)=>{if(void 0!==t){if(2!==e)throw Error("cipher output not supported");p6(t)}},l=!1;return{encrypt(e,t){if(l)throw Error("cannot encrypt() twice with same key + nonce");return l=!0,p6(e),o(a.encrypt.length,t),a.encrypt(e,t)},decrypt(e,t){if(p6(e),s&&e.length<s)throw Error("invalid ciphertext length: smaller than tagLength="+s);return o(a.decrypt.length,t),a.decrypt(e,t)}}}return Object.assign(r,e),r})({blockSize:64,nonceLength:12,tagLength:16},(e,t,r)=>({encrypt(i,n){let s=i.length;(n=fr(s+16,n,!1)).set(i);let a=n.subarray(0,-16);fm(e,t,a,a,1);let o=fE(fm,e,t,a,r);return n.set(o,s),p9(o),n},decrypt(i,n){n=fr(i.length-16,n,!1);let s=i.subarray(0,-16),a=i.subarray(-16),o=fE(fm,e,t,s,r);if(!function(e,t){if(e.length!==t.length)return!1;let r=0;for(let i=0;i<e.length;i++)r|=e[i]^t[i];return 0===r}(a,o))throw Error("invalid tag");return n.set(i.subarray(0,-16)),fm(e,t,n,n,1),p9(o),n}}));class fA extends hG{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,hO(e);const r=hJ(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,n=new Uint8Array(i);n.set(r.length>i?e.create().update(r).digest():r);for(let e=0;e<n.length;e++)n[e]^=54;this.iHash.update(n),this.oHash=e.create();for(let e=0;e<n.length;e++)n[e]^=106;this.oHash.update(n),hU(n)}update(e){return hR(this),this.iHash.update(e),this}digestInto(e){hR(this),hP(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:r,finished:i,destroyed:n,blockLen:s,outputLen:a}=this;return e.finished=i,e.destroyed=n,e.blockLen=s,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let fS=(e,t,r)=>new fA(e,t).update(r).digest();fS.create=(e,t)=>new fA(e,t);let fx=Uint8Array.from([0]),fI=Uint8Array.of(),fk=BigInt(0),fT=BigInt(1);function fC(e,t=""){if("boolean"!=typeof e)throw Error((t&&`"${t}"`)+"expected boolean, got type="+typeof e);return e}function fP(e,t,r=""){let i=hT(e),n=e?.length,s=void 0!==t;if(!i||s&&n!==t)throw Error((r&&`"${r}" `)+"expected Uint8Array"+(s?` of length ${t}`:"")+", got "+(i?`length=${n}`:`type=${typeof e}`));return e}function fO(e){let t=e.toString(16);return 1&t.length?"0"+t:t}function fR(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);return""===e?fk:BigInt("0x"+e)}function fN(e){return hP(e),fR(hz(Uint8Array.from(e).reverse()))}function fM(e,t){return hK(e.toString(16).padStart(2*t,"0"))}function fU(e,t){return fM(e,t).reverse()}function fD(e,t,r){let i;if("string"==typeof t)try{i=hK(t)}catch(t){throw Error(e+" must be hex string or Uint8Array, cause: "+t)}else if(hT(t))i=Uint8Array.from(t);else throw Error(e+" must be hex string or Uint8Array");let n=i.length;if("number"==typeof r&&n!==r)throw Error(e+" of length "+r+" expected, got "+n);return i}let fL=e=>"bigint"==typeof e&&fk<=e;function fj(e,t,r,i){if(!(fL(t)&&fL(r)&&fL(i))||!(r<=t)||!(t<i))throw Error("expected valid "+e+": "+r+" <= n < "+i+", got "+t)}function fB(e){let t;for(t=0;e>fk;e>>=fT,t+=1);return t}let fW=e=>(fT<<BigInt(e))-fT;function fF(e,t,r={}){if(!e||"object"!=typeof e)throw Error("expected valid options object");function i(t,r,i){let n=e[t];if(i&&void 0===n)return;let s=typeof n;if(s!==r||null===n)throw Error(`param "${t}" is invalid: expected ${r}, got ${s}`)}Object.entries(t).forEach(([e,t])=>i(e,t,!1)),Object.entries(r).forEach(([e,t])=>i(e,t,!0))}function fH(e){let t=new WeakMap;return(r,...i)=>{let n=t.get(r);if(void 0!==n)return n;let s=e(r,...i);return t.set(r,s),s}}let fq=BigInt(0),fz=BigInt(1),f$=BigInt(2),fK=BigInt(3),fV=BigInt(4),fJ=BigInt(5),fZ=BigInt(7),fG=BigInt(8),fY=BigInt(9),fQ=BigInt(16);function fX(e,t){let r=e%t;return r>=fq?r:t+r}function f0(e,t,r){let i=e;for(;t-- >fq;)i*=i,i%=r;return i}function f1(e,t){if(e===fq)throw Error("invert: expected non-zero number");if(t<=fq)throw Error("invert: expected positive modulus, got "+t);let r=fX(e,t),i=t,n=fq,s=fz;for(;r!==fq;){let e=i/r,t=i%r,a=n-s*e;i=r,r=t,n=s,s=a}if(i!==fz)throw Error("invert: does not exist");return fX(n,t)}function f2(e,t,r){if(!e.eql(e.sqr(t),r))throw Error("Cannot find square root")}function f3(e,t){let r=(e.ORDER+fz)/fV,i=e.pow(t,r);return f2(e,i,t),i}function f5(e,t){let r=(e.ORDER-fJ)/fG,i=e.mul(t,f$),n=e.pow(i,r),s=e.mul(t,n),a=e.mul(e.mul(s,f$),n),o=e.mul(s,e.sub(a,e.ONE));return f2(e,o,t),o}function f8(e){if(e<fK)throw Error("sqrt is not defined for small field");let t=e-fz,r=0;for(;t%f$===fq;)t/=f$,r++;let i=f$,n=ye(e);for(;1===f7(n,i);)if(i++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===r)return f3;let s=n.pow(i,t),a=(t+fz)/f$;return function(e,i){if(e.is0(i))return i;if(1!==f7(e,i))throw Error("Cannot find square root");let n=r,o=e.mul(e.ONE,s),l=e.pow(i,t),c=e.pow(i,a);for(;!e.eql(l,e.ONE);){if(e.is0(l))return e.ZERO;let t=1,r=e.sqr(l);for(;!e.eql(r,e.ONE);)if(t++,r=e.sqr(r),t===n)throw Error("Cannot find square root");let i=fz<<BigInt(n-t-1),s=e.pow(o,i);n=t,o=e.sqr(s),l=e.mul(l,o),c=e.mul(c,s)}return c}}let f6=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function f4(e,t,r=!1){let i=Array(t.length).fill(r?e.ZERO:void 0),n=t.reduce((t,r,n)=>e.is0(r)?t:(i[n]=t,e.mul(t,r)),e.ONE),s=e.inv(n);return t.reduceRight((t,r,n)=>e.is0(r)?t:(i[n]=e.mul(t,i[n]),e.mul(t,r)),s),i}function f7(e,t){let r=(e.ORDER-fz)/f$,i=e.pow(t,r),n=e.eql(i,e.ONE),s=e.eql(i,e.ZERO),a=e.eql(i,e.neg(e.ONE));if(!n&&!s&&!a)throw Error("invalid Legendre symbol result");return n?1:s?0:-1}function f9(e,t){void 0!==t&&hC(t);let r=void 0!==t?t:e.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function ye(e,t,r=!1,i={}){let n;if(e<=fq)throw Error("invalid field: expected ORDER > 0, got "+e);let s,a,o=!1,l;if("object"==typeof t&&null!=t){if(i.sqrt||r)throw Error("cannot specify opts in two arguments");t.BITS&&(s=t.BITS),t.sqrt&&(a=t.sqrt),"boolean"==typeof t.isLE&&(r=t.isLE),"boolean"==typeof t.modFromBytes&&(o=t.modFromBytes),l=t.allowedLengths}else"number"==typeof t&&(s=t),i.sqrt&&(a=i.sqrt);let{nBitLength:c,nByteLength:d}=f9(e,s);if(d>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let u=Object.freeze({ORDER:e,isLE:r,BITS:c,BYTES:d,MASK:fW(c),ZERO:fq,ONE:fz,allowedLengths:l,create:t=>fX(t,e),isValid:t=>{if("bigint"!=typeof t)throw Error("invalid field element: expected bigint, got "+typeof t);return fq<=t&&t<e},is0:e=>e===fq,isValidNot0:e=>!u.is0(e)&&u.isValid(e),isOdd:e=>(e&fz)===fz,neg:t=>fX(-t,e),eql:(e,t)=>e===t,sqr:t=>fX(t*t,e),add:(t,r)=>fX(t+r,e),sub:(t,r)=>fX(t-r,e),mul:(t,r)=>fX(t*r,e),pow:(e,t)=>(function(e,t,r){if(r<fq)throw Error("invalid exponent, negatives unsupported");if(r===fq)return e.ONE;if(r===fz)return t;let i=e.ONE,n=t;for(;r>fq;)r&fz&&(i=e.mul(i,n)),n=e.sqr(n),r>>=fz;return i})(u,e,t),div:(t,r)=>fX(t*f1(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>f1(t,e),sqrt:a||(t=>{let r,i,s,a,o,l;return n||(n=e%fV===fK?f3:e%fG===fJ?f5:e%fQ===fY?(r=ye(e),s=(i=f8(e))(r,r.neg(r.ONE)),a=i(r,s),o=i(r,r.neg(s)),l=(e+fZ)/fQ,(e,t)=>{let r=e.pow(t,l),i=e.mul(r,s),n=e.mul(r,a),c=e.mul(r,o),d=e.eql(e.sqr(i),t),u=e.eql(e.sqr(n),t);r=e.cmov(r,i,d),i=e.cmov(c,n,u);let h=e.eql(e.sqr(i),t),p=e.cmov(r,i,h);return f2(e,p,t),p}):f8(e)),n(u,t)}),toBytes:e=>r?fU(e,d):fM(e,d),fromBytes:(t,i=!0)=>{if(l){if(!l.includes(t.length)||t.length>d)throw Error("Field.fromBytes: expected "+l+" bytes, got "+t.length);let e=new Uint8Array(d);e.set(t,r?0:e.length-t.length),t=e}if(t.length!==d)throw Error("Field.fromBytes: expected "+d+" bytes, got "+t.length);let n=r?fN(t):fR(hz(t));if(o&&(n=fX(n,e)),!i&&!u.isValid(n))throw Error("invalid field element: outside of range 0..ORDER");return n},invertBatch:e=>f4(u,e),cmov:(e,t,r)=>r?t:e});return Object.freeze(u)}function yt(e){if("bigint"!=typeof e)throw Error("field order must be bigint");return Math.ceil(e.toString(2).length/8)}function yr(e){let t=yt(e);return t+Math.ceil(t/2)}let yi=BigInt(0),yn=BigInt(1);function ys(e,t){let r=t.negate();return e?r:t}function ya(e,t){let r=f4(e.Fp,t.map(e=>e.Z));return t.map((t,i)=>e.fromAffine(t.toAffine(r[i])))}function yo(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw Error("invalid window size, expected [1.."+t+"], got W="+e)}function yl(e,t){yo(e,t);let r=Math.ceil(t/e)+1,i=2**(e-1),n=2**e;return{windows:r,windowSize:i,mask:fW(e),maxNumber:n,shiftBy:BigInt(e)}}function yc(e,t,r){let{windowSize:i,mask:n,maxNumber:s,shiftBy:a}=r,o=Number(e&n),l=e>>a;o>i&&(o-=s,l+=yn);let c=t*i;return{nextN:l,offset:c+Math.abs(o)-1,isZero:0===o,isNeg:o<0,isNegF:t%2!=0,offsetF:c}}let yd=new WeakMap,yu=new WeakMap;function yh(e){return yu.get(e)||1}function yp(e){if(e!==yi)throw Error("invalid wNAF")}class yf{constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,r=this.ZERO){let i=e;for(;t>yi;)t&yn&&(r=r.add(i)),i=i.double(),t>>=yn;return r}precomputeWindow(e,t){let{windows:r,windowSize:i}=yl(t,this.bits),n=[],s=e,a=s;for(let e=0;e<r;e++){a=s,n.push(a);for(let e=1;e<i;e++)a=a.add(s),n.push(a);s=a.double()}return n}wNAF(e,t,r){if(!this.Fn.isValid(r))throw Error("invalid scalar");let i=this.ZERO,n=this.BASE,s=yl(e,this.bits);for(let e=0;e<s.windows;e++){let{nextN:a,offset:o,isZero:l,isNeg:c,isNegF:d,offsetF:u}=yc(r,e,s);r=a,l?n=n.add(ys(d,t[u])):i=i.add(ys(c,t[o]))}return yp(r),{p:i,f:n}}wNAFUnsafe(e,t,r,i=this.ZERO){let n=yl(e,this.bits);for(let e=0;e<n.windows&&r!==yi;e++){let{nextN:s,offset:a,isZero:o,isNeg:l}=yc(r,e,n);if(r=s,!o){let e=t[a];i=i.add(l?e.negate():e)}}return yp(r),i}getPrecomputes(e,t,r){let i=yd.get(t);return i||(i=this.precomputeWindow(t,e),1!==e&&("function"==typeof r&&(i=r(i)),yd.set(t,i))),i}cached(e,t,r){let i=yh(e);return this.wNAF(i,this.getPrecomputes(i,e,r),t)}unsafe(e,t,r,i){let n=yh(e);return 1===n?this._unsafeLadder(e,t,i):this.wNAFUnsafe(n,this.getPrecomputes(n,e,r),t,i)}createCache(e,t){yo(t,this.bits),yu.set(e,t),yd.delete(e)}hasCache(e){return 1!==yh(e)}}function yy(e,t,r){if(!t)return ye(e,{isLE:r});if(t.ORDER!==e)throw Error("Field.ORDER must match order: Fp == p, Fn == n");return fF(t,f6.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"})),t}BigInt(0),BigInt(1),BigInt(2),BigInt(8),hV("HashToScalar-");let yg=BigInt(0),ym=BigInt(1),yw=BigInt(2),yb=BigInt(1),yv=BigInt(2),yE=BigInt(3),y_=BigInt(5),yA=BigInt(8),yS=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),yx={p:yS,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:yA,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")},yI=function(e){let{P:t,type:r,adjustScalarBytes:i,powPminus2:n,randomBytes:s}=(fF(e,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...e})),a="x25519"===r;if(!a&&"x448"!==r)throw Error("invalid type");let o=s||hQ,l=a?255:448,c=a?32:56,d=BigInt(a?9:5),u=BigInt(a?121665:39081),h=a?yw**BigInt(254):yw**BigInt(447),p=h+(a?BigInt(8)*yw**BigInt(251)-ym:BigInt(4)*yw**BigInt(445)-ym)+ym,f=e=>fX(e,t),y=fU(f(d),c);function g(e,r){let s,o=function(e,r){fj("u",e,yg,t),fj("scalar",r,h,p);let i=ym,s=yg,a=e,o=ym,c=yg;for(let t=BigInt(l-1);t>=yg;t--){let n=r>>t&ym;c^=n,({x_2:i,x_3:a}=w(c,i,a)),({x_2:s,x_3:o}=w(c,s,o)),c=n;let l=i+s,d=f(l*l),h=i-s,p=f(h*h),y=d-p,g=a+o,m=f((a-o)*l),b=f(g*h),v=m+b,E=m-b;a=f(v*v),o=f(e*f(E*E)),i=f(d*p),s=f(y*(d+f(u*y)))}return{x_2:i,x_3:a}=w(c,i,a),{x_2:s,x_3:o}=w(c,s,o),f(i*n(s))}((s=fD("u coordinate",r,c),a&&(s[31]&=127),f(fN(s))),fN(i(fD("scalar",e,c))));if(o===yg)throw Error("invalid private or public key received");return fU(f(o),c)}function m(e){return g(e,y)}function w(e,t,r){let i=f(e*(t-r));return{x_2:t=f(t-i),x_3:r=f(r+i)}}let b={secretKey:c,publicKey:c,seed:c},v=(e=o(c))=>(hP(e,b.seed),e);return{keygen:function(e){let t=v(e);return{secretKey:t,publicKey:m(t)}},getSharedSecret:(e,t)=>g(e,t),getPublicKey:e=>m(e),scalarMult:g,scalarMultBase:m,utils:{randomSecretKey:v,randomPrivateKey:v},GuBytes:y.slice(),lengths:b}}({P:W=ye(yx.p,{isLE:!0}).ORDER,type:"x25519",powPminus2:e=>{let t,r,i,n,s,a,o,l,c,d,u,h,p,f,{pow_p_5_8:y,b2:g}=(t=BigInt(10),r=BigInt(20),i=BigInt(40),n=BigInt(80),a=f0(s=e*e%yS*e%yS,yv,yS)*s%yS,o=f0(a,yb,yS)*e%yS,l=f0(o,y_,yS)*o%yS,c=f0(l,t,yS)*l%yS,d=f0(c,r,yS)*c%yS,u=f0(d,i,yS)*d%yS,h=f0(u,n,yS)*u%yS,p=f0(h,n,yS)*u%yS,f=f0(p,t,yS)*l%yS,{pow_p_5_8:f0(f,yv,yS)*e%yS,b2:s});return fX(f0(y,yE,W)*g,W)},adjustScalarBytes:function(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}}),yk=(e,t)=>(e+(e>=0?t:-t)/yN)/t;function yT(e){if(!["compact","recovered","der"].includes(e))throw Error('Signature format must be "compact", "recovered", or "der"');return e}function yC(e,t){let r={};for(let i of Object.keys(t))r[i]=void 0===e[i]?t[i]:e[i];return fC(r.lowS,"lowS"),fC(r.prehash,"prehash"),void 0!==r.format&&yT(r.format),r}let yP={Err:class extends Error{constructor(e=""){super(e)}},_tlv:{encode:(e,t)=>{let{Err:r}=yP;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(1&t.length)throw new r("tlv.encode: unpadded data");let i=t.length/2,n=fO(i);if(n.length/2&128)throw new r("tlv.encode: long form length too big");let s=i>127?fO(n.length/2|128):"";return fO(e)+s+n+t},decode(e,t){let{Err:r}=yP,i=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[i++]!==e)throw new r("tlv.decode: wrong tlv");let n=t[i++],s=0;if(128&n){let e=127&n;if(!e)throw new r("tlv.decode(long): indefinite length not supported");if(e>4)throw new r("tlv.decode(long): byte length is too big");let a=t.subarray(i,i+e);if(a.length!==e)throw new r("tlv.decode: length bytes not complete");if(0===a[0])throw new r("tlv.decode(long): zero leftmost byte");for(let e of a)s=s<<8|e;if(i+=e,s<128)throw new r("tlv.decode(long): not minimal encoding")}else s=n;let a=t.subarray(i,i+s);if(a.length!==s)throw new r("tlv.decode: wrong value length");return{v:a,l:t.subarray(i+s)}}},_int:{encode(e){let{Err:t}=yP;if(e<yO)throw new t("integer: negative integers are not allowed");let r=fO(e);if(8&Number.parseInt(r[0],16)&&(r="00"+r),1&r.length)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=yP;if(128&e[0])throw new t("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("invalid signature integer: unnecessary leading zero");return fR(hz(e))}},toSig(e){let{Err:t,_int:r,_tlv:i}=yP,n=fD("signature",e),{v:s,l:a}=i.decode(48,n);if(a.length)throw new t("invalid signature: left bytes after parsing");let{v:o,l:l}=i.decode(2,s),{v:c,l:d}=i.decode(2,l);if(d.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(o),s:r.decode(c)}},hexFromSig(e){let{_tlv:t,_int:r}=yP,i=t.encode(2,r.encode(e.r)),n=t.encode(2,r.encode(e.s));return t.encode(48,i+n)}},yO=BigInt(0),yR=BigInt(1),yN=BigInt(2),yM=BigInt(3),yU=BigInt(4);function yD(e,t){let r,{BYTES:i}=e;if("bigint"==typeof t)r=t;else{let n=fD("private key",t);try{r=e.fromBytes(n)}catch{throw Error(`invalid private key: expected ui8a of size ${i}, got ${typeof t}`)}}if(!e.isValidNot0(r))throw Error("invalid private key: out of range [1..N-1]");return r}function yL(e){return Uint8Array.of(e?2:3)}function yj(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function yB(e,t){let r=t=>(function(e){let t,{CURVE:r,curveOpts:i,hash:n,ecdsaOpts:s}=function(e){let t,r,i,n,{CURVE:s,curveOpts:a}=(t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,i=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(e=>Math.ceil(e/2)))):void 0,n={Fp:r,Fn:ye(t.n,{BITS:e.nBitLength,allowedLengths:i,modFromBytes:e.wrapPrivateKey}),allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes},{CURVE:t,curveOpts:n}),o={hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN};return{CURVE:s,curveOpts:a,hash:e.hash,ecdsaOpts:o}}(e),a=function(e,t,r={}){hO(t),fF(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let i=r.randomBytes||hQ,n=r.hmac||((e,...r)=>fS(t,e,hZ(...r))),{Fp:s,Fn:a}=e,{ORDER:o,BITS:l}=a,{keygen:c,getPublicKey:d,getSharedSecret:u,utils:h,lengths:p}=function(e,t={}){let{Fn:r}=e,i=t.randomBytes||hQ,n=Object.assign(yj(e.Fp,r),{seed:yr(r.ORDER)});function s(e){try{return!!yD(r,e)}catch{return!1}}function a(e=i(n.seed)){return function(e,t,r=!1){let i=e.length,n=yt(t),s=yr(t);if(i<16||i<s||i>1024)throw Error("expected "+s+"-1024 bytes of input, got "+i);let a=fX(r?fN(e):fR(hz(e)),t-fz)+fz;return r?fU(a,n):fM(a,n)}(fP(e,n.seed,"seed"),r.ORDER)}function o(t,i=!0){return e.BASE.multiply(yD(r,t)).toBytes(i)}function l(t){if("bigint"==typeof t)return!1;if(t instanceof e)return!0;let{secretKey:i,publicKey:s,publicKeyUncompressed:a}=n;if(r.allowedLengths||i===s)return;let o=fD("key",t).length;return o===s||o===a}return Object.freeze({getPublicKey:o,getSharedSecret:function(t,i,n=!0){if(!0===l(t))throw Error("first arg must be private key");if(!1===l(i))throw Error("second arg must be public key");let s=yD(r,t);return e.fromHex(i).multiply(s).toBytes(n)},keygen:function(e){let t=a(e);return{secretKey:t,publicKey:o(t)}},Point:e,utils:{isValidSecretKey:s,isValidPublicKey:function(t,r){let{publicKey:i,publicKeyUncompressed:s}=n;try{let n=t.length;return(!0!==r||n===i)&&(!1!==r||n===s)&&!!e.fromBytes(t)}catch{return!1}},randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:e=>yD(r,e),precompute:(t=8,r=e.BASE)=>r.precompute(t,!1)},lengths:n})}(e,r),f={prehash:!1,lowS:"boolean"==typeof r.lowS&&r.lowS,format:void 0,extraEntropy:!1},y="compact";function g(e,t){if(!a.isValidNot0(t))throw Error(`invalid signature ${e}: out of range 1..Point.Fn.ORDER`);return t}class m{constructor(e,t,r){this.r=g("r",e),this.s=g("s",t),null!=r&&(this.recovery=r),Object.freeze(this)}static fromBytes(e,t=y){var r,i;let n,s;if(r=e,yT(i=t),s=p.signature,fP(r,"compact"===i?s:"recovered"===i?s+1:void 0,`${i} signature`),"der"===t){let{r:t,s:r}=yP.toSig(fP(e));return new m(t,r)}"recovered"===t&&(n=e[0],t="compact",e=e.subarray(1));let o=a.BYTES,l=e.subarray(0,o),c=e.subarray(o,2*o);return new m(a.fromBytes(l),a.fromBytes(c),n)}static fromHex(e,t){return this.fromBytes(hK(e),t)}addRecoveryBit(e){return new m(this.r,this.s,e)}recoverPublicKey(t){let r=s.ORDER,{r:i,s:n,recovery:l}=this;if(null==l||![0,1,2,3].includes(l))throw Error("recovery id invalid");if(o*yN<r&&l>1)throw Error("recovery id is ambiguous for h>1 curve");let c=2===l||3===l?i+o:i;if(!s.isValid(c))throw Error("recovery id 2 or 3 invalid");let d=s.toBytes(c),u=e.fromBytes(hZ(yL((1&l)==0),d)),h=a.inv(c),p=b(fD("msgHash",t)),f=a.create(-p*h),y=a.create(n*h),g=e.BASE.multiplyUnsafe(f).add(u.multiplyUnsafe(y));if(g.is0())throw Error("point at infinify");return g.assertValidity(),g}hasHighS(){return this.s>o>>yR}toBytes(e=y){if(yT(e),"der"===e)return hK(yP.hexFromSig(this));let t=a.toBytes(this.r),r=a.toBytes(this.s);if("recovered"===e){if(null==this.recovery)throw Error("recovery bit must be present");return hZ(Uint8Array.of(this.recovery),t,r)}return hZ(t,r)}toHex(e){return hz(this.toBytes(e))}assertValidity(){}static fromCompact(e){return m.fromBytes(fD("sig",e),"compact")}static fromDER(e){return m.fromBytes(fD("sig",e),"der")}normalizeS(){return this.hasHighS()?new m(this.r,a.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return hz(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return hz(this.toBytes("compact"))}}let w=r.bits2int||function(e){if(e.length>8192)throw Error("input is too large");let t=fR(hz(e)),r=8*e.length-l;return r>0?t>>BigInt(r):t},b=r.bits2int_modN||function(e){return a.create(w(e))},v=fW(l);function E(e){return fj("num < 2^"+l,e,yO,v),a.toBytes(e)}function _(e,r){return fP(e,void 0,"message"),r?fP(t(e),void 0,"prehashed message"):e}return Object.freeze({keygen:c,getPublicKey:d,getSharedSecret:u,utils:h,lengths:p,Point:e,sign:function(r,s,l={}){let{seed:c,k2sig:d}=function(t,r,n){if(["recovered","canonical"].some(e=>e in n))throw Error("sign() legacy options not supported");let{lowS:s,prehash:l,extraEntropy:c}=yC(n,f),d=b(t=_(t,l)),u=yD(a,r),h=[E(u),E(d)];if(null!=c&&!1!==c){let e=!0===c?i(p.secretKey):c;h.push(fD("extraEntropy",e))}return{seed:hZ(...h),k2sig:function(t){let r=w(t);if(!a.isValidNot0(r))return;let i=a.inv(r),n=e.BASE.multiply(r).toAffine(),l=a.create(n.x);if(l===yO)return;let c=a.create(i*a.create(d+l*u));if(c===yO)return;let h=2*(n.x!==l)|Number(n.y&yR),p=c;return s&&c>o>>yR&&(p=a.neg(c),h^=1),new m(l,p,h)}}}(r=fD("message",r),s,l);return(function(e,t,r){if("number"!=typeof e||e<2)throw Error("hashLen must be a number");if("number"!=typeof t||t<2)throw Error("qByteLen must be a number");if("function"!=typeof r)throw Error("hmacFn must be a function");let i=e=>new Uint8Array(e),n=i(e),s=i(e),a=0,o=()=>{n.fill(1),s.fill(0),a=0},l=(...e)=>r(s,n,...e),c=(e=i(0))=>{s=l(Uint8Array.of(0),e),n=l(),0!==e.length&&(s=l(Uint8Array.of(1),e),n=l())},d=()=>{if(a++>=1e3)throw Error("drbg: tried 1000 values");let e=0,r=[];for(;e<t;){let t=(n=l()).slice();r.push(t),e+=n.length}return hZ(...r)};return(e,t)=>{let r;for(o(),c(e);!(r=t(d()));)c();return o(),r}})(t.outputLen,a.BYTES,n)(c,d)},verify:function(t,r,i,n={}){let{lowS:s,prehash:o,format:l}=yC(n,f);if(i=fD("publicKey",i),r=_(fD("message",r),o),"strict"in n)throw Error("options.strict was renamed to lowS");let c=void 0===l?function(e){let t,r="string"==typeof e||hT(e),i=!r&&null!==e&&"object"==typeof e&&"bigint"==typeof e.r&&"bigint"==typeof e.s;if(!r&&!i)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(i)t=new m(e.r,e.s);else if(r){try{t=m.fromBytes(fD("sig",e),"der")}catch(e){if(!(e instanceof yP.Err))throw e}if(!t)try{t=m.fromBytes(fD("sig",e),"compact")}catch{return!1}}return t||!1}(t):m.fromBytes(fD("sig",t),l);if(!1===c)return!1;try{let t=e.fromBytes(i);if(s&&c.hasHighS())return!1;let{r:n,s:o}=c,l=b(r),d=a.inv(o),u=a.create(l*d),h=a.create(n*d),p=e.BASE.multiplyUnsafe(u).add(t.multiplyUnsafe(h));return!p.is0()&&a.create(p.x)===n}catch{return!1}},recoverPublicKey:function(e,t,r={}){let{prehash:i}=yC(r,f);return t=_(t,i),m.fromBytes(e,"recovered").recoverPublicKey(t).toBytes()},Signature:m,hash:t})}(function(e,t={}){let r=function(e,t,r={},i){if(void 0===i&&(i="edwards"===e),!t||"object"!=typeof t)throw Error(`expected valid ${e} CURVE object`);for(let e of["p","n","h"]){let r=t[e];if(!("bigint"==typeof r&&r>yi))throw Error(`CURVE.${e} must be positive bigint`)}let n=yy(t.p,r.Fp,i),s=yy(t.n,r.Fn,i);for(let r of["Gx","Gy","a","weierstrass"===e?"b":"d"])if(!n.isValid(t[r]))throw Error(`CURVE.${r} must be valid field element of CURVE.Fp`);return{CURVE:t=Object.freeze(Object.assign({},t)),Fp:n,Fn:s}}("weierstrass",e,t),{Fp:i,Fn:n}=r,s=r.CURVE,{h:a,n:o}=s;fF(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:l}=t;if(l&&(!i.is0(s.a)||"bigint"!=typeof l.beta||!Array.isArray(l.basises)))throw Error('invalid endo: expected "beta": bigint and "basises": array');let c=yj(i,n);function d(){if(!i.isOdd)throw Error("compression is not supported: Field does not have .isOdd()")}let u=t.toBytes||function(e,t,r){let{x:n,y:s}=t.toAffine(),a=i.toBytes(n);return(fC(r,"isCompressed"),r)?(d(),hZ(yL(!i.isOdd(s)),a)):hZ(Uint8Array.of(4),a,i.toBytes(s))},h=t.fromBytes||function(e){fP(e,void 0,"Point");let{publicKey:t,publicKeyUncompressed:r}=c,n=e.length,s=e[0],a=e.subarray(1);if(n===t&&(2===s||3===s)){let e,t=i.fromBytes(a);if(!i.isValid(t))throw Error("bad point: is not on curve, wrong x");let r=p(t);try{e=i.sqrt(r)}catch(e){throw Error("bad point: is not on curve, sqrt error"+(e instanceof Error?": "+e.message:""))}return d(),(1&s)==1!==i.isOdd(e)&&(e=i.neg(e)),{x:t,y:e}}if(n===r&&4===s){let e=i.BYTES,t=i.fromBytes(a.subarray(0,e)),r=i.fromBytes(a.subarray(e,2*e));if(!f(t,r))throw Error("bad point: is not on curve");return{x:t,y:r}}throw Error(`bad point: got length ${n}, expected compressed=${t} or uncompressed=${r}`)};function p(e){let t=i.sqr(e),r=i.mul(t,e);return i.add(i.add(r,i.mul(e,s.a)),s.b)}function f(e,t){let r=i.sqr(t),n=p(e);return i.eql(r,n)}if(!f(s.Gx,s.Gy))throw Error("bad curve params: generator point");let y=i.mul(i.pow(s.a,yM),yU),g=i.mul(i.sqr(s.b),BigInt(27));if(i.is0(i.add(y,g)))throw Error("bad curve params: a or b");function m(e,t,r=!1){if(!i.isValid(t)||r&&i.is0(t))throw Error(`bad point coordinate ${e}`);return t}function w(e){if(!(e instanceof A))throw Error("ProjectivePoint expected")}function b(e){if(!l||!l.basises)throw Error("no endo");return function(e,t,r){let[[i,n],[s,a]]=t,o=yk(a*e,r),l=yk(-n*e,r),c=e-o*i-l*s,d=-o*n-l*a,u=c<yO,h=d<yO;u&&(c=-c),h&&(d=-d);let p=fW(Math.ceil(fB(r)/2))+yR;if(c<yO||c>=p||d<yO||d>=p)throw Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:u,k1:c,k2neg:h,k2:d}}(e,l.basises,n.ORDER)}let v=fH((e,t)=>{let{X:r,Y:n,Z:s}=e;if(i.eql(s,i.ONE))return{x:r,y:n};let a=e.is0();null==t&&(t=a?i.ONE:i.inv(s));let o=i.mul(r,t),l=i.mul(n,t),c=i.mul(s,t);if(a)return{x:i.ZERO,y:i.ZERO};if(!i.eql(c,i.ONE))throw Error("invZ was invalid");return{x:o,y:l}}),E=fH(e=>{if(e.is0()){if(t.allowInfinityPoint&&!i.is0(e.Y))return;throw Error("bad point: ZERO")}let{x:r,y:n}=e.toAffine();if(!i.isValid(r)||!i.isValid(n))throw Error("bad point: x or y not field elements");if(!f(r,n))throw Error("bad point: equation left != right");if(!e.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});function _(e,t,r,n,s){return r=new A(i.mul(r.X,e),r.Y,r.Z),t=ys(n,t),r=ys(s,r),t.add(r)}class A{constructor(e,t,r){this.X=m("x",e),this.Y=m("y",t,!0),this.Z=m("z",r),Object.freeze(this)}static CURVE(){return s}static fromAffine(e){let{x:t,y:r}=e||{};if(!e||!i.isValid(t)||!i.isValid(r))throw Error("invalid affine point");if(e instanceof A)throw Error("projective point not allowed");return i.is0(t)&&i.is0(r)?A.ZERO:new A(t,r,i.ONE)}static fromBytes(e){let t=A.fromAffine(h(fP(e,void 0,"point")));return t.assertValidity(),t}static fromHex(e){return A.fromBytes(fD("pointHex",e))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(e=8,t=!0){return x.createCache(this,e),t||this.multiply(yM),this}assertValidity(){E(this)}hasEvenY(){let{y:e}=this.toAffine();if(!i.isOdd)throw Error("Field doesn't support isOdd");return!i.isOdd(e)}equals(e){w(e);let{X:t,Y:r,Z:n}=this,{X:s,Y:a,Z:o}=e,l=i.eql(i.mul(t,o),i.mul(s,n)),c=i.eql(i.mul(r,o),i.mul(a,n));return l&&c}negate(){return new A(this.X,i.neg(this.Y),this.Z)}double(){let{a:e,b:t}=s,r=i.mul(t,yM),{X:n,Y:a,Z:o}=this,l=i.ZERO,c=i.ZERO,d=i.ZERO,u=i.mul(n,n),h=i.mul(a,a),p=i.mul(o,o),f=i.mul(n,a);return f=i.add(f,f),d=i.mul(n,o),d=i.add(d,d),l=i.mul(e,d),c=i.mul(r,p),c=i.add(l,c),l=i.sub(h,c),c=i.add(h,c),c=i.mul(l,c),l=i.mul(f,l),d=i.mul(r,d),p=i.mul(e,p),f=i.sub(u,p),f=i.mul(e,f),f=i.add(f,d),d=i.add(u,u),u=i.add(d,u),u=i.add(u,p),u=i.mul(u,f),c=i.add(c,u),p=i.mul(a,o),p=i.add(p,p),u=i.mul(p,f),l=i.sub(l,u),d=i.mul(p,h),d=i.add(d,d),new A(l,c,d=i.add(d,d))}add(e){w(e);let{X:t,Y:r,Z:n}=this,{X:a,Y:o,Z:l}=e,c=i.ZERO,d=i.ZERO,u=i.ZERO,h=s.a,p=i.mul(s.b,yM),f=i.mul(t,a),y=i.mul(r,o),g=i.mul(n,l),m=i.add(t,r),b=i.add(a,o);m=i.mul(m,b),b=i.add(f,y),m=i.sub(m,b),b=i.add(t,n);let v=i.add(a,l);return b=i.mul(b,v),v=i.add(f,g),b=i.sub(b,v),v=i.add(r,n),c=i.add(o,l),v=i.mul(v,c),c=i.add(y,g),v=i.sub(v,c),u=i.mul(h,b),c=i.mul(p,g),u=i.add(c,u),c=i.sub(y,u),u=i.add(y,u),d=i.mul(c,u),y=i.add(f,f),y=i.add(y,f),g=i.mul(h,g),b=i.mul(p,b),y=i.add(y,g),g=i.sub(f,g),g=i.mul(h,g),b=i.add(b,g),f=i.mul(y,b),d=i.add(d,f),f=i.mul(v,b),c=i.mul(m,c),c=i.sub(c,f),f=i.mul(m,y),u=i.mul(v,u),new A(c,d,u=i.add(u,f))}subtract(e){return this.add(e.negate())}is0(){return this.equals(A.ZERO)}multiply(e){let r,i,{endo:s}=t;if(!n.isValidNot0(e))throw Error("invalid scalar: out of range");let a=e=>x.cached(this,e,e=>ya(A,e));if(s){let{k1neg:t,k1:n,k2neg:o,k2:l}=b(e),{p:c,f:d}=a(n),{p:u,f:h}=a(l);i=d.add(h),r=_(s.beta,c,u,t,o)}else{let{p:t,f:n}=a(e);r=t,i=n}return ya(A,[r,i])[0]}multiplyUnsafe(e){let{endo:r}=t;if(!n.isValid(e))throw Error("invalid scalar: out of range");if(e===yO||this.is0())return A.ZERO;if(e===yR)return this;if(x.hasCache(this))return this.multiply(e);if(!r)return x.unsafe(this,e);{let{k1neg:t,k1:i,k2neg:n,k2:s}=b(e),{p1:a,p2:o}=function(e,t,r,i){let n=t,s=e.ZERO,a=e.ZERO;for(;r>yi||i>yi;)r&yn&&(s=s.add(n)),i&yn&&(a=a.add(n)),n=n.double(),r>>=yn,i>>=yn;return{p1:s,p2:a}}(A,this,i,s);return _(r.beta,a,o,t,n)}}multiplyAndAddUnsafe(e,t,r){let i=this.multiplyUnsafe(t).add(e.multiplyUnsafe(r));return i.is0()?void 0:i}toAffine(e){return v(this,e)}isTorsionFree(){let{isTorsionFree:e}=t;return a===yR||(e?e(A,this):x.unsafe(this,o).is0())}clearCofactor(){let{clearCofactor:e}=t;return a===yR?this:e?e(A,this):this.multiplyUnsafe(a)}isSmallOrder(){return this.multiplyUnsafe(a).is0()}toBytes(e=!0){return fC(e,"isCompressed"),this.assertValidity(),u(A,this,e)}toHex(e=!0){return hz(this.toBytes(e))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(e=!0){return this.toBytes(e)}_setWindowSize(e){this.precompute(e)}static normalizeZ(e){return ya(A,e)}static msm(e,t){return function(e,t,r,i){(function(e,t){if(!Array.isArray(e))throw Error("array expected");e.forEach((e,r)=>{if(!(e instanceof t))throw Error("invalid point at index "+r)})})(r,e),function(e,t){if(!Array.isArray(e))throw Error("array of scalars expected");e.forEach((e,r)=>{if(!t.isValid(e))throw Error("invalid scalar at index "+r)})}(i,t);let n=r.length,s=i.length;if(n!==s)throw Error("arrays of points and scalars must have equal length");let a=e.ZERO,o=fB(BigInt(n)),l=1;o>12?l=o-3:o>4?l=o-2:o>0&&(l=2);let c=fW(l),d=Array(Number(c)+1).fill(a),u=Math.floor((t.BITS-1)/l)*l,h=a;for(let e=u;e>=0;e-=l){d.fill(a);for(let t=0;t<s;t++){let n=Number(i[t]>>BigInt(e)&c);d[n]=d[n].add(r[t])}let t=a;for(let e=d.length-1,r=a;e>0;e--)r=r.add(d[e]),t=t.add(r);if(h=h.add(t),0!==e)for(let e=0;e<l;e++)h=h.double()}return h}(A,n,e,t)}static fromPrivateKey(e){return A.BASE.multiply(yD(n,e))}}A.BASE=new A(s.Gx,s.Gy,i.ONE),A.ZERO=new A(i.ZERO,i.ONE,i.ZERO),A.Fp=i,A.Fn=n;let S=n.BITS,x=new yf(A,t.endo?Math.ceil(S/2):S);return A.BASE.precompute(8),A}(r,i),n,s);return t=a.Point,Object.assign({},a,{ProjectivePoint:t,CURVE:Object.assign({},e,f9(t.Fn.ORDER,t.Fn.BITS))})})({...e,hash:t});return{...r(t),create:r}}let yW={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},yF={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},yH={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},yq=ye(yW.p),yz=ye(yF.p),y$=ye(yH.p),yK=yB({...yW,Fp:yq,lowS:!1},pE);yB({...yF,Fp:yz,lowS:!1},pA),yB({...yH,Fp:y$,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},p_);let yV="base10",yJ="base16",yZ="base64pad",yG="base64url",yY="utf8";function yQ(){let e=hQ(32);return(0,un.toString)(e,yJ)}function yX(e){let t=pE((0,us.fromString)(e,yJ));return(0,un.toString)(t,yJ)}function y0(e){let t=pE((0,us.fromString)(e,yY));return(0,un.toString)(t,yJ)}function y1(e){return(0,us.fromString)(`${e}`,yV)}function y2(e){return Number((0,un.toString)(e,yV))}function y3(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function y5(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),r=(4-t.length%4)%4;return t+"=".repeat(r)}function y8(e){if(2===y2(e.type))return(0,un.toString)((0,ua.concat)([e.type,e.sealed]),yZ);if(1===y2(e.type)){if(typeof e.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");return(0,un.toString)((0,ua.concat)([e.type,e.senderPublicKey,e.iv,e.sealed]),yZ)}return(0,un.toString)((0,ua.concat)([e.type,e.iv,e.sealed]),yZ)}function y6(e){let t=(e.encoding||yZ)===yG?y5(e.encoded):e.encoded,r=(0,us.fromString)(t,yZ),i=r.slice(0,1);if(1===y2(i)){let e=r.slice(1,33),t=r.slice(33,45);return{type:i,sealed:r.slice(45),iv:t,senderPublicKey:e}}if(2===y2(i))return{type:i,sealed:r.slice(1),iv:hQ(12)};let n=r.slice(1,13);return{type:i,sealed:r.slice(13),iv:n}}function y4(e){let t=e?.type||0;if(1===t){if(typeof e?.senderPublicKey>"u")throw Error("missing sender public key");if(typeof e?.receiverPublicKey>"u")throw Error("missing receiver public key")}return{type:t,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function y7(e){return 1===e.type&&"string"==typeof e.senderPublicKey&&"string"==typeof e.receiverPublicKey}function y9(e){return e?.relay||{protocol:"irn"}}function ge(e){let t=uo.RELAY_JSONRPC[e];if(typeof t>"u")throw Error(`Relay Protocol not supported: ${e}`);return t}var gt=Object.defineProperty,gr=Object.defineProperties,gi=Object.getOwnPropertyDescriptors,gn=Object.getOwnPropertySymbols,gs=Object.prototype.hasOwnProperty,ga=Object.prototype.propertyIsEnumerable,go=(e,t,r)=>t in e?gt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,gl=(e,t)=>{for(var r in t||(t={}))gs.call(t,r)&&go(e,r,t[r]);if(gn)for(var r of gn(t))ga.call(t,r)&&go(e,r,t[r]);return e};function gc(e){var t;if(!e.includes("wc:")){let t=hl(e);null!=t&&t.includes("wc:")&&(e=t)}let r=(e=(e=e.includes("wc://")?e.replace("wc://",""):e).includes("wc:")?e.replace("wc:",""):e).indexOf(":"),i=-1!==e.indexOf("?")?e.indexOf("?"):void 0,n=e.substring(0,r),s=e.substring(r+1,i).split("@"),a=Object.fromEntries(new URLSearchParams("u">typeof i?e.substring(i):"").entries()),o="string"==typeof a.methods?a.methods.split(","):void 0;return{protocol:n,topic:(t=s[0]).startsWith("//")?t.substring(2):t,version:parseInt(s[1],10),symKey:a.symKey,relay:function(e,t="-"){let r={},i="relay"+t;return Object.keys(e).forEach(t=>{if(t.startsWith(i)){let n=t.replace(i,""),s=e[t];r[n]=s}}),r}(a),methods:o,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function gd(e){let t=new URLSearchParams;return Object.entries(gl(gl(gr(gl({},function(e,t="-"){let r={};return Object.keys(e).forEach(i=>{e[i]&&(r["relay"+t+i]=e[i])}),r}(e.relay)),gi({symKey:e.symKey})),e.expiryTimestamp&&{expiryTimestamp:e.expiryTimestamp.toString()}),e.methods&&{methods:e.methods.join(",")})).sort(([e],[t])=>e.localeCompare(t)).forEach(([e,r])=>{void 0!==r&&t.append(e,String(r))}),`${e.protocol}:${e.topic}@${e.version}?${t}`}function gu(e,t,r){return`${e}?wc_ev=${r}&topic=${t}`}var gh=Object.defineProperty,gp=Object.defineProperties,gf=Object.getOwnPropertyDescriptors,gy=Object.getOwnPropertySymbols,gg=Object.prototype.hasOwnProperty,gm=Object.prototype.propertyIsEnumerable,gw=(e,t,r)=>t in e?gh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,gb=(e,t)=>{for(var r in t||(t={}))gg.call(t,r)&&gw(e,r,t[r]);if(gy)for(var r of gy(t))gm.call(t,r)&&gw(e,r,t[r]);return e},gv=(e,t)=>gp(e,gf(t));function gE(e){let t=[];return e.forEach(e=>{let[r,i]=e.split(":");t.push(`${r}:${i}`)}),t}function g_(e){return e.includes(":")}function gA(e){return g_(e)?e.split(":")[0]:e}function gS(e){var t,r,i;let n={};if(!gO(e))return n;for(let[s,a]of Object.entries(e)){let e=g_(s)?[s]:a.chains,o=a.methods||[],l=a.events||[],c=gA(s);n[c]=gv(gb({},n[c]),{chains:hr(e,null==(t=n[c])?void 0:t.chains),methods:hr(o,null==(r=n[c])?void 0:r.methods),events:hr(l,null==(i=n[c])?void 0:i.events)})}return n}function gx(e,t){var r;let i,n=(r=t=t.map(e=>e.replace("did:pkh:","")),i={},r?.forEach(e=>{var t;let[r,n]=e.split(":");i[r]||(i[r]={accounts:[],chains:[],events:[],methods:[]}),i[r].accounts.push(e),null==(t=i[r].chains)||t.push(`${r}:${n}`)}),i);for(let[t,r]of Object.entries(n))r.methods?r.methods=hr(r.methods,e):r.methods=e,r.events=["chainChanged","accountsChanged"];return n}let gI={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},gk={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function gT(e,t){let{message:r,code:i}=gk[e];return{message:t?`${r} ${t}`:r,code:i}}function gC(e,t){let{message:r,code:i}=gI[e];return{message:t?`${r} ${t}`:r,code:i}}function gP(e,t){return!!Array.isArray(e)&&(!("u">typeof t)||!e.length||e.every(t))}function gO(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function gR(e){return typeof e>"u"}function gN(e,t){return!!(t&&gR(e))||"string"==typeof e&&!!e.trim().length}function gM(e,t){return!!(t&&gR(e))||"number"==typeof e&&!isNaN(e)}function gU(e){return!!(gN(e,!1)&&e.includes(":"))&&2===e.split(":").length}function gD(e){let t=!0;return gP(e)?e.length&&(t=e.every(e=>gN(e,!1))):t=!1,t}function gL(e,t){let r=null;return Object.values(e).forEach(e=>{var i;let n;if(r)return;let s=(i=`${t}, namespace`,n=null,gD(e?.methods)?gD(e?.events)||(n=gC("UNSUPPORTED_EVENTS",`${i}, events should be an array of strings or empty array for no events`)):n=gC("UNSUPPORTED_METHODS",`${i}, methods should be an array of strings or empty array for no methods`),n);s&&(r=s)}),r}function gj(e,t){let r=null;if(e&&gO(e)){let i,n=gL(e,t);n&&(r=n);let s=(i=null,Object.values(e).forEach(e=>{var r,n;let s;if(i)return;let a=(r=e?.accounts,n=`${t} namespace`,s=null,gP(r)?r.forEach(e=>{s||function(e){if(gN(e,!1)&&e.includes(":")){let t=e.split(":");if(3===t.length){let e=t[0]+":"+t[1];return!!t[2]&&gU(e)}}return!1}(e)||(s=gC("UNSUPPORTED_ACCOUNTS",`${n}, account ${e} should be a string and conform to "namespace:chainId:address" format`))}):s=gC("UNSUPPORTED_ACCOUNTS",`${n}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),s);a&&(i=a)}),i);s&&(r=s)}else r=gT("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function gB(e){return gN(e.protocol,!0)}function gW(e){return"u">typeof e}function gF(e,t){let r;return!(!gU(t)||!(r=[],Object.values(e).forEach(e=>{r.push(...gE(e.accounts))}),r).includes(t))}function gH(e,t,r){var i,n;let s,a,o=null,l=(s={},Object.keys(i=e).forEach(e=>{var t;e.includes(":")?s[e]=i[e]:null==(t=i[e].chains)||t.forEach(t=>{s[t]={methods:i[e].methods,events:i[e].events}})}),s),c=(a={},Object.keys(n=t).forEach(e=>{if(e.includes(":"))a[e]=n[e];else{let t=gE(n[e].accounts);t?.forEach(t=>{a[t]={accounts:n[e].accounts.filter(e=>e.includes(`${t}:`)),methods:n[e].methods,events:n[e].events}})}}),a),d=Object.keys(l),u=Object.keys(c),h=gq(Object.keys(e)),p=gq(Object.keys(t)),f=h.filter(e=>!p.includes(e));return f.length&&(o=gT("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${f.toString()}
      Received: ${Object.keys(t).toString()}`)),u2(d,u)||(o=gT("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${d.toString()}
      Approved: ${u.toString()}`)),Object.keys(t).forEach(e=>{if(!e.includes(":")||o)return;let i=gE(t[e].accounts);i.includes(e)||(o=gT("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${e}
        Required: ${e}
        Approved: ${i.toString()}`))}),d.forEach(e=>{o||(u2(l[e].methods,c[e].methods)?u2(l[e].events,c[e].events)||(o=gT("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${e}`)):o=gT("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${e}`))}),o}function gq(e){return[...new Set(e.map(e=>e.includes(":")?e.split(":")[0]:e))]}function gz(){let e=uQ();return new Promise(t=>{switch(e){case uJ:t(uY()&&navigator?.onLine);break;case uK:t(g$());break;default:t(!0)}})}async function g$(){if(uG()&&null!=e.g&&e.g.NetInfo){let t=await (null==e.g?void 0:e.g.NetInfo.fetch());return t?.isConnected}return!0}let gK={};class gV{static get(e){return gK[e]}static set(e,t){gK[e]=t}static delete(e){delete gK[e]}}function gJ(e){return new Uint8Array(e.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function gZ({logger:e,name:t}){let r="string"==typeof e?uN({opts:{level:e,name:t}}).logger:e;return r.level="string"==typeof e?e:e.level,r}var gG=e.i(180476),gY=e.i(499276);e.i(826606);var gQ=e.i(81775),gX=Object.defineProperty,g0=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?gX(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class g1 extends gQ.IEvents{constructor(e){super(),this.opts=e,g0(this,"protocol","wc"),g0(this,"version",2)}}var g2=Object.defineProperty;class g3 extends gQ.IEvents{constructor(e,t){super(),this.core=e,this.logger=t,((e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?g2(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(this,"records",new Map)}}class g5{constructor(e,t){this.logger=e,this.core=t}}class g8 extends gQ.IEvents{constructor(e,t){super(),this.relayer=e,this.logger=t}}class g6 extends gQ.IEvents{constructor(e){super()}}class g4{constructor(e,t,r,i){this.core=e,this.logger=t,this.name=r}}class g7 extends gQ.IEvents{constructor(e,t){super(),this.relayer=e,this.logger=t}}class g9 extends gQ.IEvents{constructor(e,t){super(),this.core=e,this.logger=t}}class me{constructor(e,t,r){this.core=e,this.logger=t,this.store=r}}class mt{constructor(e,t){this.projectId=e,this.logger=t}}class mr{constructor(e,t,r){this.core=e,this.logger=t,this.telemetryEnabled=r}}var mi=Object.defineProperty,mn=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?mi(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};oU.default;class ms{constructor(e){this.opts=e,mn(this,"protocol","wc"),mn(this,"version",2)}}oU.EventEmitter;class ma{constructor(e){this.client=e}}var mo=e.i(501365);e.i(424047);var ml=e.i(329193),mc=e.i(850967),md=e.i(112324);let mu="core",mh=`wc@2:${mu}:`,mp={database:":memory:"},mf="client_ed25519_seed",my=oL.ONE_DAY,mg=oL.SIX_HOURS,mm="wss://relay.walletconnect.org",mw="relayer_message",mb="relayer_message_ack",mv="relayer_connection_stalled",mE="relayer_publish",m_="payload",mA="connect",mS="disconnect",mx="error",mI="2.22.4",mk="link_mode",mT="relay",mC="inbound",mP="WALLETCONNECT_LINK_MODE_APPS",mO="subscription_created",mR="subscription_deleted",mN=(oL.THIRTY_DAYS,oL.FIVE_SECONDS,oL.THIRTY_DAYS,{wc_pairingDelete:{req:{ttl:oL.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:oL.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:oL.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:oL.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:oL.ONE_DAY,prompt:!1,tag:0},res:{ttl:oL.ONE_DAY,prompt:!1,tag:0}}}),mM="pairing_create",mU="pairing_delete",mD="history_created",mL="history_updated",mj="history_deleted",mB="expirer_created",mW="expirer_deleted",mF="expirer_expired",mH=(oL.ONE_DAY,"https://verify.walletconnect.org"),mq=`${mH}/v3`,mz=["https://verify.walletconnect.com",mH],m$="malformed_pairing_uri",mK="session_approve_started";var mV=function(e,t){if(e.length>=255)throw TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<e.length;n++){var s=e.charAt(n),a=s.charCodeAt(0);if(255!==r[a])throw TypeError(s+" is ambiguous");r[a]=n}var o=e.length,l=e.charAt(0),c=Math.log(o)/Math.log(256),d=Math.log(256)/Math.log(o);function u(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[0]){for(var i=0,n=0;e[t]===l;)i++,t++;for(var s=(e.length-t)*c+1>>>0,a=new Uint8Array(s);e[t];){var d=r[e.charCodeAt(t)];if(255===d)return;for(var u=0,h=s-1;(0!==d||u<n)&&-1!==h;h--,u++)d+=o*a[h]>>>0,a[h]=d%256>>>0,d=d/256>>>0;if(0!==d)throw Error("Non-zero carry");n=u,t++}if(" "!==e[t]){for(var p=s-n;p!==s&&0===a[p];)p++;for(var f=new Uint8Array(i+(s-p)),y=i;p!==s;)f[y++]=a[p++];return f}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,i=0,n=0,s=t.length;n!==s&&0===t[n];)n++,r++;for(var a=(s-n)*d+1>>>0,c=new Uint8Array(a);n!==s;){for(var u=t[n],h=0,p=a-1;(0!==u||h<i)&&-1!==p;p--,h++)u+=256*c[p]>>>0,c[p]=u%o>>>0,u=u/o>>>0;if(0!==u)throw Error("Non-zero carry");i=h,n++}for(var f=a-i;f!==a&&0===c[f];)f++;for(var y=l.repeat(r);f<a;++f)y+=e.charAt(c[f]);return y},decodeUnsafe:u,decode:function(e){var r=u(e);if(r)return r;throw Error(`Non-${t} character`)}}};let mJ=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error("Unknown type, must be binary type")};class mZ{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class mG{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return mQ(this,e)}}class mY{constructor(e){this.decoders=e}or(e){return mQ(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let mQ=(e,t)=>new mY({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class mX{constructor(e,t,r,i){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=i,this.encoder=new mZ(e,t,r),this.decoder=new mG(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}let m0=({name:e,prefix:t,encode:r,decode:i})=>new mX(e,t,r,i),m1=({prefix:e,name:t,alphabet:r})=>{let{encode:i,decode:n}=mV(r,t);return m0({prefix:e,name:t,encode:i,decode:e=>mJ(n(e))})},m2=({name:e,prefix:t,bitsPerChar:r,alphabet:i})=>m0({prefix:t,name:e,encode:e=>((e,t,r)=>{let i="="===t[t.length-1],n=(1<<r)-1,s="",a=0,o=0;for(let i=0;i<e.length;++i)for(o=o<<8|e[i],a+=8;a>r;)a-=r,s+=t[n&o>>a];if(a&&(s+=t[n&o<<r-a]),i)for(;s.length*r&7;)s+="=";return s})(e,i,r),decode:t=>((e,t,r,i)=>{let n={};for(let e=0;e<t.length;++e)n[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;let a=new Uint8Array(s*r/8|0),o=0,l=0,c=0;for(let t=0;t<s;++t){let s=n[e[t]];if(void 0===s)throw SyntaxError(`Non-${i} character`);l=l<<r|s,(o+=r)>=8&&(o-=8,a[c++]=255&l>>o)}if(o>=r||255&l<<8-o)throw SyntaxError("Unexpected end of data");return a})(t,i,r,e)});var m3=Object.freeze({__proto__:null,identity:m0({prefix:"\0",name:"identity",encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)})}),m5=Object.freeze({__proto__:null,base2:m2({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})}),m8=Object.freeze({__proto__:null,base8:m2({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})}),m6=Object.freeze({__proto__:null,base10:m1({prefix:"9",name:"base10",alphabet:"0123456789"})}),m4=Object.freeze({__proto__:null,base16:m2({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper:m2({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})}),m7=Object.freeze({__proto__:null,base32:m2({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper:m2({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad:m2({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper:m2({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex:m2({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper:m2({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad:m2({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper:m2({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z:m2({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})}),m9=Object.freeze({__proto__:null,base36:m1({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper:m1({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})}),we=Object.freeze({__proto__:null,base58btc:m1({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr:m1({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})}),wt=Object.freeze({__proto__:null,base64:m2({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad:m2({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url:m2({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad:m2({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});let wr=Array.from(""),wi=wr.reduce((e,t,r)=>(e[r]=t,e),[]),wn=wr.reduce((e,t,r)=>(e[t.codePointAt(0)]=r,e),[]);var ws=Object.freeze({__proto__:null,base256emoji:m0({prefix:"",name:"base256emoji",encode:function(e){return e.reduce((e,t)=>e+=wi[t],"")},decode:function(e){let t=[];for(let r of e){let e=wn[r.codePointAt(0)];if(void 0===e)throw Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}})});function wa(e,t,r){t=t||[],r=r||0;for(var i=r;e>=0x80000000;)t[r++]=255&e|128,e/=128;for(;-128&e;)t[r++]=255&e|128,e>>>=7;return t[r]=0|e,wa.bytes=r-i+1,t}var wo=function(e){return e<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:e<0x800000000?5:e<0x40000000000?6:e<0x2000000000000?7:e<0x100000000000000?8:e<0x8000000000000000?9:10};let wl=(e,t,r=0)=>(wa(e,t,r),t),wc=(e,t)=>{let r=t.byteLength,i=wo(e),n=i+wo(r),s=new Uint8Array(n+r);return wl(e,s,0),wl(r,s,i),s.set(t,n),new wd(e,r,t,s)};class wd{constructor(e,t,r,i){this.code=e,this.size=t,this.digest=r,this.bytes=i}}let wu=({name:e,code:t,encode:r})=>new wh(e,t,r);class wh{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?wc(this.code,t):t.then(e=>wc(this.code,e))}throw Error("Unknown type, must be binary type")}}let wp=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t));var wf=Object.freeze({__proto__:null,sha256:wu({name:"sha2-256",code:18,encode:wp("SHA-256")}),sha512:wu({name:"sha2-512",code:19,encode:wp("SHA-512")})}),wy=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:mJ,digest:e=>wc(0,mJ(e))}});new TextEncoder,new TextDecoder;let wg={...m3,...m5,...m8,...m6,...m4,...m7,...m9,...we,...wt,...ws};function wm(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function ww(e,t,r,i){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:i}}}({...wf,...wy});let wb=ww("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),wv=ww("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{let t=function(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?wm(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),wE={utf8:wb,"utf-8":wb,hex:wg.base16,latin1:wv,ascii:wv,binary:wv,...wg};var w_=Object.defineProperty,wA=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?w_(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class wS{constructor(e,t){this.core=e,this.logger=t,wA(this,"keychain",new Map),wA(this,"name","keychain"),wA(this,"version","0.3"),wA(this,"initialized",!1),wA(this,"storagePrefix",mh),wA(this,"init",async()=>{if(!this.initialized){let e=await this.getKeyChain();"u">typeof e&&(this.keychain=e),this.initialized=!0}}),wA(this,"has",e=>(this.isInitialized(),this.keychain.has(e))),wA(this,"set",async(e,t)=>{this.isInitialized(),this.keychain.set(e,t),await this.persist()}),wA(this,"get",e=>{this.isInitialized();let t=this.keychain.get(e);if(typeof t>"u"){let{message:t}=gT("NO_MATCHING_KEY",`${this.name}: ${e}`);throw Error(t)}return t}),wA(this,"del",async e=>{this.isInitialized(),this.keychain.delete(e),await this.persist()}),this.core=e,this.logger=uR(t,this.name)}get context(){return uO(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,u3(e))}async getKeyChain(){let e=await this.core.storage.getItem(this.storageKey);return"u">typeof e?u5(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:e}=gT("NOT_INITIALIZED",this.name);throw Error(e)}}}var wx=Object.defineProperty,wI=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?wx(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class wk{constructor(e,t,r){this.core=e,this.logger=t,wI(this,"name","crypto"),wI(this,"keychain"),wI(this,"randomSessionIdentifier",yQ()),wI(this,"initialized",!1),wI(this,"clientId"),wI(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),wI(this,"hasKeys",e=>(this.isInitialized(),this.keychain.has(e))),wI(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;let e=await this.getClientSeed(),t=ui.generateKeyPair(e),r=ui.encodeIss(t.publicKey);return this.clientId=r,r}),wI(this,"generateKeyPair",()=>{let e,t;this.isInitialized();let r=(e=yI.utils.randomPrivateKey(),t=yI.getPublicKey(e),{privateKey:(0,un.toString)(e,yJ),publicKey:(0,un.toString)(t,yJ)});return this.setPrivateKey(r.publicKey,r.privateKey)}),wI(this,"signJWT",async e=>{this.isInitialized();let t=await this.getClientSeed(),r=ui.generateKeyPair(t),i=this.randomSessionIdentifier;return await ui.signJWT(i,e,my,r)}),wI(this,"generateSharedKey",(e,t,r)=>{var i,n,s;let a,o;this.isInitialized();let l=(i=this.getPrivateKey(e),a=yI.getSharedSecret((0,us.fromString)(i,yJ),(0,us.fromString)(t,yJ)),n=void 0,o=function(e,t,r,i=32){hO(e),hC(i);let n=e.outputLen;if(i>255*n)throw Error("Length should be <= 255*HashLen");let s=Math.ceil(i/n);void 0===r&&(r=fI);let a=new Uint8Array(s*n),o=fS.create(e,t),l=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let e=0;e<s;e++)fx[0]=e+1,l.update(0===e?fI:c).update(r).update(fx).digestInto(c),a.set(c,n*e),o._cloneInto(l);return o.destroy(),l.destroy(),hU(c,fx),a.slice(0,i)}(pE,(s=void 0,hO(pE),void 0===s&&(s=new Uint8Array(pE.outputLen)),fS(pE,hJ(s),hJ(a))),n,32),(0,un.toString)(o,yJ));return this.setSymKey(l,r)}),wI(this,"setSymKey",async(e,t)=>{this.isInitialized();let r=t||yX(e);return await this.keychain.set(r,e),r}),wI(this,"deleteKeyPair",async e=>{this.isInitialized(),await this.keychain.del(e)}),wI(this,"deleteSymKey",async e=>{this.isInitialized(),await this.keychain.del(e)}),wI(this,"encode",async(e,t,r)=>{this.isInitialized();let i=y4(r),n=(0,ud.safeJsonStringify)(t);if(2===i.type){var s;let e,t,i;return s=r?.encoding,e=y1(2),t=hQ(12),i=y8({type:e,sealed:(0,us.fromString)(n,yY),iv:t}),s===yG?y3(i):i}if(y7(i)){let t=i.senderPublicKey,r=i.receiverPublicKey;e=await this.generateSharedKey(t,r)}let a=this.getSymKey(e),{type:o,senderPublicKey:l}=i;return function(e){let t=y1("u">typeof e.type?e.type:0);if(1===y2(t)&&typeof e.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");let r="u">typeof e.senderPublicKey?(0,us.fromString)(e.senderPublicKey,yJ):void 0,i="u">typeof e.iv?(0,us.fromString)(e.iv,yJ):hQ(12),n=y8({type:t,sealed:f_((0,us.fromString)(e.symKey,yJ),i).encrypt((0,us.fromString)(e.message,yY)),iv:i,senderPublicKey:r});return e.encoding===yG?y3(n):n}({type:o,symKey:a,message:n,senderPublicKey:l,encoding:r?.encoding})}),wI(this,"decode",async(e,t,r)=>{let i;this.isInitialized();let n=y4({type:y2((i=y6({encoded:t,encoding:r?.encoding})).type),senderPublicKey:"u">typeof i.senderPublicKey?(0,un.toString)(i.senderPublicKey,yJ):void 0,receiverPublicKey:r?.receiverPublicKey});if(2===n.type){let e=function(e,t){let{sealed:r}=y6({encoded:e,encoding:t});return(0,un.toString)(r,yY)}(t,r?.encoding);return(0,ud.safeJsonParse)(e)}if(y7(n)){let t=n.receiverPublicKey,r=n.senderPublicKey;e=await this.generateSharedKey(t,r)}try{let i=this.getSymKey(e),n=function(e){let t=(0,us.fromString)(e.symKey,yJ),{sealed:r,iv:i}=y6({encoded:e.encoded,encoding:e.encoding}),n=f_(t,i).decrypt(r);if(null===n)throw Error("Failed to decrypt");return(0,un.toString)(n,yY)}({symKey:i,encoded:t,encoding:r?.encoding});return(0,ud.safeJsonParse)(n)}catch(t){this.logger.error(`Failed to decode message from topic: '${e}', clientId: '${await this.getClientId()}'`),this.logger.error(t)}}),wI(this,"getPayloadType",(e,t=yZ)=>y2(y6({encoded:e,encoding:t}).type)),wI(this,"getPayloadSenderPublicKey",(e,t=yZ)=>{let r=y6({encoded:e,encoding:t});return r.senderPublicKey?(0,un.toString)(r.senderPublicKey,yJ):void 0}),this.core=e,this.logger=uR(t,this.name),this.keychain=r||new wS(this.core,this.logger)}get context(){return uO(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(mf)}catch{e=yQ(),await this.keychain.set(mf,e)}return function(e,t="utf8"){let r=wE[t];if(!r)throw Error(`Unsupported encoding "${t}"`);return("utf8"===t||"utf-8"===t)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?wm(globalThis.Buffer.from(e,"utf-8")):r.decoder.decode(`${r.prefix}${e}`)}(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){let{message:e}=gT("NOT_INITIALIZED",this.name);throw Error(e)}}}var wT=Object.defineProperty,wC=Object.defineProperties,wP=Object.getOwnPropertyDescriptors,wO=Object.getOwnPropertySymbols,wR=Object.prototype.hasOwnProperty,wN=Object.prototype.propertyIsEnumerable,wM=(e,t,r)=>t in e?wT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,wU=(e,t,r)=>wM(e,"symbol"!=typeof t?t+"":t,r);class wD extends g5{constructor(e,t){super(e,t),this.logger=e,this.core=t,wU(this,"messages",new Map),wU(this,"messagesWithoutClientAck",new Map),wU(this,"name","messages"),wU(this,"version","0.3"),wU(this,"initialized",!1),wU(this,"storagePrefix",mh),wU(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let e=await this.getRelayerMessages();"u">typeof e&&(this.messages=e);let t=await this.getRelayerMessagesWithoutClientAck();"u">typeof t&&(this.messagesWithoutClientAck=t),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}finally{this.initialized=!0}}}),wU(this,"set",async(e,t,r)=>{this.isInitialized();let i=y0(t),n=this.messages.get(e);if(typeof n>"u"&&(n={}),"u">typeof n[i])return i;if(n[i]=t,this.messages.set(e,n),r===mC){let r=this.messagesWithoutClientAck.get(e)||{};this.messagesWithoutClientAck.set(e,wC(((e,t)=>{for(var r in t||(t={}))wR.call(t,r)&&wM(e,r,t[r]);if(wO)for(var r of wO(t))wN.call(t,r)&&wM(e,r,t[r]);return e})({},r),wP({[i]:t})))}return await this.persist(),i}),wU(this,"get",e=>{this.isInitialized();let t=this.messages.get(e);return typeof t>"u"&&(t={}),t}),wU(this,"getWithoutAck",e=>{this.isInitialized();let t={};for(let r of e){let e=this.messagesWithoutClientAck.get(r)||{};t[r]=Object.values(e)}return t}),wU(this,"has",(e,t)=>(this.isInitialized(),"u">typeof this.get(e)[y0(t)])),wU(this,"ack",async(e,t)=>{this.isInitialized();let r=this.messagesWithoutClientAck.get(e);if(typeof r>"u")return;let i=y0(t);delete r[i],0===Object.keys(r).length?this.messagesWithoutClientAck.delete(e):this.messagesWithoutClientAck.set(e,r),await this.persist()}),wU(this,"del",async e=>{this.isInitialized(),this.messages.delete(e),this.messagesWithoutClientAck.delete(e),await this.persist()}),this.logger=uR(e,this.name),this.core=t}get context(){return uO(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,u3(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,u3(e))}async getRelayerMessages(){let e=await this.core.storage.getItem(this.storageKey);return"u">typeof e?u5(e):void 0}async getRelayerMessagesWithoutClientAck(){let e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return"u">typeof e?u5(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:e}=gT("NOT_INITIALIZED",this.name);throw Error(e)}}}var wL=Object.defineProperty,wj=Object.defineProperties,wB=Object.getOwnPropertyDescriptors,wW=Object.getOwnPropertySymbols,wF=Object.prototype.hasOwnProperty,wH=Object.prototype.propertyIsEnumerable,wq=(e,t,r)=>t in e?wL(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,wz=(e,t)=>{for(var r in t||(t={}))wF.call(t,r)&&wq(e,r,t[r]);if(wW)for(var r of wW(t))wH.call(t,r)&&wq(e,r,t[r]);return e},w$=(e,t,r)=>wq(e,"symbol"!=typeof t?t+"":t,r);class wK extends g8{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,w$(this,"events",new oU.EventEmitter),w$(this,"name","publisher"),w$(this,"queue",new Map),w$(this,"publishTimeout",(0,oL.toMiliseconds)(oL.ONE_MINUTE)),w$(this,"initialPublishTimeout",(0,oL.toMiliseconds)(15*oL.ONE_SECOND)),w$(this,"needsTransportRestart",!1),w$(this,"publish",async(e,t,r)=>{var i,n,s,a,o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,message:t,opts:r}});let l=r?.ttl||mg,c=r?.prompt||!1,d=r?.tag||0,u=r?.id||(0,ml.getBigIntRpcId)().toString(),h=ge(y9().protocol),p={id:u,method:r?.publishMethod||h.publish,params:wz({topic:e,message:t,ttl:l,prompt:c,tag:d,attestation:r?.attestation},r?.tvf)},f=`Failed to publish payload, please try again. id:${u} tag:${d}`;try{gR(null==(i=p.params)?void 0:i.prompt)&&(null==(n=p.params)||delete n.prompt),gR(null==(s=p.params)?void 0:s.tag)&&(null==(a=p.params)||delete a.tag);let o=new Promise(async e=>{let t=({id:r})=>{var i;(null==(i=p.id)?void 0:i.toString())===r.toString()&&(this.removeRequestFromQueue(r),this.relayer.events.removeListener(mE,t),e())};this.relayer.events.on(mE,t);let i=u6(new Promise((e,t)=>{this.rpcPublish(p,r).then(e).catch(e=>{this.logger.warn(e,e?.message),t(e)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${u} tag:${d}`);try{await i,this.events.removeListener(mE,t)}catch(e){this.queue.set(u,{request:p,opts:r,attempt:1}),this.logger.warn(e,e?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:u,topic:e,message:t,opts:r}}),await u6(o,this.publishTimeout,f)}catch(e){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(e),null!=(o=r?.internal)&&o.throwOnFailedPublish)throw e}finally{this.queue.delete(u)}}),w$(this,"publishCustom",async e=>{var t,r,i,n,s;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:e});let{payload:a,opts:o={}}=e,{attestation:l,tvf:c,publishMethod:d,prompt:u,tag:h,ttl:p=oL.FIVE_MINUTES}=o,f=o.id||(0,ml.getBigIntRpcId)().toString(),y=ge(y9().protocol),g=d||y.publish,m={id:f,method:g,params:wz(wj(wz({},a),wB({ttl:p,prompt:u,tag:h,attestation:l})),c)},w=`Failed to publish custom payload, please try again. id:${f} tag:${h}`;try{gR(null==(t=m.params)?void 0:t.prompt)&&(null==(r=m.params)||delete r.prompt),gR(null==(i=m.params)?void 0:i.tag)&&(null==(n=m.params)||delete n.tag);let e=new Promise(async e=>{let t=({id:r})=>{var i;(null==(i=m.id)?void 0:i.toString())===r.toString()&&(this.removeRequestFromQueue(r),this.relayer.events.removeListener(mE,t),e())};this.relayer.events.on(mE,t);let r=u6(new Promise((e,t)=>{this.rpcPublish(m,o).then(e).catch(e=>{this.logger.warn(e,e?.message),t(e)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${g} id:${f} tag:${h}`);try{await r,this.events.removeListener(mE,t)}catch(e){this.queue.set(f,{request:m,opts:o,attempt:1}),this.logger.warn(e,e?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:f,payload:a,opts:o}}),await u6(e,this.publishTimeout,w)}catch(e){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(e),null!=(s=o?.internal)&&s.throwOnFailedPublish)throw e}finally{this.queue.delete(f)}}),w$(this,"on",(e,t)=>{this.events.on(e,t)}),w$(this,"once",(e,t)=>{this.events.once(e,t)}),w$(this,"off",(e,t)=>{this.events.off(e,t)}),w$(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.relayer=e,this.logger=uR(t,this.name),this.registerEventListeners()}get context(){return uO(this.logger)}async rpcPublish(e,t){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});let r=await this.relayer.request(e);return this.relayer.events.emit(mE,wz(wz({},e),t)),this.logger.debug("Successfully Published Payload"),r}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{var r;let i=e.attempt+1;this.queue.set(t,wj(wz({},e),wB({attempt:i}))),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${null==(r=e.request.params)?void 0:r.tag}, attempt: ${i}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(gG.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(mv);return}this.checkQueue()}),this.relayer.on(mb,e=>{this.removeRequestFromQueue(e.id.toString())})}}var wV=Object.defineProperty,wJ=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?wV(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class wZ{constructor(){wJ(this,"map",new Map),wJ(this,"set",(e,t)=>{let r=this.get(e);this.exists(e,t)||this.map.set(e,[...r,t])}),wJ(this,"get",e=>this.map.get(e)||[]),wJ(this,"exists",(e,t)=>this.get(e).includes(t)),wJ(this,"delete",(e,t)=>{if(typeof t>"u")return void this.map.delete(e);if(!this.map.has(e))return;let r=this.get(e);if(!this.exists(e,t))return;let i=r.filter(e=>e!==t);i.length?this.map.set(e,i):this.map.delete(e)}),wJ(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var wG=Object.defineProperty,wY=Object.defineProperties,wQ=Object.getOwnPropertyDescriptors,wX=Object.getOwnPropertySymbols,w0=Object.prototype.hasOwnProperty,w1=Object.prototype.propertyIsEnumerable,w2=(e,t,r)=>t in e?wG(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,w3=(e,t)=>{for(var r in t||(t={}))w0.call(t,r)&&w2(e,r,t[r]);if(wX)for(var r of wX(t))w1.call(t,r)&&w2(e,r,t[r]);return e},w5=(e,t,r)=>w2(e,"symbol"!=typeof t?t+"":t,r);class w8 extends g7{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,w5(this,"subscriptions",new Map),w5(this,"topicMap",new wZ),w5(this,"events",new oU.EventEmitter),w5(this,"name","subscription"),w5(this,"version","0.3"),w5(this,"pending",new Map),w5(this,"cached",[]),w5(this,"initialized",!1),w5(this,"storagePrefix",mh),w5(this,"subscribeTimeout",(0,oL.toMiliseconds)(oL.ONE_MINUTE)),w5(this,"initialSubscribeTimeout",(0,oL.toMiliseconds)(15*oL.ONE_SECOND)),w5(this,"clientId"),w5(this,"batchSubscribeTopicsLimit",500),w5(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),w5(this,"subscribe",async(e,t)=>{var r;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}});try{let i=y9(t),n={topic:e,relay:i,transportType:t?.transportType};null!=(r=t?.internal)&&r.skipSubscribe||this.pending.set(e,n);let s=await this.rpcSubscribe(e,i,t);return"string"==typeof s&&(this.onSubscribe(s,n),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}})),s}catch(e){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(e),e}}),w5(this,"unsubscribe",async(e,t)=>{this.isInitialized(),"u">typeof t?.id?await this.unsubscribeById(e,t.id,t):await this.unsubscribeByTopic(e,t)}),w5(this,"isSubscribed",e=>new Promise(t=>{t(this.topicMap.topics.includes(e))})),w5(this,"isKnownTopic",e=>new Promise(t=>{t(this.topicMap.topics.includes(e)||this.pending.has(e)||this.cached.some(t=>t.topic===e))})),w5(this,"on",(e,t)=>{this.events.on(e,t)}),w5(this,"once",(e,t)=>{this.events.once(e,t)}),w5(this,"off",(e,t)=>{this.events.off(e,t)}),w5(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),w5(this,"start",async()=>{await this.onConnect()}),w5(this,"stop",async()=>{await this.onDisconnect()}),w5(this,"restart",async()=>{await this.restore(),await this.onRestart()}),w5(this,"checkPending",async()=>{if(0===this.pending.size&&(!this.initialized||!this.relayer.connected))return;let e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}),w5(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(gG.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.events.on(mO,async e=>{this.logger.info(`Emitting ${mO}`),this.logger.debug({type:"event",event:mO,data:e}),await this.persist()}),this.events.on(mR,async e=>{this.logger.info(`Emitting ${mR}`),this.logger.debug({type:"event",event:mR,data:e}),await this.persist()})}),this.relayer=e,this.logger=uR(t,this.name),this.clientId=""}get context(){return uO(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let r=!1;try{r=this.getSubscription(e).topic===t}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){let r=this.topicMap.get(e);await Promise.all(r.map(async r=>await this.unsubscribeById(e,r,t)))}async unsubscribeById(e,t,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}});try{let i=y9(r);await this.restartToComplete({topic:e,id:t,relay:i}),await this.rpcUnsubscribe(e,t,i);let n=gC("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}})}catch(e){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(e),e}}async rpcSubscribe(e,t,r){var i,n;let s=await this.getSubscriptionId(e);if(null!=(i=r?.internal)&&i.skipSubscribe)return s;r&&r?.transportType!==mT||await this.restartToComplete({topic:e,id:e,relay:t});let a={method:ge(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});let o=null==(n=r?.internal)?void 0:n.throwOnFailedPublish;try{if(r?.transportType===mk)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(e=>this.logger.warn(e))},(0,oL.toMiliseconds)(oL.ONE_SECOND)),s;let t=new Promise(async t=>{let r=i=>{i.topic===e&&(this.events.removeListener(mO,r),t(i.id))};this.events.on(mO,r);try{let i=await u6(new Promise((e,t)=>{this.relayer.request(a).catch(e=>{this.logger.warn(e,e?.message),t(e)}).then(e)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(mO,r),t(i)}catch{}}),i=await u6(t,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!i&&o)throw Error(`Subscribing to ${e} failed, please try again`);return i?s:null}catch(e){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(mv),o)throw e}return null}async rpcBatchSubscribe(e){if(!e.length)return;let t={method:ge(e[0].relay.protocol).batchSubscribe,params:{topics:e.map(e=>e.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:t});try{await await u6(new Promise(e=>{this.relayer.request(t).catch(e=>this.logger.warn(e)).then(e)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(mv)}}async rpcBatchFetchMessages(e){let t;if(!e.length)return;let r={method:ge(e[0].relay.protocol).batchFetchMessages,params:{topics:e.map(e=>e.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{t=await await u6(new Promise((e,t)=>{this.relayer.request(r).catch(e=>{this.logger.warn(e),t(e)}).then(e)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(mv)}return t}rpcUnsubscribe(e,t,r){let i={method:ge(r.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,t){this.setSubscription(e,wY(w3({},t),wQ({id:e}))),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(e=>{this.setSubscription(e.id,w3({},e)),this.pending.delete(e.topic)})}async onUnsubscribe(e,t,r){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,w3({},t)),this.topicMap.set(t.topic,e),this.events.emit(mO,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});let t=this.subscriptions.get(e);if(!t){let{message:t}=gT("NO_MATCHING_KEY",`${this.name}: ${e}`);throw Error(t)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});let r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(mR,wY(w3({},r),wQ({reason:t})))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit("subscription_sync")}async onRestart(){if(this.cached.length){let e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){let t=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(t)}}this.events.emit("subscription_resubscribed")}async restore(){try{let e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(e=>{var t;return e.topic===(null==(t=this.subscriptions.get(e.id))?void 0:t.topic)})){let{message:e}=gT("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async e=>wY(w3({},e),wQ({id:await this.getSubscriptionId(e.topic)}))))))}async batchFetchMessages(e){var t;if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);let r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await (t=(0,oL.toMiliseconds)(oL.ONE_SECOND),new Promise(e=>setTimeout(e,t))),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:e}=gT("NOT_INITIALIZED",this.name);throw Error(e)}}async restartToComplete(e){this.relayer.connected||this.relayer.connecting||(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return y0(e+await this.getClientId())}}var w6=Object.defineProperty,w4=Object.getOwnPropertySymbols,w7=Object.prototype.hasOwnProperty,w9=Object.prototype.propertyIsEnumerable,be=(e,t,r)=>t in e?w6(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,bt=(e,t)=>{for(var r in t||(t={}))w7.call(t,r)&&be(e,r,t[r]);if(w4)for(var r of w4(t))w9.call(t,r)&&be(e,r,t[r]);return e},br=(e,t,r)=>be(e,"symbol"!=typeof t?t+"":t,r);class bi extends g6{constructor(t){var r;super(t),br(this,"protocol","wc"),br(this,"version",2),br(this,"core"),br(this,"logger"),br(this,"events",new oU.EventEmitter),br(this,"provider"),br(this,"messages"),br(this,"subscriber"),br(this,"publisher"),br(this,"name","relayer"),br(this,"transportExplicitlyClosed",!1),br(this,"initialized",!1),br(this,"connectionAttemptInProgress",!1),br(this,"relayUrl"),br(this,"projectId"),br(this,"packageName"),br(this,"bundleId"),br(this,"hasExperiencedNetworkDisruption",!1),br(this,"pingTimeout"),br(this,"heartBeatTimeout",(0,oL.toMiliseconds)(oL.THIRTY_SECONDS+oL.FIVE_SECONDS)),br(this,"reconnectTimeout"),br(this,"connectPromise"),br(this,"reconnectInProgress",!1),br(this,"requestsInFlight",[]),br(this,"connectTimeout",(0,oL.toMiliseconds)(15*oL.ONE_SECOND)),br(this,"request",async e=>{var t,r;this.logger.debug("Publishing Request Payload");let i=e.id||(0,ml.getBigIntRpcId)().toString();await this.toEstablishConnection();try{this.logger.trace({id:i,method:e.method,topic:null==(t=e.params)?void 0:t.topic},"relayer.request - publishing...");let n=`${i}:${(null==(r=e.params)?void 0:r.tag)||""}`;this.requestsInFlight.push(n);let s=await this.provider.request(e);return this.requestsInFlight=this.requestsInFlight.filter(e=>e!==n),s}catch(e){throw this.logger.debug(`Failed to Publish Request: ${i}`),e}}),br(this,"resetPingTimeout",()=>{uZ()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var e,t,r,i;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(i=null==(r=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:r.terminate)||i.call(r)}catch(e){this.logger.warn(e,e?.message)}},this.heartBeatTimeout))}),br(this,"onPayloadHandler",e=>{this.onProviderPayload(e),this.resetPingTimeout()}),br(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit("relayer_connect")}),br(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),br(this,"onProviderErrorHandler",e=>{this.logger.fatal(`Fatal socket error: ${e.message}`),this.events.emit("relayer_error",e),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),br(this,"registerProviderListeners",()=>{this.provider.on(m_,this.onPayloadHandler),this.provider.on(mA,this.onConnectHandler),this.provider.on(mS,this.onDisconnectHandler),this.provider.on(mx,this.onProviderErrorHandler)}),this.core=t.core,this.logger=gZ({logger:null!=(r=t.logger)?r:"error",name:this.name}),this.messages=new wD(this.logger,t.core),this.subscriber=new w8(this,this.logger),this.publisher=new wK(this,this.logger),this.projectId=t?.projectId,this.relayUrl=t?.relayUrl||mm,uG()&&"u">typeof(null==e.g?void 0:e.g.Platform)&&(null==e.g?void 0:e.g.Platform.OS)==="android"?this.packageName=uX():uG()&&"u">typeof(null==e.g?void 0:e.g.Platform)&&(null==e.g?void 0:e.g.Platform.OS)==="ios"&&(this.bundleId=uX()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return uO(this.logger)}get connected(){var e,t,r;return(null==(r=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:r.readyState)===1}get connecting(){var e,t,r;return(null==(r=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:r.readyState)===0||void 0!==this.connectPromise}async publish(e,t,r){this.isInitialized(),await this.publisher.publish(e,t,r),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:mT},"outbound")}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,t){var r,i,n;this.isInitialized(),null!=t&&t.transportType&&t?.transportType!=="relay"||await this.toEstablishConnection();let s=typeof(null==(r=t?.internal)?void 0:r.throwOnFailedPublish)>"u"||(null==(i=t?.internal)?void 0:i.throwOnFailedPublish),a=(null==(n=this.subscriber.topicMap.get(e))?void 0:n[0])||"",o,l=t=>{t.topic===e&&(this.subscriber.off(mO,l),o())};return await Promise.all([new Promise(e=>{o=e,this.subscriber.on(mO,l)}),new Promise(async(r,i)=>{a=await this.subscriber.subscribe(e,bt({internal:{throwOnFailedPublish:s}},t)).catch(e=>{s&&i(e)})||a,r()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await u6(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics)return void this.logger.info("Starting WS connection skipped because the client has no topics to work with.");if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,r)=>{await this.connect(e).then(t).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),this.connectionAttemptInProgress||(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await gz())throw Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0)return void this.logger.trace("Batch message events is empty. Ignoring...");let t=e.sort((e,t)=>e.publishedAt-t.publishedAt);for(let e of(this.logger.debug(`Batch of ${t.length} message events sorted`),t))try{await this.onMessageEvent(e)}catch(e){this.logger.warn(e,"Error while processing batch message event: "+e?.message)}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){let{topic:r}=e;if(!t.sessionExists){let e=u9(oL.FIVE_MINUTES);await this.core.pairing.pairings.set(r,{topic:r,expiry:e,relay:{protocol:"irn"},active:!1})}this.events.emit(mw,e),await this.recordMessageEvent(e,mC)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(e,t)=>{let r=()=>{t(Error("Connection interrupted while trying to connect"))};this.provider.once(mS,r),await u6(new Promise((e,t)=>{this.provider.connect().then(e).catch(t)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(e=>{t(e)}).finally(()=>{this.provider.off(mS,r),clearTimeout(this.reconnectTimeout)}),await new Promise(async(e,r)=>{let i=()=>{t(Error("Connection interrupted while trying to subscribe"))};this.provider.once(mS,i),await this.subscriber.start().then(e).catch(r).finally(()=>{this.provider.off(mS,i)})}),this.hasExperiencedNetworkDisruption=!1,e()})}catch(e){await this.subscriber.stop(),this.logger.warn({},e.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(e=>setTimeout(e,(0,oL.toMiliseconds)(+t))),t++}}startPingTimeout(){var e,t,r,i,n;if(uZ())try{null!=(t=null==(e=this.provider)?void 0:e.connection)&&t.socket&&(null==(n=null==(i=null==(r=this.provider)?void 0:r.connection)?void 0:i.socket)||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(e){this.logger.warn(e,e?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new mo.JsonRpcProvider(new md.default(function({protocol:e,version:t,relayUrl:r,sdkVersion:i,auth:n,projectId:s,useOnCloseEvent:a,bundleId:o,packageName:l}){var c,d;let u,h=r.split("?"),p=u1(e,t,i),f=(c=h[1]||"",d={auth:n,ua:p,projectId:s,useOnCloseEvent:a||void 0,packageName:l||void 0,bundleId:o||void 0},u=new URLSearchParams(c),Object.entries(d).sort(([e],[t])=>e.localeCompare(t)).forEach(([e,t])=>{null!=t&&u.set(e,String(t))}),u.toString());return h[0]+"?"+f}({sdkVersion:mI,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){let{topic:r,message:i}=e;await this.messages.set(r,i,t)}async shouldIgnoreMessageEvent(e){let{topic:t,message:r}=e;if(!r||0===r.length)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;let i=this.messages.has(t,r);return i&&this.logger.warn(`Ignoring duplicate message: ${r}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),(0,mc.isJsonRpcRequest)(e)){if(!e.method.endsWith("_subscription"))return;let t=e.params,{topic:r,message:i,publishedAt:n,attestation:s}=t.data,a={topic:r,message:i,publishedAt:n,transportType:mT,attestation:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(bt({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else(0,mc.isJsonRpcResponse)(e)&&this.events.emit(mb,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,mC),this.events.emit(mw,e))}async acknowledgePayload(e){let t=(0,ml.formatJsonRpcResult)(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(m_,this.onPayloadHandler),this.provider.off(mA,this.onConnectHandler),this.provider.off(mS,this.onDisconnectHandler),this.provider.off(mx,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let t=await gz();(function(t){var r,i;switch(uQ()){case uJ:r=t,!uG()&&uY()&&(window.addEventListener("online",()=>r(!0)),window.addEventListener("offline",()=>r(!1)));break;case uK:i=t,uG()&&null!=e.g&&e.g.NetInfo&&e.g?.NetInfo.addEventListener(e=>i(e?.isConnected))}})(async e=>{t!==e&&(t=e,e?await this.transportOpen().catch(e=>this.logger.error(e,e?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(gG.HEARTBEAT_EVENTS.pulse,async()=>{var e;if(!this.transportExplicitlyClosed&&!this.connected&&(!(uY()&&(0,oj.getDocument)())||(null==(e=(0,oj.getDocument)())?void 0:e.visibilityState)==="visible"))try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit("relayer_disconnect"),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,oL.toMiliseconds)(.1)))))}isInitialized(){if(!this.initialized){let{message:e}=gT("NOT_INITIALIZED",this.name);throw Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise)return void await this.connectPromise;await this.connect()}}}function bn(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function bs(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}let ba="[object Arguments]",bo="[object Object]";function bl(){}function bc(e){if(!e||"object"!=typeof e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&"[object Object]"===Object.prototype.toString.call(e)}var bd=Object.defineProperty,bu=Object.getOwnPropertySymbols,bh=Object.prototype.hasOwnProperty,bp=Object.prototype.propertyIsEnumerable,bf=(e,t,r)=>t in e?bd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,by=(e,t)=>{for(var r in t||(t={}))bh.call(t,r)&&bf(e,r,t[r]);if(bu)for(var r of bu(t))bp.call(t,r)&&bf(e,r,t[r]);return e},bg=(e,t,r)=>bf(e,"symbol"!=typeof t?t+"":t,r);class bm extends g4{constructor(e,t,r,i=mh,n){super(e,t,r,i),this.core=e,this.logger=t,this.name=r,bg(this,"map",new Map),bg(this,"version","0.3"),bg(this,"cached",[]),bg(this,"initialized",!1),bg(this,"getKey"),bg(this,"storagePrefix",mh),bg(this,"recentlyDeleted",[]),bg(this,"recentlyDeletedLimit",200),bg(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>{var t;this.getKey&&null!==e&&!gR(e)?this.map.set(this.getKey(e),e):(null==(t=e?.proposer)?void 0:t.publicKey)?this.map.set(e.id,e):e?.topic&&this.map.set(e.topic,e)}),this.cached=[],this.initialized=!0)}),bg(this,"set",async(e,t)=>{this.isInitialized(),this.map.has(e)?await this.update(e,t):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:e,value:t}),this.map.set(e,t),await this.persist())}),bg(this,"get",e=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:e}),this.getData(e))),bg(this,"getAll",e=>(this.isInitialized(),e?this.values.filter(t=>Object.keys(e).every(r=>{var i;return i=t[r],function e(t,r,i,n,s,a,o){let l=o(t,r,i,n,s,a);if(void 0!==l)return l;if(typeof t==typeof r)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return t===r;case"number":return t===r||Object.is(t,r)}return function t(r,i,n,s){if(Object.is(r,i))return!0;let a=bs(r),o=bs(i);if(a===ba&&(a=bo),o===ba&&(o=bo),a!==o)return!1;switch(a){case"[object String]":return r.toString()===i.toString();case"[object Number]":{let e=r.valueOf(),t=i.valueOf();return e===t||Number.isNaN(e)&&Number.isNaN(t)}case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(r.valueOf(),i.valueOf());case"[object RegExp]":return r.source===i.source&&r.flags===i.flags;case"[object Function]":return r===i}let l=(n=n??new Map).get(r),c=n.get(i);if(null!=l&&null!=c)return l===i;n.set(r,i),n.set(i,r);try{switch(a){case"[object Map]":if(r.size!==i.size)return!1;for(let[t,a]of r.entries())if(!i.has(t)||!e(a,i.get(t),t,r,i,n,s))return!1;return!0;case"[object Set]":{if(r.size!==i.size)return!1;let t=Array.from(r.values()),a=Array.from(i.values());for(let o=0;o<t.length;o++){let l=t[o],c=a.findIndex(t=>e(l,t,void 0,r,i,n,s));if(-1===c)return!1;a.splice(c,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if("u">typeof t3.Buffer&&t3.Buffer.isBuffer(r)!==t3.Buffer.isBuffer(i)||r.length!==i.length)return!1;for(let t=0;t<r.length;t++)if(!e(r[t],i[t],t,r,i,n,s))return!1;return!0;case"[object ArrayBuffer]":return r.byteLength===i.byteLength&&t(new Uint8Array(r),new Uint8Array(i),n,s);case"[object DataView]":return r.byteLength===i.byteLength&&r.byteOffset===i.byteOffset&&t(new Uint8Array(r),new Uint8Array(i),n,s);case"[object Error]":return r.name===i.name&&r.message===i.message;case bo:{if(!(t(r.constructor,i.constructor,n,s)||bc(r)&&bc(i)))return!1;let a=[...Object.keys(r),...bn(r)],o=[...Object.keys(i),...bn(i)];if(a.length!==o.length)return!1;for(let t=0;t<a.length;t++){let o=a[t],l=r[o];if(!Object.hasOwn(i,o))return!1;let c=i[o];if(!e(l,c,o,r,i,n,s))return!1}return!0}default:return!1}}finally{n.delete(r),n.delete(i)}}(t,r,a,o)}(i,e[r],void 0,void 0,void 0,void 0,bl)})):this.values)),bg(this,"update",async(e,t)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:e,update:t});let r=by(by({},this.getData(e)),t);this.map.set(e,r),await this.persist()}),bg(this,"delete",async(e,t)=>{this.isInitialized(),this.map.has(e)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:e,reason:t}),this.map.delete(e),this.addToRecentlyDeleted(e),await this.persist())}),this.logger=uR(t,this.name),this.storagePrefix=i,this.getKey=n}get context(){return uO(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){let t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){let{message:t}=gT("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(t),Error(t)}let{message:t}=gT("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(t),Error(t)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{let e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){let{message:e}=gT("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){let{message:e}=gT("NOT_INITIALIZED",this.name);throw Error(e)}}}var bw=Object.defineProperty,bb=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?bw(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class bv{constructor(e,t){this.core=e,this.logger=t,bb(this,"name","pairing"),bb(this,"version","0.3"),bb(this,"events",new oU.default),bb(this,"pairings"),bb(this,"initialized",!1),bb(this,"storagePrefix",mh),bb(this,"ignoredPayloadTypes",[1]),bb(this,"registeredMethods",[]),bb(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),bb(this,"register",({methods:e})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...e])]}),bb(this,"create",async e=>{this.isInitialized();let t=yQ(),r=await this.core.crypto.setSymKey(t),i=u9(oL.FIVE_MINUTES),n={protocol:"irn"},s={topic:r,expiry:i,relay:n,active:!1,methods:e?.methods},a=gd({protocol:this.core.protocol,version:this.core.version,topic:r,symKey:t,relay:n,expiryTimestamp:i,methods:e?.methods});return this.events.emit(mM,s),this.core.expirer.set(r,i),await this.pairings.set(r,s),await this.core.relayer.subscribe(r,{transportType:e?.transportType,internal:e?.internal}),{topic:r,uri:a}}),bb(this,"pair",async e=>{let t;this.isInitialized();let r=this.core.eventClient.createEvent({properties:{topic:e?.uri,trace:["pairing_started"]}});this.isValidPair(e,r);let{topic:i,symKey:n,relay:s,expiryTimestamp:a,methods:o}=gc(e.uri);if(r.props.properties.topic=i,r.addTrace("pairing_uri_validation_success"),r.addTrace("pairing_uri_not_expired"),this.pairings.keys.includes(i)){if(t=this.pairings.get(i),r.addTrace("existing_pairing"),t.active)throw r.setError("active_pairing_already_exists"),Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);r.addTrace("pairing_not_expired")}let l=a||u9(oL.FIVE_MINUTES),c={topic:i,relay:s,expiry:l,active:!1,methods:o};this.core.expirer.set(i,l),await this.pairings.set(i,c),r.addTrace("store_new_pairing"),e.activatePairing&&await this.activate({topic:i}),this.events.emit(mM,c),r.addTrace("emit_inactive_pairing"),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(n,i),r.addTrace("subscribing_pairing_topic");try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{r.setError("no_internet_connection")}try{await this.core.relayer.subscribe(i,{relay:s})}catch(e){throw r.setError("subscribe_pairing_topic_failure"),e}return r.addTrace("subscribe_pairing_topic_success"),c}),bb(this,"activate",async({topic:e})=>{this.isInitialized();let t=u9(oL.FIVE_MINUTES);this.core.expirer.set(e,t),await this.pairings.update(e,{active:!0,expiry:t})}),bb(this,"ping",async e=>{this.isInitialized(),await this.isValidPing(e),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:t}=e;if(this.pairings.keys.includes(t)){let e=await this.sendRequest(t,"wc_pairingPing",{}),{done:r,resolve:i,reject:n}=u8();this.events.once(ht("pairing_ping",e),({error:e})=>{e?n(e):i()}),await r()}}),bb(this,"updateExpiry",async({topic:e,expiry:t})=>{this.isInitialized(),await this.pairings.update(e,{expiry:t})}),bb(this,"updateMetadata",async({topic:e,metadata:t})=>{this.isInitialized(),await this.pairings.update(e,{peerMetadata:t})}),bb(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),bb(this,"disconnect",async e=>{this.isInitialized(),await this.isValidDisconnect(e);let{topic:t}=e;this.pairings.keys.includes(t)&&(await this.sendRequest(t,"wc_pairingDelete",gC("USER_DISCONNECTED")),await this.deletePairing(t))}),bb(this,"formatUriFromPairing",e=>{this.isInitialized();let{topic:t,relay:r,expiry:i,methods:n}=e,s=this.core.crypto.keychain.get(t);return gd({protocol:this.core.protocol,version:this.core.version,topic:t,symKey:s,relay:r,expiryTimestamp:i,methods:n})}),bb(this,"sendRequest",async(e,t,r)=>{let i=(0,ml.formatJsonRpcRequest)(t,r),n=await this.core.crypto.encode(e,i),s=mN[t].req;return this.core.history.set(e,i),this.core.relayer.publish(e,n,s),i.id}),bb(this,"sendResult",async(e,t,r)=>{let i=(0,ml.formatJsonRpcResult)(e,r),n=await this.core.crypto.encode(t,i),s=mN[(await this.core.history.get(t,e)).request.method].res;await this.core.relayer.publish(t,n,s),await this.core.history.resolve(i)}),bb(this,"sendError",async(e,t,r)=>{let i=(0,ml.formatJsonRpcError)(e,r),n=await this.core.crypto.encode(t,i),s=(await this.core.history.get(t,e)).request.method,a=mN[s]?mN[s].res:mN.unregistered_method.res;await this.core.relayer.publish(t,n,a),await this.core.history.resolve(i)}),bb(this,"deletePairing",async(e,t)=>{await this.core.relayer.unsubscribe(e),await Promise.all([this.pairings.delete(e,gC("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(e),t?Promise.resolve():this.core.expirer.del(e)])}),bb(this,"cleanup",async()=>{let e=this.pairings.getAll().filter(e=>he(e.expiry));await Promise.all(e.map(e=>this.deletePairing(e.topic)))}),bb(this,"onRelayEventRequest",async e=>{let{topic:t,payload:r}=e;switch(r.method){case"wc_pairingPing":return await this.onPairingPingRequest(t,r);case"wc_pairingDelete":return await this.onPairingDeleteRequest(t,r);default:return await this.onUnknownRpcMethodRequest(t,r)}}),bb(this,"onRelayEventResponse",async e=>{let{topic:t,payload:r}=e,i=(await this.core.history.get(t,r.id)).request.method;return"wc_pairingPing"===i?this.onPairingPingResponse(t,r):this.onUnknownRpcMethodResponse(i)}),bb(this,"onPairingPingRequest",async(e,t)=>{let{id:r}=t;try{this.isValidPing({topic:e}),await this.sendResult(r,e,!0),this.events.emit("pairing_ping",{id:r,topic:e})}catch(t){await this.sendError(r,e,t),this.logger.error(t)}}),bb(this,"onPairingPingResponse",(e,t)=>{let{id:r}=t;setTimeout(()=>{(0,mc.isJsonRpcResult)(t)?this.events.emit(ht("pairing_ping",r),{}):(0,mc.isJsonRpcError)(t)&&this.events.emit(ht("pairing_ping",r),{error:t.error})},500)}),bb(this,"onPairingDeleteRequest",async(e,t)=>{let{id:r}=t;try{this.isValidDisconnect({topic:e}),await this.deletePairing(e),this.events.emit(mU,{id:r,topic:e})}catch(t){await this.sendError(r,e,t),this.logger.error(t)}}),bb(this,"onUnknownRpcMethodRequest",async(e,t)=>{let{id:r,method:i}=t;try{if(this.registeredMethods.includes(i))return;let t=gC("WC_METHOD_UNSUPPORTED",i);await this.sendError(r,e,t),this.logger.error(t)}catch(t){await this.sendError(r,e,t),this.logger.error(t)}}),bb(this,"onUnknownRpcMethodResponse",e=>{this.registeredMethods.includes(e)||this.logger.error(gC("WC_METHOD_UNSUPPORTED",e))}),bb(this,"isValidPair",(e,t)=>{var r;if(!gW(e)){let{message:r}=gT("MISSING_OR_INVALID",`pair() params: ${e}`);throw t.setError(m$),Error(r)}if(!function(e){function t(e){try{return"u">typeof new URL(e)}catch{return!1}}try{if(gN(e,!1)){if(t(e))return!0;let r=hl(e);return t(r)}}catch{}return!1}(e.uri)){let{message:r}=gT("MISSING_OR_INVALID",`pair() uri: ${e.uri}`);throw t.setError(m$),Error(r)}let i=gc(e?.uri);if(!(null!=(r=i?.relay)&&r.protocol)){let{message:e}=gT("MISSING_OR_INVALID","pair() uri#relay-protocol");throw t.setError(m$),Error(e)}if(!(null!=i&&i.symKey)){let{message:e}=gT("MISSING_OR_INVALID","pair() uri#symKey");throw t.setError(m$),Error(e)}if(null!=i&&i.expiryTimestamp&&(0,oL.toMiliseconds)(i?.expiryTimestamp)<Date.now()){t.setError("pairing_expired");let{message:e}=gT("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw Error(e)}}),bb(this,"isValidPing",async e=>{if(!gW(e)){let{message:t}=gT("MISSING_OR_INVALID",`ping() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidPairingTopic(t)}),bb(this,"isValidDisconnect",async e=>{if(!gW(e)){let{message:t}=gT("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidPairingTopic(t)}),bb(this,"isValidPairingTopic",async e=>{if(!gN(e,!1)){let{message:t}=gT("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw Error(t)}if(!this.pairings.keys.includes(e)){let{message:t}=gT("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw Error(t)}if(he(this.pairings.get(e).expiry)){await this.deletePairing(e);let{message:t}=gT("EXPIRED",`pairing topic: ${e}`);throw Error(t)}}),this.core=e,this.logger=uR(t,this.name),this.pairings=new bm(this.core,this.logger,this.name,this.storagePrefix)}get context(){return uO(this.logger)}isInitialized(){if(!this.initialized){let{message:e}=gT("NOT_INITIALIZED",this.name);throw Error(e)}}registerRelayerEvents(){this.core.relayer.on(mw,async e=>{let{topic:t,message:r,transportType:i}=e;if(this.pairings.keys.includes(t)&&i!==mk&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{let e=await this.core.crypto.decode(t,r);(0,mc.isJsonRpcRequest)(e)?(this.core.history.set(t,e),await this.onRelayEventRequest({topic:t,payload:e})):(0,mc.isJsonRpcResponse)(e)&&(await this.core.history.resolve(e),await this.onRelayEventResponse({topic:t,payload:e}),this.core.history.delete(t,e.id)),await this.core.relayer.messages.ack(t,r)}catch(e){this.logger.error(e)}})}registerExpirerEvents(){this.core.expirer.on(mF,async e=>{let{topic:t}=u7(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit("pairing_expire",{topic:t}))})}}var bE=Object.defineProperty,b_=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?bE(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class bA extends g3{constructor(e,t){super(e,t),this.core=e,this.logger=t,b_(this,"records",new Map),b_(this,"events",new oU.EventEmitter),b_(this,"name","history"),b_(this,"version","0.3"),b_(this,"cached",[]),b_(this,"initialized",!1),b_(this,"storagePrefix",mh),b_(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>this.records.set(e.id,e)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),b_(this,"set",(e,t,r)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:e,request:t,chainId:r}),this.records.has(t.id))return;let i={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:r,expiry:u9(oL.THIRTY_DAYS)};this.records.set(i.id,i),this.persist(),this.events.emit(mD,i)}),b_(this,"resolve",async e=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:e}),!this.records.has(e.id))return;let t=await this.getRecord(e.id);typeof t.response>"u"&&(t.response=(0,mc.isJsonRpcError)(e)?{error:e.error}:{result:e.result},this.records.set(t.id,t),this.persist(),this.events.emit(mL,t))}),b_(this,"get",async(e,t)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:e,id:t}),await this.getRecord(t))),b_(this,"delete",(e,t)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:t}),this.values.forEach(r=>{r.topic===e&&("u">typeof t&&r.id!==t||(this.records.delete(r.id),this.events.emit(mj,r)))}),this.persist()}),b_(this,"exists",async(e,t)=>(this.isInitialized(),!!this.records.has(t)&&(await this.getRecord(t)).topic===e)),b_(this,"on",(e,t)=>{this.events.on(e,t)}),b_(this,"once",(e,t)=>{this.events.once(e,t)}),b_(this,"off",(e,t)=>{this.events.off(e,t)}),b_(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.logger=uR(t,this.name)}get context(){return uO(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let e=[];return this.values.forEach(t=>{if("u">typeof t.response)return;let r={topic:t.topic,request:(0,ml.formatJsonRpcRequest)(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();let t=this.records.get(e);if(!t){let{message:t}=gT("NO_MATCHING_KEY",`${this.name}: ${e}`);throw Error(t)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit("history_sync")}async restore(){try{let e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){let{message:e}=gT("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(mD,e=>{this.logger.info(`Emitting ${mD}`),this.logger.debug({type:"event",event:mD,record:e})}),this.events.on(mL,e=>{this.logger.info(`Emitting ${mL}`),this.logger.debug({type:"event",event:mL,record:e})}),this.events.on(mj,e=>{this.logger.info(`Emitting ${mj}`),this.logger.debug({type:"event",event:mj,record:e})}),this.core.heartbeat.on(gG.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{(0,oL.toMiliseconds)(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(mj,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){let{message:e}=gT("NOT_INITIALIZED",this.name);throw Error(e)}}}var bS=Object.defineProperty,bx=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?bS(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class bI extends g9{constructor(e,t){super(e,t),this.core=e,this.logger=t,bx(this,"expirations",new Map),bx(this,"events",new oU.EventEmitter),bx(this,"name","expirer"),bx(this,"version","0.3"),bx(this,"cached",[]),bx(this,"initialized",!1),bx(this,"storagePrefix",mh),bx(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>this.expirations.set(e.target,e)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),bx(this,"has",e=>{try{let t=this.formatTarget(e);return"u">typeof this.getExpiration(t)}catch{return!1}}),bx(this,"set",(e,t)=>{this.isInitialized();let r=this.formatTarget(e),i={target:r,expiry:t};this.expirations.set(r,i),this.checkExpiry(r,i),this.events.emit(mB,{target:r,expiration:i})}),bx(this,"get",e=>{this.isInitialized();let t=this.formatTarget(e);return this.getExpiration(t)}),bx(this,"del",e=>{if(this.isInitialized(),this.has(e)){let t=this.formatTarget(e),r=this.getExpiration(t);this.expirations.delete(t),this.events.emit(mW,{target:t,expiration:r})}}),bx(this,"on",(e,t)=>{this.events.on(e,t)}),bx(this,"once",(e,t)=>{this.events.once(e,t)}),bx(this,"off",(e,t)=>{this.events.off(e,t)}),bx(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.logger=uR(t,this.name)}get context(){return uO(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if("string"==typeof e)return u4("topic",e);if("number"==typeof e)return u4("id",e);let{message:t}=gT("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit("expirer_sync")}async restore(){try{let e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){let{message:e}=gT("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){let t=this.expirations.get(e);if(!t){let{message:t}=gT("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(t),Error(t)}return t}checkExpiry(e,t){let{expiry:r}=t;(0,oL.toMiliseconds)(r)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(mF,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(gG.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(mB,e=>{this.logger.info(`Emitting ${mB}`),this.logger.debug({type:"event",event:mB,data:e}),this.persist()}),this.events.on(mF,e=>{this.logger.info(`Emitting ${mF}`),this.logger.debug({type:"event",event:mF,data:e}),this.persist()}),this.events.on(mW,e=>{this.logger.info(`Emitting ${mW}`),this.logger.debug({type:"event",event:mW,data:e}),this.persist()})}isInitialized(){if(!this.initialized){let{message:e}=gT("NOT_INITIALIZED",this.name);throw Error(e)}}}var bk=Object.defineProperty,bT=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?bk(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class bC extends me{constructor(e,t,r){super(e,t,r),this.core=e,this.logger=t,this.store=r,bT(this,"name","verify-api"),bT(this,"abortController"),bT(this,"isDevEnv"),bT(this,"verifyUrlV3",mq),bT(this,"storagePrefix",mh),bT(this,"version",2),bT(this,"publicKey"),bT(this,"fetchPromise"),bT(this,"init",async()=>{var e;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,oL.toMiliseconds)(null==(e=this.publicKey)?void 0:e.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),bT(this,"register",async e=>{if(!uY()||this.isDevEnv)return;let t=window.location.origin,{id:r,decryptedId:i}=e,n=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${t}&id=${r}&decryptedId=${i}`;try{let e=(0,oj.getDocument)(),t=this.startAbortTimer(5*oL.ONE_SECOND),i=await new Promise((i,s)=>{let a=()=>{window.removeEventListener("message",l),e.body.removeChild(o),s("attestation aborted")};this.abortController.signal.addEventListener("abort",a);let o=e.createElement("iframe");o.src=n,o.style.display="none",o.addEventListener("error",a,{signal:this.abortController.signal});let l=n=>{if(n.data&&"string"==typeof n.data)try{let s=JSON.parse(n.data);if("verify_attestation"===s.type){if((0,ui.decodeJWT)(s.attestation).payload.id!==r)return;clearInterval(t),e.body.removeChild(o),this.abortController.signal.removeEventListener("abort",a),window.removeEventListener("message",l),i(null===s.attestation?"":s.attestation)}}catch(e){this.logger.warn(e)}};e.body.appendChild(o),window.addEventListener("message",l,{signal:this.abortController.signal})});return this.logger.debug(i,"jwt attestation"),i}catch(e){this.logger.warn(e)}return""}),bT(this,"resolve",async e=>{if(this.isDevEnv)return"";let{attestationId:t,hash:r,encryptedId:i}=e;if(""===t)return void this.logger.debug("resolve: attestationId is empty, skipping");if(t){if((0,ui.decodeJWT)(t).payload.id!==i)return;let e=await this.isValidJwtAttestation(t);if(e)return e.isVerified?e:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!r)return;let n=this.getVerifyUrl(e?.verifyUrl);return this.fetchAttestation(r,n)}),bT(this,"fetchAttestation",async(e,t)=>{this.logger.debug(`resolving attestation: ${e} from url: ${t}`);let r=this.startAbortTimer(5*oL.ONE_SECOND),i=await fetch(`${t}/attestation/${e}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(r),200===i.status?await i.json():void 0}),bT(this,"getVerifyUrl",e=>{let t=e||mH;return mz.includes(t)||(this.logger.info(`verify url: ${t}, not included in trusted list, assigning default: ${mH}`),t=mH),t}),bT(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let e=this.startAbortTimer(oL.FIVE_SECONDS),t=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(e),await t.json()}catch(e){this.logger.warn(e)}}),bT(this,"persistPublicKey",async e=>{this.logger.debug(e,"persisting public key to local storage"),await this.store.setItem(this.storeKey,e),this.publicKey=e}),bT(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),bT(this,"isValidJwtAttestation",async e=>{let t=await this.getPublicKey();try{if(t)return this.validateAttestation(e,t)}catch(e){this.logger.error(e),this.logger.warn("error validating attestation")}let r=await this.fetchAndPersistPublicKey();try{if(r)return this.validateAttestation(e,r)}catch(e){this.logger.error(e),this.logger.warn("error validating attestation")}}),bT(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),bT(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async e=>{let t=await this.fetchPublicKey();t&&(await this.persistPublicKey(t),e(t))});let e=await this.fetchPromise;return this.fetchPromise=void 0,e}),bT(this,"validateAttestation",(e,t)=>{let r=function(e,t){let r,i,[n,s,a]=e.split("."),o=t3.Buffer.from(y5(a),"base64");if(64!==o.length)throw Error("Invalid signature length");let l=o.slice(0,32),c=o.slice(32,64),d=pE(`${n}.${s}`),u=(r=t3.Buffer.from(t.x,"base64"),i=t3.Buffer.from(t.y,"base64"),(0,ua.concat)([new Uint8Array([4]),r,i]));if(!yK.verify((0,ua.concat)([l,c]),d,u))throw Error("Invalid signature");return(0,ui.decodeJWT)(e).payload}(e,t.publicKey),i={hasExpired:(0,oL.toMiliseconds)(r.exp)<Date.now(),payload:r};if(i.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),Error("JWT attestation expired");return{origin:i.payload.origin,isScam:i.payload.isScam,isVerified:i.payload.isVerified}}),this.logger=uR(t,this.name),this.abortController=new AbortController,this.isDevEnv=ho(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return uO(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,oL.toMiliseconds)(e))}}var bP=Object.defineProperty,bO=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?bP(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class bR extends mt{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,bO(this,"context","echo"),bO(this,"registerDeviceToken",async e=>{let{clientId:t,token:r,notificationType:i,enableEncrypted:n=!1}=e,s=`https://echo.walletconnect.com/${this.projectId}/clients`;await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:t,type:i,token:r,always_raw:n})})}),this.logger=uR(t,this.context)}}var bN=Object.defineProperty,bM=Object.getOwnPropertySymbols,bU=Object.prototype.hasOwnProperty,bD=Object.prototype.propertyIsEnumerable,bL=(e,t,r)=>t in e?bN(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,bj=(e,t)=>{for(var r in t||(t={}))bU.call(t,r)&&bL(e,r,t[r]);if(bM)for(var r of bM(t))bD.call(t,r)&&bL(e,r,t[r]);return e},bB=(e,t,r)=>bL(e,"symbol"!=typeof t?t+"":t,r);class bW extends mr{constructor(e,t,r=!0){super(e,t,r),this.core=e,this.logger=t,bB(this,"context","event-client"),bB(this,"storagePrefix",mh),bB(this,"storageVersion",.1),bB(this,"events",new Map),bB(this,"shouldPersist",!1),bB(this,"init",async()=>{if(!ho())try{let e={eventId:ha(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:u1(this.core.relayer.protocol,this.core.relayer.version,mI)}}};await this.sendEvent([e])}catch(e){this.logger.warn(e)}}),bB(this,"createEvent",e=>{let{event:t="ERROR",type:r="",properties:{topic:i,trace:n}}=e,s=ha(),a=this.core.projectId||"",o=bj({eventId:s,timestamp:Date.now(),props:{event:t,type:r,properties:{topic:i,trace:n}},bundleId:a,domain:this.getAppDomain()},this.setMethods(s));return this.telemetryEnabled&&(this.events.set(s,o),this.shouldPersist=!0),o}),bB(this,"getEvent",e=>{let{eventId:t,topic:r}=e;if(t)return this.events.get(t);let i=Array.from(this.events.values()).find(e=>e.props.properties.topic===r);if(i)return bj(bj({},i),this.setMethods(i.eventId))}),bB(this,"deleteEvent",e=>{let{eventId:t}=e;this.events.delete(t),this.shouldPersist=!0}),bB(this,"setEventListeners",()=>{this.core.heartbeat.on(gG.HEARTBEAT_EVENTS.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(e=>{(0,oL.fromMiliseconds)(Date.now())-(0,oL.fromMiliseconds)(e.timestamp)>86400&&(this.events.delete(e.eventId),this.shouldPersist=!0)})})}),bB(this,"setMethods",e=>({addTrace:t=>this.addTrace(e,t),setError:t=>this.setError(e,t)})),bB(this,"addTrace",(e,t)=>{let r=this.events.get(e);r&&(r.props.properties.trace.push(t),this.events.set(e,r),this.shouldPersist=!0)}),bB(this,"setError",(e,t)=>{let r=this.events.get(e);r&&(r.props.type=t,r.timestamp=Date.now(),this.events.set(e,r),this.shouldPersist=!0)}),bB(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),bB(this,"restore",async()=>{try{let e=await this.core.storage.getItem(this.storageKey)||[];if(!e.length)return;e.forEach(e=>{this.events.set(e.eventId,bj(bj({},e),this.setMethods(e.eventId)))})}catch(e){this.logger.warn(e)}}),bB(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;let e=[];for(let[t,r]of this.events)r.props.type&&e.push(r);if(0!==e.length)try{if((await this.sendEvent(e)).ok)for(let t of e)this.events.delete(t.eventId),this.shouldPersist=!0}catch(e){this.logger.warn(e)}}),bB(this,"sendEvent",async e=>{let t=this.getAppDomain()?"":"&sp=desktop";return await fetch(`https://pulse.walletconnect.org/batch?projectId=${this.core.projectId}&st=events_sdk&sv=js-${mI}${t}`,{method:"POST",body:JSON.stringify(e)})}),bB(this,"getAppDomain",()=>u0().url),this.logger=uR(t,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var bF=Object.defineProperty,bH=Object.getOwnPropertySymbols,bq=Object.prototype.hasOwnProperty,bz=Object.prototype.propertyIsEnumerable,b$=(e,t,r)=>t in e?bF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,bK=(e,t)=>{for(var r in t||(t={}))bq.call(t,r)&&b$(e,r,t[r]);if(bH)for(var r of bH(t))bz.call(t,r)&&b$(e,r,t[r]);return e},bV=(e,t,r)=>b$(e,"symbol"!=typeof t?t+"":t,r);class bJ extends g1{constructor(e){var t;super(e),bV(this,"protocol","wc"),bV(this,"version",2),bV(this,"name",mu),bV(this,"relayUrl"),bV(this,"projectId"),bV(this,"customStoragePrefix"),bV(this,"events",new oU.EventEmitter),bV(this,"logger"),bV(this,"heartbeat"),bV(this,"relayer"),bV(this,"crypto"),bV(this,"storage"),bV(this,"history"),bV(this,"expirer"),bV(this,"pairing"),bV(this,"verify"),bV(this,"echoClient"),bV(this,"linkModeSupportedApps"),bV(this,"eventClient"),bV(this,"initialized",!1),bV(this,"logChunkController"),bV(this,"on",(e,t)=>this.events.on(e,t)),bV(this,"once",(e,t)=>this.events.once(e,t)),bV(this,"off",(e,t)=>this.events.off(e,t)),bV(this,"removeListener",(e,t)=>this.events.removeListener(e,t)),bV(this,"dispatchEnvelope",({topic:e,message:t,sessionExists:r})=>{if(!e||!t)return;let i={topic:e,message:t,publishedAt:Date.now(),transportType:mk};this.relayer.onLinkMessageEvent(i,{sessionExists:r})});const r=this.getGlobalCore(e?.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(e){console.warn("Failed to copy global core",e)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||mm,this.customStoragePrefix=null!=e&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const{logger:i,chunkLoggerController:n}=uN({opts:function(e){return uS(uP({},e),ux({level:e?.level||"info"}))}({level:"string"==typeof e?.logger&&e.logger?e.logger:"error",name:mu}),maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=n,null!=(t=this.logChunkController)&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var e,t;null!=(e=this.logChunkController)&&e.downloadLogsBlobInBrowser&&(null==(t=this.logChunkController)||t.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=uR(i,this.name),this.heartbeat=new gG.HeartBeat,this.crypto=new wk(this,this.logger,e?.keychain),this.history=new bA(this,this.logger),this.expirer=new bI(this,this.logger),this.storage=null!=e&&e.storage?e.storage:new gY.default(bK(bK({},mp),e?.storageOptions)),this.relayer=new bi({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new bv(this,this.logger),this.verify=new bC(this,this.logger,this.storage),this.echoClient=new bR(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new bW(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){let t=new bJ(e);await t.initialize();let r=await t.crypto.getClientId();return await t.storage.setItem("WALLETCONNECT_CLIENT_ID",r),t}get context(){return uO(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return null==(e=this.logChunkController)?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(mP,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(mP)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;let t=`_walletConnectCore_${e}`,r=`${t}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[t]}catch(e){console.warn("Failed to get global WalletConnect core",e);return}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;let r=`_walletConnectCore_${(null==(t=e.opts)?void 0:t.customStoragePrefix)||""}`;globalThis[r]=e}catch(e){console.warn("Failed to set global WalletConnect core",e)}}isGlobalCoreDisabled(){try{return"u">typeof sm.default&&"true"===sm.default.env.DISABLE_GLOBAL_CORE}catch{return!0}}}let bZ="client",bG=`wc@2:${bZ}:`,bY="WALLETCONNECT_DEEPLINK_CHOICE",bQ=(oL.THIRTY_DAYS,"Proposal expired"),bX=oL.SEVEN_DAYS,b0={wc_sessionPropose:{req:{ttl:oL.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:oL.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:oL.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:oL.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:oL.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:oL.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:oL.ONE_DAY,prompt:!1,tag:1104},res:{ttl:oL.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:oL.ONE_DAY,prompt:!1,tag:1106},res:{ttl:oL.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:oL.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:oL.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:oL.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:oL.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:oL.ONE_DAY,prompt:!1,tag:1112},res:{ttl:oL.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:oL.ONE_DAY,prompt:!1,tag:1114},res:{ttl:oL.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:oL.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:oL.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:oL.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:oL.FIVE_MINUTES,prompt:!1,tag:1119}}},b1={min:oL.FIVE_MINUTES,max:oL.SEVEN_DAYS},b2="IDLE",b3="ACTIVE",b5={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},b8=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],b6="wc@1.5:auth:",b4=`${b6}:PUB_KEY`;var b7=Object.defineProperty,b9=Object.defineProperties,ve=Object.getOwnPropertyDescriptors,vt=Object.getOwnPropertySymbols,vr=Object.prototype.hasOwnProperty,vi=Object.prototype.propertyIsEnumerable,vn=(e,t,r)=>t in e?b7(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,vs=(e,t)=>{for(var r in t||(t={}))vr.call(t,r)&&vn(e,r,t[r]);if(vt)for(var r of vt(t))vi.call(t,r)&&vn(e,r,t[r]);return e},va=(e,t,r)=>vn(e,"symbol"!=typeof t?t+"":t,r);class vo extends ma{constructor(t){super(t),va(this,"name","engine"),va(this,"events",new oU.default),va(this,"initialized",!1),va(this,"requestQueue",{state:b2,queue:[]}),va(this,"sessionRequestQueue",{state:b2,queue:[]}),va(this,"emittedSessionRequests",new hc({limit:500})),va(this,"requestQueueDelay",oL.ONE_SECOND),va(this,"expectedPairingMethodMap",new Map),va(this,"recentlyDeletedMap",new Map),va(this,"recentlyDeletedLimit",200),va(this,"relayMessageCache",[]),va(this,"pendingSessions",new Map),va(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(b0)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,oL.toMiliseconds)(this.requestQueueDelay)))}),va(this,"connect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let t=b9(vs({},e),ve({requiredNamespaces:e.requiredNamespaces||{},optionalNamespaces:e.optionalNamespaces||{}}));await this.isValidConnect(t),t.optionalNamespaces=function(e,t){var r,i,n,s,a,o;let l=gS(e),c=gS(t),d={};for(let e of Object.keys(l).concat(Object.keys(c)))d[e]={chains:hr(null==(r=l[e])?void 0:r.chains,null==(i=c[e])?void 0:i.chains),methods:hr(null==(n=l[e])?void 0:n.methods,null==(s=c[e])?void 0:s.methods),events:hr(null==(a=l[e])?void 0:a.events,null==(o=c[e])?void 0:o.events)};return d}(t.requiredNamespaces,t.optionalNamespaces),t.requiredNamespaces={};let{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:n,sessionProperties:s,scopedProperties:a,relays:o}=t,l=r,c,d=!1;try{if(l){let e=this.client.core.pairing.pairings.get(l);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=e.active}}catch(e){throw this.client.logger.error(`connect() -> pairing.get(${l}) failed`),e}if(!l||!d){let{topic:e,uri:t}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});l=e,c=t}if(!l){let{message:e}=gT("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw Error(e)}let u=await this.client.core.crypto.generateKeyPair(),h=b0.wc_sessionPropose.req.ttl||oL.FIVE_MINUTES,p=u9(h),f=b9(vs(vs({requiredNamespaces:i,optionalNamespaces:n,relays:o??[{protocol:"irn"}],proposer:{publicKey:u,metadata:this.client.metadata},expiryTimestamp:p,pairingTopic:l},s&&{sessionProperties:s}),a&&{scopedProperties:a}),ve({id:(0,ml.payloadId)()})),y=ht("session_connect",f.id),{reject:g,resolve:m,done:w}=u8(h,bQ),b=({id:e})=>{e===f.id&&(this.client.events.off("proposal_expire",b),this.pendingSessions.delete(f.id),this.events.emit(y,{error:{message:bQ,code:0}}))};return this.client.events.on("proposal_expire",b),this.events.once(y,({error:e,session:t})=>{this.client.events.off("proposal_expire",b),e?g(e):t&&m(t)}),await this.sendProposeSession({proposal:f,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:f.id}}}),await this.setProposal(f.id,f),{uri:c,approval:w}}),va(this,"pair",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(e)}catch(e){throw this.client.logger.error("pair() failed"),e}}),va(this,"approve",async e=>{var t,r,i;let n=this.client.core.eventClient.createEvent({properties:{topic:null==(t=e?.id)?void 0:t.toString(),trace:[mK]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(e){throw n.setError("no_internet_connection"),e}try{await this.isValidProposalId(e?.id)}catch(t){throw this.client.logger.error(`approve() -> proposal.get(${e?.id}) failed`),n.setError("proposal_not_found"),t}try{await this.isValidApprove(e)}catch(e){throw this.client.logger.error("approve() -> isValidApprove() failed"),n.setError("session_approve_namespace_validation_failure"),e}let{id:s,relayProtocol:a,namespaces:o,sessionProperties:l,scopedProperties:c,sessionConfig:d}=e,u=this.client.proposal.get(s);this.client.core.eventClient.deleteEvent({eventId:n.eventId});let{pairingTopic:h,proposer:p,requiredNamespaces:f,optionalNamespaces:y}=u,g=null==(r=this.client.core.eventClient)?void 0:r.getEvent({topic:h});g||(g=null==(i=this.client.core.eventClient)?void 0:i.createEvent({type:mK,properties:{topic:h,trace:[mK,"session_namespaces_validation_success"]}}));let m=await this.client.core.crypto.generateKeyPair(),w=p.publicKey,b=await this.client.core.crypto.generateSharedKey(m,w),v=vs(vs(vs({relay:{protocol:a??"irn"},namespaces:o,controller:{publicKey:m,metadata:this.client.metadata},expiry:u9(bX)},l&&{sessionProperties:l}),c&&{scopedProperties:c}),d&&{sessionConfig:d});g.addTrace("subscribing_session_topic");try{await this.client.core.relayer.subscribe(b,{transportType:mT,internal:{skipSubscribe:!0}})}catch(e){throw g.setError("subscribe_session_topic_failure"),e}g.addTrace("subscribe_session_topic_success");let E=b9(vs({},v),ve({topic:b,requiredNamespaces:f,optionalNamespaces:y,pairingTopic:h,acknowledged:!1,self:v.controller,peer:{publicKey:p.publicKey,metadata:p.metadata},controller:m,transportType:mT}));await this.client.session.set(b,E),g.addTrace("store_session");try{await this.sendApproveSession({sessionTopic:b,proposal:u,pairingProposalResponse:{relay:{protocol:a??"irn"},responderPublicKey:m},sessionSettleRequest:v,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:s}}}),g.addTrace("session_approve_publish_success")}catch(e){throw this.client.logger.error(e),this.client.session.delete(b,gC("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(b),e}return this.client.core.eventClient.deleteEvent({eventId:g.eventId}),await this.client.core.pairing.updateMetadata({topic:h,metadata:p.metadata}),await this.deleteProposal(s),await this.client.core.pairing.activate({topic:h}),await this.setExpiry(b,u9(bX)),{topic:b,acknowledged:()=>Promise.resolve(this.client.session.get(b))}}),va(this,"reject",async e=>{let t;this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(e)}catch(e){throw this.client.logger.error("reject() -> isValidReject() failed"),e}let{id:r,reason:i}=e;try{t=this.client.proposal.get(r).pairingTopic}catch(e){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),e}t&&await this.sendError({id:r,topic:t,error:i,rpcOpts:b0.wc_sessionPropose.reject}),await this.deleteProposal(r)}),va(this,"update",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(e)}catch(e){throw this.client.logger.error("update() -> isValidUpdate() failed"),e}let{topic:t,namespaces:r}=e,{done:i,resolve:n,reject:s}=u8(),a=(0,ml.payloadId)(),o=(0,ml.getBigIntRpcId)().toString(),l=this.client.session.get(t).namespaces;return this.events.once(ht("session_update",a),({error:e})=>{e?s(e):n()}),await this.client.session.update(t,{namespaces:r}),await this.sendRequest({topic:t,method:"wc_sessionUpdate",params:{namespaces:r},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:o}).catch(e=>{this.client.logger.error(e),this.client.session.update(t,{namespaces:l}),s(e)}),{acknowledged:i}}),va(this,"extend",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(e)}catch(e){throw this.client.logger.error("extend() -> isValidExtend() failed"),e}let{topic:t}=e,r=(0,ml.payloadId)(),{done:i,resolve:n,reject:s}=u8();return this.events.once(ht("session_extend",r),({error:e})=>{e?s(e):n()}),await this.setExpiry(t,u9(bX)),this.sendRequest({topic:t,method:"wc_sessionExtend",params:{},clientRpcId:r,throwOnFailedPublish:!0}).catch(e=>{s(e)}),{acknowledged:i}}),va(this,"request",async e=>{this.isInitialized();try{await this.isValidRequest(e)}catch(e){throw this.client.logger.error("request() -> isValidRequest() failed"),e}let{chainId:t,request:r,topic:i,expiry:n=b0.wc_sessionRequest.req.ttl}=e,s=this.client.session.get(i);s?.transportType===mT&&await this.confirmOnlineStateOrThrow();let a=(0,ml.payloadId)(),o=(0,ml.getBigIntRpcId)().toString(),{done:l,resolve:c,reject:d}=u8(n,"Request expired. Please try again.");this.events.once(ht("session_request",a),({error:e,result:t})=>{e?d(e):c(t)});let u="wc_sessionRequest",h=this.getAppLinkIfEnabled(s.peer.metadata,s.transportType);if(h)return await this.sendRequest({clientRpcId:a,relayRpcId:o,topic:i,method:u,params:{request:b9(vs({},r),ve({expiryTimestamp:u9(n)})),chainId:t},expiry:n,throwOnFailedPublish:!0,appLink:h}).catch(e=>d(e)),this.client.events.emit("session_request_sent",{topic:i,request:r,chainId:t,id:a}),await l();let p={request:b9(vs({},r),ve({expiryTimestamp:u9(n)})),chainId:t};return await Promise.all([new Promise(async e=>{await this.sendRequest({clientRpcId:a,relayRpcId:o,topic:i,method:u,params:p,expiry:n,throwOnFailedPublish:!0,tvf:this.getTVFParams(a,p)}).catch(e=>d(e)),this.client.events.emit("session_request_sent",{topic:i,request:r,chainId:t,id:a}),e()}),new Promise(async e=>{var t;if(!(null!=(t=s.sessionConfig)&&t.disableDeepLink)){let e=await hn(this.client.core.storage,bY);await hi({id:a,topic:i,wcDeepLink:e})}e()}),l()]).then(e=>e[2])}),va(this,"respond",async e=>{var t,r;this.isInitialized();let i=this.client.core.eventClient.createEvent({properties:{topic:e?.topic||(null==(r=null==(t=e?.response)?void 0:t.id)?void 0:r.toString()),trace:["session_request_response_started"]}});try{await this.isValidRespond(e)}catch(e){throw i.addTrace(e?.message),i.setError("session_request_response_validation_failure"),e}i.addTrace("session_request_response_validation_success");let{topic:n,response:s}=e,{id:a}=s,o=this.client.session.get(n);o.transportType===mT&&await this.confirmOnlineStateOrThrow();let l=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);try{i.addTrace("session_request_response_publish_started"),(0,mc.isJsonRpcResult)(s)?await this.sendResult({id:a,topic:n,result:s.result,throwOnFailedPublish:!0,appLink:l}):(0,mc.isJsonRpcError)(s)&&await this.sendError({id:a,topic:n,error:s.error,appLink:l}),this.cleanupAfterResponse(e)}catch(e){throw i.addTrace(e?.message),i.setError("session_request_response_publish_failure"),e}}),va(this,"ping",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(e)}catch(e){throw this.client.logger.error("ping() -> isValidPing() failed"),e}let{topic:t}=e;if(this.client.session.keys.includes(t)){let e=(0,ml.payloadId)(),r=(0,ml.getBigIntRpcId)().toString(),{done:i,resolve:n,reject:s}=u8();this.events.once(ht("session_ping",e),({error:e})=>{e?s(e):n()}),await Promise.all([this.sendRequest({topic:t,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:e,relayRpcId:r}),i()])}else this.client.core.pairing.pairings.keys.includes(t)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:t}))}),va(this,"emit",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(e);let{topic:t,event:r,chainId:i}=e,n=(0,ml.getBigIntRpcId)().toString(),s=(0,ml.payloadId)();await this.sendRequest({topic:t,method:"wc_sessionEvent",params:{event:r,chainId:i},throwOnFailedPublish:!0,relayRpcId:n,clientRpcId:s})}),va(this,"disconnect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(e);let{topic:t}=e;if(this.client.session.keys.includes(t))await this.sendRequest({topic:t,method:"wc_sessionDelete",params:gC("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:t,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(t))await this.client.core.pairing.disconnect({topic:t});else{let{message:e}=gT("MISMATCHED_TOPIC",`Session or pairing topic not found: ${t}`);throw Error(e)}}),va(this,"find",e=>(this.isInitialized(),this.client.session.getAll().filter(t=>(function(e,t){let{requiredNamespaces:r}=t,i=Object.keys(e.namespaces),n=Object.keys(r),s=!0;return!!u2(n,i)&&(i.forEach(t=>{let{accounts:i,methods:n,events:a}=e.namespaces[t],o=gE(i),l=r[t];u2(uD(t,l),o)&&u2(l.methods,n)&&u2(l.events,a)||(s=!1)}),s)})(t,e)))),va(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),va(this,"authenticate",async(e,t)=>{var r,i,n,s,a;let o;this.isInitialized(),this.isValidAuthenticate(e);let l=t&&this.client.core.linkModeSupportedApps.includes(t)&&(null==(r=this.client.metadata.redirect)?void 0:r.linkMode),c=l?mk:mT;c===mT&&await this.confirmOnlineStateOrThrow();let{chains:d,statement:u="",uri:h,domain:p,nonce:f,type:y,exp:g,nbf:m,methods:w=[],expiry:b}=e,v=[...e.resources||[]],{topic:E,uri:_}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:c});this.client.logger.info({message:"Generated new pairing",pairing:{topic:E,uri:_}});let A=await this.client.core.crypto.generateKeyPair(),S=yX(A);if(await Promise.all([this.client.auth.authKeys.set(b4,{responseTopic:S,publicKey:A}),this.client.auth.pairingTopics.set(S,{topic:S,pairingTopic:E})]),await this.client.core.relayer.subscribe(S,{transportType:c}),this.client.logger.info(`sending request to new pairing topic: ${E}`),w.length>0){let e,t,{namespace:r}=uM(d[0]),o=pQ(function(e,t,r,i={}){return r?.sort((e,t)=>e.localeCompare(t)),{att:{[e]:function(e,t,r={}){return Object.assign({},...(t=t?.sort((e,t)=>e.localeCompare(t))).map(t=>({[`${e}/${t}`]:[r]})))}(t,r,i)}}}(r,"request",w));p2(v)&&(i=o,n=v.pop(),o=pQ((s=pX(i),a=pX(n),pY(s),pY(a),e=Object.keys(s.att).concat(Object.keys(a.att)).sort((e,t)=>e.localeCompare(t)),t={att:{}},e.forEach(e=>{var r,i;Object.keys((null==(r=s.att)?void 0:r[e])||{}).concat(Object.keys((null==(i=a.att)?void 0:i[e])||{})).sort((e,t)=>e.localeCompare(t)).forEach(r=>{var i,n;t.att[e]=pW(((e,t)=>{for(var r in t||(t={}))pq.call(t,r)&&p$(e,r,t[r]);if(pH)for(var r of pH(t))pz.call(t,r)&&p$(e,r,t[r]);return e})({},t.att[e]),pF({[r]:(null==(i=s.att[e])?void 0:i[r])||(null==(n=a.att[e])?void 0:n[r])}))})}),t))),v.push(o)}let x=b&&b>b0.wc_sessionAuthenticate.req.ttl?b:b0.wc_sessionAuthenticate.req.ttl,I={authPayload:{type:y??"caip122",chains:d,statement:u,aud:h,domain:p,version:"1",nonce:f,iat:new Date().toISOString(),exp:g,nbf:m,resources:v},requester:{publicKey:A,metadata:this.client.metadata},expiryTimestamp:u9(x)},k={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:d,methods:[...new Set(["personal_sign",...w])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:E,proposer:{publicKey:A,metadata:this.client.metadata},expiryTimestamp:u9(b0.wc_sessionPropose.req.ttl),id:(0,ml.payloadId)()},{done:T,resolve:C,reject:P}=u8(x,"Request expired"),O=(0,ml.payloadId)(),R=ht("session_connect",k.id),N=ht("session_request",O),M=async({error:e,session:t})=>{this.events.off(N,U),e?P(e):t&&C({session:t})},U=async e=>{var r,i,n;let s;if(await this.deletePendingAuthRequest(O,{message:"fulfilled",code:0}),e.error){let t=gC("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return e.error.code===t.code?void 0:(this.events.off(R,M),P(e.error.message))}await this.deleteProposal(k.id),this.events.off(R,M);let{cacaos:a,responder:o}=e.result,l=[],d=[];for(let e of a){await pZ({cacao:e,projectId:this.client.core.projectId})||(this.client.logger.error(e,"Signature verification failed"),P(gC("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:t}=e,r=p2(t.resources),i=[pV(t.iss)],n=pJ(t.iss);if(r){let e=p0(r),t=p1(r);l.push(...e),i.push(...t)}for(let e of i)d.push(`${e}:${n}`)}let u=await this.client.core.crypto.generateSharedKey(A,o.publicKey);l.length>0&&(s={topic:u,acknowledged:!0,self:{publicKey:A,metadata:this.client.metadata},peer:o,controller:o.publicKey,expiry:u9(bX),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:E,namespaces:gx([...new Set(l)],[...new Set(d)]),transportType:c},await this.client.core.relayer.subscribe(u,{transportType:c}),await this.client.session.set(u,s),E&&await this.client.core.pairing.updateMetadata({topic:E,metadata:o.metadata}),s=this.client.session.get(u)),null!=(r=this.client.metadata.redirect)&&r.linkMode&&null!=(i=o.metadata.redirect)&&i.linkMode&&null!=(n=o.metadata.redirect)&&n.universal&&t&&(this.client.core.addLinkModeSupportedApp(o.metadata.redirect.universal),this.client.session.update(u,{transportType:mk})),C({auths:a,session:s})};this.events.once(R,M),this.events.once(N,U);try{if(l){let e=(0,ml.formatJsonRpcRequest)("wc_sessionAuthenticate",I,O);this.client.core.history.set(E,e);let r=await this.client.core.crypto.encode("",e,{type:2,encoding:yG});o=gu(t,E,r)}else await Promise.all([this.sendRequest({topic:E,method:"wc_sessionAuthenticate",params:I,expiry:e.expiry,throwOnFailedPublish:!0,clientRpcId:O}),this.sendRequest({topic:E,method:"wc_sessionPropose",params:k,expiry:b0.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:k.id})])}catch(e){throw this.events.off(R,M),this.events.off(N,U),e}return await this.setProposal(k.id,k),await this.setAuthRequest(O,{request:b9(vs({},I),ve({verifyContext:{}})),pairingTopic:E,transportType:c}),{uri:o??_,response:T}}),va(this,"approveSessionAuthenticate",async e=>{let t,{id:r,auths:i}=e,n=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:["authenticated_session_approve_started"]}});try{this.isInitialized()}catch(e){throw n.setError("no_internet_connection"),e}let s=this.getPendingAuthRequest(r);if(!s)throw n.setError("authenticated_session_pending_request_not_found"),Error(`Could not find pending auth request with id ${r}`);let a=s.transportType||mT;a===mT&&await this.confirmOnlineStateOrThrow();let o=s.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),c=yX(o),d={type:1,receiverPublicKey:o,senderPublicKey:l},u=[],h=[];for(let e of i){if(!await pZ({cacao:e,projectId:this.client.core.projectId})){n.setError("invalid_cacao");let e=gC("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:r,topic:c,error:e,encodeOpts:d}),Error(e.message)}n.addTrace("cacaos_verified");let{p:t}=e,i=p2(t.resources),s=[pV(t.iss)],a=pJ(t.iss);if(i){let e=p0(i),t=p1(i);u.push(...e),s.push(...t)}for(let e of s)h.push(`${e}:${a}`)}let p=await this.client.core.crypto.generateSharedKey(l,o);if(n.addTrace("create_authenticated_session_topic"),u?.length>0){t={topic:p,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:o,metadata:s.requester.metadata},controller:o,expiry:u9(bX),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:s.pairingTopic,namespaces:gx([...new Set(u)],[...new Set(h)]),transportType:a},n.addTrace("subscribing_authenticated_session_topic");try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(e){throw n.setError("subscribe_authenticated_session_topic_failure"),e}n.addTrace("subscribe_authenticated_session_topic_success"),await this.client.session.set(p,t),n.addTrace("store_authenticated_session"),await this.client.core.pairing.updateMetadata({topic:s.pairingTopic,metadata:s.requester.metadata})}n.addTrace("publishing_authenticated_session_approve");try{await this.sendResult({topic:c,id:r,result:{cacaos:i,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:d,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(s.requester.metadata,a)})}catch(e){throw n.setError("authenticated_session_approve_publish_failure"),e}return await this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:s.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:t}}),va(this,"rejectSessionAuthenticate",async e=>{this.isInitialized();let{id:t,reason:r}=e,i=this.getPendingAuthRequest(t);if(!i)throw Error(`Could not find pending auth request with id ${t}`);i.transportType===mT&&await this.confirmOnlineStateOrThrow();let n=i.requester.publicKey,s=await this.client.core.crypto.generateKeyPair(),a=yX(n);await this.sendError({id:t,topic:a,error:r,encodeOpts:{type:1,receiverPublicKey:n,senderPublicKey:s},rpcOpts:b0.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),await this.client.auth.requests.delete(t,{message:"rejected",code:0}),await this.deleteProposal(t)}),va(this,"formatAuthMessage",e=>{this.isInitialized();let{request:t,iss:r}=e;return pG(t,r)}),va(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{let e=this.relayMessageCache.shift();e&&await this.onRelayMessage(e)}catch(e){this.client.logger.error(e)}},50)}),va(this,"cleanupDuplicatePairings",async e=>{if(e.pairingTopic)try{let t=this.client.core.pairing.pairings.get(e.pairingTopic),r=this.client.core.pairing.pairings.getAll().filter(r=>{var i,n;return(null==(i=r.peerMetadata)?void 0:i.url)&&(null==(n=r.peerMetadata)?void 0:n.url)===e.peer.metadata.url&&r.topic&&r.topic!==t.topic});if(0===r.length)return;this.client.logger.info(`Cleaning up ${r.length} duplicate pairing(s)`),await Promise.all(r.map(e=>this.client.core.pairing.disconnect({topic:e.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(e){this.client.logger.error(e)}}),va(this,"deleteSession",async e=>{var t;let{topic:r,expirerHasDeleted:i=!1,emitEvent:n=!0,id:s=0}=e,{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await this.client.session.delete(r,gC("USER_DISCONNECTED")),this.addToRecentlyDeleted(r,"session"),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),i||this.client.core.expirer.del(r),this.client.core.storage.removeItem(bY).catch(e=>this.client.logger.warn(e)),this.getPendingSessionRequests().forEach(e=>{e.topic===r&&this.deletePendingSessionRequest(e.id,gC("USER_DISCONNECTED"))}),r===(null==(t=this.sessionRequestQueue.queue[0])?void 0:t.topic)&&(this.sessionRequestQueue.state=b2),n&&this.client.events.emit("session_delete",{id:s,topic:r})}),va(this,"deleteProposal",async(e,t)=>{if(t)try{let t=this.client.proposal.get(e),r=this.client.core.eventClient.getEvent({topic:t.pairingTopic});r?.setError("proposal_expired")}catch{}await Promise.all([this.client.proposal.delete(e,gC("USER_DISCONNECTED")),t?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"proposal")}),va(this,"deletePendingSessionRequest",async(e,t,r=!1)=>{await Promise.all([this.client.pendingRequest.delete(e,t),r?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(t=>t.id!==e),r&&(this.sessionRequestQueue.state=b2,this.client.events.emit("session_request_expire",{id:e}))}),va(this,"deletePendingAuthRequest",async(e,t,r=!1)=>{await Promise.all([this.client.auth.requests.delete(e,t),r?Promise.resolve():this.client.core.expirer.del(e)])}),va(this,"setExpiry",async(e,t)=>{this.client.session.keys.includes(e)&&(this.client.core.expirer.set(e,t),await this.client.session.update(e,{expiry:t}))}),va(this,"setProposal",async(e,t)=>{this.client.core.expirer.set(e,u9(b0.wc_sessionPropose.req.ttl)),await this.client.proposal.set(e,t)}),va(this,"setAuthRequest",async(e,t)=>{let{request:r,pairingTopic:i,transportType:n=mT}=t;this.client.core.expirer.set(e,r.expiryTimestamp),await this.client.auth.requests.set(e,{authPayload:r.authPayload,requester:r.requester,expiryTimestamp:r.expiryTimestamp,id:e,pairingTopic:i,verifyContext:r.verifyContext,transportType:n})}),va(this,"setPendingSessionRequest",async e=>{let{id:t,topic:r,params:i,verifyContext:n}=e,s=i.request.expiryTimestamp||u9(b0.wc_sessionRequest.req.ttl);this.client.core.expirer.set(t,s),await this.client.pendingRequest.set(t,{id:t,topic:r,params:i,verifyContext:n})}),va(this,"sendRequest",async t=>{let r,i,{topic:n,method:s,params:a,expiry:o,relayRpcId:l,clientRpcId:c,throwOnFailedPublish:d,appLink:u,tvf:h,publishOpts:p={}}=t,f=(0,ml.formatJsonRpcRequest)(s,a,c),y=!!u;try{let e=y?yG:yZ;r=await this.client.core.crypto.encode(n,f,{encoding:e})}catch(e){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),e}if(b8.includes(s)){let e=y0(JSON.stringify(f)),t=y0(r);i=await this.client.core.verify.register({id:t,decryptedId:e})}let g=vs(vs({},b0[s].req),p);if(g.attestation=i,o&&(g.ttl=o),l&&(g.id=l),this.client.core.history.set(n,f),y){let t=gu(u,n,r);await e.g.Linking.openURL(t,this.client.name)}else{let e;g.tvf=b9(vs({},h),ve({correlationId:f.id})),d?(e=vs({},g.internal),g.internal=b9(e,ve({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(n,r,g)):this.client.core.relayer.publish(n,r,g).catch(e=>this.client.logger.error(e))}return f.id}),va(this,"sendProposeSession",async e=>{let{proposal:t,publishOpts:r}=e,i=(0,ml.formatJsonRpcRequest)("wc_sessionPropose",t,t.id);this.client.core.history.set(t.pairingTopic,i);let n=await this.client.core.crypto.encode(t.pairingTopic,i,{encoding:yZ}),s=y0(JSON.stringify(i)),a=y0(n),o=await this.client.core.verify.register({id:a,decryptedId:s});await this.client.core.relayer.publishCustom({payload:{pairingTopic:t.pairingTopic,sessionProposal:n},opts:b9(vs({},r),ve({publishMethod:"wc_proposeSession",attestation:o}))})}),va(this,"sendApproveSession",async e=>{let{sessionTopic:t,pairingProposalResponse:r,proposal:i,sessionSettleRequest:n,publishOpts:s}=e,a=(0,ml.formatJsonRpcResult)(i.id,r),o=await this.client.core.crypto.encode(i.pairingTopic,a,{encoding:yZ}),l=(0,ml.formatJsonRpcRequest)("wc_sessionSettle",n,s?.id),c=await this.client.core.crypto.encode(t,l,{encoding:yZ});this.client.core.history.set(t,l),await this.client.core.relayer.publishCustom({payload:{sessionTopic:t,pairingTopic:i.pairingTopic,sessionProposalResponse:o,sessionSettlementRequest:c},opts:b9(vs({},s),ve({publishMethod:"wc_approveSession"}))})}),va(this,"sendResult",async t=>{let r,i,n,{id:s,topic:a,result:o,throwOnFailedPublish:l,encodeOpts:c,appLink:d}=t,u=(0,ml.formatJsonRpcResult)(s,o),h=d&&"u">typeof(null==e.g?void 0:e.g.Linking);try{let e,t,i=h?yG:yZ;r=await this.client.core.crypto.encode(a,u,(e=vs({},c||{}),t={encoding:i},b9(e,ve(t))))}catch(e){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${a} failed`),e}try{let e=(i=await this.client.core.history.get(a,s)).request;try{n=this.getTVFParams(s,e.params,o)}catch(e){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${e?.message}`)}}catch(e){throw this.client.logger.error(`sendResult() -> history.get(${a}, ${s}) failed`),e}if(h){let t=gu(d,a,r);await e.g.Linking.openURL(t,this.client.name)}else{let e,t=b0[i.request.method].res;t.tvf=b9(vs({},n),ve({correlationId:s})),l?(e=vs({},t.internal),t.internal=b9(e,ve({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(a,r,t)):this.client.core.relayer.publish(a,r,t).catch(e=>this.client.logger.error(e))}await this.client.core.history.resolve(u)}),va(this,"sendError",async t=>{let r,i,{id:n,topic:s,error:a,encodeOpts:o,rpcOpts:l,appLink:c}=t,d=(0,ml.formatJsonRpcError)(n,a),u=c&&"u">typeof(null==e.g?void 0:e.g.Linking);try{let e,t,i=u?yG:yZ;r=await this.client.core.crypto.encode(s,d,(e=vs({},o||{}),t={encoding:i},b9(e,ve(t))))}catch(e){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),e}try{i=await this.client.core.history.get(s,n)}catch(e){throw this.client.logger.error(`sendError() -> history.get(${s}, ${n}) failed`),e}if(u){let t=gu(c,s,r);await e.g.Linking.openURL(t,this.client.name)}else{let e=i.request.method,t=l||b0[e].res;this.client.core.relayer.publish(s,r,t)}await this.client.core.history.resolve(d)}),va(this,"cleanup",async()=>{let e=[],t=[];this.client.session.getAll().forEach(t=>{let r=!1;he(t.expiry)&&(r=!0),this.client.core.crypto.keychain.has(t.topic)||(r=!0),r&&e.push(t.topic)}),this.client.proposal.getAll().forEach(e=>{he(e.expiryTimestamp)&&t.push(e.id)}),await Promise.all([...e.map(e=>this.deleteSession({topic:e})),...t.map(e=>this.deleteProposal(e))])}),va(this,"onProviderMessageEvent",async e=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(e):await this.onRelayMessage(e)}),va(this,"onRelayEventRequest",async e=>{this.requestQueue.queue.push(e),await this.processRequestsQueue()}),va(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===b3)return void this.client.logger.info("Request queue already active, skipping...");for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=b3;let e=this.requestQueue.queue.shift();if(e)try{await this.processRequest(e)}catch(e){this.client.logger.warn(e)}}this.requestQueue.state=b2}),va(this,"processRequest",async e=>{let{topic:t,payload:r,attestation:i,transportType:n,encryptedId:s}=e,a=r.method;if(!this.shouldIgnorePairingRequest({topic:t,requestMethod:a}))switch(a){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:t,payload:r,attestation:i,encryptedId:s});case"wc_sessionSettle":return await this.onSessionSettleRequest(t,r);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(t,r);case"wc_sessionExtend":return await this.onSessionExtendRequest(t,r);case"wc_sessionPing":return await this.onSessionPingRequest(t,r);case"wc_sessionDelete":return await this.onSessionDeleteRequest(t,r);case"wc_sessionRequest":return await this.onSessionRequest({topic:t,payload:r,attestation:i,encryptedId:s,transportType:n});case"wc_sessionEvent":return await this.onSessionEventRequest(t,r);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:t,payload:r,attestation:i,encryptedId:s,transportType:n});default:return this.client.logger.info(`Unsupported request method ${a}`)}}),va(this,"onRelayEventResponse",async e=>{let{topic:t,payload:r,transportType:i}=e,n=(await this.client.core.history.get(t,r.id)).request.method;switch(n){case"wc_sessionPropose":return this.onSessionProposeResponse(t,r,i);case"wc_sessionSettle":return this.onSessionSettleResponse(t,r);case"wc_sessionUpdate":return this.onSessionUpdateResponse(t,r);case"wc_sessionExtend":return this.onSessionExtendResponse(t,r);case"wc_sessionPing":return this.onSessionPingResponse(t,r);case"wc_sessionRequest":return this.onSessionRequestResponse(t,r);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(t,r);default:return this.client.logger.info(`Unsupported response method ${n}`)}}),va(this,"onRelayEventUnknownPayload",e=>{let{topic:t}=e,{message:r}=gT("MISSING_OR_INVALID",`Decoded payload on topic ${t} is not identifiable as a JSON-RPC request or a response.`);throw Error(r)}),va(this,"shouldIgnorePairingRequest",e=>{let{topic:t,requestMethod:r}=e,i=this.expectedPairingMethodMap.get(t);return!(!i||i.includes(r))&&!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),va(this,"onSessionProposeRequest",async e=>{let{topic:t,payload:r,attestation:i,encryptedId:n}=e,{params:s,id:a}=r;try{let e=this.client.core.eventClient.getEvent({topic:t});0===this.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),e?.setError("proposal_listener_not_found")),this.isValidConnect(vs({},r.params));let o=s.expiryTimestamp||u9(b0.wc_sessionPropose.req.ttl),l=vs({id:a,pairingTopic:t,expiryTimestamp:o,attestation:i,encryptedId:n},s);await this.setProposal(a,l);let c=await this.getVerifyContext({attestationId:i,hash:y0(JSON.stringify(r)),encryptedId:n,metadata:l.proposer.metadata});e?.addTrace("emit_session_proposal"),this.client.events.emit("session_proposal",{id:a,params:l,verifyContext:c})}catch(e){await this.sendError({id:a,topic:t,error:e,rpcOpts:b0.wc_sessionPropose.autoReject}),this.client.logger.error(e)}}),va(this,"onSessionProposeResponse",async(e,t,r)=>{let{id:i}=t;if((0,mc.isJsonRpcResult)(t)){let{result:n}=t;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:n});let s=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:s});let a=s.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:a});let o=n.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:o});let l=await this.client.core.crypto.generateSharedKey(a,o);this.pendingSessions.set(i,{sessionTopic:l,pairingTopic:e,proposalId:i,publicKey:a});let c=await this.client.core.relayer.subscribe(l,{transportType:r});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:c}),await this.client.core.pairing.activate({topic:e})}else if((0,mc.isJsonRpcError)(t)){await this.deleteProposal(i);let e=ht("session_connect",i);if(0===this.events.listenerCount(e))throw Error(`emitting ${e} without any listeners, 954`);this.events.emit(e,{error:t.error})}}),va(this,"onSessionSettleRequest",async(e,t)=>{let{id:r,params:i}=t;try{let r,n;this.isValidSessionSettleRequest(i);let{relay:s,controller:a,expiry:o,namespaces:l,sessionProperties:c,scopedProperties:d,sessionConfig:u}=t.params,h=[...this.pendingSessions.values()].find(t=>t.sessionTopic===e);if(!h)return this.client.logger.error(`Pending session not found for topic ${e}`);let p=this.client.proposal.get(h.proposalId),f=(r=vs(vs(vs({topic:e,relay:s,expiry:o,namespaces:l,acknowledged:!0,pairingTopic:h.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:h.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},c&&{sessionProperties:c}),d&&{scopedProperties:d}),u&&{sessionConfig:u}),n={transportType:mT},b9(r,ve(n)));await this.client.session.set(f.topic,f),await this.setExpiry(f.topic,f.expiry),await this.client.core.pairing.updateMetadata({topic:h.pairingTopic,metadata:f.peer.metadata}),this.client.events.emit("session_connect",{session:f}),this.events.emit(ht("session_connect",h.proposalId),{session:f}),this.pendingSessions.delete(h.proposalId),this.deleteProposal(h.proposalId,!1),this.cleanupDuplicatePairings(f),await this.sendResult({id:t.id,topic:e,result:!0})}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),va(this,"onSessionSettleResponse",async(e,t)=>{let{id:r}=t;(0,mc.isJsonRpcResult)(t)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(ht("session_approve",r),{})):(0,mc.isJsonRpcError)(t)&&(await this.client.session.delete(e,gC("USER_DISCONNECTED")),this.events.emit(ht("session_approve",r),{error:t.error}))}),va(this,"onSessionUpdateRequest",async(e,t)=>{let{params:r,id:i}=t;try{let t=`${e}_session_update`,n=gV.get(t);if(n&&this.isRequestOutOfSync(n,i)){this.client.logger.warn(`Discarding out of sync request - ${i}`),this.sendError({id:i,topic:e,error:gC("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(vs({topic:e},r));try{gV.set(t,i),await this.client.session.update(e,{namespaces:r.namespaces}),await this.sendResult({id:i,topic:e,result:!0})}catch(e){throw gV.delete(t),e}this.client.events.emit("session_update",{id:i,topic:e,params:r})}catch(t){await this.sendError({id:i,topic:e,error:t}),this.client.logger.error(t)}}),va(this,"isRequestOutOfSync",(e,t)=>t.toString().slice(0,-3)<e.toString().slice(0,-3)),va(this,"onSessionUpdateResponse",(e,t)=>{let{id:r}=t,i=ht("session_update",r);if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners`);(0,mc.isJsonRpcResult)(t)?this.events.emit(ht("session_update",r),{}):(0,mc.isJsonRpcError)(t)&&this.events.emit(ht("session_update",r),{error:t.error})}),va(this,"onSessionExtendRequest",async(e,t)=>{let{id:r}=t;try{this.isValidExtend({topic:e}),await this.setExpiry(e,u9(bX)),await this.sendResult({id:r,topic:e,result:!0}),this.client.events.emit("session_extend",{id:r,topic:e})}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),va(this,"onSessionExtendResponse",(e,t)=>{let{id:r}=t,i=ht("session_extend",r);if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners`);(0,mc.isJsonRpcResult)(t)?this.events.emit(ht("session_extend",r),{}):(0,mc.isJsonRpcError)(t)&&this.events.emit(ht("session_extend",r),{error:t.error})}),va(this,"onSessionPingRequest",async(e,t)=>{let{id:r}=t;try{this.isValidPing({topic:e}),await this.sendResult({id:r,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:r,topic:e})}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),va(this,"onSessionPingResponse",(e,t)=>{let{id:r}=t,i=ht("session_ping",r);setTimeout(()=>{if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners 2176`);(0,mc.isJsonRpcResult)(t)?this.events.emit(ht("session_ping",r),{}):(0,mc.isJsonRpcError)(t)&&this.events.emit(ht("session_ping",r),{error:t.error})},500)}),va(this,"onSessionDeleteRequest",async(e,t)=>{let{id:r}=t;try{this.isValidDisconnect({topic:e,reason:t.params}),await Promise.all([new Promise(t=>{this.client.core.relayer.once(mE,async()=>{t(await this.deleteSession({topic:e,id:r}))})}),this.sendResult({id:r,topic:e,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:e,error:gC("USER_DISCONNECTED")})]).catch(e=>this.client.logger.error(e))}catch(e){this.client.logger.error(e)}}),va(this,"onSessionRequest",async e=>{var t,r,i;let{topic:n,payload:s,attestation:a,encryptedId:o,transportType:l}=e,{id:c,params:d}=s;try{await this.isValidRequest(vs({topic:n},d));let e=this.client.session.get(n),s=await this.getVerifyContext({attestationId:a,hash:y0(JSON.stringify((0,ml.formatJsonRpcRequest)("wc_sessionRequest",d,c))),encryptedId:o,metadata:e.peer.metadata,transportType:l}),u={id:c,topic:n,params:d,verifyContext:s};await this.setPendingSessionRequest(u),l===mk&&null!=(t=e.peer.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(null==(r=e.peer.metadata.redirect)?void 0:r.universal),null!=(i=this.client.signConfig)&&i.disableRequestQueue?this.emitSessionRequest(u):(this.addSessionRequestToSessionRequestQueue(u),this.processSessionRequestQueue())}catch(e){await this.sendError({id:c,topic:n,error:e}),this.client.logger.error(e)}}),va(this,"onSessionRequestResponse",(e,t)=>{let{id:r}=t,i=ht("session_request",r);if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners`);(0,mc.isJsonRpcResult)(t)?this.events.emit(ht("session_request",r),{result:t.result}):(0,mc.isJsonRpcError)(t)&&this.events.emit(ht("session_request",r),{error:t.error})}),va(this,"onSessionEventRequest",async(e,t)=>{let{id:r,params:i}=t;try{let t=`${e}_session_event_${i.event.name}`,n=gV.get(t);if(n&&this.isRequestOutOfSync(n,r))return void this.client.logger.info(`Discarding out of sync request - ${r}`);this.isValidEmit(vs({topic:e},i)),this.client.events.emit("session_event",{id:r,topic:e,params:i}),gV.set(t,r)}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),va(this,"onSessionAuthenticateResponse",(e,t)=>{let{id:r}=t;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:e,payload:t}),(0,mc.isJsonRpcResult)(t)?this.events.emit(ht("session_request",r),{result:t.result}):(0,mc.isJsonRpcError)(t)&&this.events.emit(ht("session_request",r),{error:t.error})}),va(this,"onSessionAuthenticateRequest",async e=>{var t;let{topic:r,payload:i,attestation:n,encryptedId:s,transportType:a}=e;try{let{requester:e,authPayload:o,expiryTimestamp:l}=i.params,c=await this.getVerifyContext({attestationId:n,hash:y0(JSON.stringify(i)),encryptedId:s,metadata:e.metadata,transportType:a}),d={requester:e,pairingTopic:r,id:i.id,authPayload:o,verifyContext:c,expiryTimestamp:l};await this.setAuthRequest(i.id,{request:d,pairingTopic:r,transportType:a}),a===mk&&null!=(t=e.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(e.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:r,params:i.params,id:i.id,verifyContext:c})}catch(s){this.client.logger.error(s);let e=i.params.requester.publicKey,t=await this.client.core.crypto.generateKeyPair(),n=this.getAppLinkIfEnabled(i.params.requester.metadata,a);await this.sendError({id:i.id,topic:r,error:s,encodeOpts:{type:1,receiverPublicKey:e,senderPublicKey:t},rpcOpts:b0.wc_sessionAuthenticate.autoReject,appLink:n})}}),va(this,"addSessionRequestToSessionRequestQueue",e=>{this.sessionRequestQueue.queue.push(e)}),va(this,"cleanupAfterResponse",e=>{this.deletePendingSessionRequest(e.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=b2,this.processSessionRequestQueue()},(0,oL.toMiliseconds)(this.requestQueueDelay))}),va(this,"cleanupPendingSentRequestsForTopic",({topic:e,error:t})=>{let r=this.client.core.history.pending;r.length>0&&r.filter(t=>t.topic===e&&"wc_sessionRequest"===t.request.method).forEach(e=>{let r=ht("session_request",e.request.id);if(0===this.events.listenerCount(r))throw Error(`emitting ${r} without any listeners`);this.events.emit(ht("session_request",e.request.id),{error:t})})}),va(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===b3)return void this.client.logger.info("session request queue is already active.");let e=this.sessionRequestQueue.queue[0];if(!e)return void this.client.logger.info("session request queue is empty.");try{this.emitSessionRequest(e)}catch(e){this.client.logger.error(e)}}),va(this,"emitSessionRequest",e=>{this.emittedSessionRequests.has(e.id)?this.client.logger.warn({id:e.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${e.id}`):(this.sessionRequestQueue.state=b3,this.emittedSessionRequests.add(e.id),this.client.events.emit("session_request",e))}),va(this,"onPairingCreated",e=>{if(e.methods&&this.expectedPairingMethodMap.set(e.topic,e.methods),e.active)return;let t=this.client.proposal.getAll().find(t=>t.pairingTopic===e.topic);t&&this.onSessionProposeRequest({topic:e.topic,payload:(0,ml.formatJsonRpcRequest)("wc_sessionPropose",b9(vs({},t),ve({requiredNamespaces:t.requiredNamespaces,optionalNamespaces:t.optionalNamespaces,relays:t.relays,proposer:t.proposer,sessionProperties:t.sessionProperties,scopedProperties:t.scopedProperties})),t.id),attestation:t.attestation,encryptedId:t.encryptedId})}),va(this,"isValidConnect",async e=>{let t;if(!gW(e)){let{message:t}=gT("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(e)}`);throw Error(t)}let{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:n,sessionProperties:s,scopedProperties:a,relays:o}=e;if(gR(r)||await this.isValidPairingTopic(r),t=!1,o?o&&gP(o)&&o.length&&o.forEach(e=>{t=gB(e)}):t=!0,!t){let{message:e}=gT("MISSING_OR_INVALID",`connect() relays: ${o}`);throw Error(e)}if(i&&!gR(i)&&0!==gO(i)){let e="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(e):this.client.logger.warn(e),this.validateNamespaces(i,"requiredNamespaces")}if(n&&!gR(n)&&0!==gO(n)&&this.validateNamespaces(n,"optionalNamespaces"),s&&!gR(s)&&this.validateSessionProps(s,"sessionProperties"),a&&!gR(a)){this.validateSessionProps(a,"scopedProperties");let e=Object.keys(i||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(t=>e.includes(t.split(":")[0])))throw Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(e)}`)}}),va(this,"validateNamespaces",(e,t)=>{let r=function(e,t,r){let i=null;if(e&&gO(e)){let n,s=gL(e,t);s&&(i=s);let a=(n=null,Object.entries(e).forEach(([e,i])=>{var s,a;let o;if(n)return;let l=(s=uD(e,i),a=`${t} ${r}`,o=null,gP(s)&&s.length?s.forEach(e=>{o||gU(e)||(o=gC("UNSUPPORTED_CHAINS",`${a}, chain ${e} should be a string and conform to "namespace:chainId" format`))}):gU(e)||(o=gC("UNSUPPORTED_CHAINS",`${a}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),o);l&&(n=l)}),n);a&&(i=a)}else i=gT("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return i}(e,"connect()",t);if(r)throw Error(r.message)}),va(this,"isValidApprove",async e=>{if(!gW(e))throw Error(gT("MISSING_OR_INVALID",`approve() params: ${e}`).message);let{id:t,namespaces:r,relayProtocol:i,sessionProperties:n,scopedProperties:s}=e;this.checkRecentlyDeleted(t),await this.isValidProposalId(t);let a=this.client.proposal.get(t),o=gj(r,"approve()");if(o)throw Error(o.message);let l=gH(a.requiredNamespaces,r,"approve()");if(l)throw Error(l.message);if(!gN(i,!0)){let{message:e}=gT("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw Error(e)}if(n&&!gR(n)&&this.validateSessionProps(n,"sessionProperties"),s&&!gR(s)){this.validateSessionProps(s,"scopedProperties");let e=new Set(Object.keys(r));if(!Object.keys(s).every(t=>e.has(t.split(":")[0])))throw Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(s)}, approved namespaces: ${Array.from(e).join(", ")}`)}}),va(this,"isValidReject",async e=>{if(!gW(e)){let{message:t}=gT("MISSING_OR_INVALID",`reject() params: ${e}`);throw Error(t)}let{id:t,reason:r}=e;if(this.checkRecentlyDeleted(t),await this.isValidProposalId(t),!r||"object"!=typeof r||!r.code||!gM(r.code,!1)||!r.message||!gN(r.message,!1)){let{message:e}=gT("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(r)}`);throw Error(e)}}),va(this,"isValidSessionSettleRequest",e=>{let t;if(!gW(e)){let{message:t}=gT("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${e}`);throw Error(t)}let{relay:r,controller:i,namespaces:n,expiry:s}=e;if(!gB(r)){let{message:e}=gT("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw Error(e)}let a=(t=null,gN(i?.publicKey,!1)||(t=gT("MISSING_OR_INVALID","onSessionSettleRequest() controller public key should be a string")),t);if(a)throw Error(a.message);let o=gj(n,"onSessionSettleRequest()");if(o)throw Error(o.message);if(he(s)){let{message:e}=gT("EXPIRED","onSessionSettleRequest()");throw Error(e)}}),va(this,"isValidUpdate",async e=>{if(!gW(e)){let{message:t}=gT("MISSING_OR_INVALID",`update() params: ${e}`);throw Error(t)}let{topic:t,namespaces:r}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);let i=this.client.session.get(t),n=gj(r,"update()");if(n)throw Error(n.message);let s=gH(i.requiredNamespaces,r,"update()");if(s)throw Error(s.message)}),va(this,"isValidExtend",async e=>{if(!gW(e)){let{message:t}=gT("MISSING_OR_INVALID",`extend() params: ${e}`);throw Error(t)}let{topic:t}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t)}),va(this,"isValidRequest",async e=>{var t;let r;if(!gW(e)){let{message:t}=gT("MISSING_OR_INVALID",`request() params: ${e}`);throw Error(t)}let{topic:i,request:n,chainId:s,expiry:a}=e;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);let{namespaces:o}=this.client.session.get(i);if(!gF(o,s)){let{message:e}=gT("MISSING_OR_INVALID",`request() chainId: ${s}`);throw Error(e)}if(gR(n)||!gN(n.method,!1)){let{message:e}=gT("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw Error(e)}if(!(gN(t=n.method,!1)&&(r=[],Object.values(o).forEach(e=>{gE(e.accounts).includes(s)&&r.push(...e.methods)}),r).includes(t))){let{message:e}=gT("MISSING_OR_INVALID",`request() method: ${n.method}`);throw Error(e)}if(a&&(!gM(a,!1)||!(a<=b1.max)||!(a>=b1.min))){let{message:e}=gT("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${b1.min} and ${b1.max}`);throw Error(e)}}),va(this,"isValidRespond",async e=>{var t;if(!gW(e)){let{message:t}=gT("MISSING_OR_INVALID",`respond() params: ${e}`);throw Error(t)}let{topic:r,response:i}=e;try{await this.isValidSessionTopic(r)}catch(r){throw null!=(t=e?.response)&&t.id&&this.cleanupAfterResponse(e),r}if(gR(i)||gR(i.result)&&gR(i.error)||!gM(i.id,!1)||!gN(i.jsonrpc,!1)){let{message:e}=gT("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw Error(e)}let n=this.client.pendingRequest.get(i.id);if(n.topic!==r){let{message:e}=gT("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${i.id}, expected topic: ${n.topic}, received topic: ${r}`);throw Error(e)}}),va(this,"isValidPing",async e=>{if(!gW(e)){let{message:t}=gT("MISSING_OR_INVALID",`ping() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),va(this,"isValidEmit",async e=>{var t;let r;if(!gW(e)){let{message:t}=gT("MISSING_OR_INVALID",`emit() params: ${e}`);throw Error(t)}let{topic:i,event:n,chainId:s}=e;await this.isValidSessionTopic(i);let{namespaces:a}=this.client.session.get(i);if(!gF(a,s)){let{message:e}=gT("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw Error(e)}if(gR(n)||!gN(n.name,!1)||!(gN(t=n.name,!1)&&(r=[],Object.values(a).forEach(e=>{gE(e.accounts).includes(s)&&r.push(...e.events)}),r).includes(t))){let{message:e}=gT("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw Error(e)}}),va(this,"isValidDisconnect",async e=>{if(!gW(e)){let{message:t}=gT("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),va(this,"isValidAuthenticate",e=>{let{chains:t,uri:r,domain:i,nonce:n}=e;if(!Array.isArray(t)||0===t.length)throw Error("chains is required and must be a non-empty array");if(!gN(r,!1))throw Error("uri is required parameter");if(!gN(i,!1))throw Error("domain is required parameter");if(!gN(n,!1))throw Error("nonce is required parameter");if([...new Set(t.map(e=>uM(e).namespace))].length>1)throw Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:s}=uM(t[0]);if("eip155"!==s)throw Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),va(this,"getVerifyContext",async e=>{let{attestationId:t,hash:r,encryptedId:i,metadata:n,transportType:s}=e,a={verified:{verifyUrl:n.verifyUrl||mH,validation:"UNKNOWN",origin:n.url||""}};try{if(s===mk){let e=this.getAppLinkIfEnabled(n,s);return a.verified.validation=e&&new URL(e).origin===new URL(n.url).origin?"VALID":"INVALID",a}let e=await this.client.core.verify.resolve({attestationId:t,hash:r,encryptedId:i,verifyUrl:n.verifyUrl});e&&(a.verified.origin=e.origin,a.verified.isScam=e.isScam,a.verified.validation=e.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(e){this.client.logger.warn(e)}return this.client.logger.debug(`Verify context: ${JSON.stringify(a)}`),a}),va(this,"validateSessionProps",(e,t)=>{Object.values(e).forEach((r,i)=>{if(null==r){let{message:n}=gT("MISSING_OR_INVALID",`${t} must contain an existing value for each key. Received: ${r} for key ${Object.keys(e)[i]}`);throw Error(n)}})}),va(this,"getPendingAuthRequest",e=>{let t=this.client.auth.requests.get(e);return"object"==typeof t?t:void 0}),va(this,"addToRecentlyDeleted",(e,t)=>{if(this.recentlyDeletedMap.set(e,t),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let e=0,t=this.recentlyDeletedLimit/2;for(let r of this.recentlyDeletedMap.keys()){if(e++>=t)break;this.recentlyDeletedMap.delete(r)}}}),va(this,"checkRecentlyDeleted",e=>{let t=this.recentlyDeletedMap.get(e);if(t){let{message:r}=gT("MISSING_OR_INVALID",`Record was recently deleted - ${t}: ${e}`);throw Error(r)}}),va(this,"isLinkModeEnabled",(t,r)=>{var i,n,s,a,o,l,c,d,u;return!!t&&r===mk&&(null==(n=null==(i=this.client.metadata)?void 0:i.redirect)?void 0:n.linkMode)===!0&&(null==(a=null==(s=this.client.metadata)?void 0:s.redirect)?void 0:a.universal)!==void 0&&(null==(l=null==(o=this.client.metadata)?void 0:o.redirect)?void 0:l.universal)!==""&&(null==(c=t?.redirect)?void 0:c.universal)!==void 0&&(null==(d=t?.redirect)?void 0:d.universal)!==""&&(null==(u=t?.redirect)?void 0:u.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&"u">typeof(null==e.g?void 0:e.g.Linking)}),va(this,"getAppLinkIfEnabled",(e,t)=>{var r;return this.isLinkModeEnabled(e,t)?null==(r=e?.redirect)?void 0:r.universal:void 0}),va(this,"handleLinkModeMessage",({url:e})=>{if(!e||!e.includes("wc_ev")||!e.includes("topic"))return;let t=hs(e,"topic")||"",r=decodeURIComponent(hs(e,"wc_ev")||""),i=this.client.session.keys.includes(t);i&&this.client.session.update(t,{transportType:mk}),this.client.core.dispatchEnvelope({topic:t,message:r,sessionExists:i})}),va(this,"registerLinkModeListeners",async()=>{var t;if(ho()||uG()&&null!=(t=this.client.metadata.redirect)&&t.linkMode){let t=null==e.g?void 0:e.g.Linking;if("u">typeof t){t.addEventListener("url",this.handleLinkModeMessage,this.client.name);let e=await t.getInitialURL();e&&setTimeout(()=>{this.handleLinkModeMessage({url:e})},50)}}}),va(this,"getTVFParams",(e,t,r)=>{var i,n,s;if(!(null!=(i=t.request)&&i.method))return{};let a={correlationId:e,rpcMethods:[t.request.method],chainId:t.chainId};try{a.txHashes=this.extractTxHashesFromResult(t.request,r),a.contractAddresses=this.isValidContractData(t.request.params)?[null==(s=null==(n=t.request.params)?void 0:n[0])?void 0:s.to]:[]}catch(e){this.client.logger.warn(e,"Error getting TVF params")}return a}),va(this,"isValidContractData",e=>{var t;if(!e)return!1;try{let r=e?.data||(null==(t=e?.[0])?void 0:t.data);if(!r.startsWith("0x"))return!1;let i=r.slice(2);return!!/^[0-9a-fA-F]*$/.test(i)&&i.length%2==0}catch{}return!1}),va(this,"extractTxHashesFromResult",(e,t)=>{var r,i,n,s,a;try{if(!t)return[];let o=e.method,l=b5[o];if("sui_signTransaction"===o){let e,r,i,s;return[(n=t.transactionBytes,e=new Uint8Array(t3.Buffer.from(n,"base64")),r=Array.from("TransactionData::").map(e=>e.charCodeAt(0)),(i=new Uint8Array(r.length+e.length)).set(r),i.set(e,r.length),s=pR(i,{dkLen:32}),ue.default.encode(s))]}if("near_signTransaction"===o)return[pD(t)];if("near_signTransactions"===o)return t.map(e=>pD(e));if("xrpl_signTransactionFor"===o||"xrpl_signTransaction"===o)return[null==(r=t.tx_json)?void 0:r.hash];if("polkadot_signTransaction"===o){let r,n,s,a;return[(i={transaction:e.params.transactionPayload,signature:t.signature},s=Uint8Array.from(t3.Buffer.from(i.signature,"hex")),a=function({publicKey:e,signature:t,payload:r}){var i,n,s;let a,o=gJ(r.method),l=128|parseInt((null==(i=r.version)?void 0:i.toString())||"4"),c=(n=r.address,a=ue.default.decode(n)[0],42===a?0:60===a?2:1),d="00"===r.era?new Uint8Array([0]):gJ(r.era);if(1!==d.length&&2!==d.length)throw Error("Invalid era length");let u=parseInt(r.nonce,16),h=new Uint8Array([255&u,u>>8&255]),p=new Uint8Array([0,...e,c,...t,...d,...h,...function(e){if(e<BigInt(1)<<BigInt(6))return new Uint8Array([Number(e<<BigInt(2))]);if(e<BigInt(1)<<BigInt(14)){let t=e<<BigInt(2)|BigInt(1);return new Uint8Array([Number(t&BigInt(255)),Number(t>>BigInt(8)&BigInt(255))])}if(e<BigInt(1)<<BigInt(30)){let t=e<<BigInt(2)|BigInt(2);return new Uint8Array([Number(t&BigInt(255)),Number(t>>BigInt(8)&BigInt(255)),Number(t>>BigInt(16)&BigInt(255)),Number(t>>BigInt(24)&BigInt(255))])}throw Error("BigInt compact encoding not supported > 2^30")}(BigInt(`0x${(s=r.tip).startsWith("0x")?s.slice(2):s}`)),...o]);return new Uint8Array([...function(e){if(e<64)return new Uint8Array([e<<2]);if(e<16384){let t=e<<2|1;return new Uint8Array([255&t,t>>8&255])}if(e<0x40000000){let t=e<<2|2;return new Uint8Array([255&t,t>>8&255,t>>16&255,t>>24&255])}throw Error("Compact encoding > 2^30 not supported")}(p.length+1),l,...p])}({publicKey:function(e){let t=ue.default.decode(e);if(t.length<33)throw Error("Too short to contain a public key");return t.slice(1,33)}(i.transaction.address),signature:s,payload:i.transaction}),r=gJ(t3.Buffer.from(a).toString("hex")),n=(0,ul.blake2b)(r,void 0,32),"0x"+t3.Buffer.from(n).toString("hex"))]}if("algo_signTxn"===o)return gP(t)?t.map(e=>pL(e)):[pL(t)];if("cosmos_signDirect"===o){let e,r,i,n,s;return[(e=t3.Buffer.from(t.signed.bodyBytes,"base64"),r=t3.Buffer.from(t.signed.authInfoBytes,"base64"),i=t3.Buffer.from(t.signature.signature,"base64"),(n=[]).push(t3.Buffer.from([10])),n.push(pj(e.length)),n.push(e),n.push(t3.Buffer.from([18])),n.push(pj(r.length)),n.push(r),n.push(t3.Buffer.from([26])),n.push(pj(i.length)),n.push(i),s=pE(t3.Buffer.concat(n)),t3.Buffer.from(s).toString("hex").toUpperCase())]}if("wallet_sendCalls"===o){let e=[];try{if("string"==typeof t)return e.push(t),e;if("object"!=typeof t)return e;null!=t&&t.id&&e.push(t.id);let r=null==(a=null==(s=t?.capabilities)?void 0:s.caip345)?void 0:a.transactionHashes;r&&e.push(...r)}catch(e){console.warn("getWalletSendCallsHashes failed: ",e)}return e}if("string"==typeof t)return[t];let c=t[l.key];if(gP(c))return"solana_signAllTransactions"===o?c.map(e=>(function(e){let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);let i=r[0];if(0===i)throw Error("No signatures found");if(r.length<1+64*i)throw Error("Transaction data too short for claimed signature count");if(r.length<100)throw Error("Transaction too short");let n=t3.Buffer.from(e,"base64").slice(1,65);return ue.default.encode(n)})(e)):c;if("string"==typeof c)return[c]}catch(e){this.client.logger.warn(e,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{let e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(let[e,r]of Object.entries(t))for(let t of r)try{await this.onProviderMessageEvent({topic:e,message:t,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${e}, message: ${t}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){let{message:e}=gT("NOT_INITIALIZED",this.name);throw Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(mw,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){let{topic:t,message:r,attestation:i,transportType:n}=e,{publicKey:s}=this.client.auth.authKeys.keys.includes(b4)?this.client.auth.authKeys.get(b4):{responseTopic:void 0,publicKey:void 0};try{let e=await this.client.core.crypto.decode(t,r,{receiverPublicKey:s,encoding:n===mk?yG:yZ});(0,mc.isJsonRpcRequest)(e)?(this.client.core.history.set(t,e),await this.onRelayEventRequest({topic:t,payload:e,attestation:i,transportType:n,encryptedId:y0(r)})):(0,mc.isJsonRpcResponse)(e)?(await this.client.core.history.resolve(e),await this.onRelayEventResponse({topic:t,payload:e,transportType:n}),this.client.core.history.delete(t,e.id)):await this.onRelayEventUnknownPayload({topic:t,payload:e,transportType:n}),await this.client.core.relayer.messages.ack(t,r)}catch(e){this.client.logger.error(e)}}registerExpirerEvents(){this.client.core.expirer.on(mF,async e=>{let{topic:t,id:r}=u7(e.target);return r&&this.client.pendingRequest.keys.includes(r)?await this.deletePendingSessionRequest(r,gT("EXPIRED"),!0):r&&this.client.auth.requests.keys.includes(r)?await this.deletePendingAuthRequest(r,gT("EXPIRED"),!0):void(t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r})))})}registerPairingEvents(){this.client.core.pairing.events.on(mM,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(mU,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!gN(e,!1)){let{message:t}=gT("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){let{message:t}=gT("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw Error(t)}if(he(this.client.core.pairing.pairings.get(e).expiry)){let{message:t}=gT("EXPIRED",`pairing topic: ${e}`);throw Error(t)}}async isValidSessionTopic(e){if(!gN(e,!1)){let{message:t}=gT("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){let{message:t}=gT("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw Error(t)}if(he(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});let{message:t}=gT("EXPIRED",`session topic: ${e}`);throw Error(t)}if(!this.client.core.crypto.keychain.has(e)){let{message:t}=gT("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(gN(e,!1)){let{message:t}=gT("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw Error(t)}else{let{message:t}=gT("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw Error(t)}}async isValidProposalId(e){if("number"!=typeof e){let{message:t}=gT("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw Error(t)}if(!this.client.proposal.keys.includes(e)){let{message:t}=gT("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw Error(t)}if(he(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);let{message:t}=gT("EXPIRED",`proposal id: ${e}`);throw Error(t)}}}class vl extends bm{constructor(e,t){super(e,t,"proposal",bG),this.core=e,this.logger=t}}class vc extends bm{constructor(e,t){super(e,t,"session",bG),this.core=e,this.logger=t}}class vd extends bm{constructor(e,t){super(e,t,"request",bG,e=>e.id),this.core=e,this.logger=t}}class vu extends bm{constructor(e,t){super(e,t,"authKeys",b6,()=>b4),this.core=e,this.logger=t}}class vh extends bm{constructor(e,t){super(e,t,"pairingTopics",b6),this.core=e,this.logger=t}}class vp extends bm{constructor(e,t){super(e,t,"requests",b6,e=>e.id),this.core=e,this.logger=t}}var vf=Object.defineProperty,vy=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?vf(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class vg{constructor(e,t){this.core=e,this.logger=t,vy(this,"authKeys"),vy(this,"pairingTopics"),vy(this,"requests"),this.authKeys=new vu(this.core,this.logger),this.pairingTopics=new vh(this.core,this.logger),this.requests=new vp(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var vm=Object.defineProperty,vw=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?vm(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class vb extends ms{constructor(e){super(e),vw(this,"protocol","wc"),vw(this,"version",2),vw(this,"name",bZ),vw(this,"metadata"),vw(this,"core"),vw(this,"logger"),vw(this,"events",new oU.EventEmitter),vw(this,"engine"),vw(this,"session"),vw(this,"proposal"),vw(this,"pendingRequest"),vw(this,"auth"),vw(this,"signConfig"),vw(this,"on",(e,t)=>this.events.on(e,t)),vw(this,"once",(e,t)=>this.events.once(e,t)),vw(this,"off",(e,t)=>this.events.off(e,t)),vw(this,"removeListener",(e,t)=>this.events.removeListener(e,t)),vw(this,"removeAllListeners",e=>this.events.removeAllListeners(e)),vw(this,"connect",async e=>{try{return await this.engine.connect(e)}catch(e){throw this.logger.error(e.message),e}}),vw(this,"pair",async e=>{try{return await this.engine.pair(e)}catch(e){throw this.logger.error(e.message),e}}),vw(this,"approve",async e=>{try{return await this.engine.approve(e)}catch(e){throw this.logger.error(e.message),e}}),vw(this,"reject",async e=>{try{return await this.engine.reject(e)}catch(e){throw this.logger.error(e.message),e}}),vw(this,"update",async e=>{try{return await this.engine.update(e)}catch(e){throw this.logger.error(e.message),e}}),vw(this,"extend",async e=>{try{return await this.engine.extend(e)}catch(e){throw this.logger.error(e.message),e}}),vw(this,"request",async e=>{try{return await this.engine.request(e)}catch(e){throw this.logger.error(e.message),e}}),vw(this,"respond",async e=>{try{return await this.engine.respond(e)}catch(e){throw this.logger.error(e.message),e}}),vw(this,"ping",async e=>{try{return await this.engine.ping(e)}catch(e){throw this.logger.error(e.message),e}}),vw(this,"emit",async e=>{try{return await this.engine.emit(e)}catch(e){throw this.logger.error(e.message),e}}),vw(this,"disconnect",async e=>{try{return await this.engine.disconnect(e)}catch(e){throw this.logger.error(e.message),e}}),vw(this,"find",e=>{try{return this.engine.find(e)}catch(e){throw this.logger.error(e.message),e}}),vw(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(e){throw this.logger.error(e.message),e}}),vw(this,"authenticate",async(e,t)=>{try{return await this.engine.authenticate(e,t)}catch(e){throw this.logger.error(e.message),e}}),vw(this,"formatAuthMessage",e=>{try{return this.engine.formatAuthMessage(e)}catch(e){throw this.logger.error(e.message),e}}),vw(this,"approveSessionAuthenticate",async e=>{try{return await this.engine.approveSessionAuthenticate(e)}catch(e){throw this.logger.error(e.message),e}}),vw(this,"rejectSessionAuthenticate",async e=>{try{return await this.engine.rejectSessionAuthenticate(e)}catch(e){throw this.logger.error(e.message),e}}),this.name=e?.name||bZ,this.metadata=function(e){var t,r;let i=u0();try{let n,s;return null!=e&&e.url&&i.url&&new URL(e.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${e.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),e.url=i.url),null!=(t=e?.icons)&&t.length&&e.icons.length>0&&(e.icons=e.icons.filter(e=>""!==e)),n=uz(uz({},i),e),s={url:e?.url||i.url,name:e?.name||i.name,description:e?.description||i.description,icons:null!=(r=e?.icons)&&r.length&&e.icons.length>0?e.icons:i.icons},uj(n,uB(s))}catch(t){return console.warn("Error populating app metadata",t),e||i}}(e?.metadata),this.signConfig=e?.signConfig;const t=gZ({logger:e?.logger||"error",name:this.name});this.logger=t,this.core=e?.core||new bJ(e),this.session=new vc(this.core,this.logger),this.proposal=new vl(this.core,this.logger),this.pendingRequest=new vd(this.core,this.logger),this.engine=new vo(this),this.auth=new vg(this.core,this.logger)}static async init(e){let t=new vb(e);return await t.initialize(),t}get context(){return uO(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}var vv=e.i(98418);function vE(e){return null==e||"object"!=typeof e&&"function"!=typeof e}function v_(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function vA(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}let vS="[object String]",vx="[object Number]",vI="[object Boolean]",vk="[object Arguments]";function vT(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function vC(e,t,r,i=new Map,n){let s=n?.(e,t,r,i);if(null!=s)return s;if(vE(e))return e;if(i.has(e))return i.get(e);if(Array.isArray(e)){let t=Array(e.length);i.set(e,t);for(let s=0;s<e.length;s++)t[s]=vC(e[s],s,r,i,n);return Object.hasOwn(e,"index")&&(t.index=e.index),Object.hasOwn(e,"input")&&(t.input=e.input),t}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){let t=new RegExp(e.source,e.flags);return t.lastIndex=e.lastIndex,t}if(e instanceof Map){let t=new Map;for(let[s,a]of(i.set(e,t),e))t.set(s,vC(a,s,r,i,n));return t}if(e instanceof Set){let t=new Set;for(let s of(i.set(e,t),e))t.add(vC(s,void 0,r,i,n));return t}if("u">typeof t3.Buffer&&t3.Buffer.isBuffer(e))return e.subarray();if(vT(e)){let t=new(Object.getPrototypeOf(e)).constructor(e.length);i.set(e,t);for(let s=0;s<e.length;s++)t[s]=vC(e[s],s,r,i,n);return t}if(e instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer)return e.slice(0);if(e instanceof DataView){let t=new DataView(e.buffer.slice(0),e.byteOffset,e.byteLength);return i.set(e,t),vP(t,e,r,i,n),t}if("u">typeof File&&e instanceof File){let t=new File([e],e.name,{type:e.type});return i.set(e,t),vP(t,e,r,i,n),t}if(e instanceof Blob){let t=new Blob([e],{type:e.type});return i.set(e,t),vP(t,e,r,i,n),t}if(e instanceof Error){let t=new e.constructor;return i.set(e,t),t.message=e.message,t.name=e.name,t.stack=e.stack,t.cause=e.cause,vP(t,e,r,i,n),t}if("object"==typeof e&&function(e){switch(vA(e)){case vk:case"[object Array]":case"[object ArrayBuffer]":case"[object DataView]":case vI:case"[object Date]":case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Map]":case vx:case"[object Object]":case"[object RegExp]":case"[object Set]":case vS:case"[object Symbol]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return!0;default:return!1}}(e)){let t=Object.create(Object.getPrototypeOf(e));return i.set(e,t),vP(t,e,r,i,n),t}return e}function vP(e,t,r=e,i,n){let s=[...Object.keys(t),...v_(t)];for(let a=0;a<s.length;a++){let o=s[a],l=Object.getOwnPropertyDescriptor(e,o);(null==l||l.writable)&&(e[o]=vC(t[o],o,r,i,n))}}function vO(e){var t;return t=(t,r,i,n)=>{let s;if(null!=s)return s;if("object"==typeof e)switch(Object.prototype.toString.call(e)){case vx:case vS:case vI:{let t=new e.constructor(e?.valueOf());return vP(t,e),t}case vk:{let t={};return vP(t,e),t.length=e.length,t[Symbol.iterator]=e[Symbol.iterator],t}default:return}},vC(e,void 0,e,new Map,t)}function vR(e){return null!==e&&"object"==typeof e&&"[object Arguments]"===vA(e)}function vN(e){return"object"==typeof e&&null!==e}function vM(){}let vU="error",vD="universal_provider",vL=`wc@2:${vD}:`,vj="https://rpc.walletconnect.org/v1/",vB="generic",vW=`${vj}bundler`,vF="call_status",vH="default_chain_changed";var vq=Object.defineProperty,vz=Object.defineProperties,v$=Object.getOwnPropertyDescriptors,vK=Object.getOwnPropertySymbols,vV=Object.prototype.hasOwnProperty,vJ=Object.prototype.propertyIsEnumerable,vZ=(e,t,r)=>t in e?vq(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,vG=(e,t)=>{for(var r in t||(t={}))vV.call(t,r)&&vZ(e,r,t[r]);if(vK)for(var r of vK(t))vJ.call(t,r)&&vZ(e,r,t[r]);return e},vY=(e,t)=>vz(e,v$(t));function vQ(e,t,r){var i;let n=uM(e);return(null==(i=t.rpcMap)?void 0:i[n.reference])||`${vj}?chainId=${n.namespace}:${n.reference}&projectId=${r}`}function vX(e){return e.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function v0(e){return Object.fromEntries(Object.entries(e).filter(([e,t])=>{var r,i;return(null==(r=t?.chains)?void 0:r.length)&&(null==(i=t?.chains)?void 0:i.length)>0}))}function v1(e={},t={}){return function(e,...t){return function(e,...t){let r=t.slice(0,-1),i=t[t.length-1],n=e;for(let e=0;e<r.length;e++)n=function e(t,r,i,n){if(vE(t)&&(t=Object(t)),null==r||"object"!=typeof r)return t;if(n.has(r))return function(e){if(vE(e))return e;if(Array.isArray(e)||vT(e)||e instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer)return e.slice(0);let t=Object.getPrototypeOf(e),r=t.constructor;if(e instanceof Date||e instanceof Map||e instanceof Set)return new r(e);if(e instanceof RegExp){let t=new r(e);return t.lastIndex=e.lastIndex,t}if(e instanceof DataView)return new r(e.buffer.slice(0));if(e instanceof Error){let t=new r(e.message);return t.stack=e.stack,t.name=e.name,t.cause=e.cause,t}return"u">typeof File&&e instanceof File?new r([e],e.name,{type:e.type,lastModified:e.lastModified}):"object"==typeof e?Object.assign(Object.create(t),e):e}(n.get(r));if(n.set(r,t),Array.isArray(r)){r=r.slice();for(let e=0;e<r.length;e++)r[e]=r[e]??void 0}let s=[...Object.keys(r),...v_(r)];for(let a=0;a<s.length;a++){let o=s[a],l=r[o],c=t[o];if(vR(l)&&(l={...l}),vR(c)&&(c={...c}),"u">typeof t3.Buffer&&t3.Buffer.isBuffer(l)&&(l=vO(l)),Array.isArray(l))if("object"==typeof c&&null!=c){let e=[],t=Reflect.ownKeys(c);for(let r=0;r<t.length;r++){let i=t[r];e[i]=c[i]}c=e}else c=[];let d=i(c,l,o,t,r,n);null!=d?t[o]=d:Array.isArray(l)||vN(c)&&vN(l)?t[o]=e(c,l,i,n):null==c&&function(e){if("object"!=typeof e||null==e)return!1;if(null===Object.getPrototypeOf(e))return!0;if("[object Object]"!==Object.prototype.toString.call(e)){let t=e[Symbol.toStringTag];return null!=t&&!!Object.getOwnPropertyDescriptor(e,Symbol.toStringTag)?.writable&&e.toString()===`[object ${t}]`}let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(l)?t[o]=e({},l,i,n):null==c&&vT(l)?t[o]=vO(l):(void 0===c||void 0!==l)&&(t[o]=l)}return t}(n,r[e],i,new Map);return n}(e,...t,vM)}(v0(v2(e)),v0(v2(t)))}function v2(e){var t,r,i,n,s;let a={};if(!gO(e))return a;for(let[o,l]of Object.entries(e)){let e=g_(o)?[o]:l.chains,c=l.methods||[],d=l.events||[],u=l.rpcMap||{},h=gA(o);a[h]=vY(vG(vG({},a[h]),l),{chains:hr(e,null==(t=a[h])?void 0:t.chains),methods:hr(c,null==(r=a[h])?void 0:r.methods),events:hr(d,null==(i=a[h])?void 0:i.events)}),(gO(u)||gO((null==(n=a[h])?void 0:n.rpcMap)||{}))&&(a[h].rpcMap=vG(vG({},u),null==(s=a[h])?void 0:s.rpcMap))}return a}function v3(e){return e.includes(":")?e.split(":")[2]:e}function v5(e){let t={};for(let[r,i]of Object.entries(e)){let e=i.methods||[],n=i.events||[],s=i.accounts||[],a=g_(r)?[r]:i.chains?i.chains:vX(i.accounts);t[r]={chains:a,methods:e,events:n,accounts:s}}return t}function v8(e){return"number"==typeof e?e:e.includes("0x")?parseInt(e,16):isNaN(Number(e=e.includes(":")?e.split(":")[1]:e))?e:Number(e)}let v6={},v4=e=>v6[e],v7=(e,t)=>{v6[e]=t};var v9=Object.defineProperty,Ee=Object.getOwnPropertySymbols,Et=Object.prototype.hasOwnProperty,Er=Object.prototype.propertyIsEnumerable,Ei=(e,t,r)=>t in e?v9(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,En=(e,t)=>{for(var r in t||(t={}))Et.call(t,r)&&Ei(e,r,t[r]);if(Ee)for(var r of Ee(t))Er.call(t,r)&&Ei(e,r,t[r]);return e};let Es="eip155",Ea=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],Eo=e=>e&&e.startsWith("0x")?BigInt(e).toString(10):e,El=e=>e&&e.startsWith("0x")?e:`0x${BigInt(e).toString(16)}`,Ec=e=>Object.keys(e).filter(e=>Ea.includes(e)).reduce((t,r)=>(t[r]=Ed(e[r]),t),{}),Ed=e=>"string"==typeof e&&function(e){try{let t=JSON.parse(e);return"object"==typeof t&&null!==t&&!Array.isArray(t)}catch{return!1}}(e)?JSON.parse(e):e;var Eu=Object.defineProperty;class Eh{constructor(e){((e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?Eu(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,t){return await this.storage.setItem(e,t)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return t||(t=new Eh(e)),t}}var Ep=Object.defineProperty,Ef=Object.defineProperties,Ey=Object.getOwnPropertyDescriptors,Eg=Object.getOwnPropertySymbols,Em=Object.prototype.hasOwnProperty,Ew=Object.prototype.propertyIsEnumerable,Eb=(e,t,r)=>t in e?Ep(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;async function Ev(e,t){let r,i=uM(e.result.capabilities.caip345.caip2),n=e.result.capabilities.caip345.transactionHashes,s=await Promise.allSettled(n.map(e=>EE(i.reference,e,t))),a=s.filter(e=>"fulfilled"===e.status).map(e=>e.value).filter(e=>e);s.filter(e=>"rejected"===e.status).forEach(e=>console.warn("Failed to fetch transaction receipt:",e.reason));let o=!a.length||a.some(e=>!e),l=a.every(e=>e?.status==="0x1"),c=a.every(e=>e?.status==="0x0"),d=a.some(e=>e?.status==="0x0");return o?r=100:l?r=200:c?r=500:d&&(r=600),{id:e.result.id,version:e.request.version,atomic:e.request.atomicRequired,chainId:e.request.chainId,capabilities:e.result.capabilities,receipts:a,status:r}}async function EE(e,t,r){return await r(parseInt(e)).request((0,ml.formatJsonRpcRequest)("eth_getTransactionReceipt",[t]))}async function E_({sendCalls:e,storage:t}){let r=await t.getItem(vF);await t.setItem(vF,Ef(((e,t)=>{for(var r in t||(t={}))Em.call(t,r)&&Eb(e,r,t[r]);if(Eg)for(var r of Eg(t))Ew.call(t,r)&&Eb(e,r,t[r]);return e})({},r),Ey({[e.result.id]:{request:e.request,result:e.result,expiry:u9(86400)}})))}async function EA({resultId:e,storage:t}){let r=await t.getItem(vF);if(r){for(let i in delete r[e],await t.setItem(vF,r),r)he(r[i].expiry)&&delete r[i];await t.setItem(vF,r)}}async function ES({resultId:e,storage:t}){let r=await t.getItem(vF),i=r?.[e];if(i&&!he(i.expiry))return i;await EA({resultId:e,storage:t})}var Ex=Object.defineProperty,EI=Object.defineProperties,Ek=Object.getOwnPropertyDescriptors,ET=Object.getOwnPropertySymbols,EC=Object.prototype.hasOwnProperty,EP=Object.prototype.propertyIsEnumerable,EO=(e,t,r)=>t in e?Ex(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ER=(e,t)=>{for(var r in t||(t={}))EC.call(t,r)&&EO(e,r,t[r]);if(ET)for(var r of ET(t))EP.call(t,r)&&EO(e,r,t[r]);return e},EN=(e,t,r)=>EO(e,"symbol"!=typeof t?t+"":t,r);class EM{constructor(e){EN(this,"name","eip155"),EN(this,"client"),EN(this,"chainId"),EN(this,"namespace"),EN(this,"httpProviders"),EN(this,"events"),EN(this,"storage"),this.namespace=e.namespace,this.events=v4("events"),this.client=v4("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=Eh.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t);let r=this.chainId;this.chainId=parseInt(e),this.events.emit(vH,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${r}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){let r=t||vQ(`${this.name}:${e}`,this.namespace,this.client.core.projectId);return new mo.JsonRpcProvider(new vv.HttpConnection(r,v4("disableProviderPing")))}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var r;let i=parseInt(t.includes(":")?t.split(":")[1]:t);e[i]=this.createHttpProvider(i,null==(r=this.namespace.rpcMap)?void 0:r[t])}),e}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}getHttpProvider(e){let t=e||this.chainId;return this.httpProviders[t]||(this.httpProviders=EI(ER({},this.httpProviders),Ek({[t]:this.createHttpProvider(t)})),this.httpProviders[t])}async handleSwitchChain(e){var t,r;let i=e.request.params?null==(t=e.request.params[0])?void 0:t.chainId:"0x0",n=parseInt(i=i.startsWith("0x")?i:`0x${i}`,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:i}]},chainId:null==(r=this.namespace.chains)?void 0:r[0]}),this.setDefaultChain(`${n}`);else throw Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,r,i,n,s;let a,o=null==(r=null==(t=e.request)?void 0:t.params)?void 0:r[0],l=(null==(n=null==(i=e.request)?void 0:i.params)?void 0:n[1])||[];if(!o)throw Error("Missing address parameter in `wallet_getCapabilities` request");let c=this.client.session.get(e.topic),d=(null==(s=c?.sessionProperties)?void 0:s.capabilities)||{},u=`${o}${l.join(",")}`,h=d?.[u];if(h)return h;try{a=((e,t,r)=>{let{sessionProperties:i={},scopedProperties:n={}}=e,s={};if(!gO(n)&&!gO(i))return;let a=Ec(i);for(let e of r){let r=Eo(e);if(!r)continue;s[El(r)]=a;let i=n?.[`${Es}:${r}`];if(i){let e=i?.[`${Es}:${r}:${t}`];s[El(r)]=En(En({},s[El(r)]),Ec(e||i))}}for(let[e,t]of Object.entries(s))0===Object.keys(t).length&&delete s[e];return Object.keys(s).length>0?s:void 0})(c,o,l)}catch(e){console.warn("Failed to extract capabilities from session",e)}if(a)return a;let p=await this.client.request(e);try{let t,r,i,n;await this.client.session.update(e.topic,{sessionProperties:(i=ER({},c.sessionProperties||{}),n={capabilities:(t=ER({},d||{}),r={[u]:p},EI(t,Ek(r)))},EI(i,Ek(n)))})}catch(e){console.warn("Failed to update session with capabilities",e)}return p}async getCallStatus(e){var t,r,i;let n=this.client.session.get(e.topic),s=null==(t=n.sessionProperties)?void 0:t.bundler_name;if(s){let t=this.getBundlerUrl(e.chainId,s);try{return await this.getUserOperationReceipt(t,e)}catch(e){console.warn("Failed to fetch call status from bundler",e,t)}}let a=null==(r=n.sessionProperties)?void 0:r.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(e){console.warn("Failed to fetch call status from custom bundler",e,a)}let o=await ES({resultId:null==(i=e.request.params)?void 0:i[0],storage:this.storage});if(o)try{return await Ev(o,this.getHttpProvider.bind(this))}catch(e){console.warn("Failed to fetch call status from stored send calls",e,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var r;let i=new URL(e),n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,ml.formatJsonRpcRequest)("eth_getUserOperationReceipt",[null==(r=t.request.params)?void 0:r[0]]))});if(!n.ok)throw Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,t){return`${vW}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}async sendCalls(e){var t,r,i;let n=await this.client.request(e),s=null==(t=e.request.params)?void 0:t[0],a=n?.id,o=n?.capabilities||{},l=null==(r=o?.caip345)?void 0:r.caip2,c=null==(i=o?.caip345)?void 0:i.transactionHashes;return a&&l&&null!=c&&c.length&&await E_({sendCalls:{request:s,result:n},storage:this.storage}),n}}var EU=Object.defineProperty,ED=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?EU(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class EL{constructor(e){ED(this,"name",vB),ED(this,"client"),ED(this,"httpProviders"),ED(this,"events"),ED(this,"namespace"),ED(this,"chainId"),this.namespace=e.namespace,this.events=v4("events"),this.client=v4("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t);let r=this.chainId;this.chainId=e,this.events.emit(vH,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${r}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return uM(e).namespace}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){var e,t;let r={};return null==(t=null==(e=this.namespace)?void 0:e.accounts)||t.forEach(e=>{var t,i;let n=uM(e),s=null==(i=null==(t=this.namespace)?void 0:t.rpcMap)?void 0:i[`${n.namespace}:${n.reference}`];r[n.reference]=this.createHttpProvider(e,s)}),r}getHttpProvider(e){let t=uM(e).reference,r=this.httpProviders[t];if(typeof r>"u")throw Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){let r=t||vQ(e,this.namespace,this.client.core.projectId);return new mo.JsonRpcProvider(new vv.default(r,v4("disableProviderPing")))}}var Ej=Object.defineProperty,EB=Object.defineProperties,EW=Object.getOwnPropertyDescriptors,EF=Object.getOwnPropertySymbols,EH=Object.prototype.hasOwnProperty,Eq=Object.prototype.propertyIsEnumerable,Ez=(e,t,r)=>t in e?Ej(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,E$=(e,t)=>{for(var r in t||(t={}))EH.call(t,r)&&Ez(e,r,t[r]);if(EF)for(var r of EF(t))Eq.call(t,r)&&Ez(e,r,t[r]);return e},EK=(e,t,r)=>Ez(e,"symbol"!=typeof t?t+"":t,r);class EV{constructor(e){var t,r;EK(this,"client"),EK(this,"namespaces"),EK(this,"optionalNamespaces"),EK(this,"sessionProperties"),EK(this,"scopedProperties"),EK(this,"events",new oU.default),EK(this,"rpcProviders",{}),EK(this,"session"),EK(this,"providerOpts"),EK(this,"logger"),EK(this,"uri"),EK(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=gZ({logger:null!=(t=e.logger)?t:vU,name:null!=(r=this.providerOpts.name)?r:vD}),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){let t=new EV(e);return await t.initialize(),t}async request(e,t,r){let[i,n]=this.validateChain(t);if(!this.session)throw Error("Please call connect() before request()");return await this.getProvider(i).request({request:E$({},e),chainId:`${i}:${n}`,topic:this.session.topic,expiry:r})}sendAsync(e,t,r,i){let n=new Date().getTime();this.request(e,r,i).then(e=>t(null,(0,ml.formatJsonRpcResult)(n,e))).catch(e=>t(e,void 0))}async enable(){if(!this.client)throw Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(e=this.session)?void 0:e.topic,reason:gC("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw Error("Sign Client not initialized");if(this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();let{uri:r,response:i}=await this.client.authenticate(e,t);r&&(this.uri=r,this.events.emit("display_uri",r));let n=await i();if(this.session=n.session,this.session){let e=v5(this.session.namespaces);this.namespaces=v1(this.namespaces,e),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){let{uri:t,approval:r}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));let i=await r();this.session=i;let n=v5(i.namespaces);return this.namespaces=v1(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;let[r,i]=this.validateChain(e);this.getProvider(r).setDefaultChain(i,t)}catch(e){if(!/Please call connect/.test(e.message))throw e}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");let t=this.client.pairing.getAll();if(!gP(t))return;for(let r of t)e.deletePairings?this.client.core.expirer.set(r.topic,0):await this.client.core.relayer.subscriber.unsubscribe(r.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}catch(e){this.logger.warn(e,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await vb.init({core:this.providerOpts.core,logger:this.providerOpts.logger||vU,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(r){throw this.logger.error(r,"Failed to get session"),Error(`The provided session: ${null==(t=null==(e=this.providerOpts)?void 0:e.session)?void 0:t.topic} doesn't exist in the Sign client`)}else{let e=this.client.session.getAll();this.session=e[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw Error("Sign Client not initialized");if(!this.session)throw Error("Session not initialized. Please call connect() before enable()");let e=[...new Set(Object.keys(this.session.namespaces).map(e=>gA(e)))];v7("client",this.client),v7("events",this.events),v7("disableProviderPing",this.disableProviderPing),e.forEach(e=>{if(!this.session)return;let t=function(e,t){let r=Object.keys(t.namespaces).filter(t=>t.includes(e));if(!r.length)return[];let i=[];return r.forEach(e=>{let r=t.namespaces[e].accounts;i.push(...r)}),i}(e,this.session);if(t?.length===0)return;let r=vX(t),i=EB(E$({},v1(this.namespaces,this.optionalNamespaces)[e]),EW({accounts:t,chains:r}));"eip155"===e?this.rpcProviders[e]=new EM({namespace:i}):this.rpcProviders[e]=new EL({namespace:i})})}registerEventListeners(){if(typeof this.client>"u")throw Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;let{topic:r}=e;r===(null==(t=this.session)?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;let{params:r,topic:i}=e;if(i!==(null==(t=this.session)?void 0:t.topic))return;let{event:n}=r;if("accountsChanged"===n.name){let e=n.data;e&&gP(e)&&this.events.emit("accountsChanged",e.map(v3))}else if("chainChanged"===n.name){let e=r.chainId,t=r.event.data,i=gA(e),n=v8(e)!==v8(t)?`${i}:${v8(t)}`:e;this.onChainChanged({currentCaipChainId:n})}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var r,i;if(e!==(null==(r=this.session)?void 0:r.topic))return;let{namespaces:n}=t,s=null==(i=this.client)?void 0:i.session.get(e);this.session=EB(E$({},s),EW({namespaces:n})),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{var t;e.topic===(null==(t=this.session)?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",EB(E$({},gC("USER_DISCONNECTED")),EW({data:e.topic}))))}),this.on(vH,e=>{this.onChainChanged(EB(E$({},e),EW({internal:!0})))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[vB]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace(null==(t=this.session)?void 0:t.namespaces[e])})}setNamespaces(e){let{namespaces:t={},optionalNamespaces:r={},sessionProperties:i,scopedProperties:n}=e;this.optionalNamespaces=v1(t,r),this.sessionProperties=i,this.scopedProperties=n}validateChain(e){let[t,r]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,r];if(t&&!Object.keys(this.namespaces||{}).map(e=>gA(e)).includes(t))throw Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&r)return[t,r];let i=gA(Object.keys(this.namespaces)[0]),n=this.rpcProviders[i].getDefaultChain();return[i,n]}async requestAccounts(){let[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:t,internal:r=!1}){if(!this.namespaces)return;let[i,n]=this.validateChain(e);n&&(this.updateNamespaceChain(i,n),r?(this.events.emit("chainChanged",n),this.emitAccountsChangedOnChainChange({namespace:i,currentCaipChainId:e,previousCaipChainId:t})):this.getProvider(i).setDefaultChain(n),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:t,previousCaipChainId:r}){var i,n;try{if(r===t)return;let s=null==(n=null==(i=this.session)?void 0:i.namespaces[e])?void 0:n.accounts;if(!s)return;let a=s.filter(e=>e.includes(`${t}:`)).map(v3);if(!gP(a))return;this.events.emit("accountsChanged",a)}catch(e){this.logger.warn(e,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(e,t){if(!this.namespaces)return;let r=this.namespaces[e]?e:`${e}:${t}`;this.namespaces[r]?this.namespaces[r]&&(this.namespaces[r].defaultChain=t):this.namespaces[r]={chains:[],methods:[],events:[],defaultChain:t}}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var r;let i=(null==(r=this.session)?void 0:r.topic)||"";await this.client.core.storage.setItem(`${vL}/${e}${i}`,t)}async getFromStore(e){var t;let r=(null==(t=this.session)?void 0:t.topic)||"";return await this.client.core.storage.getItem(`${vL}/${e}${r}`)}async deleteFromStore(e){var t;let r=(null==(t=this.session)?void 0:t.topic)||"";await this.client.core.storage.removeItem(`${vL}/${e}${r}`)}async cleanupStorage(){var e;try{if((null==(e=this.client)?void 0:e.session.length)>0)return;for(let e of(await this.client.core.storage.getKeys()))e.startsWith(vL)&&await this.client.core.storage.removeItem(e)}catch(e){this.logger.warn(e,"Failed to cleanup storage")}}}let EJ=["eth_sendTransaction","personal_sign"],EZ=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],EG=["chainChanged","accountsChanged"],EY=["chainChanged","accountsChanged","message","disconnect","connect"],EQ=async()=>{let{createAppKit:t}=await e.A(156814);return t};var EX=Object.defineProperty,E0=Object.defineProperties,E1=Object.getOwnPropertyDescriptors,E2=Object.getOwnPropertySymbols,E3=Object.prototype.hasOwnProperty,E5=Object.prototype.propertyIsEnumerable,E8=(e,t,r)=>t in e?EX(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,E6=(e,t)=>{for(var r in t||(t={}))E3.call(t,r)&&E8(e,r,t[r]);if(E2)for(var r of E2(t))E5.call(t,r)&&E8(e,r,t[r]);return e},E4=(e,t,r)=>E8(e,"symbol"!=typeof t?t+"":t,r);function E7(e){return Number(e[0].split(":")[1])}function E9(e){return`0x${e.toString(16)}`}class _e{constructor(){E4(this,"events",new oU.EventEmitter),E4(this,"namespace","eip155"),E4(this,"accounts",[]),E4(this,"signer"),E4(this,"chainId",1),E4(this,"modal"),E4(this,"rpc"),E4(this,"STORAGE_KEY","wc@2:ethereum_provider:"),E4(this,"on",(e,t)=>(this.events.on(e,t),this)),E4(this,"once",(e,t)=>(this.events.once(e,t),this)),E4(this,"removeListener",(e,t)=>(this.events.removeListener(e,t),this)),E4(this,"off",(e,t)=>(this.events.off(e,t),this)),E4(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){let t=new _e;return await t.initialize(e),t}async request(e,t){return await this.signer.request(e,this.formatChainId(this.chainId),t)}sendAsync(e,t,r){this.signer.sendAsync(e,t,this.formatChainId(this.chainId),r)}get connected(){return!!this.signer.client&&this.signer.client.core.relayer.connected}get connecting(){return!!this.signer.client&&this.signer.client.core.relayer.connecting}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var t;if(!this.signer.client)throw Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);let{required:r,optional:i}=function(e){let{chains:t,optionalChains:r,methods:i,optionalMethods:n,events:s,optionalEvents:a,rpcMap:o}=e;if(!gP(t))throw Error("Invalid chains");let l={chains:t,methods:i||EJ,events:s||EG,rpcMap:E6({},t.length?{[E7(t)]:o[E7(t)]}:{})},c=s?.filter(e=>!EG.includes(e)),d=i?.filter(e=>!EJ.includes(e));if(!r&&!a&&!n&&!(null!=c&&c.length)&&!(null!=d&&d.length))return{required:t.length?l:void 0};let u={chains:[...new Set(c?.length&&d?.length||!r?l.chains.concat(r||[]):r)],methods:[...new Set(l.methods.concat(null!=n&&n.length?n:EZ))],events:[...new Set(l.events.concat(null!=a&&a.length?a:EY))],rpcMap:o};return{required:t.length?l:void 0,optional:r.length?u:void 0}}(this.rpc);try{let t=await new Promise(async(t,n)=>{var s,a;let o,l;this.rpc.showQrModal&&(null==(s=this.modal)||s.open(),null==(a=this.modal)||a.subscribeState(e=>{e.open||this.signer.session||(this.signer.abortPairingAttempt(),n(Error("Connection request reset. Please try again.")))}));let c=null!=e&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect((o=E6({namespaces:E6({},r&&{[this.namespace]:r})},i&&{optionalNamespaces:{[this.namespace]:i}}),l={pairingTopic:e?.pairingTopic,scopedProperties:c},E0(o,E1(l)))).then(e=>{t(e)}).catch(e=>{var t;null==(t=this.modal)||t.showErrorMessage("Unable to connect"),n(Error(e.message))})});if(!t)return;let n=uU(t.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:n),this.setAccounts(n),this.events.emit("connect",{chainId:E9(this.chainId)})}catch(e){throw this.signer.logger.error(e),e}finally{null==(t=this.modal)||t.close()}}async authenticate(e,t){var r;if(!this.signer.client)throw Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e?.chains});try{let r=await new Promise(async(r,i)=>{var n,s;let a,o;this.rpc.showQrModal&&(null==(n=this.modal)||n.open(),null==(s=this.modal)||s.subscribeState(e=>{e.open||this.signer.session||(this.signer.abortPairingAttempt(),i(Error("Connection request reset. Please try again.")))})),await this.signer.authenticate((a=E6({},e),o={chains:this.rpc.chains},E0(a,E1(o))),t).then(e=>{r(e)}).catch(e=>{var t;null==(t=this.modal)||t.showErrorMessage("Unable to connect"),i(Error(e.message))})}),i=r.session;if(i){let e=uU(i.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:e),this.setAccounts(e),this.events.emit("connect",{chainId:E9(this.chainId)})}return r}catch(e){throw this.signer.logger.error(e),e}finally{null==(r=this.modal)||r.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{let{params:t}=e,{event:r}=t;"accountsChanged"===r.name?(this.accounts=this.parseAccounts(r.data),this.events.emit("accountsChanged",this.accounts)):"chainChanged"===r.name?this.setChainId(this.formatChainId(r.data)):this.events.emit(r.name,r.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{let t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",E9(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",E0(E6({},gC("USER_DISCONNECTED")),E1({data:e.topic,name:"USER_DISCONNECTED"})))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return"string"==typeof e&&e.startsWith(`${this.namespace}:`)}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){let t=e.filter(e=>this.isCompatibleChainId(e)).map(e=>this.parseChainId(e));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",E9(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){let t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){let[t,r,i]=e.split(":");return{chainId:`${t}:${r}`,address:i}}setAccounts(e){this.accounts=e.filter(e=>this.parseChainId(this.parseAccountId(e).chainId)===this.chainId).map(e=>this.parseAccountId(e).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,r;let i=null!=(t=e?.chains)?t:[],n=null!=(r=e?.optionalChains)?r:[],s=i.concat(n);if(!s.length)throw Error("No chains specified in either `chains` or `optionalChains`");let a=i.length?e?.methods||EJ:[],o=i.length?e?.events||EG:[],l=e?.optionalMethods||[],c=e?.optionalEvents||[],d=e?.rpcMap||this.buildRpcMap(s,e.projectId),u=e?.qrModalOptions||void 0;return{chains:i?.map(e=>this.formatChainId(e)),optionalChains:n.map(e=>this.formatChainId(e)),methods:a,events:o,optionalMethods:l,optionalEvents:c,rpcMap:d,showQrModal:!!(null!=e&&e.showQrModal),qrModalOptions:u,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){let r={};return e.forEach(e=>{r[e]=this.getRpcUrl(e,t)}),r}async initialize(e){var t;if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?E7(this.rpc.chains):E7(this.rpc.optionalChains),this.signer=await EV.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let e;try{let r,i,n,s,a=await EQ(),{convertWCMToAppKitOptions:o}=await Promise.resolve().then(function(){return _u}),l=o((r=E6({},this.rpc.qrModalOptions),i={chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId},E0(r,E1(i))));if(!l.networks.length)throw Error("No networks found for WalletConnect");e=a((n=E6({},l),s={universalProvider:this.signer,manualWCControl:!0,enableMobileFullScreen:(null==(t=this.rpc.qrModalOptions)?void 0:t.enableMobileFullScreen)===!0},E0(n,E1(s))))}catch(e){throw console.warn(e),Error("To use QR modal, please install @reown/appkit package")}if(e)try{this.modal=e}catch(e){throw this.signer.logger.error(e),Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;let{chains:t,optionalChains:r,rpcMap:i}=e;t&&gP(t)&&(this.rpc.chains=t.map(e=>this.formatChainId(e)),t.forEach(e=>{this.rpc.rpcMap[e]=i?.[e]||this.getRpcUrl(e)})),r&&gP(r)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=r?.map(e=>this.formatChainId(e)),r.forEach(e=>{this.rpc.rpcMap[e]=i?.[e]||this.getRpcUrl(e)}))}getRpcUrl(e,t){var r;return(null==(r=this.rpc.rpcMap)?void 0:r[e])||`https://rpc.walletconnect.org/v1/?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{let e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:t?.accounts),this.setAccounts(t?.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(e=>this.signer.logger.warn(e))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return"string"==typeof e||e instanceof String?[this.parseAccount(e)]:e.map(e=>this.parseAccount(e))}}var _t=Object.defineProperty,_r=Object.defineProperties,_i=Object.getOwnPropertyDescriptors,_n=Object.getOwnPropertySymbols,_s=Object.prototype.hasOwnProperty,_a=Object.prototype.propertyIsEnumerable,_o=(e,t,r)=>t in e?_t(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_l=(e,t)=>{for(var r in t||(t={}))_s.call(t,r)&&_o(e,r,t[r]);if(_n)for(var r of _n(t))_a.call(t,r)&&_o(e,r,t[r]);return e};let _c=e=>{let[t,r]=e.split(":");return _d({id:r,caipNetworkId:e,chainNamespace:t,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function _d(e){return _l({formatters:void 0,fees:void 0,serializers:void 0},e)}var _u=Object.freeze({__proto__:null,convertWCMToAppKitOptions:function(e){var t,r,i,n,s,a,o;let l=null==(t=e.chains)?void 0:t.map(_c).filter(Boolean);if(0===l.length)throw Error("At least one chain must be specified");let c=l.find(t=>{var r;return t.id===(null==(r=e.defaultChain)?void 0:r.id)}),d={projectId:e.projectId,networks:l,themeMode:e.themeMode,themeVariables:function(e){if(e)return{"--w3m-font-family":e["--wcm-font-family"],"--w3m-accent":e["--wcm-accent-color"],"--w3m-color-mix":e["--wcm-background-color"],"--w3m-z-index":e["--wcm-z-index"]?Number(e["--wcm-z-index"]):void 0,"--w3m-qr-color":e["--wcm-accent-color"],"--w3m-font-size-master":e["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":e["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}(e.themeVariables),chainImages:e.chainImages,connectorImages:e.walletImages,defaultNetwork:c,metadata:_r(_l({},e.metadata),_i({name:(null==(r=e.metadata)?void 0:r.name)||"WalletConnect",description:(null==(i=e.metadata)?void 0:i.description)||"Connect to WalletConnect-compatible wallets",url:(null==(n=e.metadata)?void 0:n.url)||"https://walletconnect.org",icons:(null==(s=e.metadata)?void 0:s.icons)||["https://walletconnect.org/walletconnect-logo.png"]})),showWallets:!0,featuredWalletIds:"NONE"===e.explorerRecommendedWalletIds?[]:Array.isArray(e.explorerRecommendedWalletIds)?e.explorerRecommendedWalletIds:[],excludeWalletIds:"ALL"===e.explorerExcludedWalletIds?[]:Array.isArray(e.explorerExcludedWalletIds)?e.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if(null!=(a=e.mobileWallets)&&a.length||null!=(o=e.desktopWallets)&&o.length){let t=[...(e.mobileWallets||[]).map(e=>({id:e.id,name:e.name,links:e.links})),...(e.desktopWallets||[]).map(e=>({id:e.id,name:e.name,links:{native:e.links.native,universal:e.links.universal}}))],r=[...d.featuredWalletIds||[],...d.excludeWalletIds||[]],i=t.filter(e=>!r.includes(e.id));i.length&&(d.customWallets=i)}return d},defineChain:_d}),_h=e.i(722262);e.i(914146);var _p=e.i(57159),_f=e.i(110163);e.i(189643);var _y=e.i(500986),_g=e.i(450223),_m=e.i(117595),_w=Object.defineProperty,_b=(e,t)=>{for(var r in t)_w(e,r,{get:t[r],enumerable:!0})},_v={84532:{usdcAddress:"0x036CbD53842c5426634e7929541eC2318f3dCF7e",usdcName:"USDC"},8453:{usdcAddress:"0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913",usdcName:"USD Coin"},43113:{usdcAddress:"0x5425890298aed601595a70AB815c96711a31Bc65",usdcName:"USD Coin"},43114:{usdcAddress:"0xB97EF9Ef8734C71904D8002F8b6Bc66Dd9c48a6E",usdcName:"USD Coin"},4689:{usdcAddress:"0xcdf79194c6c285077a58da47641d4dbe51f63542",usdcName:"Bridged USDC"},103:{usdcAddress:"4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU",usdcName:"USDC"},101:{usdcAddress:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",usdcName:"USDC"},1328:{usdcAddress:"0x4fcf1784b31630811181f670aea7a7bef803eaed",usdcName:"USDC"},1329:{usdcAddress:"0xe15fc38f6d8c56af07bbcbe3baf5708a2bf42392",usdcName:"USDC"},137:{usdcAddress:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",usdcName:"USD Coin"},80002:{usdcAddress:"0x41E94Eb019C0762f9Bfcf9Fb1E58725BfB0e7582",usdcName:"USDC"},3338:{usdcAddress:"0xbbA60da06c2c5424f03f7434542280FCAd453d10",usdcName:"USDC"},2741:{usdcAddress:"0x84a71ccd554cc1b02749b35d22f684cc8ec987e1",usdcName:"Bridged USDC"},11124:{usdcAddress:"0xe4C7fBB0a626ed208021ccabA6Be1566905E2dFc",usdcName:"Bridged USDC"},1514:{usdcAddress:"0xF1815bd50389c46847f0Bda824eC8da914045D14",usdcName:"Bridged USDC"},41923:{usdcAddress:"0x12a272A581feE5577A5dFa371afEB4b2F3a8C2F8",usdcName:"Bridged USDC (Stargate)"},0x135a9d92:{usdcAddress:"0x2e08028E3C4c2356572E096d8EF835cD5C6030bD",usdcName:"Bridged USDC (SKALE Bridge)"}},_E=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"authorizer",type:"address"},{indexed:!0,internalType:"bytes32",name:"nonce",type:"bytes32"}],name:"AuthorizationCanceled",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"authorizer",type:"address"},{indexed:!0,internalType:"bytes32",name:"nonce",type:"bytes32"}],name:"AuthorizationUsed",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_account",type:"address"}],name:"Blacklisted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newBlacklister",type:"address"}],name:"BlacklisterChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"burner",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"Burn",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newMasterMinter",type:"address"}],name:"MasterMinterChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"minter",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"Mint",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"minter",type:"address"},{indexed:!1,internalType:"uint256",name:"minterAllowedAmount",type:"uint256"}],name:"MinterConfigured",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"oldMinter",type:"address"}],name:"MinterRemoved",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"previousOwner",type:"address"},{indexed:!1,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[],name:"Pause",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newAddress",type:"address"}],name:"PauserChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newRescuer",type:"address"}],name:"RescuerChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_account",type:"address"}],name:"UnBlacklisted",type:"event"},{anonymous:!1,inputs:[],name:"Unpause",type:"event"},{inputs:[],name:"CANCEL_AUTHORIZATION_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"DOMAIN_SEPARATOR",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"PERMIT_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"RECEIVE_WITH_AUTHORIZATION_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"TRANSFER_WITH_AUTHORIZATION_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"authorizer",type:"address"},{internalType:"bytes32",name:"nonce",type:"bytes32"}],name:"authorizationState",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_account",type:"address"}],name:"blacklist",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"blacklister",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_amount",type:"uint256"}],name:"burn",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"authorizer",type:"address"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"cancelAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"authorizer",type:"address"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"cancelAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"minter",type:"address"},{internalType:"uint256",name:"minterAllowedAmount",type:"uint256"}],name:"configureMinter",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"currency",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"decrement",type:"uint256"}],name:"decreaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"increment",type:"uint256"}],name:"increaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"tokenName",type:"string"},{internalType:"string",name:"tokenSymbol",type:"string"},{internalType:"string",name:"tokenCurrency",type:"string"},{internalType:"uint8",name:"tokenDecimals",type:"uint8"},{internalType:"address",name:"newMasterMinter",type:"address"},{internalType:"address",name:"newPauser",type:"address"},{internalType:"address",name:"newBlacklister",type:"address"},{internalType:"address",name:"newOwner",type:"address"}],name:"initialize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"newName",type:"string"}],name:"initializeV2",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"lostAndFound",type:"address"}],name:"initializeV2_1",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address[]",name:"accountsToBlacklist",type:"address[]"},{internalType:"string",name:"newSymbol",type:"string"}],name:"initializeV2_2",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_account",type:"address"}],name:"isBlacklisted",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"isMinter",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"masterMinter",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_to",type:"address"},{internalType:"uint256",name:"_amount",type:"uint256"}],name:"mint",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"minter",type:"address"}],name:"minterAllowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"nonces",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"pause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"pauser",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"permit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"permit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"validAfter",type:"uint256"},{internalType:"uint256",name:"validBefore",type:"uint256"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"receiveWithAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"validAfter",type:"uint256"},{internalType:"uint256",name:"validBefore",type:"uint256"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"receiveWithAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"minter",type:"address"}],name:"removeMinter",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"contract IERC20",name:"tokenContract",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"rescueERC20",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"rescuer",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"validAfter",type:"uint256"},{internalType:"uint256",name:"validBefore",type:"uint256"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"transferWithAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"validAfter",type:"uint256"},{internalType:"uint256",name:"validBefore",type:"uint256"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"transferWithAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_account",type:"address"}],name:"unBlacklist",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"unpause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_newBlacklister",type:"address"}],name:"updateBlacklister",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_newMasterMinter",type:"address"}],name:"updateMasterMinter",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_newPauser",type:"address"}],name:"updatePauser",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newRescuer",type:"address"}],name:"updateRescuer",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"version",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"pure",type:"function"}];e.s([],38570),e.i(38570),(CC=C$||(C$={})).assertEqual=e=>{},CC.assertIs=function(e){},CC.assertNever=function(e){throw Error()},CC.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},CC.getValidEnumValues=e=>{let t=CC.objectKeys(e).filter(t=>"number"!=typeof e[e[t]]),r={};for(let i of t)r[i]=e[i];return CC.objectValues(r)},CC.objectValues=e=>CC.objectKeys(e).map(function(t){return e[t]}),CC.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},CC.find=(e,t)=>{for(let r of e)if(t(r))return r},CC.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,CC.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},CC.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(CK||(CK={})).mergeShapes=(e,t)=>({...e,...t});let __=C$.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),_A=e=>{switch(typeof e){case"undefined":return __.undefined;case"string":return __.string;case"number":return Number.isNaN(e)?__.nan:__.number;case"boolean":return __.boolean;case"function":return __.function;case"bigint":return __.bigint;case"symbol":return __.symbol;case"object":if(Array.isArray(e))return __.array;if(null===e)return __.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return __.promise;if("undefined"!=typeof Map&&e instanceof Map)return __.map;if("undefined"!=typeof Set&&e instanceof Set)return __.set;if("undefined"!=typeof Date&&e instanceof Date)return __.date;return __.object;default:return __.unknown}};e.s(["ZodParsedType",0,__,"getParsedType",0,_A,"objectUtil",()=>CK,"util",()=>C$],904783);let _S=C$.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),_x=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class _I extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},i=e=>{for(let n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(i);else if("invalid_return_type"===n.code)i(n.returnTypeError);else if("invalid_arguments"===n.code)i(n.argumentsError);else if(0===n.path.length)r._errors.push(t(n));else{let e=r,i=0;for(;i<n.path.length;){let r=n.path[i];i===n.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(n))):e[r]=e[r]||{_errors:[]},e=e[r],i++}}};return i(this),r}static assert(e){if(!(e instanceof _I))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,C$.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let i of this.issues)if(i.path.length>0){let r=i.path[0];t[r]=t[r]||[],t[r].push(e(i))}else r.push(e(i));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}_I.create=e=>new _I(e),e.s(["ZodError",()=>_I,"ZodIssueCode",0,_S,"quotelessJson",0,_x],169790);let _k=(e,t)=>{let r;switch(e.code){case _S.invalid_type:r=e.received===__.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case _S.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,C$.jsonStringifyReplacer)}`;break;case _S.unrecognized_keys:r=`Unrecognized key(s) in object: ${C$.joinValues(e.keys,", ")}`;break;case _S.invalid_union:r="Invalid input";break;case _S.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${C$.joinValues(e.options)}`;break;case _S.invalid_enum_value:r=`Invalid enum value. Expected ${C$.joinValues(e.options)}, received '${e.received}'`;break;case _S.invalid_arguments:r="Invalid function arguments";break;case _S.invalid_return_type:r="Invalid function return type";break;case _S.invalid_date:r="Invalid date";break;case _S.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:C$.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case _S.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case _S.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case _S.custom:r="Invalid input";break;case _S.invalid_intersection_types:r="Intersection results could not be merged";break;case _S.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case _S.not_finite:r="Number must be finite";break;default:r=t.defaultError,C$.assertNever(e)}return{message:r}},_T=_k;function _C(e){_T=e}function _P(){return _T}e.s(["getErrorMap",()=>_P,"setErrorMap",()=>_C],937904),e.i(937904),e.s(["defaultErrorMap",0,_k,"getErrorMap",()=>_P,"setErrorMap",()=>_C],277290),e.i(277290);let _O=e=>{let{data:t,path:r,errorMaps:i,issueData:n}=e,s=[...r,...n.path||[]],a={...n,path:s};if(void 0!==n.message)return{...n,path:s,message:n.message};let o="";for(let e of i.filter(e=>!!e).slice().reverse())o=e(a,{data:t,defaultError:o}).message;return{...n,path:s,message:o}},_R=[];function _N(e,t){let r=_T,i=_O({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===_k?void 0:_k].filter(e=>!!e)});e.common.issues.push(i)}class _M{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let i of t){if("aborted"===i.status)return _U;"dirty"===i.status&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,i=await e.value;r.push({key:t,value:i})}return _M.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let i of t){let{key:t,value:n}=i;if("aborted"===t.status||"aborted"===n.status)return _U;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==n.value||i.alwaysSet)&&(r[t.value]=n.value)}return{status:e.value,value:r}}}let _U=Object.freeze({status:"aborted"}),_D=e=>({status:"dirty",value:e}),_L=e=>({status:"valid",value:e}),_j=e=>"aborted"===e.status,_B=e=>"dirty"===e.status,_W=e=>"valid"===e.status,_F=e=>"undefined"!=typeof Promise&&e instanceof Promise;e.s(["DIRTY",0,_D,"EMPTY_PATH",0,_R,"INVALID",0,_U,"OK",0,_L,"ParseStatus",()=>_M,"addIssueToContext",()=>_N,"isAborted",0,_j,"isAsync",0,_F,"isDirty",0,_B,"isValid",0,_W,"makeIssue",0,_O],665354),e.i(665354),e.s([],527404),e.i(527404),e.i(904783),(CP=CV||(CV={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},CP.toString=e=>"string"==typeof e?e:e?.message;class _H{constructor(e,t,r,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let _q=(e,t)=>{if(_W(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new _I(e.common.issues);return this._error=t,this._error}}};function _z(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:i,description:n}=e;if(t&&(r||i))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:n}:{errorMap:(t,n)=>{let{message:s}=e;return"invalid_enum_value"===t.code?{message:s??n.defaultError}:void 0===n.data?{message:s??i??n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:s??r??n.defaultError}},description:n}}class _${get description(){return this._def.description}_getType(e){return _A(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:_A(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new _M,ctx:{common:e.parent.common,data:e.data,parsedType:_A(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(_F(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_A(e)},i=this._parseSync({data:e,path:r.path,parent:r});return _q(r,i)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_A(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return _W(r)?{value:r.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>_W(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_A(e)},i=this._parse({data:e,path:r.path,parent:r});return _q(r,await (_F(i)?i:Promise.resolve(i)))}refine(e,t){return this._refinement((r,i)=>{let n=e(r),s=()=>i.addIssue({code:_S.custom,..."string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(r):t});return"undefined"!=typeof Promise&&n instanceof Promise?n.then(e=>!!e||(s(),!1)):!!n||(s(),!1)})}refinement(e,t){return this._refinement((r,i)=>!!e(r)||(i.addIssue("function"==typeof t?t(r,i):t),!1))}_refinement(e){return new AC({schema:this,typeName:CJ.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return AP.create(this,this._def)}nullable(){return AO.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ah.create(this)}promise(){return AT.create(this,this._def)}or(e){return Af.create([this,e],this._def)}and(e){return Am.create(this,e,this._def)}transform(e){return new AC({..._z(this._def),schema:this,typeName:CJ.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new AR({..._z(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:CJ.ZodDefault})}brand(){return new AD({typeName:CJ.ZodBranded,type:this,..._z(this._def)})}catch(e){return new AN({..._z(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:CJ.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return AL.create(this,e)}readonly(){return Aj.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let _K=/^c[^\s-]{8,}$/i,_V=/^[0-9a-z]+$/,_J=/^[0-9A-HJKMNP-TV-Z]{26}$/i,_Z=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,_G=/^[a-z0-9_-]{21}$/i,_Y=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,_Q=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,_X=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,_0=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,_1=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,_2=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,_3=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,_5=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,_8=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,_6="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",_4=RegExp(`^${_6}$`);function _7(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function _9(e){let t=`${_6}T${_7(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}class Ae extends _${_parse(e){var t,i,n,s;let a;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==__.string){let t=this._getOrReturnCtx(e);return _N(t,{code:_S.invalid_type,expected:__.string,received:t.parsedType}),_U}let o=new _M;for(let l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(_N(a=this._getOrReturnCtx(e,a),{code:_S.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("max"===l.kind)e.data.length>l.value&&(_N(a=this._getOrReturnCtx(e,a),{code:_S.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("length"===l.kind){let t=e.data.length>l.value,r=e.data.length<l.value;(t||r)&&(a=this._getOrReturnCtx(e,a),t?_N(a,{code:_S.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):r&&_N(a,{code:_S.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),o.dirty())}else if("email"===l.kind)_X.test(e.data)||(_N(a=this._getOrReturnCtx(e,a),{validation:"email",code:_S.invalid_string,message:l.message}),o.dirty());else if("emoji"===l.kind)r||(r=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),r.test(e.data)||(_N(a=this._getOrReturnCtx(e,a),{validation:"emoji",code:_S.invalid_string,message:l.message}),o.dirty());else if("uuid"===l.kind)_Z.test(e.data)||(_N(a=this._getOrReturnCtx(e,a),{validation:"uuid",code:_S.invalid_string,message:l.message}),o.dirty());else if("nanoid"===l.kind)_G.test(e.data)||(_N(a=this._getOrReturnCtx(e,a),{validation:"nanoid",code:_S.invalid_string,message:l.message}),o.dirty());else if("cuid"===l.kind)_K.test(e.data)||(_N(a=this._getOrReturnCtx(e,a),{validation:"cuid",code:_S.invalid_string,message:l.message}),o.dirty());else if("cuid2"===l.kind)_V.test(e.data)||(_N(a=this._getOrReturnCtx(e,a),{validation:"cuid2",code:_S.invalid_string,message:l.message}),o.dirty());else if("ulid"===l.kind)_J.test(e.data)||(_N(a=this._getOrReturnCtx(e,a),{validation:"ulid",code:_S.invalid_string,message:l.message}),o.dirty());else if("url"===l.kind)try{new URL(e.data)}catch{_N(a=this._getOrReturnCtx(e,a),{validation:"url",code:_S.invalid_string,message:l.message}),o.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(_N(a=this._getOrReturnCtx(e,a),{validation:"regex",code:_S.invalid_string,message:l.message}),o.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(_N(a=this._getOrReturnCtx(e,a),{code:_S.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),o.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(_N(a=this._getOrReturnCtx(e,a),{code:_S.invalid_string,validation:{startsWith:l.value},message:l.message}),o.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(_N(a=this._getOrReturnCtx(e,a),{code:_S.invalid_string,validation:{endsWith:l.value},message:l.message}),o.dirty()):"datetime"===l.kind?_9(l).test(e.data)||(_N(a=this._getOrReturnCtx(e,a),{code:_S.invalid_string,validation:"datetime",message:l.message}),o.dirty()):"date"===l.kind?_4.test(e.data)||(_N(a=this._getOrReturnCtx(e,a),{code:_S.invalid_string,validation:"date",message:l.message}),o.dirty()):"time"===l.kind?RegExp(`^${_7(l)}$`).test(e.data)||(_N(a=this._getOrReturnCtx(e,a),{code:_S.invalid_string,validation:"time",message:l.message}),o.dirty()):"duration"===l.kind?_Q.test(e.data)||(_N(a=this._getOrReturnCtx(e,a),{validation:"duration",code:_S.invalid_string,message:l.message}),o.dirty()):"ip"===l.kind?(t=e.data,!(("v4"===(i=l.version)||!i)&&_0.test(t)||("v6"===i||!i)&&_2.test(t))&&1&&(_N(a=this._getOrReturnCtx(e,a),{validation:"ip",code:_S.invalid_string,message:l.message}),o.dirty())):"jwt"===l.kind?!function(e,t){if(!_Y.test(e))return!1;try{let[r]=e.split(".");if(!r)return!1;let i=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(i));if("object"!=typeof n||null===n||"typ"in n&&n?.typ!=="JWT"||!n.alg||t&&n.alg!==t)return!1;return!0}catch{return!1}}(e.data,l.alg)&&(_N(a=this._getOrReturnCtx(e,a),{validation:"jwt",code:_S.invalid_string,message:l.message}),o.dirty()):"cidr"===l.kind?(n=e.data,!(("v4"===(s=l.version)||!s)&&_1.test(n)||("v6"===s||!s)&&_3.test(n))&&1&&(_N(a=this._getOrReturnCtx(e,a),{validation:"cidr",code:_S.invalid_string,message:l.message}),o.dirty())):"base64"===l.kind?_5.test(e.data)||(_N(a=this._getOrReturnCtx(e,a),{validation:"base64",code:_S.invalid_string,message:l.message}),o.dirty()):"base64url"===l.kind?_8.test(e.data)||(_N(a=this._getOrReturnCtx(e,a),{validation:"base64url",code:_S.invalid_string,message:l.message}),o.dirty()):C$.assertNever(l);return{status:o.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:_S.invalid_string,...CV.errToObj(r)})}_addCheck(e){return new Ae({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...CV.errToObj(e)})}url(e){return this._addCheck({kind:"url",...CV.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...CV.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...CV.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...CV.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...CV.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...CV.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...CV.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...CV.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...CV.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...CV.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...CV.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...CV.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...CV.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...CV.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...CV.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...CV.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...CV.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...CV.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...CV.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...CV.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...CV.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...CV.errToObj(t)})}nonempty(e){return this.min(1,CV.errToObj(e))}trim(){return new Ae({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ae({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ae({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}Ae.create=e=>new Ae({checks:[],typeName:CJ.ZodString,coerce:e?.coerce??!1,..._z(e)});class At extends _${constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==__.number){let t=this._getOrReturnCtx(e);return _N(t,{code:_S.invalid_type,expected:__.number,received:t.parsedType}),_U}let r=new _M;for(let i of this._def.checks)"int"===i.kind?C$.isInteger(e.data)||(_N(t=this._getOrReturnCtx(e,t),{code:_S.invalid_type,expected:"integer",received:"float",message:i.message}),r.dirty()):"min"===i.kind?(i.inclusive?e.data<i.value:e.data<=i.value)&&(_N(t=this._getOrReturnCtx(e,t),{code:_S.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):"max"===i.kind?(i.inclusive?e.data>i.value:e.data>=i.value)&&(_N(t=this._getOrReturnCtx(e,t),{code:_S.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):"multipleOf"===i.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,i=(t.toString().split(".")[1]||"").length,n=r>i?r:i;return Number.parseInt(e.toFixed(n).replace(".",""))%Number.parseInt(t.toFixed(n).replace(".",""))/10**n}(e.data,i.value)&&(_N(t=this._getOrReturnCtx(e,t),{code:_S.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):"finite"===i.kind?Number.isFinite(e.data)||(_N(t=this._getOrReturnCtx(e,t),{code:_S.not_finite,message:i.message}),r.dirty()):C$.assertNever(i);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,CV.toString(t))}gt(e,t){return this.setLimit("min",e,!1,CV.toString(t))}lte(e,t){return this.setLimit("max",e,!0,CV.toString(t))}lt(e,t){return this.setLimit("max",e,!1,CV.toString(t))}setLimit(e,t,r,i){return new At({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:CV.toString(i)}]})}_addCheck(e){return new At({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:CV.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:CV.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:CV.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:CV.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:CV.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:CV.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:CV.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:CV.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:CV.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&C$.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks)if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;else"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value);return Number.isFinite(t)&&Number.isFinite(e)}}At.create=e=>new At({checks:[],typeName:CJ.ZodNumber,coerce:e?.coerce||!1,..._z(e)});class Ar extends _${constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==__.bigint)return this._getInvalidInput(e);let r=new _M;for(let i of this._def.checks)"min"===i.kind?(i.inclusive?e.data<i.value:e.data<=i.value)&&(_N(t=this._getOrReturnCtx(e,t),{code:_S.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):"max"===i.kind?(i.inclusive?e.data>i.value:e.data>=i.value)&&(_N(t=this._getOrReturnCtx(e,t),{code:_S.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):"multipleOf"===i.kind?e.data%i.value!==BigInt(0)&&(_N(t=this._getOrReturnCtx(e,t),{code:_S.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):C$.assertNever(i);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return _N(t,{code:_S.invalid_type,expected:__.bigint,received:t.parsedType}),_U}gte(e,t){return this.setLimit("min",e,!0,CV.toString(t))}gt(e,t){return this.setLimit("min",e,!1,CV.toString(t))}lte(e,t){return this.setLimit("max",e,!0,CV.toString(t))}lt(e,t){return this.setLimit("max",e,!1,CV.toString(t))}setLimit(e,t,r,i){return new Ar({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:CV.toString(i)}]})}_addCheck(e){return new Ar({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:CV.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:CV.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:CV.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:CV.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:CV.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}Ar.create=e=>new Ar({checks:[],typeName:CJ.ZodBigInt,coerce:e?.coerce??!1,..._z(e)});class Ai extends _${_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==__.boolean){let t=this._getOrReturnCtx(e);return _N(t,{code:_S.invalid_type,expected:__.boolean,received:t.parsedType}),_U}return _L(e.data)}}Ai.create=e=>new Ai({typeName:CJ.ZodBoolean,coerce:e?.coerce||!1,..._z(e)});class An extends _${_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==__.date){let t=this._getOrReturnCtx(e);return _N(t,{code:_S.invalid_type,expected:__.date,received:t.parsedType}),_U}if(Number.isNaN(e.data.getTime()))return _N(this._getOrReturnCtx(e),{code:_S.invalid_date}),_U;let r=new _M;for(let i of this._def.checks)"min"===i.kind?e.data.getTime()<i.value&&(_N(t=this._getOrReturnCtx(e,t),{code:_S.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):"max"===i.kind?e.data.getTime()>i.value&&(_N(t=this._getOrReturnCtx(e,t),{code:_S.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):C$.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new An({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:CV.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:CV.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}An.create=e=>new An({checks:[],coerce:e?.coerce||!1,typeName:CJ.ZodDate,..._z(e)});class As extends _${_parse(e){if(this._getType(e)!==__.symbol){let t=this._getOrReturnCtx(e);return _N(t,{code:_S.invalid_type,expected:__.symbol,received:t.parsedType}),_U}return _L(e.data)}}As.create=e=>new As({typeName:CJ.ZodSymbol,..._z(e)});class Aa extends _${_parse(e){if(this._getType(e)!==__.undefined){let t=this._getOrReturnCtx(e);return _N(t,{code:_S.invalid_type,expected:__.undefined,received:t.parsedType}),_U}return _L(e.data)}}Aa.create=e=>new Aa({typeName:CJ.ZodUndefined,..._z(e)});class Ao extends _${_parse(e){if(this._getType(e)!==__.null){let t=this._getOrReturnCtx(e);return _N(t,{code:_S.invalid_type,expected:__.null,received:t.parsedType}),_U}return _L(e.data)}}Ao.create=e=>new Ao({typeName:CJ.ZodNull,..._z(e)});class Al extends _${constructor(){super(...arguments),this._any=!0}_parse(e){return _L(e.data)}}Al.create=e=>new Al({typeName:CJ.ZodAny,..._z(e)});class Ac extends _${constructor(){super(...arguments),this._unknown=!0}_parse(e){return _L(e.data)}}Ac.create=e=>new Ac({typeName:CJ.ZodUnknown,..._z(e)});class Ad extends _${_parse(e){let t=this._getOrReturnCtx(e);return _N(t,{code:_S.invalid_type,expected:__.never,received:t.parsedType}),_U}}Ad.create=e=>new Ad({typeName:CJ.ZodNever,..._z(e)});class Au extends _${_parse(e){if(this._getType(e)!==__.undefined){let t=this._getOrReturnCtx(e);return _N(t,{code:_S.invalid_type,expected:__.void,received:t.parsedType}),_U}return _L(e.data)}}Au.create=e=>new Au({typeName:CJ.ZodVoid,..._z(e)});class Ah extends _${_parse(e){let{ctx:t,status:r}=this._processInputParams(e),i=this._def;if(t.parsedType!==__.array)return _N(t,{code:_S.invalid_type,expected:__.array,received:t.parsedType}),_U;if(null!==i.exactLength){let e=t.data.length>i.exactLength.value,n=t.data.length<i.exactLength.value;(e||n)&&(_N(t,{code:e?_S.too_big:_S.too_small,minimum:n?i.exactLength.value:void 0,maximum:e?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(null!==i.minLength&&t.data.length<i.minLength.value&&(_N(t,{code:_S.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),null!==i.maxLength&&t.data.length>i.maxLength.value&&(_N(t,{code:_S.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>i.type._parseAsync(new _H(t,e,t.path,r)))).then(e=>_M.mergeArray(r,e));let n=[...t.data].map((e,r)=>i.type._parseSync(new _H(t,e,t.path,r)));return _M.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new Ah({...this._def,minLength:{value:e,message:CV.toString(t)}})}max(e,t){return new Ah({...this._def,maxLength:{value:e,message:CV.toString(t)}})}length(e,t){return new Ah({...this._def,exactLength:{value:e,message:CV.toString(t)}})}nonempty(e){return this.min(1,e)}}Ah.create=(e,t)=>new Ah({type:e,minLength:null,maxLength:null,exactLength:null,typeName:CJ.ZodArray,..._z(t)});class Ap extends _${constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=C$.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==__.object){let t=this._getOrReturnCtx(e);return _N(t,{code:_S.invalid_type,expected:__.object,received:t.parsedType}),_U}let{status:t,ctx:r}=this._processInputParams(e),{shape:i,keys:n}=this._getCached(),s=[];if(!(this._def.catchall instanceof Ad&&"strip"===this._def.unknownKeys))for(let e in r.data)n.includes(e)||s.push(e);let a=[];for(let e of n){let t=i[e],n=r.data[e];a.push({key:{status:"valid",value:e},value:t._parse(new _H(r,n,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof Ad){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of s)a.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)s.length>0&&(_N(r,{code:_S.unrecognized_keys,keys:s}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of s){let i=r.data[t];a.push({key:{status:"valid",value:t},value:e._parse(new _H(r,i,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of a){let r=await t.key,i=await t.value;e.push({key:r,value:i,alwaysSet:t.alwaysSet})}return e}).then(e=>_M.mergeObjectSync(t,e)):_M.mergeObjectSync(t,a)}get shape(){return this._def.shape()}strict(e){return CV.errToObj,new Ap({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{let i=this._def.errorMap?.(t,r).message??r.defaultError;return"unrecognized_keys"===t.code?{message:CV.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new Ap({...this._def,unknownKeys:"strip"})}passthrough(){return new Ap({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ap({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ap({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:CJ.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Ap({...this._def,catchall:e})}pick(e){let t={};for(let r of C$.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new Ap({...this._def,shape:()=>t})}omit(e){let t={};for(let r of C$.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new Ap({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof Ap){let r={};for(let i in t.shape){let n=t.shape[i];r[i]=AP.create(e(n))}return new Ap({...t._def,shape:()=>r})}if(t instanceof Ah)return new Ah({...t._def,type:e(t.element)});if(t instanceof AP)return AP.create(e(t.unwrap()));if(t instanceof AO)return AO.create(e(t.unwrap()));if(t instanceof Aw)return Aw.create(t.items.map(t=>e(t)));else return t}(this)}partial(e){let t={};for(let r of C$.objectKeys(this.shape)){let i=this.shape[r];e&&!e[r]?t[r]=i:t[r]=i.optional()}return new Ap({...this._def,shape:()=>t})}required(e){let t={};for(let r of C$.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof AP;)e=e._def.innerType;t[r]=e}return new Ap({...this._def,shape:()=>t})}keyof(){return Ax(C$.objectKeys(this.shape))}}Ap.create=(e,t)=>new Ap({shape:()=>e,unknownKeys:"strip",catchall:Ad.create(),typeName:CJ.ZodObject,..._z(t)}),Ap.strictCreate=(e,t)=>new Ap({shape:()=>e,unknownKeys:"strict",catchall:Ad.create(),typeName:CJ.ZodObject,..._z(t)}),Ap.lazycreate=(e,t)=>new Ap({shape:e,unknownKeys:"strip",catchall:Ad.create(),typeName:CJ.ZodObject,..._z(t)});class Af extends _${_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new _I(e.ctx.common.issues));return _N(t,{code:_S.invalid_union,unionErrors:r}),_U});{let e,i=[];for(let n of r){let r={...t,common:{...t.common,issues:[]},parent:null},s=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:r}),r.common.issues.length&&i.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let n=i.map(e=>new _I(e));return _N(t,{code:_S.invalid_union,unionErrors:n}),_U}}get options(){return this._def.options}}Af.create=(e,t)=>new Af({options:e,typeName:CJ.ZodUnion,..._z(t)});let Ay=e=>{if(e instanceof AA)return Ay(e.schema);if(e instanceof AC)return Ay(e.innerType());if(e instanceof AS)return[e.value];if(e instanceof AI)return e.options;if(e instanceof Ak)return C$.objectValues(e.enum);else if(e instanceof AR)return Ay(e._def.innerType);else if(e instanceof Aa)return[void 0];else if(e instanceof Ao)return[null];else if(e instanceof AP)return[void 0,...Ay(e.unwrap())];else if(e instanceof AO)return[null,...Ay(e.unwrap())];else if(e instanceof AD)return Ay(e.unwrap());else if(e instanceof Aj)return Ay(e.unwrap());else if(e instanceof AN)return Ay(e._def.innerType);else return[]};class Ag extends _${_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==__.object)return _N(t,{code:_S.invalid_type,expected:__.object,received:t.parsedType}),_U;let r=this.discriminator,i=t.data[r],n=this.optionsMap.get(i);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(_N(t,{code:_S.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),_U)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let i=new Map;for(let r of t){let t=Ay(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let n of t){if(i.has(n))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);i.set(n,r)}}return new Ag({typeName:CJ.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,..._z(r)})}}class Am extends _${_parse(e){let{status:t,ctx:r}=this._processInputParams(e),i=(e,i)=>{if(_j(e)||_j(i))return _U;let n=function e(t,r){let i=_A(t),n=_A(r);if(t===r)return{valid:!0,data:t};if(i===__.object&&n===__.object){let i=C$.objectKeys(r),n=C$.objectKeys(t).filter(e=>-1!==i.indexOf(e)),s={...t,...r};for(let i of n){let n=e(t[i],r[i]);if(!n.valid)return{valid:!1};s[i]=n.data}return{valid:!0,data:s}}if(i===__.array&&n===__.array){if(t.length!==r.length)return{valid:!1};let i=[];for(let n=0;n<t.length;n++){let s=e(t[n],r[n]);if(!s.valid)return{valid:!1};i.push(s.data)}return{valid:!0,data:i}}if(i===__.date&&n===__.date&&+t==+r)return{valid:!0,data:t};return{valid:!1}}(e.value,i.value);return n.valid?((_B(e)||_B(i))&&t.dirty(),{status:t.value,value:n.data}):(_N(r,{code:_S.invalid_intersection_types}),_U)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>i(e,t)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Am.create=(e,t,r)=>new Am({left:e,right:t,typeName:CJ.ZodIntersection,..._z(r)});class Aw extends _${_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==__.array)return _N(r,{code:_S.invalid_type,expected:__.array,received:r.parsedType}),_U;if(r.data.length<this._def.items.length)return _N(r,{code:_S.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),_U;!this._def.rest&&r.data.length>this._def.items.length&&(_N(r,{code:_S.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...r.data].map((e,t)=>{let i=this._def.items[t]||this._def.rest;return i?i._parse(new _H(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(i).then(e=>_M.mergeArray(t,e)):_M.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new Aw({...this._def,rest:e})}}Aw.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new Aw({items:e,typeName:CJ.ZodTuple,rest:null,..._z(t)})};class Ab extends _${get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==__.object)return _N(r,{code:_S.invalid_type,expected:__.object,received:r.parsedType}),_U;let i=[],n=this._def.keyType,s=this._def.valueType;for(let e in r.data)i.push({key:n._parse(new _H(r,e,r.path,e)),value:s._parse(new _H(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?_M.mergeObjectAsync(t,i):_M.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,r){return new Ab(t instanceof _$?{keyType:e,valueType:t,typeName:CJ.ZodRecord,..._z(r)}:{keyType:Ae.create(),valueType:e,typeName:CJ.ZodRecord,..._z(t)})}}class Av extends _${get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==__.map)return _N(r,{code:_S.invalid_type,expected:__.map,received:r.parsedType}),_U;let i=this._def.keyType,n=this._def.valueType,s=[...r.data.entries()].map(([e,t],s)=>({key:i._parse(new _H(r,e,r.path,[s,"key"])),value:n._parse(new _H(r,t,r.path,[s,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of s){let i=await r.key,n=await r.value;if("aborted"===i.status||"aborted"===n.status)return _U;("dirty"===i.status||"dirty"===n.status)&&t.dirty(),e.set(i.value,n.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of s){let i=r.key,n=r.value;if("aborted"===i.status||"aborted"===n.status)return _U;("dirty"===i.status||"dirty"===n.status)&&t.dirty(),e.set(i.value,n.value)}return{status:t.value,value:e}}}}Av.create=(e,t,r)=>new Av({valueType:t,keyType:e,typeName:CJ.ZodMap,..._z(r)});class AE extends _${_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==__.set)return _N(r,{code:_S.invalid_type,expected:__.set,received:r.parsedType}),_U;let i=this._def;null!==i.minSize&&r.data.size<i.minSize.value&&(_N(r,{code:_S.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),null!==i.maxSize&&r.data.size>i.maxSize.value&&(_N(r,{code:_S.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());let n=this._def.valueType;function s(e){let r=new Set;for(let i of e){if("aborted"===i.status)return _U;"dirty"===i.status&&t.dirty(),r.add(i.value)}return{status:t.value,value:r}}let a=[...r.data.values()].map((e,t)=>n._parse(new _H(r,e,r.path,t)));return r.common.async?Promise.all(a).then(e=>s(e)):s(a)}min(e,t){return new AE({...this._def,minSize:{value:e,message:CV.toString(t)}})}max(e,t){return new AE({...this._def,maxSize:{value:e,message:CV.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}AE.create=(e,t)=>new AE({valueType:e,minSize:null,maxSize:null,typeName:CJ.ZodSet,..._z(t)});class A_ extends _${constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==__.function)return _N(t,{code:_S.invalid_type,expected:__.function,received:t.parsedType}),_U;function r(e,r){return _O({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,_T,_k].filter(e=>!!e),issueData:{code:_S.invalid_arguments,argumentsError:r}})}function i(e,r){return _O({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,_T,_k].filter(e=>!!e),issueData:{code:_S.invalid_return_type,returnTypeError:r}})}let n={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof AT){let e=this;return _L(async function(...t){let a=new _I([]),o=await e._def.args.parseAsync(t,n).catch(e=>{throw a.addIssue(r(t,e)),a}),l=await Reflect.apply(s,this,o);return await e._def.returns._def.type.parseAsync(l,n).catch(e=>{throw a.addIssue(i(l,e)),a})})}{let e=this;return _L(function(...t){let a=e._def.args.safeParse(t,n);if(!a.success)throw new _I([r(t,a.error)]);let o=Reflect.apply(s,this,a.data),l=e._def.returns.safeParse(o,n);if(!l.success)throw new _I([i(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new A_({...this._def,args:Aw.create(e).rest(Ac.create())})}returns(e){return new A_({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new A_({args:e||Aw.create([]).rest(Ac.create()),returns:t||Ac.create(),typeName:CJ.ZodFunction,..._z(r)})}}class AA extends _${get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}AA.create=(e,t)=>new AA({getter:e,typeName:CJ.ZodLazy,..._z(t)});class AS extends _${_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return _N(t,{received:t.data,code:_S.invalid_literal,expected:this._def.value}),_U}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Ax(e,t){return new AI({values:e,typeName:CJ.ZodEnum,..._z(t)})}AS.create=(e,t)=>new AS({value:e,typeName:CJ.ZodLiteral,..._z(t)});class AI extends _${_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return _N(t,{expected:C$.joinValues(r),received:t.parsedType,code:_S.invalid_type}),_U}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return _N(t,{received:t.data,code:_S.invalid_enum_value,options:r}),_U}return _L(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return AI.create(e,{...this._def,...t})}exclude(e,t=this._def){return AI.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}AI.create=Ax;class Ak extends _${_parse(e){let t=C$.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==__.string&&r.parsedType!==__.number){let e=C$.objectValues(t);return _N(r,{expected:C$.joinValues(e),received:r.parsedType,code:_S.invalid_type}),_U}if(this._cache||(this._cache=new Set(C$.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=C$.objectValues(t);return _N(r,{received:r.data,code:_S.invalid_enum_value,options:e}),_U}return _L(e.data)}get enum(){return this._def.values}}Ak.create=(e,t)=>new Ak({values:e,typeName:CJ.ZodNativeEnum,..._z(t)});class AT extends _${unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==__.promise&&!1===t.common.async?(_N(t,{code:_S.invalid_type,expected:__.promise,received:t.parsedType}),_U):_L((t.parsedType===__.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}AT.create=(e,t)=>new AT({type:e,typeName:CJ.ZodPromise,..._z(t)});class AC extends _${innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===CJ.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),i=this._def.effect||null,n={addIssue:e=>{_N(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===i.type){let e=i.transform(r.data,n);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return _U;let i=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===i.status?_U:"dirty"===i.status||"dirty"===t.value?_D(i.value):i});{if("aborted"===t.value)return _U;let i=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===i.status?_U:"dirty"===i.status||"dirty"===t.value?_D(i.value):i}}if("refinement"===i.type){let e=e=>{let t=i.refinement(e,n);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?_U:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===i.status?_U:("dirty"===i.status&&t.dirty(),e(i.value),{status:t.value,value:i.value})}}if("transform"===i.type)if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>_W(e)?Promise.resolve(i.transform(e.value,n)).then(e=>({status:t.value,value:e})):_U);else{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!_W(e))return _U;let s=i.transform(e.value,n);if(s instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}C$.assertNever(i)}}AC.create=(e,t,r)=>new AC({schema:e,typeName:CJ.ZodEffects,effect:t,..._z(r)}),AC.createWithPreprocess=(e,t,r)=>new AC({schema:t,effect:{type:"preprocess",transform:e},typeName:CJ.ZodEffects,..._z(r)});class AP extends _${_parse(e){return this._getType(e)===__.undefined?_L(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}AP.create=(e,t)=>new AP({innerType:e,typeName:CJ.ZodOptional,..._z(t)});class AO extends _${_parse(e){return this._getType(e)===__.null?_L(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}AO.create=(e,t)=>new AO({innerType:e,typeName:CJ.ZodNullable,..._z(t)});class AR extends _${_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===__.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}AR.create=(e,t)=>new AR({innerType:e,typeName:CJ.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,..._z(t)});class AN extends _${_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return _F(i)?i.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new _I(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===i.status?i.value:this._def.catchValue({get error(){return new _I(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}AN.create=(e,t)=>new AN({innerType:e,typeName:CJ.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,..._z(t)});class AM extends _${_parse(e){if(this._getType(e)!==__.nan){let t=this._getOrReturnCtx(e);return _N(t,{code:_S.invalid_type,expected:__.nan,received:t.parsedType}),_U}return{status:"valid",value:e.data}}}AM.create=e=>new AM({typeName:CJ.ZodNaN,..._z(e)});let AU=Symbol("zod_brand");class AD extends _${_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class AL extends _${_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?_U:"dirty"===e.status?(t.dirty(),_D(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?_U:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new AL({in:e,out:t,typeName:CJ.ZodPipeline})}}class Aj extends _${_parse(e){let t=this._def.innerType._parse(e),r=e=>(_W(e)&&(e.value=Object.freeze(e.value)),e);return _F(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function AB(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function AW(e,t={},r){return e?Al.create().superRefine((i,n)=>{let s=e(i);if(s instanceof Promise)return s.then(e=>{if(!e){let e=AB(t,i),s=e.fatal??r??!0;n.addIssue({code:"custom",...e,fatal:s})}});if(!s){let e=AB(t,i),s=e.fatal??r??!0;n.addIssue({code:"custom",...e,fatal:s})}}):Al.create()}Aj.create=(e,t)=>new Aj({innerType:e,typeName:CJ.ZodReadonly,..._z(t)});let AF={object:Ap.lazycreate};(CO=CJ||(CJ={})).ZodString="ZodString",CO.ZodNumber="ZodNumber",CO.ZodNaN="ZodNaN",CO.ZodBigInt="ZodBigInt",CO.ZodBoolean="ZodBoolean",CO.ZodDate="ZodDate",CO.ZodSymbol="ZodSymbol",CO.ZodUndefined="ZodUndefined",CO.ZodNull="ZodNull",CO.ZodAny="ZodAny",CO.ZodUnknown="ZodUnknown",CO.ZodNever="ZodNever",CO.ZodVoid="ZodVoid",CO.ZodArray="ZodArray",CO.ZodObject="ZodObject",CO.ZodUnion="ZodUnion",CO.ZodDiscriminatedUnion="ZodDiscriminatedUnion",CO.ZodIntersection="ZodIntersection",CO.ZodTuple="ZodTuple",CO.ZodRecord="ZodRecord",CO.ZodMap="ZodMap",CO.ZodSet="ZodSet",CO.ZodFunction="ZodFunction",CO.ZodLazy="ZodLazy",CO.ZodLiteral="ZodLiteral",CO.ZodEnum="ZodEnum",CO.ZodEffects="ZodEffects",CO.ZodNativeEnum="ZodNativeEnum",CO.ZodOptional="ZodOptional",CO.ZodNullable="ZodNullable",CO.ZodDefault="ZodDefault",CO.ZodCatch="ZodCatch",CO.ZodPromise="ZodPromise",CO.ZodBranded="ZodBranded",CO.ZodPipeline="ZodPipeline",CO.ZodReadonly="ZodReadonly";let AH=(e,t={message:`Input not instance of ${e.name}`})=>AW(t=>t instanceof e,t),Aq=Ae.create,Az=At.create,A$=AM.create,AK=Ar.create,AV=Ai.create,AJ=An.create,AZ=As.create,AG=Aa.create,AY=Ao.create,AQ=Al.create,AX=Ac.create,A0=Ad.create,A1=Au.create,A2=Ah.create,A3=Ap.create,A5=Ap.strictCreate,A8=Af.create,A6=Ag.create,A4=Am.create,A7=Aw.create,A9=Ab.create,Se=Av.create,St=AE.create,Sr=A_.create,Si=AA.create,Sn=AS.create,Ss=AI.create,Sa=Ak.create,So=AT.create,Sl=AC.create,Sc=AP.create,Sd=AO.create,Su=AC.createWithPreprocess,Sh=AL.create,Sp=()=>Aq().optional(),Sf=()=>Az().optional(),Sy=()=>AV().optional(),Sg={string:e=>Ae.create({...e,coerce:!0}),number:e=>At.create({...e,coerce:!0}),boolean:e=>Ai.create({...e,coerce:!0}),bigint:e=>Ar.create({...e,coerce:!0}),date:e=>An.create({...e,coerce:!0})};e.s(["BRAND",0,AU,"NEVER",0,_U,"Schema",()=>_$,"ZodAny",()=>Al,"ZodArray",()=>Ah,"ZodBigInt",()=>Ar,"ZodBoolean",()=>Ai,"ZodBranded",()=>AD,"ZodCatch",()=>AN,"ZodDate",()=>An,"ZodDefault",()=>AR,"ZodDiscriminatedUnion",()=>Ag,"ZodEffects",()=>AC,"ZodEnum",()=>AI,"ZodFirstPartyTypeKind",()=>CJ,"ZodFunction",()=>A_,"ZodIntersection",()=>Am,"ZodLazy",()=>AA,"ZodLiteral",()=>AS,"ZodMap",()=>Av,"ZodNaN",()=>AM,"ZodNativeEnum",()=>Ak,"ZodNever",()=>Ad,"ZodNull",()=>Ao,"ZodNullable",()=>AO,"ZodNumber",()=>At,"ZodObject",()=>Ap,"ZodOptional",()=>AP,"ZodPipeline",()=>AL,"ZodPromise",()=>AT,"ZodReadonly",()=>Aj,"ZodRecord",()=>Ab,"ZodSchema",()=>_$,"ZodSet",()=>AE,"ZodString",()=>Ae,"ZodSymbol",()=>As,"ZodTransformer",()=>AC,"ZodTuple",()=>Aw,"ZodType",()=>_$,"ZodUndefined",()=>Aa,"ZodUnion",()=>Af,"ZodUnknown",()=>Ac,"ZodVoid",()=>Au,"any",()=>AQ,"array",()=>A2,"bigint",()=>AK,"boolean",()=>AV,"coerce",0,Sg,"custom",()=>AW,"date",()=>AJ,"datetimeRegex",()=>_9,"discriminatedUnion",()=>A6,"effect",()=>Sl,"enum",()=>Ss,"function",()=>Sr,"instanceof",()=>AH,"intersection",()=>A4,"late",0,AF,"lazy",()=>Si,"literal",()=>Sn,"map",()=>Se,"nan",()=>A$,"nativeEnum",()=>Sa,"never",()=>A0,"null",()=>AY,"nullable",()=>Sd,"number",()=>Az,"object",()=>A3,"oboolean",()=>Sy,"onumber",()=>Sf,"optional",()=>Sc,"ostring",()=>Sp,"pipeline",()=>Sh,"preprocess",()=>Su,"promise",()=>So,"record",()=>A9,"set",()=>St,"strictObject",()=>A5,"string",()=>Aq,"symbol",()=>AZ,"transformer",()=>Sl,"tuple",()=>A7,"undefined",()=>AG,"union",()=>A8,"unknown",()=>AX,"void",()=>A1],965638),e.i(965638),e.i(169790),e.s(["BRAND",0,AU,"DIRTY",0,_D,"EMPTY_PATH",0,_R,"INVALID",0,_U,"NEVER",0,_U,"OK",0,_L,"ParseStatus",()=>_M,"Schema",()=>_$,"ZodAny",()=>Al,"ZodArray",()=>Ah,"ZodBigInt",()=>Ar,"ZodBoolean",()=>Ai,"ZodBranded",()=>AD,"ZodCatch",()=>AN,"ZodDate",()=>An,"ZodDefault",()=>AR,"ZodDiscriminatedUnion",()=>Ag,"ZodEffects",()=>AC,"ZodEnum",()=>AI,"ZodError",()=>_I,"ZodFirstPartyTypeKind",()=>CJ,"ZodFunction",()=>A_,"ZodIntersection",()=>Am,"ZodIssueCode",0,_S,"ZodLazy",()=>AA,"ZodLiteral",()=>AS,"ZodMap",()=>Av,"ZodNaN",()=>AM,"ZodNativeEnum",()=>Ak,"ZodNever",()=>Ad,"ZodNull",()=>Ao,"ZodNullable",()=>AO,"ZodNumber",()=>At,"ZodObject",()=>Ap,"ZodOptional",()=>AP,"ZodParsedType",0,__,"ZodPipeline",()=>AL,"ZodPromise",()=>AT,"ZodReadonly",()=>Aj,"ZodRecord",()=>Ab,"ZodSchema",()=>_$,"ZodSet",()=>AE,"ZodString",()=>Ae,"ZodSymbol",()=>As,"ZodTransformer",()=>AC,"ZodTuple",()=>Aw,"ZodType",()=>_$,"ZodUndefined",()=>Aa,"ZodUnion",()=>Af,"ZodUnknown",()=>Ac,"ZodVoid",()=>Au,"addIssueToContext",()=>_N,"any",()=>AQ,"array",()=>A2,"bigint",()=>AK,"boolean",()=>AV,"coerce",0,Sg,"custom",()=>AW,"date",()=>AJ,"datetimeRegex",()=>_9,"defaultErrorMap",0,_k,"discriminatedUnion",()=>A6,"effect",()=>Sl,"enum",()=>Ss,"function",()=>Sr,"getErrorMap",()=>_P,"getParsedType",0,_A,"instanceof",()=>AH,"intersection",()=>A4,"isAborted",0,_j,"isAsync",0,_F,"isDirty",0,_B,"isValid",0,_W,"late",0,AF,"lazy",()=>Si,"literal",()=>Sn,"makeIssue",0,_O,"map",()=>Se,"nan",()=>A$,"nativeEnum",()=>Sa,"never",()=>A0,"null",()=>AY,"nullable",()=>Sd,"number",()=>Az,"object",()=>A3,"objectUtil",()=>CK,"oboolean",()=>Sy,"onumber",()=>Sf,"optional",()=>Sc,"ostring",()=>Sp,"pipeline",()=>Sh,"preprocess",()=>Su,"promise",()=>So,"quotelessJson",0,_x,"record",()=>A9,"set",()=>St,"setErrorMap",()=>_C,"strictObject",()=>A5,"string",()=>Aq,"symbol",()=>AZ,"transformer",()=>Sl,"tuple",()=>A7,"undefined",()=>AG,"union",()=>A8,"unknown",()=>AX,"util",()=>C$,"void",()=>A1],788685);var Sm=e.i(788685),Sm=Sm,Sw=e.i(309682),Sb=e.i(24335),Sv=e.i(450323),SE=e.i(557874),S_=e.i(982191),SA=e.i(839080);let SS={block:(0,SE.defineBlock)({format:e=>({transactions:e.transactions?.map(e=>{if("string"==typeof e)return e;let t=(0,S_.formatTransaction)(e);return"0x7e"===t.typeHex&&(t.isSystemTx=e.isSystemTx,t.mint=e.mint?(0,Sv.hexToBigInt)(e.mint):void 0,t.sourceHash=e.sourceHash,t.type="deposit"),t}),stateRoot:e.stateRoot})}),transaction:(0,S_.defineTransaction)({format(e){let t={};return"0x7e"===e.type&&(t.isSystemTx=e.isSystemTx,t.mint=e.mint?(0,Sv.hexToBigInt)(e.mint):void 0,t.sourceHash=e.sourceHash,t.type="deposit"),t}}),transactionReceipt:(0,SA.defineTransactionReceipt)({format:e=>({l1GasPrice:e.l1GasPrice?(0,Sv.hexToBigInt)(e.l1GasPrice):null,l1GasUsed:e.l1GasUsed?(0,Sv.hexToBigInt)(e.l1GasUsed):null,l1Fee:e.l1Fee?(0,Sv.hexToBigInt)(e.l1Fee):null,l1FeeScalar:e.l1FeeScalar?Number(e.l1FeeScalar):null})})};var Sx=e.i(608861),SI=e.i(147526),Sk=e.i(70326),ST=e.i(766816);let SC={blockTime:2e3,contracts:{gasPriceOracle:{address:"0x420000000000000000000000000000000000000F"},l1Block:{address:"0x4200000000000000000000000000000000000015"},l2CrossDomainMessenger:{address:"0x4200000000000000000000000000000000000007"},l2Erc721Bridge:{address:"0x4200000000000000000000000000000000000014"},l2StandardBridge:{address:"0x4200000000000000000000000000000000000010"},l2ToL1MessagePasser:{address:"0x4200000000000000000000000000000000000016"}},formatters:SS,serializers:{transaction:function(e,t){var r;return"deposit"===(r=e).type||void 0!==r.sourceHash?function(e){!function(e){let{from:t,to:r}=e;if(t&&!(0,i7.isAddress)(t))throw new Sx.InvalidAddressError({address:t});if(r&&!(0,i7.isAddress)(r))throw new Sx.InvalidAddressError({address:r})}(e);let{sourceHash:t,data:r,from:i,gas:n,isSystemTx:s,mint:a,to:o,value:l}=e,c=[t,i,o??"0x",a?(0,i4.toHex)(a):"0x",l?(0,i4.toHex)(l):"0x",n?(0,i4.toHex)(n):"0x",s?"0x1":"0x",r??"0x"];return(0,SI.concatHex)(["0x7e",(0,Sk.toRlp)(c)])}(e):(0,ST.serializeTransaction)(e,t)}}};var SP=e.i(538463);let SO=(0,SP.defineChain)({...SC,id:84532,network:"base-sepolia",name:"Base Sepolia",nativeCurrency:{name:"Sepolia Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://sepolia.base.org"]}},blockExplorers:{default:{name:"Basescan",url:"https://sepolia.basescan.org",apiUrl:"https://api-sepolia.basescan.org/api"}},contracts:{...SC.contracts,disputeGameFactory:{0xaa36a7:{address:"0xd6E6dBf4F7EA0ac412fD8b65ED297e64BB7a06E1"}},l2OutputOracle:{0xaa36a7:{address:"0x84457ca9D0163FbC4bbfe4Dfbb20ba46e48DF254"}},portal:{0xaa36a7:{address:"0x49f53e41452c74589e85ca1677426ba426459e85",blockCreated:4446677}},l1StandardBridge:{0xaa36a7:{address:"0xfd0Bf71F60660E2f608ed56e1659C450eB113120",blockCreated:4446677}},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:1059647}},testnet:!0,sourceId:0xaa36a7});({...SO,experimental_preconfirmationTime:200,rpcUrls:{default:{http:["https://sepolia-preconf.base.org"]}}});let SR=(0,SP.defineChain)({id:43113,name:"Avalanche Fuji",nativeCurrency:{decimals:18,name:"Avalanche Fuji",symbol:"AVAX"},rpcUrls:{default:{http:["https://api.avax-test.network/ext/bc/C/rpc"]}},blockExplorers:{default:{name:"SnowTrace",url:"https://testnet.snowtrace.io",apiUrl:"https://api-testnet.snowtrace.io"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:7096959}},testnet:!0}),SN=(0,SP.defineChain)({...SC,id:8453,name:"Base",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://mainnet.base.org"]}},blockExplorers:{default:{name:"Basescan",url:"https://basescan.org",apiUrl:"https://api.basescan.org/api"}},contracts:{...SC.contracts,disputeGameFactory:{1:{address:"0x43edB88C4B80fDD2AdFF2412A7BebF9dF42cB40e"}},l2OutputOracle:{1:{address:"0x56315b90c40730925ec5485cf004d835058518A0"}},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:5022},portal:{1:{address:"0x49048044D57e1C92A77f79988d21Fa8fAF74E97e",blockCreated:0x10ac19f}},l1StandardBridge:{1:{address:"0x3154Cf16ccdb4C6d922629664174b904d80F2C35",blockCreated:0x10ac19f}}},sourceId:1});({...SN,experimental_preconfirmationTime:200,rpcUrls:{default:{http:["https://mainnet-preconf.base.org"]}}});let SM=(0,SP.defineChain)({id:1329,name:"Sei Network",nativeCurrency:{name:"Sei",symbol:"SEI",decimals:18},rpcUrls:{default:{http:["https://evm-rpc.sei-apis.com/"],webSocket:["wss://evm-ws.sei-apis.com/"]}},blockExplorers:{default:{name:"Seitrace",url:"https://seitrace.com",apiUrl:"https://seitrace.com/pacific-1/api"}},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11"}}}),SU=(0,SP.defineChain)({id:1328,name:"Sei Testnet",nativeCurrency:{name:"Sei",symbol:"SEI",decimals:18},rpcUrls:{default:{http:["https://evm-rpc-testnet.sei-apis.com"],webSocket:["wss://evm-ws-testnet.sei-apis.com"]}},blockExplorers:{default:{name:"Seitrace",url:"https://seitrace.com"}},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:0x5e201b3}},testnet:!0}),SD=(0,SP.defineChain)({id:137,name:"Polygon",blockTime:2e3,nativeCurrency:{name:"POL",symbol:"POL",decimals:18},rpcUrls:{default:{http:["https://polygon-rpc.com"]}},blockExplorers:{default:{name:"PolygonScan",url:"https://polygonscan.com",apiUrl:"https://api.polygonscan.com/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:0x18938b0}}}),SL=(0,SP.defineChain)({id:80002,name:"Polygon Amoy",nativeCurrency:{name:"POL",symbol:"POL",decimals:18},rpcUrls:{default:{http:["https://rpc-amoy.polygon.technology"]}},blockExplorers:{default:{name:"PolygonScan",url:"https://amoy.polygonscan.com",apiUrl:"https://api-amoy.polygonscan.com/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:3127388}},testnet:!0}),Sj=(0,SP.defineChain)({id:3338,name:"Peaq",nativeCurrency:{decimals:18,name:"peaq",symbol:"PEAQ"},rpcUrls:{default:{http:["https://quicknode1.peaq.xyz","https://quicknode2.peaq.xyz","https://quicknode3.peaq.xyz"],webSocket:["wss://quicknode1.peaq.xyz","wss://quicknode2.peaq.xyz","wss://quicknode3.peaq.xyz"]}},blockExplorers:{default:{name:"Subscan",url:"https://peaq.subscan.io"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:3566354}}}),SB=(0,SP.defineChain)({id:43114,name:"Avalanche",blockTime:1700,nativeCurrency:{decimals:18,name:"Avalanche",symbol:"AVAX"},rpcUrls:{default:{http:["https://api.avax.network/ext/bc/C/rpc"]}},blockExplorers:{default:{name:"SnowTrace",url:"https://snowtrace.io",apiUrl:"https://api.snowtrace.io"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:0xb5b35e}}}),SW=(0,SP.defineChain)({id:4690,name:"IoTeX Testnet",nativeCurrency:{decimals:18,name:"IoTeX",symbol:"IOTX"},rpcUrls:{default:{http:["https://babel-api.testnet.iotex.io"],webSocket:["wss://babel-api.testnet.iotex.io"]}},blockExplorers:{default:{name:"IoTeXScan",url:"https://testnet.iotexscan.io"}},contracts:{multicall3:{address:"0xb5cecD6894c6f473Ec726A176f1512399A2e355d",blockCreated:0x17383c8}},testnet:!0}),SF=(0,SP.defineChain)({id:4689,name:"IoTeX",nativeCurrency:{decimals:18,name:"IoTeX",symbol:"IOTX"},rpcUrls:{default:{http:["https://babel-api.mainnet.iotex.io"],webSocket:["wss://babel-api.mainnet.iotex.io"]}},blockExplorers:{default:{name:"IoTeXScan",url:"https://iotexscan.io"}},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:0x15230d6}}});var SH=e.i(769936),Sq=e.i(856324),Sz=e.i(190521);let S$=32n*e.i(674768).maxUint16,SK={block:(0,SE.defineBlock)({format(e){let t=e.transactions?.map(e=>{if("string"==typeof e)return e;let t=SK.transaction?.format(e);return"0x71"===t.typeHex?t.type="eip712":"0xff"===t.typeHex&&(t.type="priority"),t});return{l1BatchNumber:e.l1BatchNumber?(0,Sv.hexToBigInt)(e.l1BatchNumber):null,l1BatchTimestamp:e.l1BatchTimestamp?(0,Sv.hexToBigInt)(e.l1BatchTimestamp):null,transactions:t}}}),transaction:(0,S_.defineTransaction)({format(e){let t={};return"0x71"===e.type?t.type="eip712":"0xff"===e.type&&(t.type="priority"),{...t,l1BatchNumber:e.l1BatchNumber?(0,Sv.hexToBigInt)(e.l1BatchNumber):null,l1BatchTxIndex:e.l1BatchTxIndex?(0,Sv.hexToBigInt)(e.l1BatchTxIndex):null}}}),transactionReceipt:(0,SA.defineTransactionReceipt)({format:e=>({l1BatchNumber:e.l1BatchNumber?(0,Sv.hexToBigInt)(e.l1BatchNumber):null,l1BatchTxIndex:e.l1BatchTxIndex?(0,Sv.hexToBigInt)(e.l1BatchTxIndex):null,logs:e.logs.map(e=>({...(0,Sq.formatLog)(e),l1BatchNumber:e.l1BatchNumber?(0,Sv.hexToBigInt)(e.l1BatchNumber):null,transactionLogIndex:(0,Sv.hexToNumber)(e.transactionLogIndex),logType:e.logType})),l2ToL1Logs:e.l2ToL1Logs.map(e=>({blockNumber:(0,Sv.hexToBigInt)(e.blockHash),blockHash:e.blockHash,l1BatchNumber:e.l1BatchNumber?(0,Sv.hexToBigInt)(e.l1BatchNumber):null,transactionIndex:(0,Sv.hexToBigInt)(e.transactionIndex),shardId:(0,Sv.hexToBigInt)(e.shardId),isService:e.isService,sender:e.sender,key:e.key,value:e.value,transactionHash:e.transactionHash,logIndex:(0,Sv.hexToBigInt)(e.logIndex)}))})}),transactionRequest:(0,Sz.defineTransactionRequest)({exclude:["customSignature","factoryDeps","gasPerPubdata","paymaster","paymasterInput"],format:e=>e.gasPerPubdata||e.paymaster&&e.paymasterInput||e.factoryDeps||e.customSignature?{eip712Meta:{...e.gasPerPubdata?{gasPerPubdata:(0,i4.toHex)(e.gasPerPubdata)}:{gasPerPubdata:(0,i4.toHex)(50000n)},...e.paymaster&&e.paymasterInput?{paymasterParams:{paymaster:e.paymaster,paymasterInput:Array.from((0,SH.hexToBytes)(e.paymasterInput))}}:{},...e.factoryDeps?{factoryDeps:e.factoryDeps.map(e=>Array.from((0,SH.hexToBytes)(e)))}:{},...e.customSignature?{customSignature:Array.from((0,SH.hexToBytes)(e.customSignature))}:{}},type:"0x71"}:{}})};var SV=e.i(569934),SJ=e.i(505880),SZ=SV;class SG extends SZ.BaseError{constructor(){super('Transaction is not an EIP712 transaction.\n\nTransaction must:\n  - include `type: "eip712"`\n  - include one of the following: `customSignature`, `paymaster`, `paymasterInput`, `gasPerPubdata`, `factoryDeps`',{name:"InvalidEip712TransactionError"})}}function SY(e){return"eip712"===e.type||"customSignature"in e&&!!e.customSignature||"paymaster"in e&&!!e.paymaster||"paymasterInput"in e&&!!e.paymasterInput||"gasPerPubdata"in e&&"bigint"==typeof e.gasPerPubdata||"factoryDeps"in e&&!!e.factoryDeps||!1}function SQ(e){let{chainId:t,to:r,from:i,paymaster:n,paymasterInput:s}=e;if(!SY(e))throw new SG;if(!t||t<=0)throw new SJ.InvalidChainIdError({chainId:t});if(r&&!(0,i7.isAddress)(r))throw new Sx.InvalidAddressError({address:r});if(i&&!(0,i7.isAddress)(i))throw new Sx.InvalidAddressError({address:i});if(n&&!(0,i7.isAddress)(n))throw new Sx.InvalidAddressError({address:n});if(n&&!s)throw new SV.BaseError("`paymasterInput` must be provided when `paymaster` is defined");if(!n&&s)throw new SV.BaseError("`paymaster` must be provided when `paymasterInput` is defined")}var SX=e.i(22411),S0=e.i(862243),S1=SV;class S2 extends S1.BaseError{constructor({givenLength:e,maxBytecodeSize:t}){super(`Bytecode cannot be longer than ${t} bytes. Given length: ${e}`,{name:"BytecodeLengthExceedsMaxSizeError"})}}class S3 extends S1.BaseError{constructor({givenLengthInWords:e}){super(`Bytecode length in 32-byte words must be odd. Given length in words: ${e}`,{name:"BytecodeLengthInWordsMustBeOddError"})}}class S5 extends S1.BaseError{constructor({givenLength:e}){super(`The bytecode length in bytes must be divisible by 32. Given length: ${e}`,{name:"BytecodeLengthMustBeDivisibleBy32Error"})}}function S8(e){let t=(0,SH.toBytes)(e);if(t.length%32!=0)throw new S5({givenLength:t.length});if(t.length>S$)throw new S2({givenLength:t.length,maxBytecodeSize:S$});let r=(0,S0.sha256)(t),i=(0,SH.toBytes)(r),n=t.length/32;if(n%2==0)throw new S3({givenLengthInWords:n});let s=(0,SH.toBytes)(n),a=(0,SX.pad)(s,{size:2}),o=new Uint8Array([1,0]);return i.set(o,0),i.set(a,2),i}let S6={blockTime:1e3,formatters:SK,serializers:{transaction:function(e,t){return SY(e)?function(e){let{chainId:t,gas:r,nonce:i,to:n,from:s,value:a,maxFeePerGas:o,maxPriorityFeePerGas:l,customSignature:c,factoryDeps:d,paymaster:u,paymasterInput:h,gasPerPubdata:p,data:f}=e;SQ(e);let y=[i?(0,i4.toHex)(i):"0x",l?(0,i4.toHex)(l):"0x",o?(0,i4.toHex)(o):"0x",r?(0,i4.toHex)(r):"0x",n??"0x",a?(0,i4.toHex)(a):"0x",f??"0x",(0,i4.toHex)(t),(0,i4.toHex)(""),(0,i4.toHex)(""),(0,i4.toHex)(t),s??"0x",p?(0,i4.toHex)(p):(0,i4.toHex)(50000n),d??[],c??"0x",u&&h?[u,h]:[]];return(0,SI.concatHex)(["0x71",(0,Sk.toRlp)(y)])}(e):(0,ST.serializeTransaction)(e,t)}},custom:{getEip712Domain:e=>{SQ(e);let t=function(e){let{gas:t,nonce:r,to:i,from:n,value:s,maxFeePerGas:a,maxPriorityFeePerGas:o,factoryDeps:l,paymaster:c,paymasterInput:d,gasPerPubdata:u,data:h}=e;return{txType:113n,from:BigInt(n),to:i?BigInt(i):0n,gasLimit:t??0n,gasPerPubdataByteLimit:u??50000n,maxFeePerGas:a??0n,maxPriorityFeePerGas:o??0n,paymaster:c?BigInt(c):0n,nonce:r?BigInt(r):0n,value:s??0n,data:h??"0x",factoryDeps:l?.map(e=>(0,i4.toHex)(S8(e)))??[],paymasterInput:d||"0x"}}(e);return{domain:{name:"zkSync",version:"2",chainId:e.chainId},types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]},primaryType:"Transaction",message:t}}}},S4=(0,SP.defineChain)({...S6,blockTime:200,id:2741,name:"Abstract",nativeCurrency:{decimals:18,name:"ETH",symbol:"ETH"},rpcUrls:{default:{http:["https://api.mainnet.abs.xyz"],webSocket:["wss://api.mainnet.abs.xyz/ws"]}},blockExplorers:{default:{name:"Etherscan",url:"https://abscan.org"},native:{name:"Abstract Explorer",url:"https://explorer.mainnet.abs.xyz"}},contracts:{multicall3:{address:"0xAa4De41dba0Ca5dCBb288b7cC6b708F3aaC759E7",blockCreated:5288},erc6492Verifier:{address:"0xfB688330379976DA81eB64Fe4BF50d7401763B9C",blockCreated:5263}}}),S7=(0,SP.defineChain)({...S6,blockTime:200,id:11124,name:"Abstract Testnet",nativeCurrency:{decimals:18,name:"ETH",symbol:"ETH"},rpcUrls:{default:{http:["https://api.testnet.abs.xyz"]}},blockExplorers:{default:{name:"Etherscan",url:"https://sepolia.abscan.org"},native:{name:"Abstract Explorer",url:"https://explorer.testnet.abs.xyz"}},testnet:!0,contracts:{multicall3:{address:"0xF9cda624FBC7e059355ce98a31693d299FACd963",blockCreated:358349},erc6492Verifier:{address:"0xfB688330379976DA81eB64Fe4BF50d7401763B9C",blockCreated:431682}}}),S9=(0,SP.defineChain)({id:1514,name:"Story",nativeCurrency:{decimals:18,name:"IP Token",symbol:"IP"},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:340998},ensRegistry:{address:"0x5dc881dda4e4a8d312be3544ad13118d1a04cb17",blockCreated:648924},ensUniversalResolver:{address:"0xddfb18888a9466688235887dec2a10c4f5effee9",blockCreated:649114}},rpcUrls:{default:{http:["https://mainnet.storyrpc.io"]}},blockExplorers:{default:{name:"Story explorer",url:"https://storyscan.io",apiUrl:"https://storyscan.io/api/v2"}},ensTlds:[".ip"],testnet:!1}),xe=(0,SP.defineChain)({id:41923,name:"EDU Chain",nativeCurrency:{decimals:18,name:"EDU",symbol:"EDU"},rpcUrls:{default:{http:["https://rpc.edu-chain.raas.gelato.cloud"]}},blockExplorers:{default:{name:"EDU Chain Explorer",url:"https://educhain.blockscout.com/"}},testnet:!1});var xt=e.i(337575),xr=e.i(704433),xi=e.i(913091);async function xn({hash:e,privateKey:t,to:r="object"}){let{r:i,s:n,recovery:s}=xt.secp256k1.sign(e.slice(2),t.slice(2),{lowS:!0,extraEntropy:!!(0,ne.isHex)(!1,{strict:!1})&&(0,SH.hexToBytes)(!1)}),a={r:(0,i4.numberToHex)(i,{size:32}),s:(0,i4.numberToHex)(n,{size:32}),v:s?28n:27n,yParity:s};return"bytes"===r||"hex"===r?(0,xi.serializeSignature)({...a,to:r}):a}async function xs(e){let{chainId:t,nonce:r,privateKey:i,to:n="object"}=e,s=e.contractAddress??e.address,a=await xn({hash:(0,nt.hashAuthorization)({address:s,chainId:t,nonce:r}),privateKey:i,to:n});return"object"===n?{address:s,chainId:t,nonce:r,...a}:a}var xa=e.i(658765);async function xo({message:e,privateKey:t}){return await xn({hash:(0,xa.hashMessage)(e),privateKey:t,to:"hex"})}var xl=e.i(831095);async function xc(e){let{privateKey:t,transaction:r,serializer:i=ST.serializeTransaction}=e,n="eip4844"===r.type?{...r,sidecars:!1}:r,s=await xn({hash:(0,xl.keccak256)(await i(n)),privateKey:t});return await i(r,s)}var xd=e.i(995062);async function xu(e){let{privateKey:t,...r}=e;return await xn({hash:(0,xd.hashTypedData)(r),privateKey:t,to:"hex"})}var xh=e.i(938630),xp=e.i(785904),xf=e.i(70204),xy=e.i(704434),xg=e.i(656679);let xm=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"accountAddress",type:"address"},{indexed:!1,internalType:"enum IContractDeployer.AccountNonceOrdering",name:"nonceOrdering",type:"uint8"}],name:"AccountNonceOrderingUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"accountAddress",type:"address"},{indexed:!1,internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"aaVersion",type:"uint8"}],name:"AccountVersionUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"deployerAddress",type:"address"},{indexed:!0,internalType:"bytes32",name:"bytecodeHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"contractAddress",type:"address"}],name:"ContractDeployed",type:"event"},{inputs:[{internalType:"bytes32",name:"_salt",type:"bytes32"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"}],name:"create",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes32",name:"_salt",type:"bytes32"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"}],name:"create2",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes32",name:"_salt",type:"bytes32"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"},{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"_aaVersion",type:"uint8"}],name:"create2Account",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"},{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"_aaVersion",type:"uint8"}],name:"createAccount",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_address",type:"address"}],name:"extendedAccountVersion",outputs:[{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"_keccak256BytecodeHash",type:"bytes32"}],name:"forceDeployKeccak256",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"bytes32",name:"bytecodeHash",type:"bytes32"},{internalType:"address",name:"newAddress",type:"address"},{internalType:"bool",name:"callConstructor",type:"bool"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"input",type:"bytes"}],internalType:"struct ContractDeployer.ForceDeployment",name:"_deployment",type:"tuple"},{internalType:"address",name:"_sender",type:"address"}],name:"forceDeployOnAddress",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"bytes32",name:"bytecodeHash",type:"bytes32"},{internalType:"address",name:"newAddress",type:"address"},{internalType:"bool",name:"callConstructor",type:"bool"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"input",type:"bytes"}],internalType:"struct ContractDeployer.ForceDeployment[]",name:"_deployments",type:"tuple[]"}],name:"forceDeployOnAddresses",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_address",type:"address"}],name:"getAccountInfo",outputs:[{components:[{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"supportedAAVersion",type:"uint8"},{internalType:"enum IContractDeployer.AccountNonceOrdering",name:"nonceOrdering",type:"uint8"}],internalType:"struct IContractDeployer.AccountInfo",name:"info",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_sender",type:"address"},{internalType:"uint256",name:"_senderNonce",type:"uint256"}],name:"getNewAddressCreate",outputs:[{internalType:"address",name:"newAddress",type:"address"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"_sender",type:"address"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes32",name:"_salt",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"}],name:"getNewAddressCreate2",outputs:[{internalType:"address",name:"newAddress",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"_version",type:"uint8"}],name:"updateAccountVersion",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"enum IContractDeployer.AccountNonceOrdering",name:"_nonceOrdering",type:"uint8"}],name:"updateNonceOrdering",outputs:[],stateMutability:"nonpayable",type:"function"}],xw="/docs/contract/encodeDeployData";function xb(e,t,r,i){let n=[t,r,i];return({create:{functionName:"create",argsContractDeployer:n},create2:{functionName:"create2",argsContractDeployer:n},createAccount:{functionName:"createAccount",argsContractDeployer:[...n,1]},create2Account:{functionName:"create2Account",argsContractDeployer:[...n,1]}})[e||"create"]}var xv=e.i(189991),xE=e.i(975948),x_=e.i(368941),xA=e.i(638291),xS=e.i(611573),xx=e.i(942305),xI=e.i(10725),xk=e.i(467125),xT=e.i(353464);function xC(e){if(!SY(e))throw new SG;(0,xT.assertRequest)(e)}var xP=e.i(866797),xO=e.i(431254);async function xR(e,t){let{account:r=e.account,chain:i=e.chain,...n}=t,s=r?(0,xv.parseAccount)(r):e.account;if(!s)throw new xS.AccountNotFoundError({docsPath:"/docs/actions/wallet/signTransaction"});if(xC({account:s,chain:i,...t}),!i?.custom?.getEip712Domain)throw new SV.BaseError("`getEip712Domain` not found on chain.");if(!i?.serializers?.transaction)throw new SV.BaseError("transaction serializer not found on chain.");let a=await (0,xk.getAction)(e,xE.getChainId,"getChainId")({});null!==i&&(0,xx.assertCurrentChain)({currentChainId:a,chain:i});let o=i?.custom.getEip712Domain({...n,chainId:a,from:s.address,type:"eip712"}),l=await (0,xO.signTypedData)(e,{...o,account:s});return i?.serializers?.transaction({chainId:a,...n,customSignature:l,type:"eip712"},{r:"0x0",s:"0x0",v:0n})}async function xN(e,t){return SY(t)?xR(e,t):await (0,xP.signTransaction)(e,t)}async function xM(e,t){let{account:r=e.account,chain:i=e.chain}=t,n=r?(0,xv.parseAccount)(r):e.account;if(!n)throw new xS.AccountNotFoundError({docsPath:"/docs/actions/wallet/sendTransaction"});try{let r;xC(t);let s=await (0,x_.prepareTransactionRequest)(e,{...t,nonceManager:n.nonceManager,parameters:["gas","nonce","fees"]});null!==i&&(r=await (0,xk.getAction)(e,xE.getChainId,"getChainId")({}),(0,xx.assertCurrentChain)({currentChainId:r,chain:i}));let a=await xN(e,{...s,chainId:r});return await (0,xk.getAction)(e,xA.sendRawTransaction,"sendRawTransaction")({serializedTransaction:a})}catch(e){throw(0,xI.getTransactionError)(e,{...t,account:n,chain:i})}}var xU=e.i(888794);async function xD(e,t){return SY(t)?xM(e,t):(0,xU.sendTransaction)(e,t)}var xL=e.i(654312),xj=e.i(642108);function xB(e){return JSON.parse(function(e){let t=[],r=!1;for(let n=0;n<e.length;n++){let s=!1;if("\\"===e[n]&&(t.push(e[n++]),s=!s),'"'===e[n]){t.push(e[n]),s||(r=!r);continue}if(!r){let r=function(e,t){if(!e[t]?.match(/[-\d]/))return null;let r=e.slice(t).match(/^-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?/);return r?r[0]:null}(e,n);if(r?.length){var i;n+=r.length-1,r.match(/\.|[eE]-/)?t.push(r):t.push((i=r,`{"$n":"${i}"}`));continue}}t.push(e[n])}return t.join("")}(e),(e,t)=>{var r;return(r=t)&&"object"==typeof r&&"$n"in r&&"string"==typeof r.$n?function({$n:e}){if(e.match(/[eE]/)){let[t,r]=e.split(/[eE]/);return BigInt(t)*BigInt(10)**BigInt(r)}return BigInt(e)}(t):t})}var xW=0n;function xF(e){let t;return{id:(t=xW,xW++,t.toString()),jsonrpc:"2.0",method:e.methodName,params:e.params}}function xH(e,t){return JSON.stringify(e,(e,t)=>{var r;return"bigint"==typeof t?(r=t,{$n:`${r}`}):t},t).replace(/\{\s*"\$n"\s*:\s*"(-?\d+)"\s*\}/g,"$1")}function xq(e){return!(null==e||"object"!=typeof e||Array.isArray(e))&&"jsonrpc"in e&&"2.0"===e.jsonrpc&&"method"in e&&"string"==typeof e.method&&"params"in e}var xz=e.i(631985);function x$(e){return"bigint"==typeof e?Number(e):e}var xK={};function xV(e){return function t(r,i){if(Array.isArray(r))return r.map((e,r)=>t(e,{...i,keyPath:[...i.keyPath,r]}));if("object"!=typeof r||null===r)return e.reduce((e,t)=>t(e,i),r);{let e={};for(let n in r){if(!Object.prototype.hasOwnProperty.call(r,n))continue;let s={...i,keyPath:[...i.keyPath,n]};e[n]=t(r[n],s)}return e}}}function xJ(e,t){return r=>{let i=xV(e);return Object.freeze({...r,params:i(r.params,t)})}}var xZ={accountNotifications:1,blockNotifications:1,getAccountInfo:1,getBalance:1,getBlock:1,getBlockHeight:0,getBlockProduction:0,getBlocks:2,getBlocksWithLimit:2,getEpochInfo:0,getFeeForMessage:1,getInflationGovernor:0,getInflationReward:1,getLargestAccounts:0,getLatestBlockhash:0,getLeaderSchedule:1,getMinimumBalanceForRentExemption:1,getMultipleAccounts:1,getProgramAccounts:1,getSignaturesForAddress:1,getSlot:0,getSlotLeader:0,getStakeMinimumDelegation:0,getSupply:0,getTokenAccountBalance:1,getTokenAccountsByDelegate:2,getTokenAccountsByOwner:2,getTokenLargestAccounts:1,getTokenSupply:1,getTransaction:1,getTransactionCount:0,getVoteAccounts:0,isBlockhashValid:1,logsNotifications:1,programNotifications:1,requestAirdrop:2,sendTransaction:1,signatureNotifications:1,simulateTransaction:1};function xG(e){let t=e?.onIntegerOverflow;return r=>(0,xz.pipe)(r,t?e=>{var r;return xJ([(r=(...r)=>t(e,...r),(e,{keyPath:t})=>("bigint"==typeof e&&r&&(e>Number.MAX_SAFE_INTEGER||e<-Number.MAX_SAFE_INTEGER)&&r(t,e),e))],{keyPath:[]})(e)}:e=>e,xJ([x$],{keyPath:[]}),function({defaultCommitment:e,optionsObjectPositionByMethod:t}){return r=>{let{params:i,methodName:n}=r;if(!Array.isArray(i))return r;let s=t[n];return null==s?r:Object.freeze({methodName:n,params:function({commitmentPropertyName:e,params:t,optionsObjectPositionInParams:r,overrideCommitment:i}){let n=t[r];if(void 0===n||n&&"object"==typeof n&&!Array.isArray(n)){if(n&&e in n){if(!n[e]||"finalized"===n[e]){let i=[...t],{[e]:s,...a}=n;return Object.keys(a).length>0?i[r]=a:r===i.length-1?i.length--:i[r]=void 0,i}}else if("finalized"!==i){let s=[...t];return s[r]={...n,[e]:i},s}}return t}({commitmentPropertyName:"sendTransaction"===n?"preflightCommitment":"commitment",optionsObjectPositionInParams:s,overrideCommitment:e,params:i})})}}({defaultCommitment:e?.defaultCommitment,optionsObjectPositionByMethod:xZ}))}function xY(e){var t,r;return t=[function(t,{keyPath:r}){var i;return"number"==typeof t&&Number.isInteger(t)||"bigint"==typeof t?(i=r,e.some(e=>{if(e.length!==i.length)return!1;for(let t=i.length-1;t>=0;t--){let r=i[t],n=e[t];if(n!==r&&(n!==xK||"number"!=typeof r))return!1}return!0}))?Number(t):BigInt(t):t}],r={keyPath:[]},e=>xV(t)(e,r)}var xQ=[["data","parsed","info","tokenAmount","decimals"],["data","parsed","info","tokenAmount","uiAmount"],["data","parsed","info","rentExemptReserve","decimals"],["data","parsed","info","rentExemptReserve","uiAmount"],["data","parsed","info","delegatedAmount","decimals"],["data","parsed","info","delegatedAmount","uiAmount"],["data","parsed","info","extensions",xK,"state","olderTransferFee","transferFeeBasisPoints"],["data","parsed","info","extensions",xK,"state","newerTransferFee","transferFeeBasisPoints"],["data","parsed","info","extensions",xK,"state","preUpdateAverageRate"],["data","parsed","info","extensions",xK,"state","currentRate"]],xX=[...xQ,["data","parsed","info","lastExtendedSlotStartIndex"],["data","parsed","info","slashPenalty"],["data","parsed","info","warmupCooldownRate"],["data","parsed","info","decimals"],["data","parsed","info","numRequiredSigners"],["data","parsed","info","numValidSigners"],["data","parsed","info","stake","delegation","warmupCooldownRate"],["data","parsed","info","exemptionThreshold"],["data","parsed","info","burnPercent"],["data","parsed","info","commission"],["data","parsed","info","votes",xK,"confirmationCount"]],x0=[["index"],["instructions",xK,"accounts",xK],["instructions",xK,"programIdIndex"],["instructions",xK,"stackHeight"]],x1=[["addressTableLookups",xK,"writableIndexes",xK],["addressTableLookups",xK,"readonlyIndexes",xK],["header","numReadonlySignedAccounts"],["header","numReadonlyUnsignedAccounts"],["header","numRequiredSignatures"],["instructions",xK,"accounts",xK],["instructions",xK,"programIdIndex"],["instructions",xK,"stackHeight"]],x2=["getAccountInfo","getBalance","getBlock","getBlockCommitment","getBlockHeight","getBlockProduction","getBlocks","getBlocksWithLimit","getBlockTime","getClusterNodes","getEpochInfo","getEpochSchedule","getFeeForMessage","getFirstAvailableBlock","getGenesisHash","getHealth","getHighestSnapshotSlot","getIdentity","getInflationGovernor","getInflationRate","getInflationReward","getLargestAccounts","getLatestBlockhash","getLeaderSchedule","getMaxRetransmitSlot","getMaxShredInsertSlot","getMinimumBalanceForRentExemption","getMultipleAccounts","getProgramAccounts","getRecentPerformanceSamples","getRecentPrioritizationFees","getSignaturesForAddress","getSignatureStatuses","getSlot","getSlotLeader","getSlotLeaders","getStakeMinimumDelegation","getSupply","getTokenAccountBalance","getTokenAccountsByDelegate","getTokenAccountsByOwner","getTokenLargestAccounts","getTokenSupply","getTransaction","getTransactionCount","getVersion","getVoteAccounts","index","isBlockhashValid","minimumLedgerSlot","requestAirdrop","sendTransaction","simulateTransaction"];function x3(e){return xq(e)&&x2.includes(e.method)}var x5=Object.prototype.toString,x8=Object.keys||function(e){let t=[];for(let r in e)t.push(r);return t};function x6(e){let t=function e(t,r){let i,n,s,a,o,l,c;if(!0===t)return"true";if(!1===t)return"false";switch(typeof t){case"object":if(null===t)return null;if("toJSON"in t&&"function"==typeof t.toJSON)return e(t.toJSON(),r);if("[object Array]"===(c=x5.call(t))){for(i=0,s="[",n=t.length-1;i<n;i++)s+=e(t[i],!0)+",";return n>-1&&(s+=e(t[i],!0)),s+"]"}if("[object Object]"!==c)return JSON.stringify(t);for(n=(a=x8(t).sort()).length,s="",i=0;i<n;)void 0!==(l=e(t[o=a[i]],!1))&&(s&&(s+=","),s+=JSON.stringify(o)+":"+l),i++;return"{"+s+"}";case"function":case"undefined":return r?null:void 0;case"bigint":return`${t.toString()}n`;case"string":return JSON.stringify(t);default:return isFinite(t)?t:null}}(e,!1);if(void 0!==t)return""+t}var x4={defaultCommitment:"confirmed",onIntegerOverflow(e,t,r){throw function e(t,r,i){let n="";if("number"==typeof r[0]){let e=r[0]+1,t=e%10,i=e%100;n=1==t&&11!=i?e+"st":2==t&&12!=i?e+"nd":3==t&&13!=i?e+"rd":e+"th"}else n=`\`${r[0].toString()}\``;let s=r.length>1?r.slice(1).map(e=>"number"==typeof e?`[${e}]`:e).join("."):void 0,a=new xj.SolanaError(xj.SOLANA_ERROR__RPC__INTEGER_OVERFLOW,{argumentLabel:n,keyPath:r,methodName:t,optionalPathLabel:s?` at path \`${s}\``:"",value:i,...void 0!==s?{path:s}:void 0});return(0,xj.safeCaptureStackTrace)(a,e),a}(e.methodName,t,r)}},x7=globalThis.AbortController;function x9(e){return xq(e)?x6([e.method,e.params]):void 0}function Ie(e,t){var r,i,n,s,a;return i=(r={url:e,...t},(0,xz.pipe)(function(e){let t,{fromJson:r,headers:i,toJson:n,url:s}=e,a=i&&function(e){let t={};for(let r in e)t[r.toLowerCase()]=e[r];return t}(i);return async function({payload:e,signal:i}){let o=n?n(e):JSON.stringify(e),l={...t,body:o,headers:{...a,accept:"application/json","content-length":o.length.toString(),"content-type":"application/json; charset=utf-8"},method:"POST",signal:i},c=await fetch(s,l);if(!c.ok)throw new xj.SolanaError(xj.SOLANA_ERROR__RPC__TRANSPORT_HTTP_ERROR,{headers:c.headers,message:c.statusText,statusCode:c.status});return r?r(await c.text(),e):await c.json()}}({...{...r,headers:{...!1,...r.headers?function(e){let t={};for(let r in e)t[r.toLowerCase()]=e[r];return t}(r.headers):void 0,"solana-client":"js/5.0.0"}},fromJson:(e,t)=>x3(t)?xB(e):JSON.parse(e),toJson:e=>x3(e)?xH(e):JSON.stringify(e)}),e=>{let t;return async function(r){let{payload:i,signal:n}=r,s=x9(i);if(void 0===s)return await e(r);if(t||(queueMicrotask(()=>{t=void 0}),t={}),null==t[s]){let i=new x7,n=(async()=>{try{return await e({...r,signal:i.signal})}catch(e){if(e===(CG||={}))return;throw e}})();t[s]={abortController:i,numConsumers:0,responsePromise:n}}let a=t[s];if(a.numConsumers++,!n)return await a.responsePromise;{let e=a.responsePromise;return await new Promise((t,r)=>{let i=e=>{n.removeEventListener("abort",i),a.numConsumers-=1,queueMicrotask(()=>{0===a.numConsumers&&a.abortController.abort(CG||={})}),r(e.target.reason)};n.addEventListener("abort",i),e.then(t).catch(r).finally(()=>{n.removeEventListener("abort",i)})})}}})),a={api:(s={requestTransformer:xG(x4),responseTransformer:(n={allowedNumericKeyPaths:(CZ||(CZ={getAccountInfo:xX.map(e=>["value",...e]),getBlock:[["transactions",xK,"meta","preTokenBalances",xK,"accountIndex"],["transactions",xK,"meta","preTokenBalances",xK,"uiTokenAmount","decimals"],["transactions",xK,"meta","postTokenBalances",xK,"accountIndex"],["transactions",xK,"meta","postTokenBalances",xK,"uiTokenAmount","decimals"],["transactions",xK,"meta","rewards",xK,"commission"],...x0.map(e=>["transactions",xK,"meta","innerInstructions",xK,...e]),...x1.map(e=>["transactions",xK,"transaction","message",...e]),["rewards",xK,"commission"]],getClusterNodes:[[xK,"featureSet"],[xK,"shredVersion"]],getInflationGovernor:[["initial"],["foundation"],["foundationTerm"],["taper"],["terminal"]],getInflationRate:[["foundation"],["total"],["validator"]],getInflationReward:[[xK,"commission"]],getMultipleAccounts:xX.map(e=>["value",xK,...e]),getProgramAccounts:xX.flatMap(e=>[["value",xK,"account",...e],[xK,"account",...e]]),getRecentPerformanceSamples:[[xK,"samplePeriodSecs"]],getTokenAccountBalance:[["value","decimals"],["value","uiAmount"]],getTokenAccountsByDelegate:xQ.map(e=>["value",xK,"account",...e]),getTokenAccountsByOwner:xQ.map(e=>["value",xK,"account",...e]),getTokenLargestAccounts:[["value",xK,"decimals"],["value",xK,"uiAmount"]],getTokenSupply:[["value","decimals"],["value","uiAmount"]],getTransaction:[["meta","preTokenBalances",xK,"accountIndex"],["meta","preTokenBalances",xK,"uiTokenAmount","decimals"],["meta","postTokenBalances",xK,"accountIndex"],["meta","postTokenBalances",xK,"uiTokenAmount","decimals"],["meta","rewards",xK,"commission"],...x0.map(e=>["meta","innerInstructions",xK,...e]),...x1.map(e=>["transaction","message",...e])],getVersion:[["feature-set"]],getVoteAccounts:[["current",xK,"commission"],["delinquent",xK,"commission"]],simulateTransaction:[["value","loadedAccountsDataSize"],...xX.map(e=>["value","accounts",xK,...e]),...x0.map(e=>["value","innerInstructions",xK,...e])]}),CZ)},(e,t)=>{let r=t.methodName,i=n?.allowedNumericKeyPaths&&r?n.allowedNumericKeyPaths[r]:void 0;return(0,xz.pipe)(e,e=>(e=>{if("error"in e)throw(0,xj.getSolanaErrorFromJsonRpcError)(e.error);return e})(e,t),e=>e.result,e=>xY(i??[])(e,t))})},new Proxy({},{defineProperty:()=>!1,deleteProperty:()=>!1,get(...e){let[t,r]=e,i=r.toString();return function(...e){let t=Object.freeze({methodName:i,params:e}),r=s?.requestTransformer?s?.requestTransformer(t):t;return Object.freeze({execute:async({signal:e,transport:t})=>{let i=xF(r),n=await t({payload:i,signal:e});return s?.responseTransformer?s.responseTransformer(n,r):n}})}}})),transport:i},new Proxy(a.api,{defineProperty:()=>!1,deleteProperty:()=>!1,get(e,t,r){if("then"!==t)return function(...i){let n=t.toString(),s=Reflect.get(e,n,r);if(!s)throw new xj.SolanaError(xj.SOLANA_ERROR__RPC__API_PLAN_MISSING_FOR_RPC_METHOD,{method:n,params:i});return function({transport:e},t){return{send:async r=>await t.execute({signal:r?.abortSignal,transport:e})}}(a,s(...i))}}})}var It=e.i(850631),Ir=globalThis.AbortController,Ii=globalThis.EventTarget;function In(){return Symbol(void 0)}var Is=Symbol();function Ia(e){return{on(t,r,i){function n(e){e instanceof CustomEvent?r(e.detail):r()}return e.addEventListener(t,n,i),()=>{e.removeEventListener(t,n)}}}}var Io=e.i(391791),Il=globalThis.AbortController,Ic=new WeakMap;function Id(e,t,r){let i;if(void 0===r)return;let n=((i=Ic.get(t))||Ic.set(t,i={}),i);!n[r]&&e>0&&(n[r]=0);let s=e+n[r];return s<=0?delete n[r]:n[r]=s,s}var Iu=new WeakMap;async function Ih({channel:e,responseTransformer:t,signal:r,subscribeRequest:i,unsubscribeMethodName:n}){var s;let a,o,l,c,d,u,h;e.on("error",()=>{a=void 0,Ic.delete(e)},{signal:r});let p=new Promise((t,i)=>{function s(){if(0===Id(-1,e,a)){let t=xF({methodName:n,params:[a]});a=void 0,e.send(t).catch(()=>{})}i(this.reason)}r.aborted?s.call(r):r.addEventListener("abort",s)}),f=xF(i);await e.send(f);let y=new Promise((t,i)=>{let n=new Il;r.addEventListener("abort",n.abort.bind(n));let s={signal:n.signal};e.on("error",e=>{n.abort(),i(e)},s),e.on("message",e=>{e&&"object"==typeof e&&"id"in e&&e.id===f.id&&(n.abort(),"error"in e?i((0,xj.getSolanaErrorFromJsonRpcError)(e.error)):t(e.result))},s)});if(null==(a=await (0,Io.safeRace)([p,y])))throw new xj.SolanaError(xj.SOLANA_ERROR__RPC_SUBSCRIPTIONS__EXPECTED_SERVER_SUBSCRIPTION_ID);Id(1,e,a);let g=((o=Iu.get(e))||Iu.set(e,o=new WeakMap),l=t??e,(c=o.get(l))||o.set(l,(s=e=>{if(!("method"in e))return;let r=t?t(e.params.result,i):e.params.result;return[`notification:${e.params.subscription}`,r]},c={...h=Ia(u=new Ii),on(t,r,i){d||(d={dispose:e.on("message",e=>{let t=s(e);if(!t)return;let[r,i]=t;u.dispatchEvent(new CustomEvent(r,{detail:i}))}),numSubscribers:0}),d.numSubscribers++;let n=h.on(t,r,i),a=!0;function o(){a&&(a=!1,i?.signal.removeEventListener("abort",o),d.numSubscribers--,0===d.numSubscribers&&(d.dispose(),d=void 0),n())}return i?.signal.addEventListener("abort",o),o}})),c),m=`notification:${a}`;return{on(t,r,i){switch(t){case"notification":return g.on(m,r,i);case"error":return e.on("error",r,i);default:throw new xj.SolanaError(xj.SOLANA_ERROR__INVARIANT_VIOLATION__DATA_PUBLISHER_CHANNEL_UNIMPLEMENTED,{channelName:t,supportedChannelNames:["notification","error"]})}}}}var Ip=globalThis.EventTarget,If=globalThis.WebSocket,Iy={defaultCommitment:"confirmed",onIntegerOverflow(e,t,r){throw function e(t,r,i){let n="";if("number"==typeof r[0]){let e=r[0]+1,t=e%10,i=e%100;n=1==t&&11!=i?e+"st":2==t&&12!=i?e+"nd":3==t&&13!=i?e+"rd":e+"th"}else n=`\`${r[0].toString()}\``;let s=r.length>1?r.slice(1).map(e=>"number"==typeof e?`[${e}]`:e).join("."):void 0,a=new xj.SolanaError(xj.SOLANA_ERROR__RPC__INTEGER_OVERFLOW,{argumentLabel:n,keyPath:r,methodName:t,optionalPathLabel:s?` at path \`${s}\``:"",value:i,...void 0!==s?{path:s}:void 0});return(0,xj.safeCaptureStackTrace)(a,e),a}(e.methodName,t,r)}},Ig=globalThis.AbortController,Im={jsonrpc:"2.0",method:"ping"};function Iw(e){return(0,xz.pipe)(e,e=>Object.freeze({...e,on:(t,r,i)=>"message"!==t?e.on(t,r,i):e.on("message",e=>r(xB(e)),i)}),e=>Object.freeze({...e,send:t=>e.send(xH(t))}))}function Ib(e,t){var r,i,n,s;let a,o;return r=function({createChannel:e}){var t;return(0,xz.pipe)((t=e,async({execute:e,signal:r})=>{let i=await t({abortSignal:r});return await e({channel:i,signal:r})}),e=>{let t;return t=new Map,function(r){let{request:i,signal:n}=r,s=x6([i.methodName,i.params]),a=t.get(s);if(!a){let i=new Ig,n=e({...r,signal:i.signal});n.then(e=>{e.on("error",()=>{t.delete(s),i.abort()},{signal:i.signal})}).catch(()=>{}),t.set(s,a={abortController:i,dataPublisherPromise:n,numSubscribers:0})}return a.numSubscribers++,n.addEventListener("abort",()=>{a.numSubscribers--,0===a.numSubscribers&&queueMicrotask(()=>{0===a.numSubscribers&&(t.delete(s),a.abortController.abort())})},{signal:a.abortController.signal}),a.dataPublisherPromise}})}({createChannel:function(e){if(!1===/^wss?:/i.test(e.url)){let t=e.url.match(/^([^:]+):/);throw new DOMException(t?`Failed to construct 'WebSocket': The URL's scheme must be either 'ws' or 'wss'. '${t[1]}:' is not allowed.`:`Failed to construct 'WebSocket': The URL '${e.url}' is invalid.`)}let{intervalMs:t,...r}=e;return function(e,{maxSubscriptionsPerChannel:t,minChannels:r}){let i={entries:[],freeChannelIndex:-1};function n(){let e;if(i.entries.length<r){i.freeChannelIndex=-1;return}for(let r=0;r<i.entries.length;r++){let n=(i.freeChannelIndex+r+2)%i.entries.length,s=i.entries[n];s.subscriptionCount<t&&(!e||e.subscriptionCount>=s.subscriptionCount)&&(e={poolIndex:n,subscriptionCount:s.subscriptionCount})}i.freeChannelIndex=e?.poolIndex??-1}return function({abortSignal:t}){let r;function s(){let e=i.entries.findIndex(e=>e===r);i.entries.splice(e,1),r.dispose(),n()}if(-1===i.freeChannelIndex){let t=new Ig,n=e({abortSignal:t.signal});n.then(e=>{e.on("error",s,{signal:t.signal})}).catch(s),r={channel:n,dispose(){t.abort()},subscriptionCount:0},i.entries.push(r)}else r=i.entries[i.freeChannelIndex];return r.subscriptionCount++,t.addEventListener("abort",function(){r.subscriptionCount--,0===r.subscriptionCount?s():-1!==i.freeChannelIndex&&(i.freeChannelIndex--,n())}),n(),r.channel}}(({abortSignal:i})=>(function({sendBufferHighWatermark:e,signal:t,url:r}){let i,n,s;if(t.aborted)return Promise.reject(t.reason);let a=!1,o=new Set;function l(){o.forEach(e=>{e()}),o.clear()}function c(){l(),a||n(t.reason),y.readyState!==If.CLOSED&&y.readyState!==If.CLOSING&&y.close(1e3)}function d(e){if(!t.aborted&&!a){let t=new xj.SolanaError(xj.SOLANA_ERROR__RPC_SUBSCRIPTIONS__CHANNEL_FAILED_TO_CONNECT,{errorEvent:e});n(t),h.dispatchEvent(new CustomEvent("error",{detail:t}))}}function u(e){t.aborted||h.dispatchEvent(new CustomEvent("message",{detail:e.data}))}let h=new Ip,p=Ia(h);function f(){a=!0,s({...p,async send(t){if(y.readyState!==If.OPEN)throw new xj.SolanaError(xj.SOLANA_ERROR__RPC_SUBSCRIPTIONS__CHANNEL_CONNECTION_CLOSED);if(!i&&y.bufferedAmount>e){let t,r=new Promise((r,n)=>{let s=setInterval(()=>{y.readyState===If.OPEN&&y.bufferedAmount>e||(clearInterval(s),i=void 0,r())},16);t=()=>{i=void 0,clearInterval(s),n(new xj.SolanaError(xj.SOLANA_ERROR__RPC_SUBSCRIPTIONS__CHANNEL_CLOSED_BEFORE_MESSAGE_BUFFERED))}});i={onCancel:t,promise:r}}i&&(!ArrayBuffer.isView(t)||t instanceof DataView||(t=new t.constructor(t)),await i.promise),y.send(t)}})}let y=new If(r);return t.addEventListener("abort",c),y.addEventListener("close",function e(r){l(),i?.onCancel(),t.removeEventListener("abort",c),y.removeEventListener("close",e),y.removeEventListener("error",d),y.removeEventListener("message",u),y.removeEventListener("open",f),t.aborted||r.wasClean&&1e3===r.code||h.dispatchEvent(new CustomEvent("error",{detail:new xj.SolanaError(xj.SOLANA_ERROR__RPC_SUBSCRIPTIONS__CHANNEL_CONNECTION_CLOSED,{cause:r})}))}),y.addEventListener("error",d),y.addEventListener("message",u),y.addEventListener("open",f),new Promise((e,t)=>{n=t,s=e})})({...r,sendBufferHighWatermark:e.sendBufferHighWatermark??131072,signal:i}).then(e.jsonSerializer).then(e=>(function({abortSignal:e,channel:t,intervalMs:r}){let i;function n(){t.send(Im).catch(e=>{(0,xj.isSolanaError)(e,xj.SOLANA_ERROR__RPC_SUBSCRIPTIONS__CHANNEL_CONNECTION_CLOSED)&&a.abort()})}function s(){clearInterval(i),i=setInterval(n,r)}let a=new Ig;return a.signal.addEventListener("abort",()=>{clearInterval(i)}),e.addEventListener("abort",()=>{a.abort()}),t.on("error",()=>{a.abort()},{signal:a.signal}),t.on("message",s,{signal:a.signal}),globalThis.navigator.onLine&&s(),globalThis.addEventListener("offline",function(){clearInterval(i)},{signal:a.signal}),globalThis.addEventListener("online",function(){n(),s()},{signal:a.signal}),{...t,send:(...e)=>(a.signal.aborted||s(),t.send(...e))}})({abortSignal:i,channel:e,intervalMs:t??5e3})),{maxSubscriptionsPerChannel:e.maxSubscriptionsPerChannel??100,minChannels:e.minChannels??1})}({...t,url:e,jsonSerializer:Iw})}),i={api:(a=xG(Iy),n={allowedNumericKeyPaths:(CQ||(CQ={accountNotifications:xX.map(e=>["value",...e]),blockNotifications:[["value","block","transactions",xK,"meta","preTokenBalances",xK,"accountIndex"],["value","block","transactions",xK,"meta","preTokenBalances",xK,"uiTokenAmount","decimals"],["value","block","transactions",xK,"meta","postTokenBalances",xK,"accountIndex"],["value","block","transactions",xK,"meta","postTokenBalances",xK,"uiTokenAmount","decimals"],["value","block","transactions",xK,"meta","rewards",xK,"commission"],["value","block","transactions",xK,"meta","innerInstructions",xK,"index"],["value","block","transactions",xK,"meta","innerInstructions",xK,"instructions",xK,"programIdIndex"],["value","block","transactions",xK,"meta","innerInstructions",xK,"instructions",xK,"accounts",xK],["value","block","transactions",xK,"transaction","message","addressTableLookups",xK,"writableIndexes",xK],["value","block","transactions",xK,"transaction","message","addressTableLookups",xK,"readonlyIndexes",xK],["value","block","transactions",xK,"transaction","message","instructions",xK,"programIdIndex"],["value","block","transactions",xK,"transaction","message","instructions",xK,"accounts",xK],["value","block","transactions",xK,"transaction","message","header","numReadonlySignedAccounts"],["value","block","transactions",xK,"transaction","message","header","numReadonlyUnsignedAccounts"],["value","block","transactions",xK,"transaction","message","header","numRequiredSignatures"],["value","block","rewards",xK,"commission"]],programNotifications:xX.flatMap(e=>[["value",xK,"account",...e],[xK,"account",...e]])}),CQ)},o=(e,t)=>{let r=t.methodName,i=n?.allowedNumericKeyPaths&&r?n.allowedNumericKeyPaths[r]:void 0;return(0,xz.pipe)(e,e=>xY(i??[])(e,t))},s={planExecutor:({request:e,...t})=>Ih({...t,responseTransformer:o,subscribeRequest:{...e,methodName:e.methodName.replace(/Notifications$/,"Subscribe")},unsubscribeMethodName:e.methodName.replace(/Notifications$/,"Unsubscribe")}),requestTransformer:a},new Proxy({},{defineProperty:()=>!1,deleteProperty:()=>!1,get(...e){let[t,r]=e,i=r.toString();return function(...e){let t={methodName:i,params:e},r=s.requestTransformer?s.requestTransformer(t):t;return{execute:e=>s.planExecutor({...e,request:r}),request:r}}}})),transport:r},new Proxy(i.api,{defineProperty:()=>!1,deleteProperty:()=>!1,get(e,t,r){if("then"!==t)return function(...n){var s,a;let o=t.toString(),l=Reflect.get(e,o,r);if(!l)throw new xj.SolanaError(xj.SOLANA_ERROR__RPC_SUBSCRIPTIONS__CANNOT_CREATE_SUBSCRIPTION_PLAN,{notificationName:o});let c=l(...n);return s=i.transport,a=c,{async subscribe({abortSignal:e}){let t=await s({signal:e,...a});return function({abortSignal:e,dataChannelName:t,dataPublisher:r,errorChannelName:i}){let n=new Map;function s(e){for(let[t,r]of n.entries())r.__hasPolled?(n.delete(t),r.onError(e)):r.publishQueue.push({__type:1,err:e})}let a=new Ir;e.addEventListener("abort",()=>{a.abort(),s(CY||=In())});let o={signal:a.signal},l=Is;return r.on(i,e=>{l===Is&&(l=e,a.abort(),s(e))},o),r.on(t,e=>{n.forEach((t,r)=>{if(t.__hasPolled){let{onData:i}=t;n.set(r,{__hasPolled:!1,publishQueue:[]}),i(e)}else t.publishQueue.push({__type:0,data:e})})},o),{async *[Symbol.asyncIterator](){if(e.aborted)return;if(l!==Is)throw l;let t=Symbol();n.set(t,{__hasPolled:!1,publishQueue:[]});try{for(;;){let e=n.get(t);if(!e)throw new xj.SolanaError(xj.SOLANA_ERROR__INVARIANT_VIOLATION__SUBSCRIPTION_ITERATOR_STATE_MISSING);if(e.__hasPolled)throw new xj.SolanaError(xj.SOLANA_ERROR__INVARIANT_VIOLATION__SUBSCRIPTION_ITERATOR_MUST_NOT_POLL_BEFORE_RESOLVING_EXISTING_MESSAGE_PROMISE);let r=e.publishQueue;try{if(r.length)for(let t of(e.publishQueue=[],r))if(0===t.__type)yield t.data;else throw t.err;else yield await new Promise((e,r)=>{n.set(t,{__hasPolled:!0,onData:e,onError:r})})}catch(e){if(e===(CY||=In()))return;throw e}}}finally{n.delete(t)}}}}({abortSignal:e,dataChannelName:"notification",dataPublisher:t,errorChannelName:"error"})}}}}})}var Iv=e.i(648328),IE=e.i(994999),I_=e.i(421720),IA=e.i(104076);e.i(631157),e.i(587896),e.i(912440),e.i(38340),e.i(27408),e.i(696319),e.i(634583),e.i(441960);var IS=((CR=IS||{})[CR.Uninitialized=0]="Uninitialized",CR[CR.Initialized=1]="Initialized",CR[CR.Frozen=2]="Frozen",CR),Ix=((CN=Ix||{})[CN.MintTokens=0]="MintTokens",CN[CN.FreezeAccount=1]="FreezeAccount",CN[CN.AccountOwner=2]="AccountOwner",CN[CN.CloseAccount=3]="CloseAccount",CN[CN.TransferFeeConfig=4]="TransferFeeConfig",CN[CN.WithheldWithdraw=5]="WithheldWithdraw",CN[CN.CloseMint=6]="CloseMint",CN[CN.InterestRate=7]="InterestRate",CN[CN.PermanentDelegate=8]="PermanentDelegate",CN[CN.ConfidentialTransferMint=9]="ConfidentialTransferMint",CN[CN.TransferHookProgramId=10]="TransferHookProgramId",CN[CN.ConfidentialTransferFeeConfig=11]="ConfidentialTransferFeeConfig",CN[CN.MetadataPointer=12]="MetadataPointer",CN[CN.GroupPointer=13]="GroupPointer",CN[CN.GroupMemberPointer=14]="GroupMemberPointer",CN[CN.ScaledUiAmount=15]="ScaledUiAmount",CN[CN.Pause=16]="Pause",CN),II=((CM=II||{})[CM.Uninitialized=0]="Uninitialized",CM[CM.TransferFeeConfig=1]="TransferFeeConfig",CM[CM.TransferFeeAmount=2]="TransferFeeAmount",CM[CM.MintCloseAuthority=3]="MintCloseAuthority",CM[CM.ConfidentialTransferMint=4]="ConfidentialTransferMint",CM[CM.ConfidentialTransferAccount=5]="ConfidentialTransferAccount",CM[CM.DefaultAccountState=6]="DefaultAccountState",CM[CM.ImmutableOwner=7]="ImmutableOwner",CM[CM.MemoTransfer=8]="MemoTransfer",CM[CM.NonTransferable=9]="NonTransferable",CM[CM.InterestBearingConfig=10]="InterestBearingConfig",CM[CM.CpiGuard=11]="CpiGuard",CM[CM.PermanentDelegate=12]="PermanentDelegate",CM[CM.NonTransferableAccount=13]="NonTransferableAccount",CM[CM.TransferHook=14]="TransferHook",CM[CM.TransferHookAccount=15]="TransferHookAccount",CM[CM.ConfidentialTransferFee=16]="ConfidentialTransferFee",CM[CM.ConfidentialTransferFeeAmount=17]="ConfidentialTransferFeeAmount",CM[CM.ScaledUiAmountConfig=18]="ScaledUiAmountConfig",CM[CM.PausableConfig=19]="PausableConfig",CM[CM.PausableAccount=20]="PausableAccount",CM[CM.MetadataPointer=21]="MetadataPointer",CM[CM.TokenMetadata=22]="TokenMetadata",CM[CM.GroupPointer=23]="GroupPointer",CM[CM.TokenGroup=24]="TokenGroup",CM[CM.GroupMemberPointer=25]="GroupMemberPointer",CM[CM.TokenGroupMember=26]="TokenGroupMember",CM),Ik=((CU=Ik||{})[CU.CreateAssociatedToken=0]="CreateAssociatedToken",CU[CU.CreateAssociatedTokenIdempotent=1]="CreateAssociatedTokenIdempotent",CU[CU.RecoverNestedAssociatedToken=2]="RecoverNestedAssociatedToken",CU),IT=((CD=IT||{})[CD.Mint=0]="Mint",CD[CD.Token=1]="Token",CD[CD.Multisig=2]="Multisig",CD),IC=((CL=IC||{})[CL.InitializeMint=0]="InitializeMint",CL[CL.InitializeAccount=1]="InitializeAccount",CL[CL.InitializeMultisig=2]="InitializeMultisig",CL[CL.Transfer=3]="Transfer",CL[CL.Approve=4]="Approve",CL[CL.Revoke=5]="Revoke",CL[CL.SetAuthority=6]="SetAuthority",CL[CL.MintTo=7]="MintTo",CL[CL.Burn=8]="Burn",CL[CL.CloseAccount=9]="CloseAccount",CL[CL.FreezeAccount=10]="FreezeAccount",CL[CL.ThawAccount=11]="ThawAccount",CL[CL.TransferChecked=12]="TransferChecked",CL[CL.ApproveChecked=13]="ApproveChecked",CL[CL.MintToChecked=14]="MintToChecked",CL[CL.BurnChecked=15]="BurnChecked",CL[CL.InitializeAccount2=16]="InitializeAccount2",CL[CL.SyncNative=17]="SyncNative",CL[CL.InitializeAccount3=18]="InitializeAccount3",CL[CL.InitializeMultisig2=19]="InitializeMultisig2",CL[CL.InitializeMint2=20]="InitializeMint2",CL[CL.GetAccountDataSize=21]="GetAccountDataSize",CL[CL.InitializeImmutableOwner=22]="InitializeImmutableOwner",CL[CL.AmountToUiAmount=23]="AmountToUiAmount",CL[CL.UiAmountToAmount=24]="UiAmountToAmount",CL[CL.InitializeMintCloseAuthority=25]="InitializeMintCloseAuthority",CL[CL.InitializeTransferFeeConfig=26]="InitializeTransferFeeConfig",CL[CL.TransferCheckedWithFee=27]="TransferCheckedWithFee",CL[CL.WithdrawWithheldTokensFromMint=28]="WithdrawWithheldTokensFromMint",CL[CL.WithdrawWithheldTokensFromAccounts=29]="WithdrawWithheldTokensFromAccounts",CL[CL.HarvestWithheldTokensToMint=30]="HarvestWithheldTokensToMint",CL[CL.SetTransferFee=31]="SetTransferFee",CL[CL.InitializeConfidentialTransferMint=32]="InitializeConfidentialTransferMint",CL[CL.UpdateConfidentialTransferMint=33]="UpdateConfidentialTransferMint",CL[CL.ConfigureConfidentialTransferAccount=34]="ConfigureConfidentialTransferAccount",CL[CL.ApproveConfidentialTransferAccount=35]="ApproveConfidentialTransferAccount",CL[CL.EmptyConfidentialTransferAccount=36]="EmptyConfidentialTransferAccount",CL[CL.ConfidentialDeposit=37]="ConfidentialDeposit",CL[CL.ConfidentialWithdraw=38]="ConfidentialWithdraw",CL[CL.ConfidentialTransfer=39]="ConfidentialTransfer",CL[CL.ApplyConfidentialPendingBalance=40]="ApplyConfidentialPendingBalance",CL[CL.EnableConfidentialCredits=41]="EnableConfidentialCredits",CL[CL.DisableConfidentialCredits=42]="DisableConfidentialCredits",CL[CL.EnableNonConfidentialCredits=43]="EnableNonConfidentialCredits",CL[CL.DisableNonConfidentialCredits=44]="DisableNonConfidentialCredits",CL[CL.ConfidentialTransferWithFee=45]="ConfidentialTransferWithFee",CL[CL.InitializeDefaultAccountState=46]="InitializeDefaultAccountState",CL[CL.UpdateDefaultAccountState=47]="UpdateDefaultAccountState",CL[CL.Reallocate=48]="Reallocate",CL[CL.EnableMemoTransfers=49]="EnableMemoTransfers",CL[CL.DisableMemoTransfers=50]="DisableMemoTransfers",CL[CL.CreateNativeMint=51]="CreateNativeMint",CL[CL.InitializeNonTransferableMint=52]="InitializeNonTransferableMint",CL[CL.InitializeInterestBearingMint=53]="InitializeInterestBearingMint",CL[CL.UpdateRateInterestBearingMint=54]="UpdateRateInterestBearingMint",CL[CL.EnableCpiGuard=55]="EnableCpiGuard",CL[CL.DisableCpiGuard=56]="DisableCpiGuard",CL[CL.InitializePermanentDelegate=57]="InitializePermanentDelegate",CL[CL.InitializeTransferHook=58]="InitializeTransferHook",CL[CL.UpdateTransferHook=59]="UpdateTransferHook",CL[CL.InitializeConfidentialTransferFee=60]="InitializeConfidentialTransferFee",CL[CL.WithdrawWithheldTokensFromMintForConfidentialTransferFee=61]="WithdrawWithheldTokensFromMintForConfidentialTransferFee",CL[CL.WithdrawWithheldTokensFromAccountsForConfidentialTransferFee=62]="WithdrawWithheldTokensFromAccountsForConfidentialTransferFee",CL[CL.HarvestWithheldTokensToMintForConfidentialTransferFee=63]="HarvestWithheldTokensToMintForConfidentialTransferFee",CL[CL.EnableHarvestToMint=64]="EnableHarvestToMint",CL[CL.DisableHarvestToMint=65]="DisableHarvestToMint",CL[CL.WithdrawExcessLamports=66]="WithdrawExcessLamports",CL[CL.InitializeMetadataPointer=67]="InitializeMetadataPointer",CL[CL.UpdateMetadataPointer=68]="UpdateMetadataPointer",CL[CL.InitializeGroupPointer=69]="InitializeGroupPointer",CL[CL.UpdateGroupPointer=70]="UpdateGroupPointer",CL[CL.InitializeGroupMemberPointer=71]="InitializeGroupMemberPointer",CL[CL.UpdateGroupMemberPointer=72]="UpdateGroupMemberPointer",CL[CL.InitializeScaledUiAmountMint=73]="InitializeScaledUiAmountMint",CL[CL.UpdateMultiplierScaledUiMint=74]="UpdateMultiplierScaledUiMint",CL[CL.InitializePausableConfig=75]="InitializePausableConfig",CL[CL.Pause=76]="Pause",CL[CL.Resume=77]="Resume",CL[CL.InitializeTokenMetadata=78]="InitializeTokenMetadata",CL[CL.UpdateTokenMetadataField=79]="UpdateTokenMetadataField",CL[CL.RemoveTokenMetadataKey=80]="RemoveTokenMetadataKey",CL[CL.UpdateTokenMetadataUpdateAuthority=81]="UpdateTokenMetadataUpdateAuthority",CL[CL.EmitTokenMetadata=82]="EmitTokenMetadata",CL[CL.InitializeTokenGroup=83]="InitializeTokenGroup",CL[CL.UpdateTokenGroupMaxSize=84]="UpdateTokenGroupMaxSize",CL[CL.UpdateTokenGroupUpdateAuthority=85]="UpdateTokenGroupUpdateAuthority",CL[CL.InitializeTokenGroupMember=86]="InitializeTokenGroupMember",CL);new Uint8Array([250,166,180,250,13,12,184,70]),new Uint8Array([121,113,108,39,54,51,0,4]),new Uint8Array([152,32,222,176,223,237,116,134]),new Uint8Array([210,225,30,162,88,184,77,141]),new Uint8Array([234,18,32,56,89,141,37,181]),new Uint8Array([108,37,171,143,248,30,18,110]),new Uint8Array([161,105,88,1,237,221,216,203]),new Uint8Array([221,233,49,45,181,202,220,200]),new Uint8Array([215,228,166,228,84,100,86,123]),Sm.union([Sm.string().transform(e=>e.replace(/[^0-9.-]+/g,"")),Sm.number()]).pipe(Sm.coerce.number().min(1e-4).max(0x3b9ac9ff));var IP=Sm.enum(["abstract","abstract-testnet","base-sepolia","base","avalanche-fuji","avalanche","iotex","solana-devnet","solana","sei","sei-testnet","polygon","polygon-amoy","peaq","story","educhain","skale-base-sepolia"]),IO=new Map([["abstract",2741],["abstract-testnet",11124],["base-sepolia",84532],["base",8453],["avalanche-fuji",43113],["avalanche",43114],["iotex",4689],["sei",1329],["sei-testnet",1328],["polygon",137],["polygon-amoy",80002],["peaq",3338],["story",1514],["educhain",41923],["skale-base-sepolia",0x135a9d92]]),IR=["solana-devnet","solana"];Object.fromEntries(["abstract","abstract-testnet","base-sepolia","base","avalanche-fuji","avalanche","iotex","sei","sei-testnet","polygon","polygon-amoy","peaq","story","educhain","skale-base-sepolia",...IR].map(e=>[IO.get(e),e]));var IN={id:0x135a9d92,name:"SKALE Base Sepolia",nativeCurrency:{name:"Credits",symbol:"CREDITS",decimals:18},rpcUrls:{default:{http:["https://base-sepolia-testnet.skalenodes.com/v1/jubilant-horrible-ancha"]}},blockExplorers:{default:{name:"Blockscout",url:"https://base-sepolia-testnet-explorer.skalenodes.com",apiUrl:"https://base-sepolia-testnet-explorer.skalenodes.com/api"}}};function IM(e){let t=IH(e);return(0,Sw.createPublicClient)({chain:t,transport:(0,_f.http)()}).extend(Sb.publicActions)}function IU(){return IM("base-sepolia")}function ID(){return IM("avalanche-fuji")}function IL(e,t){let r=IH(e),i=(0,_p.createWalletClient)({chain:r,transport:(0,_f.http)(),account:function(e,t={}){let{nonceManager:r}=t,i=(0,i4.toHex)(xt.secp256k1.getPublicKey(e.slice(2),!1));return{...function(e){if("string"==typeof e){if(!(0,i7.isAddress)(e,{strict:!1}))throw new Sx.InvalidAddressError({address:e});return{address:e,type:"json-rpc"}}if(!(0,i7.isAddress)(e.address,{strict:!1}))throw new Sx.InvalidAddressError({address:e.address});return{address:e.address,nonceManager:e.nonceManager,sign:e.sign,signAuthorization:e.signAuthorization,signMessage:e.signMessage,signTransaction:e.signTransaction,signTypedData:e.signTypedData,source:"custom",type:"local"}}({address:(0,xr.publicKeyToAddress)(i),nonceManager:r,sign:async({hash:t})=>xn({hash:t,privateKey:e,to:"hex"}),signAuthorization:async t=>xs({...t,privateKey:e}),signMessage:async({message:t})=>xo({message:t,privateKey:e}),signTransaction:async(t,{serializer:r}={})=>xc({privateKey:e,transaction:t,serializer:r}),signTypedData:async t=>xu({...t,privateKey:e})}),publicKey:i,source:"privateKey"}}(t)});return Iz(r)?i.extend(Sb.publicActions).extend(e=>({sendTransaction:t=>xD(e,t),signTransaction:t=>xN(e,t),deployContract:t=>(function(e,t){let{abi:r,args:i,bytecode:n,deploymentType:s,salt:a,...o}=t,l=function(e){let{abi:t,args:r,bytecode:i,deploymentType:n,salt:s}=e;if(!r||0===r.length){let{functionName:e,argsContractDeployer:t}=xb(n,s??xp.zeroHash,(0,i4.toHex)(S8(i)),"0x");return(0,xg.encodeFunctionData)({abi:xm,functionName:e,args:t})}let a=t.find(e=>"type"in e&&"constructor"===e.type);if(!a)throw new xf.AbiConstructorNotFoundError({docsPath:xw});if(!("inputs"in a)||!a.inputs||0===a.inputs.length)throw new xf.AbiConstructorParamsNotFoundError({docsPath:xw});let o=(0,xy.encodeAbiParameters)(a.inputs,r),{functionName:l,argsContractDeployer:c}=xb(n,s??xp.zeroHash,(0,i4.toHex)(S8(i)),o);return(0,xg.encodeFunctionData)({abi:xm,functionName:l,args:c})}({abi:r,args:i,bytecode:n,deploymentType:s,salt:a});return o.factoryDeps=o.factoryDeps||[],o.factoryDeps.includes(n)||o.factoryDeps.push(n),xM(e,{...o,data:l,to:"create2"===s||"create2Account"===s?"0x0000000000000000000000000000000000010000":"0x0000000000000000000000000000000000008006"})})(e,t),writeContract:t=>(0,xh.writeContract)(Object.assign(e,{sendTransaction:t=>xD(e,t)}),t)})):i.extend(Sb.publicActions)}function Ij(e){return IL("base-sepolia",e)}function IB(e){return IL("avalanche-fuji",e)}function IW(e){return"object"==typeof e&&null!==e&&"chain"in e&&"transport"in e}function IF(e){return"object"==typeof e&&null!==e&&"string"==typeof e.address&&"string"==typeof e.type&&"function"==typeof e.sign&&"function"==typeof e.signMessage&&"function"==typeof e.signTypedData&&"function"==typeof e.signTransaction}function IH(e){if(!e)throw Error("NETWORK environment variable is not set");switch(e){case"abstract":return S4;case"abstract-testnet":return S7;case"base":return SN;case"base-sepolia":return SO;case"avalanche":return SB;case"avalanche-fuji":return SR;case"sei":return SM;case"sei-testnet":return SU;case"polygon":return SD;case"polygon-amoy":return SL;case"peaq":return Sj;case"story":return S9;case"educhain":return xe;case"iotex":return SF;case"iotex-testnet":return SW;case"skale-base-sepolia":return IN;default:throw Error(`Unsupported network: ${e}`)}}var Iq=new Set([2741,11124]);function Iz(e){return Iq.has(e.id)}function I$(e){return Ie(e?(0,It.devnet)(e):(0,It.devnet)("https://api.devnet.solana.com"))}function IK(e){return Ie(e?(0,It.mainnet)(e):(0,It.mainnet)("https://api.mainnet-beta.solana.com"))}function IV(e,t){if("solana-devnet"===e)return I$(t);if("solana"===e)return IK(t);throw Error("Invalid network")}function IJ(e,t){if("solana-devnet"===e)return Ib((0,It.devnet)(t?IZ(t):"wss://api.devnet.solana.com"));if("solana"===e)return Ib((0,It.mainnet)(t?IZ(t):"wss://api.mainnet-beta.solana.com"));throw Error("Invalid network")}function IZ(e){return e.startsWith("http")?e.replace("http","ws"):e}function IG(e){if(!IR.find(t=>t===e))throw Error(`Unsupported SVM network: ${e}`);return IV(e)}async function IY(e){let t=n7.base58.decode(e);if(64===t.length)return await (0,xL.createKeyPairSignerFromBytes)(t);if(32===t.length)return await (0,xL.createKeyPairSignerFromPrivateKeyBytes)(t);throw Error(`Unexpected key length: ${t.length}. Expected 32 or 64 bytes.`)}function IQ(e){return"object"==typeof e&&null!==e&&(0,xL.isTransactionSigner)(e)}_b({},{authorizationPrimaryType:()=>I0,authorizationTypes:()=>IX,config:()=>_v,createClientAvalancheFuji:()=>ID,createClientSepolia:()=>IU,createConnectedClient:()=>IM,createSigner:()=>IL,createSignerAvalancheFuji:()=>IB,createSignerSepolia:()=>Ij,getChainFromNetwork:()=>IH,isAccount:()=>IF,isSignerWallet:()=>IW,isZkStackChain:()=>Iz,usdcABI:()=>_E});var IX={TransferWithAuthorization:[{name:"from",type:"address"},{name:"to",type:"address"},{name:"value",type:"uint256"},{name:"validAfter",type:"uint256"},{name:"validBefore",type:"uint256"},{name:"nonce",type:"bytes32"}]},I0="TransferWithAuthorization";_b({},{SvmAddressRegex:()=>I1});var I1=/^[1-9A-HJ-NP-Za-km-z]{32,44}$/,I2=/^0x[0-9a-fA-F]{40}$/,I3=/^0x[a-fA-F0-9]{40}|[A-Za-z0-9][A-Za-z0-9-]{0,34}[A-Za-z0-9]$/,I5=["exact"],I8=[1],I6=["insufficient_funds","invalid_exact_evm_payload_authorization_valid_after","invalid_exact_evm_payload_authorization_valid_before","invalid_exact_evm_payload_authorization_value","invalid_exact_evm_payload_signature","invalid_exact_evm_payload_undeployed_smart_wallet","invalid_exact_evm_payload_recipient_mismatch","invalid_exact_svm_payload_transaction","invalid_exact_svm_payload_transaction_amount_mismatch","invalid_exact_svm_payload_transaction_create_ata_instruction","invalid_exact_svm_payload_transaction_create_ata_instruction_incorrect_payee","invalid_exact_svm_payload_transaction_create_ata_instruction_incorrect_asset","invalid_exact_svm_payload_transaction_instructions","invalid_exact_svm_payload_transaction_instructions_length","invalid_exact_svm_payload_transaction_instructions_compute_limit_instruction","invalid_exact_svm_payload_transaction_instructions_compute_price_instruction","invalid_exact_svm_payload_transaction_instructions_compute_price_instruction_too_high","invalid_exact_svm_payload_transaction_instruction_not_spl_token_transfer_checked","invalid_exact_svm_payload_transaction_instruction_not_token_2022_transfer_checked","invalid_exact_svm_payload_transaction_fee_payer_included_in_instruction_accounts","invalid_exact_svm_payload_transaction_fee_payer_transferring_funds","invalid_exact_svm_payload_transaction_not_a_transfer_instruction","invalid_exact_svm_payload_transaction_receiver_ata_not_found","invalid_exact_svm_payload_transaction_sender_ata_not_found","invalid_exact_svm_payload_transaction_simulation_failed","invalid_exact_svm_payload_transaction_transfer_to_incorrect_ata","invalid_network","invalid_payload","invalid_payment_requirements","invalid_scheme","invalid_payment","payment_expired","unsupported_scheme","invalid_x402_version","invalid_transaction_state","invalid_x402_version","settle_exact_svm_block_height_exceeded","settle_exact_svm_transaction_confirmation_timed_out","unsupported_scheme","unexpected_settle_error","unexpected_verify_error"],I4=e=>Number.isInteger(Number(e))&&Number(e)>=0,I7=Sm.string().regex(I2).or(Sm.string().regex(I1)),I9=Sm.string().regex(I3).or(Sm.string().regex(I1)),ke=Sm.object({scheme:Sm.enum(I5),network:IP,maxAmountRequired:Sm.string().refine(I4),resource:Sm.string().url(),description:Sm.string(),mimeType:Sm.string(),outputSchema:Sm.record(Sm.any()).optional(),payTo:I7,maxTimeoutSeconds:Sm.number().int(),asset:I9,extra:Sm.record(Sm.any()).optional()}),kt=Sm.object({from:Sm.string().regex(I2),to:Sm.string().regex(I2),value:Sm.string().refine(I4).refine(e=>e.length<=18),validAfter:Sm.string().refine(I4),validBefore:Sm.string().refine(I4),nonce:Sm.string().regex(/^0x[0-9a-fA-F]{64}$/)}),kr=Sm.object({signature:Sm.string().regex(/^0x[0-9a-fA-F]+$/),authorization:kt}),ki=Sm.object({transaction:Sm.string().regex(/^[A-Za-z0-9+/]*={0,2}$/)}),kn=Sm.object({x402Version:Sm.number().refine(e=>I8.includes(e)),scheme:Sm.enum(I5),network:IP,payload:Sm.union([kr,ki])});Sm.object({x402Version:Sm.number().refine(e=>I8.includes(e)),error:Sm.enum(I6).optional(),accepts:Sm.array(ke).optional(),payer:Sm.string().regex(I3).optional()});var ks=Sm.enum(["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"]),ka=Sm.object({type:Sm.literal("http"),method:ks,queryParams:Sm.record(Sm.string(),Sm.string()).optional(),bodyType:Sm.enum(["json","form-data","multipart-form-data","text","binary"]).optional(),bodyFields:Sm.record(Sm.string(),Sm.any()).optional(),headerFields:Sm.record(Sm.string(),Sm.any()).optional()});Sm.discriminatedUnion("type",[ka]);var ko=Sm.object({resource:Sm.string(),type:Sm.enum(["http"]),x402Version:Sm.number().refine(e=>I8.includes(e)),accepts:Sm.array(ke),lastUpdated:Sm.date(),metadata:Sm.record(Sm.any()).optional()});Sm.object({paymentPayload:kn,paymentRequirements:ke}),Sm.object({paymentPayload:kn,paymentRequirements:ke}),Sm.object({isValid:Sm.boolean(),invalidReason:Sm.enum(I6).optional(),payer:I7.optional()}),Sm.object({success:Sm.boolean(),errorReason:Sm.enum(I6).optional(),payer:I7.optional(),transaction:Sm.string().regex(I3),network:IP}),Sm.object({type:Sm.string().optional(),limit:Sm.number().optional(),offset:Sm.number().optional()}),Sm.object({x402Version:Sm.number().refine(e=>I8.includes(e)),items:Sm.array(ko),pagination:Sm.object({limit:Sm.number(),offset:Sm.number(),total:Sm.number()})});var kl=Sm.object({x402Version:Sm.number().refine(e=>I8.includes(e)),scheme:Sm.enum(I5),network:IP,extra:Sm.record(Sm.any()).optional()});function kc(e){try{let t=(0,IE.getBase64Encoder)().encode(e.transaction);return(0,Iv.getTransactionDecoder)().decode(t)}catch(e){throw console.error("error",e),Error("invalid_exact_svm_payload_transaction")}}function kd(e){let t=(0,I_.getCompiledTransactionMessageDecoder)().decode(e.messageBytes),r=t.staticAccounts??[];for(let e of t.instructions??[]){let t=r[e.programAddressIndex].toString();if(t===IA.TOKEN_PROGRAM_ADDRESS.toString()||t==="TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb".toString()){let t=e.accountIndices??[];if(t.length>=4){let e=r[t[3]].toString();if(e)return e}}}return""}async function ku(e,t,r){let i=await kh(e,t),n=(0,Iv.getBase64EncodedWireTransaction)(i);return await r.simulateTransaction(n,{sigVerify:!0,replaceRecentBlockhash:!1,commitment:"confirmed",encoding:"base64",accounts:void 0,innerInstructions:void 0,minContextSlot:void 0}).send()}async function kh(e,t){if((0,xL.isTransactionModifyingSigner)(e)){let[r]=await e.modifyAndSignTransactions([t]);if(!r)throw Error("transaction_signer_failed_to_return_transaction");return r}if((0,xL.isTransactionPartialSigner)(e)){var r,i;let[n]=await e.signTransactions([t]);if(!n)throw Error("transaction_signer_failed_to_return_signatures");return r=t,i=n,Object.freeze({...r,signatures:Object.freeze({...r.signatures,...i})})}throw Error("transaction_signer_must_support_offline_signing")}Sm.object({kinds:Sm.array(kl)}),_b({},{createDevnetRpcClient:()=>I$,createMainnetRpcClient:()=>IK,createSignerFromBase58:()=>IY,createSvmConnectedClient:()=>IG,decodeTransactionFromPayload:()=>kc,getRpcClient:()=>IV,getRpcSubscriptions:()=>IJ,getTokenPayerFromTransaction:()=>kd,isSignerWallet:()=>IQ,signAndSimulateTransaction:()=>ku,signTransactionWithSigner:()=>kh}),Sm.object({paymentHeader:Sm.string(),paymentRequirements:ke});var kp=((Cj=kp||{})[Cj.RequestUnits=0]="RequestUnits",Cj[Cj.RequestHeapFrame=1]="RequestHeapFrame",Cj[Cj.SetComputeUnitLimit=2]="SetComputeUnitLimit",Cj[Cj.SetComputeUnitPrice=3]="SetComputeUnitPrice",Cj[Cj.SetLoadedAccountsDataSizeLimit=4]="SetLoadedAccountsDataSizeLimit",Cj);e.s([],610760),e.i(382743),e.i(5729);class kf{static parse(e){try{return new kf(e)}catch(e){return null}}static throwIfNotWellFormedJwt(e){return tq.decodeJwt(e),e}get subject(){return this._decoded.sub}get expiration(){return this._decoded.exp}get issuer(){return this._decoded.iss}get audience(){return this._decoded.aud}isExpired(e=0){return Date.now()>=1e3*(this.expiration-e)}constructor(e){this.value=e,this._decoded=tq.decodeJwt(e)}}class ky extends kf{static parse(e){try{return new ky(e)}catch(e){return null}}get appId(){return this._decoded.aid?this._decoded.aid:this.audience}}let kg=({style:e,...t})=>(0,F.jsxs)("svg",{viewBox:"0 0 1024 1024",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{height:"28px",width:"28px",...e},...t,children:[(0,F.jsx)("rect",{width:"1024",height:"1024",fill:"#0052FF",rx:100,ry:100}),(0,F.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M152 512C152 710.823 313.177 872 512 872C710.823 872 872 710.823 872 512C872 313.177 710.823 152 512 152C313.177 152 152 313.177 152 512ZM420 396C406.745 396 396 406.745 396 420V604C396 617.255 406.745 628 420 628H604C617.255 628 628 617.255 628 604V420C628 406.745 617.255 396 604 396H420Z",fill:"white"})]}),km="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PScwIDAgMTAyNCAxMDI0JyBmaWxsPSdub25lJyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHN0eWxlPSdoZWlnaHQ6MjhweDt3aWR0aDoyOHB4Jz48cmVjdCB3aWR0aD0nMTAyNCcgaGVpZ2h0PScxMDI0JyBmaWxsPScjMDA1MkZGJyByeD0nMTAwJyByeT0nMTAwJz48L3JlY3Q+PHBhdGggZmlsbC1ydWxlPSdldmVub2RkJyBjbGlwLXJ1bGU9J2V2ZW5vZGQnIGQ9J00xNTIgNTEyQzE1MiA3MTAuODIzIDMxMy4xNzcgODcyIDUxMiA4NzJDNzEwLjgyMyA4NzIgODcyIDcxMC44MjMgODcyIDUxMkM4NzIgMzEzLjE3NyA3MTAuODIzIDE1MiA1MTIgMTUyQzMxMy4xNzcgMTUyIDE1MiAzMTMuMTc3IDE1MiA1MTJaTTQyMCAzOTZDNDA2Ljc0NSAzOTYgMzk2IDQwNi43NDUgMzk2IDQyMFY2MDRDMzk2IDYxNy4yNTUgNDA2Ljc0NSA2MjggNDIwIDYyOEg2MDRDNjE3LjI1NSA2MjggNjI4IDYxNy4yNTUgNjI4IDYwNFY0MjBDNjI4IDQwNi43NDUgNjE3LjI1NSAzOTYgNjA0IDM5Nkg0MjBaJyBmaWxsPSd3aGl0ZSc+PC9wYXRoPjwvc3ZnPg==",kw="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAALZJREFUaEPtmjEOhDAMBNc/O14GvOzys3CAKK6eAlmaVGl2Zc+kTOU685vkc9/bnD2prZK5/TZY24z9P+g4F5hNh7/GdoG37WlAA5CATwgCxHENYISwQAMQII5rACOEBRqAAHFcAxghLNAABIjjGsAIYYEGIEAc1wBGCAs0AAHiuAYwQligAQgQxzWAEcICDUCAOK4BjBAWaAACxHENYISwQAMQII6fBjr+VHkW3+u+tfyxMpJaDgYzYxb/ALZVAAAAAElFTkSuQmCC";class kb extends tQ.E{async initialize(){await this.importPromise,await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(e){return e.showPrompt&&await this.promptConnection(),await this.isConnected()?this.getConnectedWallet():null}disconnect(){this.proxyProvider.walletProvider.disconnect(),this.onDisconnect()}get walletBranding(){return{name:this.displayName,icon:kw,id:"com.coinbase.wallet"}}async promptConnection(){try{await this.importPromise;let e=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!e||0===e.length||!e[0])throw new t0.P("Unable to retrieve accounts");this.connected=!0,await this.syncAccounts([e[0]])}catch(e){throw(0,t1.f)(e)}}constructor(t,r,n,s,a){super("base_account",t,r,n),this.connectorType="base_account",this.walletClientType="base_account",this.displayName="Base",this.setBaseAccountSdk=a,this.proxyProvider=new tQ.P(void 0,this.rpcTimeoutDuration),this.subscribeListeners(),this.baseAccountConfig={...s,appChainIds:[r.id].concat(t.map(e=>e.id))},i?(this.proxyProvider.setWalletProvider(i.getProvider()),this.setBaseAccountSdk(i),console.log("Base Account SDK Initialized")):this.importPromise=e.A(224814).then(({createBaseAccountSDK:e})=>{i=e(this.baseAccountConfig),this.proxyProvider.setWalletProvider(i.getProvider()),this.setBaseAccountSdk(i),console.log("Base Account SDK Initialized")}).catch(console.error)}}let kv=[1,0xaa36a7,137,10,8453,84532,42161,7777777,43114,56];class kE extends tQ.E{async initialize(){await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(e){return e.showPrompt&&await this.promptConnection(),await this.isConnected()?this.getConnectedWallet():null}disconnect(){this.proxyProvider.walletProvider.disconnect(),this.onDisconnect()}get walletBranding(){return{name:this.displayName,icon:km,id:"com.coinbase.wallet"}}async promptConnection(){try{let e=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!e||0===e.length||!e[0])throw new t0.P("Unable to retrieve accounts");this.connected=!0,await this.syncAccounts([e[0]])}catch(e){throw(0,t1.f)(e)}}updateConnectionPreference(e){this.coinbaseWalletConfig={...this.coinbaseWalletConfig,preference:{...this.coinbaseWalletConfig.preference,options:e}},this.walletClientType="smartWalletOnly"===e?"coinbase_smart_wallet":"coinbase_wallet",n=i3({...this.coinbaseWalletConfig}),this.proxyProvider.setWalletProvider(n.getProvider())}constructor(e,t,r,i){if(super("coinbase_wallet",e,t,r),this.connectorType="coinbase_wallet",this.displayName="Coinbase Wallet",this.proxyProvider=new tQ.P(void 0,this.rpcTimeoutDuration),this.subscribeListeners(),this.coinbaseWalletConfig={...i,appChainIds:[t.id].concat(e.map(e=>e.id))},this.walletClientType="smartWalletOnly"===this.coinbaseWalletConfig.preference?.options?"coinbase_smart_wallet":"coinbase_wallet","coinbase_smart_wallet"===this.walletClientType&&(this.displayName="Coinbase Smart Wallet"),!n){let e="eoaOnly"!==this.coinbaseWalletConfig.preference?.options?(this.coinbaseWalletConfig.appChainIds??[]).filter(e=>!kv.includes(e)):[];e.length>0&&!e.every(e=>z.DEFAULT_SUPPORTED_CHAIN_IDS.has(e))&&console.info(`The configured chains are not supported by Coinbase Smart Wallet: ${e.join(", ")}`),n=i3(this.coinbaseWalletConfig)}this.proxyProvider.setWalletProvider(n.getProvider())}}let k_=({...e})=>(0,F.jsx)("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,F.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.37126 11.0323C2.37126 12.696 3.90598 13.4421 5.40654 13.4468C8.91753 13.4468 12.8021 11.2897 12.7819 7.67984C12.7673 5.07728 10.3748 2.86167 7.54357 2.88296C4.8495 2.88296 2.21821 4.6411 2.21803 7.03628C2.21803 7.67951 2.58722 8.30178 3.55231 8.37184C2.74763 9.16826 2.37126 10.1225 2.37126 11.0323ZM7.55283 8.68012C8.11562 8.68012 8.57186 8.13217 8.57186 7.45624C8.57186 6.78032 8.11562 6.23237 7.55283 6.23237C6.99003 6.23237 6.53379 6.78032 6.53379 7.45624C6.53379 8.13217 6.99003 8.68012 7.55283 8.68012ZM10.4747 8.68012C11.0375 8.68012 11.4937 8.13217 11.4937 7.45625C11.4937 6.78032 11.0375 6.23237 10.4747 6.23237C9.91186 6.23237 9.45562 6.78032 9.45562 7.45625C9.45562 8.13217 9.91186 8.68012 10.4747 8.68012Z",fill:e.color||"var(--privy-color-foreground-3)"})});class kA extends tQ.E{async initialize(){await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(e){return await this.isConnected()?(await this.proxyProvider.request({method:"wallet_switchEthereumChain",params:[(0,tQ.t)(e?.chainId||"0x1")]}),this.getConnectedWallet()):null}get walletBranding(){return{name:"Privy Wallet",icon:k_,id:"io.privy.wallet"}}disconnect(){this.connected=!1}async promptConnection(){}constructor({provider:e,chains:t,defaultChain:r,rpcConfig:i,imported:n,walletIndex:s}){super("privy",t,r,i),this.connectorType="embedded",this.proxyProvider=e,this.walletIndex=s,n&&(this.connectorType="embedded_imported"),this.subscribeListeners()}}async function kS(){let e=C4();return e?e.getAccessToken():Promise.resolve(t1.u.get(i8.P)||t1.u.get(i8.C)||null)}let kx=["eth_sign","eth_populateTransactionRequest","eth_signTransaction","personal_sign","eth_signTypedData_v4","csw_signUserOperation","secp256k1_sign"];function kI(e){return e?{"privy-ui":"t"}:void 0}class kk{async authenticate(){if(!this.api)throw new t0.a("Auth flow has no API instance");if(!this.meta.email||!this.meta.emailCode)throw new t0.a("Email and email code must be set prior to calling authenticate.");try{return await this.api.post(nA,{email:this.meta.email,code:this.meta.emailCode,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(e){throw(0,t0.f)(e)}}async link(){if(!this.api)throw new t0.a("Auth flow has no API instance");if(!this.meta.email||!this.meta.emailCode)throw new t0.a("Email and email code must be set prior to calling authenticate.");try{return await this.api.post(nS,{email:this.meta.email,code:this.meta.emailCode})}catch(e){throw(0,t0.f)(e)}}async sendCodeEmail({email:e,captchaToken:t,withPrivyUi:r}){if(!this.api)throw new t0.a("Auth flow has no API instance");if(e&&(this.meta.email=e),t&&(this.meta.captchaToken=t),!this.meta.email)throw new t0.a("Email must be set when initialzing authentication.");let i=kI(r);try{return await this.api.post(n_,{email:this.meta.email,token:this.meta.captchaToken},{headers:{...i}})}catch(e){throw(0,t0.f)(e)}}constructor({email:e,captchaToken:t,disableSignup:r}){this.meta={email:e,captchaToken:t,disableSignup:r??!1}}}class kT extends kk{async link(){if(!this.api)throw new t0.a("Auth flow has no API instance");if(!this.meta.email||!this.meta.emailCode||!this.meta.oldAddress)throw new t0.a("Email, email code, and an old email address must be set prior to calling update.");try{return await this.api.post(nI,{oldAddress:this.meta.oldAddress,newAddress:this.meta.email,code:this.meta.emailCode})}catch(e){throw(0,t0.f)(e)}}constructor(e,t,r){super({email:t,captchaToken:r}),this.meta={email:t,captchaToken:r,oldAddress:e,disableSignup:!1}}}function kC(e){return{name:e.metadata?.shortName||e.name||"",universalLink:e.mobile.universal,deepLink:e.mobile.native}}function kP(e,t){let r=kC(t);if(r.universalLink)return kM(r.universalLink,e)}let kO="WALLETCONNECT_DEEPLINK_CHOICE";function kR(e){return e.startsWith("http://")||e.startsWith("https://")}function kN(e,t){if(kR(e))return kM(e,t);let r=e;return r.includes("://")||(r=e.replaceAll("/","").replaceAll(":",""),r=`${r}://`),r.endsWith("/")||(r=`${r}/`),{redirect:`${r}wc?uri=${encodeURIComponent(t)}`,href:r}}function kM(e,t){if(!kR(e))return kN(e,t);let r=e;return r.endsWith("/")||(r=`${r}/`),{redirect:`${r}wc?uri=${encodeURIComponent(t)}`,href:r}}function kU(e,t){window.open(e,t,"noreferrer noopener")}class kD{execute(e){return null===this.promise&&(this.promise=(async()=>{try{return await this.fn(e)}finally{this.promise=null}})()),this.promise}constructor(e){this.promise=null,this.fn=e}}class kL{get meta(){return this._meta}async authenticate(){if(!this.api)throw new t0.a("Auth flow has no API instance");if(!this.meta.channelToken)throw new t0.a("Auth flow must be initialized first");try{let e=await this.api.post(nm,{channel_token:this.meta.channelToken,message:this.message,signature:this.signature,fid:this.fid,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"});if(!e)throw new t0.a("No response from authentication");return e}catch(e){throw(0,t0.f)(e)}}async link(){if(!this.api)throw new t0.a("Auth flow has no API instance");try{return await this.api.post(nw,{channel_token:this.meta.channelToken,message:this.message,signature:this.signature,fid:this.fid})}catch(e){throw(0,t0.f)(e)}}async _startChannelOnce(){if(!this.api)throw new t0.a("Auth flow has no API instance");let e=await this.api.post(ng,{token:this.captchaToken});i6.isMobile&&!i6.isIOS&&e.connect_uri&&kU(e.connect_uri,"_blank"),this._meta={...this._meta,connectUri:e.connect_uri,channelToken:e.channel_token}}async initializeFarcasterConnect(){if(!this.api)throw new t0.a("Auth flow has no API instance");await this.startChannelOnce.execute()}async _pollForReady(){if(!this.api)throw new t0.a("Auth flow has no API instance");if(!this.meta.channelToken)throw new t0.a("Auth flow must be initialized first");let e=await this.api.get(nb,{headers:{"farcaster-channel-token":this.meta.channelToken}});return"completed"===e.state&&(this.message=e.message,this.signature=e.signature,this.fid=e.fid,!0)}constructor(e,t=!1){this._meta={disableSignup:!1},this.captchaToken=e,this.startChannelOnce=new kD(this._startChannelOnce.bind(this)),this.pollForReady=new kD(this._pollForReady.bind(this)),this._meta.disableSignup=t}}function kj(){return"undefined"!=typeof window&&"chrome-extension:"===window.location.protocol&&"chrome"in window}function kB(){if(!kj())return;let e=window.chrome;return e?.runtime?.id}function kW(){if(!kj())return!1;let e=window.chrome;return"function"==typeof e?.identity?.launchWebAuthFlow}async function kF(e){return new Promise((t,r)=>{kW()?window.chrome.identity.launchWebAuthFlow({url:e,interactive:!0},async e=>{try{let r=function(){if(!kj())return;let e=window.chrome;return e?.runtime?.lastError?.message}();if(r||!e){let e=`WebAuthFlow failed: ${r||"Response URI missing"}`;throw Error(e)}let i=new URL(e),n=kB();if(!n)throw Error("Invalid extension context");if("chrome-extension:"===i.protocol){if(i.hostname!==n)throw Error("Invalid responseUri origin")}else{if("https:"!==i.protocol)throw Error("Invalid responseUri protocol");{let e=i.hostname.split(".");if(3!==e.length||"chromiumapp"!==e[1]||"org"!==e[2]||e[0]!==n)throw Error("Invalid responseUri origin")}}let s=i.searchParams.get("privy_oauth_state"),a=i.searchParams.get("privy_oauth_code");if(!s||!a)throw Error("Invalid responseUri - missing required parameters");t({privyOAuthState:s,privyOAuthCode:a})}catch(e){r(e)}}):r(Error("Chrome identity API not available"))})}function kH(e){return crypto.getRandomValues(new Uint8Array(e))}function kq(){return tZ.base64url.encode(kH(36))}function kz(){return kq()}async function k$(e,t="S256"){if("S256"!=t)return e;{let t=await async function(e){let t=(new TextEncoder).encode(e);return new Uint8Array(await crypto.subtle.digest("SHA-256",t))}(e);return tZ.base64url.encode(t)}}class kK{addCaptchaToken(e){this.meta.captchaToken=e}isActive(){return!!(this.meta.authorizationCode&&this.meta.stateCode&&this.meta.provider)}async authenticate(){if(!this.api)throw new t0.a("Auth flow has no API instance");if(!this.meta.authorizationCode||!this.meta.stateCode)throw new t0.a("[OAuth AuthFlow] Authorization and state codes code must be set prior to calling authenticate.");if("undefined"===this.meta.authorizationCode)throw new t0.a("User denied confirmation during OAuth flow");let e=function(){let e=t1.u.get(i8.a);if(!e)throw new t0.a("Authentication error.");return e}();try{let t=await this.api.post(nU,{authorization_code:this.meta.authorizationCode,state_code:this.meta.stateCode,code_verifier:e,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"});return t1.u.del(i8.a),t1.u.del(i8.H),t1.u.del(i8.O),t}catch(t){let e=(0,t0.f)(t);if(e.privyErrorCode)throw new t0.a(e.message||"Invalid code during OAuth flow.",void 0,e.privyErrorCode);if("User denied confirmation during OAuth flow"===e.message)throw new t0.a("Invalid code during oauth flow.",void 0,t0.b.OAUTH_USER_DENIED);throw new t0.a("Invalid code during OAuth flow.",void 0,t0.b.UNKNOWN_AUTH_ERROR)}}async link(){if(!this.api)throw new t0.a("Auth flow has no API instance");if(!this.meta.authorizationCode||!this.meta.stateCode)throw new t0.a("[OAuth AuthFlow] Authorization and state codes code must be set prior to calling link.");if("undefined"===this.meta.authorizationCode)throw new t0.a("User denied confirmation during OAuth flow");let e=t1.u.get(i8.a);if(!e)throw new t0.a("Authentication error.");try{let t=await this.api.post(nD,{authorization_code:this.meta.authorizationCode,state_code:this.meta.stateCode,code_verifier:e});return t1.u.del(i8.a),t}catch(e){throw(0,t0.f)(e)}}async getAuthorizationUrl(){if(!this.api)throw new t0.a("Auth flow has no API instance");if(!this.meta.provider)throw new t0.a("Provider must be set when initializing OAuth authentication.");let e=kq();t1.u.put(i8.a,e);let t=kz();t1.u.put(i8.S,t);let r=await k$(e);this.meta.withPrivyUi||t1.u.put(i8.H,!0),this.meta.disableSignup?t1.u.put(i8.O,!0):t1.u.del(i8.O);let i=kI(this.meta.withPrivyUi),n=window.location.href,s=function(){let e=kB();if(e)return`https://${e}.chromiumapp.org`}();s&&(n=s);try{return await this.api.post(nM,{provider:this.meta.provider,redirect_to:this.meta.customOAuthRedirectUrl||n,token:this.meta.captchaToken,code_challenge:r,state_code:t},{headers:{...i}})}catch(e){throw(0,t0.f)(e)}}constructor(e){this.meta=e}}function kV(){let e=new URL(window.location.href);e.searchParams.delete("privy_oauth_code"),e.searchParams.delete("privy_oauth_provider"),e.searchParams.delete("privy_oauth_state"),t1.u.del(i8.S),window.history.replaceState({},"",e)}class kJ{async initRegisterFlow(e){if(!this.api)throw new t0.a("Auth flow has no API instance");this.authenticateForRegistration=!0,this.meta.initRegisterResponse=await this.initRegisterOnce.execute(e)}async initAuthenticationFlow(e){if(!this.api)throw new t0.a("Auth flow has no API instance");this.authenticateForRegistration=!1,this.meta.initAuthenticateResponse=await this.initAuthenticateOnce.execute(e)}async initLinkFlow(){if(!this.api)throw new t0.a("Auth flow has no API instance");this.meta.initLinkResponse=await this.initLinkOnce.execute()}async register(){let t=await e.A(20190);if(!this.api)throw new t0.a("Auth flow has no API instance");if(!t.browserSupportsWebAuthn())throw new t0.a("WebAuthn is not supported in this browser");this.meta.initRegisterResponse||(this.meta.initRegisterResponse=await this.initRegisterOnce.execute());try{let e=this.meta.initRegisterResponse.options,r=await t.startRegistration({optionsJSON:this._transformInitLinkOptionsToCamelCase(e)});return this.meta.setPasskeyAuthState?.({status:"submitting-response"}),await this.api.post(nz,{relying_party:this.meta.initRegisterResponse.relying_party,authenticator_response:this._transformRegistrationResponseToSnakeCase(r)})}catch(e){if("NotAllowedError"===e.name)throw new t0.a("Passkey request timed out or rejected by user.",void 0,t0.b.PASSKEY_NOT_ALLOWED);throw(0,t0.f)(e)}}async authenticate(){if(this.authenticateForRegistration)return this.register();let t=await e.A(20190);if(!this.api)throw new t0.a("Auth flow has no API instance");if(!t.browserSupportsWebAuthn())throw new t0.a("WebAuthn is not supported in this browser");this.meta.initAuthenticateResponse||(this.meta.initAuthenticateResponse=await this.initAuthenticateOnce.execute());let r=this.meta.allowedCredentialsIds?.map(e=>({type:"public-key",id:e}))??this.meta.initAuthenticateResponse.options.allow_credentials;try{let e=await t.startAuthentication({optionsJSON:this._transformInitAuthenticateOptionsToCamelCase({...this.meta.initAuthenticateResponse.options,allow_credentials:r})});return this.meta.setPasskeyAuthState?.({status:"submitting-response"}),await this.api.post(nq,{relying_party:this.meta.initAuthenticateResponse.relying_party,challenge:this.meta.initAuthenticateResponse.options.challenge,authenticator_response:this._transformAuthenticationResponseToSnakeCase(e)})}catch(e){if("NotAllowedError"===e.name)throw new t0.a("Passkey request timed out or rejected by user.",void 0,t0.b.PASSKEY_NOT_ALLOWED);throw(0,t0.f)(e)}}async link(){let t=await e.A(20190);if(!this.api)throw new t0.a("Auth flow has no API instance");if(!t.browserSupportsWebAuthn())throw new t0.a("WebAuthn is not supported in this browser");this.meta.initLinkResponse||(this.meta.initLinkResponse=await this.initLinkOnce.execute());try{let e=this.meta.initLinkResponse.options,r=await t.startRegistration({optionsJSON:this._transformInitLinkOptionsToCamelCase(e)});return this.meta.setPasskeyAuthState?.({status:"submitting-response"}),await this.api.post(nH,{relying_party:this.meta.initLinkResponse.relying_party,authenticator_response:this._transformRegistrationResponseToSnakeCase(r)})}catch(e){if("NotAllowedError"===e.name)throw new t0.a("Passkey request timed out or rejected by user.",void 0,t0.b.PASSKEY_NOT_ALLOWED);throw(0,t0.f)(e)}}async _initRegisterOnce(e){if(!this.api)throw new t0.a("Auth flow has no API instance");let t=kI(e);return await this.api.post(nF,{token:this.meta.captchaToken},{headers:{...t}})}async _initAuthenticateOnce(e){if(!this.api)throw new t0.a("Auth flow has no API instance");let t=kI(e);return await this.api.post(nW,{token:this.meta.captchaToken},{headers:{...t}})}async _initLinkOnce(){if(!this.api)throw new t0.a("Auth flow has no API instance");return await this.api.post(nB,{})}_transformInitLinkOptionsToCamelCase(e){return{rp:e.rp,user:{id:e.user.id,name:e.user.name,displayName:e.user.display_name},challenge:e.challenge,pubKeyCredParams:e.pub_key_cred_params.map(e=>({type:e.type,alg:e.alg})),timeout:e.timeout,excludeCredentials:e.exclude_credentials?.map(e=>({id:e.id,type:e.type,transports:e.transports})),authenticatorSelection:{authenticatorAttachment:e.authenticator_selection?.authenticator_attachment,requireResidentKey:e.authenticator_selection?.require_resident_key,residentKey:e.authenticator_selection?.resident_key,userVerification:e.authenticator_selection?.user_verification},attestation:e.attestation,extensions:{appid:e.extensions?.app_id,credProps:e.extensions?.cred_props?.rk,hmacCreateSecret:e.extensions?.hmac_create_secret},hints:this.meta.hints}}_transformRegistrationResponseToSnakeCase(e){return{id:e.id,raw_id:e.rawId,response:{client_data_json:e.response.clientDataJSON,attestation_object:e.response.attestationObject,authenticator_data:e.response.authenticatorData},authenticator_attachment:e.authenticatorAttachment,client_extension_results:{app_id:e.clientExtensionResults.appid,cred_props:e.clientExtensionResults.credProps,hmac_create_secret:e.clientExtensionResults.hmacCreateSecret},type:e.type}}_transformInitAuthenticateOptionsToCamelCase(e){return{rpId:e.rp_id,challenge:e.challenge,allowCredentials:e.allow_credentials?.map(e=>({id:e.id,type:e.type,transports:e.transports}))||[],timeout:e.timeout,extensions:{appid:e.extensions?.app_id,credProps:e.extensions?.cred_props,hmacCreateSecret:e.extensions?.hmac_create_secret},userVerification:e.user_verification}}_transformAuthenticationResponseToSnakeCase(e){return{id:e.id,raw_id:e.rawId,response:{client_data_json:e.response.clientDataJSON,authenticator_data:e.response.authenticatorData,signature:e.response.signature,user_handle:e.response.userHandle},authenticator_attachment:e.authenticatorAttachment,client_extension_results:{app_id:e.clientExtensionResults.appid,cred_props:e.clientExtensionResults.credProps,hmac_create_secret:e.clientExtensionResults.hmacCreateSecret},type:e.type}}constructor({captchaToken:e,setPasskeyAuthState:t,hints:r}){this.authenticateForRegistration=!1,this.initRegisterOnce=new kD(this._initRegisterOnce.bind(this)),this.initAuthenticateOnce=new kD(this._initAuthenticateOnce.bind(this)),this.initLinkOnce=new kD(this._initLinkOnce.bind(this)),this.meta={captchaToken:e,setPasskeyAuthState:t,hints:r}}}let kZ=({address:e,chainId:t,nonce:r})=>`${window.location.host} wants you to sign in with your Ethereum account:
${e}

By signing, you are proving you own this wallet and logging in. This does not initiate a transaction or cost any fees.

URI: ${window.location.origin}
Version: 1
Chain ID: ${t}
Nonce: ${r}
Issued At: ${(new Date).toISOString()}
Resources:
- https://privy.io`;class kG{get meta(){return{connectorType:this.wallet?.connectorType,walletClientType:this.wallet?.walletClientType,chainId:this.wallet?.chainId,address:this.wallet?.address,disableSignup:this._meta.disableSignup}}async authenticate(){if(!this.client)throw new t0.a("SiweFlow has no client instance");try{if(this.preparedMessage&&this.signature)return await this.client.authenticateWithSiweInternal({message:this.preparedMessage,signature:this.signature,chainId:this.wallet?.chainId,walletClientType:this.walletClientType??this.wallet?.walletClientType,connectorType:this.connectorType??this.wallet?.connectorType,mode:this._meta.disableSignup?"no-signup":"login-or-sign-up"});if(!this.wallet)throw new t0.a("SiweFlow has no wallet instance");let{message:e,signature:t}=await this.sign();return await this.client.authenticateWithSiweInternal({message:e,signature:t,chainId:this.wallet.chainId,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(e){throw(0,t0.f)(e)}}async link(){if(!this.client)throw new t0.a("SiweFlow has no client instance");try{if(!this.wallet)throw new t0.a("SiweFlow has no wallet instance");let{message:e,signature:t}=await this.sign();return await this.client.linkWithSiweInternal({message:e,signature:t,chainId:this.wallet.chainId,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType})}catch(e){throw(0,t0.f)(e)}}async sign(){if(!this.client)throw new t0.a("SiweFlow has no client instance");if(await this.buildMessage(),!this.preparedMessage)throw new t0.a("Could not prepare SIWE message");if(!this.wallet)throw new t0.a("SiweFlow has no wallet instance");let e=await this.wallet.sign(this.preparedMessage);return{message:this.preparedMessage,signature:e}}async _getNonceOnce(){if(!this.client)throw new t0.a("SiweFlow has no client instance");if(!this.wallet)throw new t0.a("UI SiweFlow has no wallet instance");return await this.client.generateSiweNonce({address:this.wallet.address,captchaToken:this.captchaToken})}async buildMessage(){if(!this.client)throw new t0.a("SiweFlow has no client instance");if(!this.wallet)throw new t0.a("SiweFlow has no wallet instance");let e=this.wallet.address,t=this.wallet.chainId.replace("eip155:","");return this.nonce||(this.nonce=await this.getNonceOnce.execute()),this.preparedMessage=kZ({address:e,chainId:t,nonce:this.nonce}),this.preparedMessage}constructor(e,t,r,i=!1,n){this._meta={disableSignup:!1},this.getNonceOnce=new kD(this._getNonceOnce.bind(this)),this.wallet=t,this.captchaToken=r,this.client=e,this._meta.disableSignup=i,this.preparedMessage=n?.message,this.signature=n?.signature,this.walletClientType=n?.walletClientType,this.connectorType=n?.connectorType}}class kY{get meta(){return{connectorType:this.wallet.connectorType,walletClientType:this.wallet.walletClientType,disableSignup:this._meta.disableSignup,messageType:this._meta.messageType,address:this.wallet?.address}}set messageType(e){this._meta.messageType=e}async authenticate(){if(!this.client)throw new t0.a("SiwsFlow has no client instance");try{let{message:e,signature:t}=await this.sign();return await this.client.authenticateWithSiwsInternal({message:e,signature:t,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up",messageType:this.meta.messageType})}catch(e){throw(0,t0.f)(e)}}async link(){if(!this.client)throw new t0.a("SiwsFlow has no client instance");try{let{message:e,signature:t}=await this.sign();return await this.client.linkWithSiwsInternal({message:e,signature:t,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType,messageType:this.meta.messageType})}catch(e){throw(0,t0.f)(e)}}async sign(){let e,t;if(!this.client)throw new t0.a("SiwsFlow has no client instance");await this.buildMessage();let r="transaction"===this.meta.messageType;if(!this.preparedMessage)throw new t0.a("Could not prepare SIWS message");if(!r&&!this.wallet.provider.signMessage||r&&!this.wallet.provider.signTransaction)throw new t0.a("Wallet does not support the necessary signing methods");if(r&&this._plugin){let r=await this.wallet.provider.signTransaction({transaction:n7.base64.decode(this.preparedMessage)});e=n7.base64.encode(r.signedTransaction),t=this._plugin.getSignatureFromTransaction(r.signedTransaction,this.wallet.address)}else{e=this.preparedMessage;let r=await this.wallet.provider.signMessage({message:(new TextEncoder).encode(this.preparedMessage)});t=n7.base64.encode(r.signature)}return{message:e,signature:t}}async _getNonceOnce(){if(!this.client)throw new t0.a("SiwsFlow has no client instance");return await this.client.generateSiwsNonce({address:this.wallet.address,captchaToken:this.captchaToken})}async buildMessage(){if(!this.client)throw new t0.a("SiwsFlow has no client instance");let e=this.wallet.address;return this.nonce||(this.nonce=await this.getNonceOnce.execute()),"transaction"===this.meta.messageType&&this._plugin?this.preparedMessage=this._plugin.createSiwsMemoTransaction({address:e,nonce:this.nonce}):this.preparedMessage=(0,n9.p)({address:e,nonce:this.nonce}),this.preparedMessage}constructor(e,t,r,i=!1,n="plain",s){this._meta={disableSignup:!1,messageType:"plain"},this.getNonceOnce=new kD(this._getNonceOnce.bind(this)),this.wallet=e,this.captchaToken=r,this.client=t,this._meta.disableSignup=i,this._meta.messageType=n,this._plugin=s}}class kQ{async authenticate(){if(!this.api)throw new t0.a("Auth flow has no API instance");if(!this.meta.phoneNumber||!this.meta.smsCode)throw new t0.a("phone number and sms code must be set prior to calling authenticate.");try{return await this.api.post(nO,{phoneNumber:this.meta.phoneNumber,code:this.meta.smsCode,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(e){throw(0,t0.f)(e)}}async link(){if(!this.api)throw new t0.a("Auth flow has no API instance");if(!this.meta.phoneNumber||!this.meta.smsCode)throw new t0.a("phone number and sms code must be set prior to calling authenticate.");try{return await this.api.post(nC,{phoneNumber:this.meta.phoneNumber,code:this.meta.smsCode})}catch(e){throw(0,t0.f)(e)}}async sendSmsCode({phoneNumber:e,captchaToken:t,withPrivyUi:r}){if(!this.api)throw new t0.a("Auth flow has no API instance");if(e&&(this.meta.phoneNumber=e),t&&(this.meta.captchaToken=t),!this.meta.phoneNumber)throw new t0.a("phone nNumber must be set when initialzing authentication.");let i=kI(r);try{return await this.api.post(nT,{phoneNumber:this.meta.phoneNumber,token:this.meta.captchaToken},{headers:{...i}})}catch(e){throw(0,t0.f)(e)}}constructor({phoneNumber:e,captchaToken:t,disableSignup:r}){this.meta={phoneNumber:e,captchaToken:t,disableSignup:r??!1}}}class kX extends kQ{async link(){if(!this.api)throw new t0.a("Auth flow has no API instance");if(!this.meta.phoneNumber||!this.meta.smsCode||!this.meta.oldPhoneNumber)throw new t0.a("Phone number, sms code, and an old phone number must be set prior to calling update.");try{return await this.api.post(nR,{old_phone_number:this.meta.oldPhoneNumber,new_phone_number:this.meta.phoneNumber,code:this.meta.smsCode})}catch(e){throw(0,t0.f)(e)}}constructor(e,t,r){super({phoneNumber:t,captchaToken:r}),this.meta={phoneNumber:t,captchaToken:r,oldPhoneNumber:e,disableSignup:!1}}}let k0=(0,H.createContext)({enabled:!1,siteKey:"",provider:void 0,appId:void 0,token:void 0,error:void 0,status:"disabled",setToken:t0.n,setError:t0.n,setExecuting:t0.n,waitForResult:()=>Promise.resolve(""),ref:{current:null},remove:t0.d,reset:t0.n,execute:t0.n});class k1 extends t0.c{constructor(e,t,r){super(e||"Captcha failed"),this.type="Captcha",t instanceof Error&&(this.cause=t),this.privyErrorCode=r}}let k2=({children:e,appId:t,captchaSiteKey:r,captchaEnabled:i,captchaProvider:n})=>{let s=(0,H.useRef)(null),a=(0,H.useRef)(null),[o,l]=(0,H.useState)(),[c,d]=(0,H.useState)(),[u,h]=(0,H.useState)(!1),p=(0,H.useMemo)(()=>i?u||o||c?!u||o||c?o&&!c?{status:"success",token:o}:c?{status:"error",error:c}:{status:"ready"}:{status:"loading"}:{status:"ready"}:{status:"disabled"},[i,o,c,u]),f=(0,H.useMemo)(()=>i&&n?"turnstile"===n?{remove:()=>{s.current?.remove(),h(!1),d(void 0),l(void 0)},reset:()=>{s.current?.reset(),h(!1),d(void 0),l(void 0)},execute:()=>{h(!0),s.current?.execute()},waitForResult:async()=>{try{return await (0,tQ.p)(()=>s.current?.getResponse(),{interval:200,timeout:2e4})}catch(e){throw new k1("Captcha failed",null,t0.b.CAPTCHA_TIMEOUT)}}}:{remove:()=>{a.current?.removeCaptcha(),h(!1),d(void 0),l(void 0)},reset:()=>{a.current?.resetCaptcha(),h(!1),d(void 0),l(void 0)},execute:()=>{h(!0),a.current?.execute()},waitForResult:async()=>{try{return await (0,tQ.p)(()=>a.current?.getResponse(),{interval:200,timeout:2e4})}catch(e){throw new k1("Captcha failed",null,t0.b.CAPTCHA_TIMEOUT)}}}:null,[i,n]),y=(0,H.useMemo)(()=>{if(!i||!n||!f)return{...p,enabled:!1,siteKey:"",appId:t,setToken:t0.n,setError:t0.n,setExecuting:t0.n,waitForResult:()=>Promise.resolve(void 0),remove:t0.d,reset:t0.n,execute:t0.n,provider:void 0,ref:{current:null}};let e={...p,enabled:!0,appId:t,setToken:l,setError:d,setExecuting:h};return"turnstile"===n?{...e,provider:"turnstile",ref:s,siteKey:r.split("t:")[1]??"",...f}:{...e,provider:"hcaptcha",ref:a,siteKey:r.split("h:")[1]??"",...f}},[p,i,n,f,t,r]);return(0,F.jsx)(k0.Provider,{value:y,children:e})},k3=()=>(0,H.useContext)(k0);class k5{async authenticate(){if(!this.api)throw new t0.a("Auth flow has no API instance");try{return await this.api.post(n$,{captcha_token:this.meta.captchaToken,telegram_auth_result:this.meta.telegramAuthResult,telegram_web_app_data:this.meta.telegramWebAppData,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(e){throw(0,t0.f)(e)}}async link(){if(!this.api)throw new t0.a("Auth flow has no API instance");try{return await this.api.post(nK,{telegram_auth_result:this.meta.telegramAuthResult,telegram_web_app_data:this.meta.telegramWebAppData})}catch(e){throw(0,t0.f)(e)}}constructor(e,t=!1){this.meta={disableSignup:!1},this.meta={captchaToken:e,disableSignup:!1},this.meta.disableSignup=t}}function k8(e){let t={detail:"",retryable:!1};return e?.privyErrorCode===t0.b.LINKED_TO_ANOTHER_USER&&(t.detail="This account has already been linked to another user."),e?.privyErrorCode===t0.b.DISALLOWED_LOGIN_METHOD&&(t.detail="Login with Telegram not allowed."),e?.privyErrorCode===t0.b.INVALID_DATA&&(t.retryable=!0,t.detail="Something went wrong. Try again."),e?.privyErrorCode===t0.b.CANNOT_LINK_MORE_OF_TYPE&&(t.retryable=!0,t.detail="Something went wrong. Try again."),e?.privyErrorCode===t0.b.INVALID_CREDENTIALS&&(t.retryable=!0,t.detail="Something went wrong. Try again."),e?.privyErrorCode===t0.b.TOO_MANY_REQUESTS&&(t.detail="Too many requests. Please wait before trying again."),e?.privyErrorCode===t0.b.TOO_MANY_REQUESTS&&e.message.includes("rate limit")&&(t.detail="Request limit reached for Telegram. Please wait a moment and try again."),e instanceof k1&&(t.retryable=!0,t.detail="Something went wrong. Try again."),t}function k6(e){return Object.fromEntries(decodeURIComponent(e).split("&").map(e=>e.split("=").map(decodeURIComponent)))}function k4(){let e=new URL(window.location.href);e.searchParams.delete("id"),e.searchParams.delete("hash"),e.searchParams.delete("auth_date"),e.searchParams.delete("first_name"),e.searchParams.delete("last_name"),e.searchParams.delete("username"),e.searchParams.delete("photo_url"),e.hash="",window.history.replaceState({},"",e)}let k7=(0,H.lazy)(()=>e.A(953156)),k9=(0,H.lazy)(()=>e.A(724041)),Te=e=>{let t=k3();return(0,H.useEffect)(()=>t.remove,[t.remove]),t.enabled&&t.provider?(0,F.jsx)(H.Suspense,{fallback:null,children:(0,F.jsxs)("div",{className:"hidden h-0 w-0",children:["turnstile"===t.provider&&(0,F.jsx)(k7,{...e,captchaContext:t}),"hcaptcha"===t.provider&&(0,F.jsx)(k9,{...e,captchaContext:t})]})}):null};var Tt=Object.freeze({__proto__:null,AccountNotFoundScreen:()=>e.A(742630),AffirmativeConsentScreen:()=>e.A(552059),AllowlistRejectionScreen:()=>e.A(367265),AuthenticateWithWalletScreen:()=>e.A(74915),AwaitingEvmToSolBridgingScreen:()=>e.A(463842),AwaitingExternalEthereumTransferScreen:()=>e.A(547987),AwaitingPasswordlessCodeScreen:()=>e.A(635786),AwaitingSolToEvmBridgingScreen:()=>e.A(94135),CaptchaScreen:()=>e.A(971732),CoinbaseOnrampStatusScreen:()=>e.A(249312),ConnectLedgerScreen:()=>e.A(889644),ConnectOnlyLandingScreen:()=>e.A(829686),ConnectOnlyStatusScreen:()=>e.A(731908),ConnectOrCreateScreen:()=>e.A(881482),ConnectionStatusScreen:()=>e.A(498102),CrossAppAuthScreen:()=>e.A(224611),DelegatedActionsConsentScreen:()=>e.A(753527),DelegatedActionsRevokeScreen:()=>e.A(639882),EmbeddedWalletConnectingScreen:()=>e.A(987044),EmbeddedWalletCreatedScreen:()=>e.A(132540),EmbeddedWalletKeyExportScreen:()=>e.A(150589),EmbeddedWalletOnAccountCreateScreen:()=>e.A(205352),EmbeddedWalletPasswordCreateScreen:()=>e.A(190243),EmbeddedWalletPasswordUpdateScreen:()=>e.A(424561),EmbeddedWalletPasswordUpdateSplashScreen:()=>e.A(702391),ErrorScreen:()=>e.A(266818),FarcasterConnectStatusScreen:()=>e.A(366022),FarcasterSignerStatusScreen:()=>e.A(76129),FundSolWalletWithExternalSolanaWallet:()=>e.A(190220),FundingAmountEditScreen:()=>e.A(386623),FundingMethodSelectionScreen:()=>e.A(418516),InAppBrowserLoginNotPossible:()=>e.A(790209),InstallWalletScreen:()=>e.A(501685),LandingScreen:()=>e.A(146259),LinkConflictScreen:()=>e.A(784726),LinkEmailScreen:()=>e.A(669052),LinkPasskeyScreen:()=>e.A(100721),LinkPhoneScreen:()=>e.A(59325),LoginFailedScreen:()=>e.A(202846),ManualTransferScreen:()=>e.A(915883),MfaAuthEnrollmentFlowScreen:()=>e.A(858257),MfaAuthVerifyFlowScreen:()=>e.A(752733),MfaEnrollmentFlowScreen:()=>e.A(363006),MoonpayStatusScreen:()=>e.A(916690),OAuthStatusScreen:()=>e.A(744268),PasskeySelectSignupOrLogin:()=>e.A(531802),PasskeyStatusScreen:()=>e.A(297017),PasswordRecoveryScreen:()=>e.A(630205),RecoveryOAuthScreen:()=>e.A(307722),RecoverySelectionScreen:()=>e.A(646178),SendTransactionScreen:()=>e.A(207363),SetAutomaticRecoveryScreen:()=>e.A(501311),SignRequestScreen:()=>e.A(936445),StandardSignAndSendTransactionScreen:()=>e.A(35116),TelegramAuthScreen:()=>e.A(227017),TransferFromWalletScreen:()=>e.A(741113),UpdateEmailScreen:()=>e.A(963639),UpdatePhoneScreen:()=>e.A(724236),UserLimitReachedScreen:()=>e.A(870989),WalletInterstitialScreen:()=>e.A(56255)});let Tr=(0,sr.create)(()=>({inProgressMfaFlow:void 0})),Ti=(0,se.createGlobalStyle)([":root{","};"],e=>Tn(e.palette)),Tn=e=>(0,se.css)(["",""],Object.entries({"--privy-color-background":e.background,"--privy-color-background-2":e.background2,"--privy-color-background-3":e.background3,"--privy-color-foreground":e.foreground,"--privy-color-foreground-2":e.foreground2,"--privy-color-foreground-3":e.foreground3,"--privy-color-foreground-4":e.foreground4,"--privy-color-foreground-accent":e.foregroundAccent,"--privy-color-accent":e.accent,"--privy-color-accent-light":e.accentLight,"--privy-color-accent-hover":e.accentHover,"--privy-color-accent-dark":e.accentDark,"--privy-color-accent-darkest":e.accentDarkest,"--privy-color-success":e.success,"--privy-color-success-dark":e.successDark,"--privy-color-success-light":e.successLight,"--privy-color-success-bg":e.successBg,"--privy-color-error":e.error,"--privy-color-error-light":e.errorLight,"--privy-color-error-bg":e.errorBg,"--privy-color-error-bg-hover":e.errorBgHover,"--privy-color-warn":e.warn,"--privy-color-warn-light":e.warnLight,"--privy-color-warn-bg":e.warnBg,"--privy-color-warning-dark":e.warningDark,"--privy-color-error-dark":e.errorDark,"--privy-color-info-bg":e.infoBg,"--privy-color-info-bg-hover":e.infoBgHover,"--privy-color-border-default":e.borderDefault,"--privy-color-border-hover":e.borderHover,"--privy-color-border-focus":e.borderFocus,"--privy-color-border-error":e.borderError,"--privy-color-border-success":e.borderSuccess,"--privy-color-border-warning":e.borderWarning,"--privy-color-border-info":e.borderInfo,"--privy-color-border-interactive":e.borderInteractive,"--privy-color-border-interactive-hover":e.borderInteractiveHover,"--privy-color-background-hover":e.backgroundHover,"--privy-color-background-clicked":e.backgroundClicked,"--privy-color-background-disabled":e.backgroundDisabled,"--privy-color-background-interactive":e.backgroundInteractive,"--privy-color-background-interactive-hover":e.backgroundInteractiveHover,"--privy-color-background-interactive-clicked":e.backgroundInteractiveClicked,"--privy-color-background-interactive-disabled":e.backgroundInteractiveDisabled,"--privy-color-foreground-hover":e.foregroundHover,"--privy-color-foreground-clicked":e.foregroundClicked,"--privy-color-foreground-disabled":e.foregroundDisabled,"--privy-color-foreground-interactive":e.foregroundInteractive,"--privy-color-foreground-interactive-hover":e.foregroundInteractiveHover,"--privy-link-navigation-color":e.linkNavigationColor,"--privy-link-navigation-decoration":e.linkNavigationDecoration,"--privy-accent-has-good-contrast":e.accentHasGoodContrast,"--privy-color-icon-default":e.iconDefault,"--privy-color-icon-muted":e.iconMuted,"--privy-color-icon-subtle":e.iconSubtle,"--privy-color-icon-inverse":e.iconInverse,"--privy-color-icon-success":e.iconSuccess,"--privy-color-icon-warning":e.iconWarning,"--privy-color-icon-error":e.iconError,"--privy-color-icon-interactive":e.iconInteractive,"--privy-color-icon-default-hover":e.iconDefaultHover,"--privy-color-icon-muted-hover":e.iconMutedHover,"--privy-color-icon-subtle-hover":e.iconSubtleHover,"--privy-color-icon-default-clicked":e.iconDefaultClicked,"--privy-color-icon-muted-clicked":e.iconMutedClicked,"--privy-color-icon-subtle-clicked":e.iconSubtleClicked,"--privy-color-icon-default-disabled":e.iconDefaultDisabled,"--privy-color-icon-muted-disabled":e.iconMutedDisabled,"--privy-color-icon-subtle-disabled":e.iconSubtleDisabled,"--privy-color-icon-error-hover":e.iconErrorHover,"--privy-color-icon-interactive-hover":e.iconInteractiveHover,"--privy-color-icon-error-clicked":e.iconErrorClicked,"--privy-color-icon-interactive-clicked":e.iconInteractiveClicked,"--privy-color-icon-muted-disabled-alt":e.iconMutedDisabledAlt,"--privy-color-icon-subtle-disabled-alt":e.iconSubtleDisabledAlt,"--privy-border-radius-xs":"6px","--privy-border-radius-sm":"8px","--privy-border-radius-md":"12px","--privy-border-radius-mdlg":"16px","--privy-border-radius-lg":"24px","--privy-border-radius-full":"9999px","--privy-height-modal-full":"620px","--privy-height-modal-compact":"480px"}).map(([e,t])=>`${e}: ${t};`).join("\n")),Ts=se.styled.div.withConfig({displayName:"StylesWrapper",componentId:"sc-188229e4-0"})([""," color:var(--privy-color-foreground-2);h3{font-size:16px;line-height:24px;font-weight:500;color:var(--privy-color-foreground-2);}h4{font-size:14px;line-height:20px;font-weight:500;color:var(--privy-color-foreground);}p{font-size:13px;line-height:20px;color:var(--privy-color-foreground-2);}button:focus,input:focus,optgroup:focus,select:focus,textarea:focus{outline:none;border-color:var(--privy-color-accent-light);box-shadow:0 0 0 3px var(--privy-color-border-focus);}.mobile-only{@media (min-width:441px){display:none;}}@keyframes fadein{0%{opacity:0;}100%{opacity:1;}}"],"\n  *,\n  ::before,\n  ::after {\n    box-sizing: border-box;\n    border-width: 0;\n    border-style: solid;\n  }\n\n  line-height: 1.15;\n  -webkit-text-size-adjust: 100%;\n  -moz-tab-size: 4;\n  tab-size: 4;\n  font-feature-settings: normal;\n\n  margin: 0;\n  font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif,\n    'Apple Color Emoji', 'Segoe UI Emoji';\n\n  hr {\n    height: 0;\n    color: inherit;\n    border-top-width: 1px;\n  }\n\n  abbr:where([title]) {\n    text-decoration: underline dotted;\n  }\n\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6 {\n    font-size: inherit;\n    font-weight: inherit;\n    font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif,\n    'Apple Color Emoji', 'Segoe UI Emoji';\n    display: inline;\n  }\n\n  a {\n    color: inherit;\n    text-decoration: inherit;\n  }\n\n  b,\n  strong {\n    font-weight: bolder;\n  }\n\n  code,\n  kbd,\n  samp,\n  pre {\n    font-family: ui-monospace, SFMono-Regular, Consolas, 'Liberation Mono', Menlo, monospace;\n    font-size: 1em;\n  }\n\n  small {\n    font-size: 80%;\n  }\n\n  sub,\n  sup {\n    font-size: 75%;\n    line-height: 0;\n    position: relative;\n    vertical-align: baseline;\n  }\n\n  sub {\n    bottom: -0.25em;\n  }\n\n  sup {\n    top: -0.5em;\n  }\n\n  table {\n    text-indent: 0;\n    border-color: inherit;\n    border-collapse: collapse;\n  }\n\n  button,\n  input,\n  optgroup,\n  select,\n  textarea {\n    font-family: inherit;\n    font-size: 100%;\n    font-weight: inherit;\n    line-height: inherit;\n    color: inherit;\n    margin: 0;\n    padding: 0;\n  }\n\n  button,\n  select {\n    text-transform: none;\n  }\n\n  button,\n  [type='button'],\n  [type='reset'],\n  [type='submit'] {\n    -webkit-appearance: button;\n    background-color: transparent;\n    background-image: none;\n  }\n\n  ::-moz-focus-inner {\n    border-style: none;\n    padding: 0;\n  }\n\n  :-moz-focusring {\n    outline: 1px dotted ButtonText;\n  }\n\n  :-moz-ui-invalid {\n    box-shadow: none;\n  }\n\n  legend {\n    padding: 0;\n  }\n\n  progress {\n    vertical-align: baseline;\n  }\n\n  ::-webkit-inner-spin-button,\n  ::-webkit-outer-spin-button {\n    height: auto;\n  }\n\n  [type='search'] {\n    -webkit-appearance: textfield;\n    outline-offset: -2px;\n  }\n\n  ::-webkit-search-decoration {\n    -webkit-appearance: none;\n  }\n\n  ::-webkit-file-upload-button {\n    -webkit-appearance: button;\n    font: inherit;\n  }\n\n  summary {\n    display: list-item;\n  }\n\n  blockquote,\n  dl,\n  dd,\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6,\n  hr,\n  figure,\n  p,\n  pre {\n    margin: 0;\n  }\n\n  fieldset {\n    margin: 0;\n    padding: 0;\n  }\n\n  legend {\n    padding: 0;\n  }\n\n  ol,\n  ul,\n  menu {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n  }\n\n  textarea {\n    resize: vertical;\n  }\n\n  input::placeholder,\n  textarea::placeholder {\n    opacity: 1;\n    color: #9ca3af;\n  }\n\n  button,\n  [role='button'] {\n    cursor: pointer;\n  }\n\n  :disabled {\n    cursor: default;\n  }\n\n  img,\n  svg,\n  video,\n  canvas,\n  audio,\n  iframe,\n  embed,\n  object {\n    display: block;\n  }\n\n  img,\n  video {\n    max-width: 100%;\n    height: auto;\n  }\n\n  [hidden] {\n    display: none;\n  }\n"),Ta=({children:e,open:t,onClick:r,...i})=>(0,F.jsx)(sG,{show:t,as:H.default.Fragment,children:(0,F.jsxs)(oM,{onClose:r,...i,as:Tl,children:[(0,F.jsx)(sZ,{as:H.default.Fragment,enterFrom:"entering",leaveTo:"leaving",children:(0,F.jsx)(To,{id:"privy-dialog-backdrop","aria-hidden":"true"})}),(0,F.jsx)(Tc,{children:(0,F.jsx)(sZ,{as:H.default.Fragment,enterFrom:"entering",leaveTo:"leaving",children:(0,F.jsx)(oN,{as:Td,children:e})})})]})}),To=se.styled.div.withConfig({displayName:"Backdrop",componentId:"sc-3cfde0b5-0"})(["position:fixed;inset:0;transition:backdrop-filter 100ms ease;backdrop-filter:blur(3px);-webkit-backdrop-filter:blur(3px);&.entering,&.leaving{backdrop-filter:unset;-webkit-backdrop-filter:unset;}"]),Tl=se.styled.div.withConfig({displayName:"DialogWrapper",componentId:"sc-3cfde0b5-1"})(["position:relative;z-index:999999;"]),Tc=se.styled.div.withConfig({displayName:"DialogContainer",componentId:"sc-3cfde0b5-2"})(["position:fixed;inset:0;display:flex;align-items:center;justify-content:center;width:100vw;min-height:100vh;"]),Td=se.styled.div.withConfig({displayName:"Panel",componentId:"sc-3cfde0b5-3"})(["padding:0;background:transparent;border:none;width:100%;pointer-events:auto;outline:none;display:block;@media (max-width:440px){opacity:1;transform:translate3d(0,0,0);transition:transform 200ms ease-in;position:fixed;bottom:0;&.entering,&.leaving{opacity:0;transform:translate3d(0,100%,0);transition:transform 150ms ease-in 0ms,opacity 0ms ease 150ms;}}@media (min-width:441px){opacity:1;transition:opacity 100ms ease-in;&.entering,&.leaving{opacity:0;transition-delay:5ms;}margin:auto;width:360px;box-shadow:0px 8px 36px rgba(55,65,81,0.15);border-radius:var(--privy-border-radius-lg);}"]),Tu=(0,H.lazy)(()=>e.A(778255)),Th=(0,H.lazy)(()=>Tt.MfaAuthVerifyFlowScreen().then(e=>({default:e.default.component}))),Tp=()=>(0,F.jsx)(Tb,{children:(0,F.jsx)(tQ.L,{})}),Tf=()=>{let{currentScreen:e}=(0,tG.a)(),t=Tr(e=>e.inProgressMfaFlow),r=()=>Tr.setState({inProgressMfaFlow:void 0}),{component:i,isLoading:n}=(()=>{let{ready:e}=(0,tG.u)(),{currentScreen:t}=(0,tG.a)(),[r,i]=(0,H.useState)(null),[n,s]=(0,H.useState)(!1),a=function(e){let[t,r]=(0,H.useState)(!1),i=(0,H.useRef)(null),n=(0,H.useRef)(null),s=(0,H.useRef)(null);return(0,H.useEffect)(()=>{if(i.current&&(clearTimeout(i.current),i.current=null),n.current&&(clearTimeout(n.current),n.current=null),e)s.current=Date.now(),i.current=setTimeout(()=>{r(!0)},150);else if(null!==s.current){let e=Date.now()-s.current;e>=150?n.current=setTimeout(()=>{r(!1),s.current=null},Math.max(0,400-(e-150))):(i.current&&(clearTimeout(i.current),i.current=null),r(!1),s.current=null)}return()=>{i.current&&clearTimeout(i.current),n.current&&clearTimeout(n.current)}},[e]),t}(n);return(0,H.useEffect)(()=>{t?(s(!0),Tt[t]().then(r=>{(!t||e||r.default.isShownBeforeReady)&&(i(()=>r.default.component),s(!1))}).catch(()=>{i(null),s(!1)})):(i(null),s(!1))},[t,e]),{component:r,isLoading:a}})();return function(){let{isModalOpen:e}=(0,tG.u)(),{headless:t}=(0,i8.u)(),{currentScreen:r}=(0,tG.a)(),{status:i,execute:n,reset:s,enabled:a}=k3(),[o,l]=(0,H.useState)(!1);(0,H.useEffect)(()=>{!e&&a&&s()},[e,a,s]),(0,H.useEffect)(()=>{r?Tt[r]().then(e=>{l(!!e.default.isCaptchaRequired)}).catch(()=>{l(!1)}):l(!1)},[r]),(0,H.useEffect)(()=>{e&&o&&!t&&"ready"===i&&a&&n()},[e,o,t,i,a,n])}(),e||"txn"!==t?n?(0,F.jsx)(Tp,{}):i?(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(tQ.H,{$if:!!t,children:(0,F.jsx)(i,{})}),(0,F.jsxs)(H.Suspense,{children:["txn"===t&&(0,F.jsx)(Tu,{onClose:r}),"auth"===t&&(0,F.jsx)(Th,{})]})]}):null:(0,F.jsx)(Tu,{onClose:r})},Ty=()=>{let e=(0,H.useRef)(null);return(0,F.jsx)(Tw,{style:{height:(0,tQ.u)(e)},id:"privy-modal-content",children:(0,F.jsx)("div",{ref:e,children:(0,F.jsx)(Tf,{})})})},Tg=({open:e})=>{var t;let r=(0,i8.u)(),{gracefulClosePrivyModal:i}=(()=>{let{closePrivyModal:e}=(0,t0.u)(),{onUserCloseViaDialogOrKeybindRef:t}=(0,tG.a)();return{gracefulClosePrivyModal:(0,H.useCallback)(()=>{if(!t?.current)return e({shouldCallAuthOnSuccess:!1});t.current()},[e])}})(),n=Tr(e=>e.inProgressMfaFlow);return t={onMfaRequired:()=>{r.mfa.noPromptOnMfaRequired||Tr.setState({inProgressMfaFlow:"txn"})}},(0,st.u)("configureMfa",t),r.render.standalone?(0,F.jsx)(Ts,{children:(0,F.jsx)(Tm,{id:"privy-modal-content",children:(0,F.jsx)(Tf,{})})}):(0,F.jsx)(Ta,{open:!(!e&&!n),id:"privy-dialog","aria-label":"log in or sign up","aria-labelledby":"privy-dialog-title",onClick:()=>i(),children:(0,F.jsx)(Ts,{children:(0,F.jsx)(Ty,{})})})},Tm=se.styled.div.withConfig({displayName:"ContentWrapper",componentId:"sc-4759f1d5-0"})(["display:flex;flex-direction:column;text-align:center;font-size:14px;line-height:20px;width:100%;background:var(--privy-color-background);padding:0 16px;"]),Tw=(0,se.styled)(Tm).withConfig({displayName:"BaseModal",componentId:"sc-4759f1d5-1"})(["transition:height 150ms ease-out;overflow-x:hidden;overflow-y:auto;scrollbar-width:none;max-height:calc(100svh - 32px);border-radius:var(--privy-border-radius-lg) var(--privy-border-radius-lg) 0 0;box-shadow:0px 0px 36px rgba(55,65,81,0.15);@media (min-width:441px){box-shadow:0px 8px 36px rgba(55,65,81,0.15);border-radius:var(--privy-border-radius-lg);}"]),Tb=se.styled.div.withConfig({displayName:"LoadingScreenContainer",componentId:"sc-4759f1d5-2"})(["display:flex;align-items:center;justify-content:center;min-height:300px;padding:2rem;"]);function Tv(e){let t=(0,H.useRef)(null),r=(0,H.useRef)();return(0,H.useEffect)(()=>{r.current?.remove(),r.current=function({botUsername:e,scriptHost:t}){let r=document.createElement("script"),{origin:i}=new URL(t);return r.async=!0,r.src=`${i}/js/telegram-login.js`,r.setAttribute("data-telegram-login",e),r.setAttribute("data-request-access","write"),r.setAttribute("data-lang","en"),r}(e),t.current?.after(r.current)},[e]),(0,F.jsx)("div",{ref:t,hidden:!0})}let TE=()=>{let{ready:e}=(0,tX.u)(),{client:t}=(0,t0.u)();return(0,H.useEffect)(()=>{let r=()=>{if(!t.connectors||!e)return;let r=t.connectors.wallets.map(e=>({address:e.address,connectorType:e.connectorType,walletClientType:e.walletClientType,connectedAt:e.connectedAt,id:e.meta.id}));t1.u.put(i8.b,r)};return t.connectors?.on("walletsUpdated",r),()=>{t.connectors?.off("walletsUpdated",r)}},[e,t.connectors]),null};class T_ extends tQ.E{async initialize(){let e=await this.createProvider();this.provider=e,this.proxyProvider.setWalletProvider(e),this.subscribeListeners(),e.session&&(this.walletProvider?.session?.peer.metadata.url&&(this.walletEntry=(0,tQ.g)(this.walletProvider?.session?.peer.metadata.url),this.walletClientType=this.walletEntry?.slug||"unknown"),this.connected=!0,await this.syncAccounts()),this.initialized=!0,this.emit("initialized")}async connect(e){return e.showPrompt&&await this.promptConnection(),this.getConnectedWallet()}async isConnected(){return!!this.walletProvider?.connected}get walletBranding(){let e=this.walletProvider?.session?.peer.metadata.icons?.[0];return{name:(0,tQ.s)(this.walletProvider?.session?.peer.metadata.name||"")||"WalletConnect",icon:"string"==typeof e?e:t1.W,id:this.walletProvider?.session?.peer.metadata.name.toLowerCase()||"wallet_connect_v2"}}async resetConnection(e){this.walletProvider&&this.walletProvider.connected&&(await this.walletProvider.disconnect(),this.walletProvider.signer.session=void 0,this.walletClientType=e,this.redirectUri=void 0,this.fallbackUniversalRedirectUri=void 0,function(){try{localStorage.removeItem(kO)}catch{}}(),this.onDisconnect())}async promptConnection(){if(this.provider)return new Promise((e,t)=>{(async()=>{let t="",r=await Promise.race([this.walletProvider?.enable(),this.proxyProvider.walletTimeout()]);if(r?.length&&(t=r[0]),!t||""===t)throw new t0.P("Unable to retrieve address");this.walletProvider?.session?.peer.metadata.url&&(this.walletEntry=(0,tQ.g)(this.walletProvider?.session?.peer.metadata.url),this.walletClientType=this.walletEntry?.slug||"unknown",this.proxyProvider.rpcTimeoutDuration=(0,tQ.c)(this.rpcConfig,this.walletClientType)),this.connected=!0,await this.syncAccounts(r),e()})().catch(e=>{t(e?(0,t1.f)(e):new t0.P("Unknown error during connection"))})})}disconnect(){this.walletProvider?.disconnect().then(()=>this.onDisconnect()).catch(()=>console.warn("Unable to disconnect WalletConnect provider"))}get walletProvider(){return this.proxyProvider.walletProvider}setWalletProvider(e){this.proxyProvider.setWalletProvider(e)}async createProvider(){let e={};for(let t of this.chains){let r=(0,tQ.a)(t.id,this.chains,this.rpcConfig,this.privyAppId);r&&(e[t.id]=r)}let t=this.shouldEnforceDefaultChainOnConnect?[this.defaultChain.id]:[],r=this.chains.map(e=>e.id),i=await _e.init({projectId:this.walletConnectCloudProjectId,chains:t,optionalChains:r,optionalEvents:EY,optionalMethods:EZ,rpcMap:e,showQrModal:!1,metadata:{description:this.privyAppName,name:this.privyAppName,url:window.location.origin,icons:[]}});return i.on("display_uri",e=>{if(i.signer.abortPairingAttempt(),function(){try{localStorage.removeItem(kO)}catch{}}(),!this.showPrivyQrModal)throw new t0.P("WalletConnect modal not available - Privy handles wallet connections through its own UI");if(i6.isMobile&&this.walletEntry){let{redirect:t,href:r}=function(e,t){let r=kC(t);if(r.deepLink)return kN(r.deepLink,e);if(r.universalLink)return kM(r.universalLink,e);throw new t0.a(`Unsupported wallet ${t.id}`)}(e,this.walletEntry);kU(t,"_self"),function({href:e,name:t}){try{localStorage.setItem(kO,JSON.stringify({href:e,name:t}))}catch{}}({href:r,name:this.walletEntry.metadata?.shortName||this.walletEntry.name});let i=kP(e,this.walletEntry);return this.redirectUri=t,this.fallbackUniversalRedirectUri=i?.redirect,this.showPrivyQrModal({native:t,universal:t})}if(this.redirectUri=void 0,this.walletEntry){let t=kP(e,this.walletEntry);this.fallbackUniversalRedirectUri=t?.redirect}this.showPrivyQrModal({native:e,universal:void 0})}),i.on("connect",()=>{i.session?.peer.metadata.url&&(this.walletEntry=(0,tQ.g)(i.session?.peer.metadata.url),this.walletClientType=this.walletEntry?.slug||"unknown")}),i}async enableProvider(){return this.walletProvider?.connected?Promise.resolve(this.walletProvider.accounts):await this.walletProvider?.enable()}setWalletEntry(e,t){this.walletEntry=e,this.showPrivyQrModal=t}constructor({walletConnectCloudProjectId:e,rpcConfig:t,chains:r,defaultChain:i,shouldEnforceDefaultChainOnConnect:n,privyAppId:s,privyAppName:a,walletClientType:o}){super(o||"unknown",r,i,t),this.connectorType="wallet_connect_v2",this.privyAppId=s,this.privyAppName=a,this.walletConnectCloudProjectId=e,this.rpcConfig=t,this.shouldEnforceDefaultChainOnConnect=n,this.proxyProvider=new tQ.P(void 0,this.rpcTimeoutDuration),o&&(this.walletEntry=(0,tQ.b)(o),this.walletClientType=o)}}let TA=["error","invalid_request_arguments","wallet_not_on_device","invalid_recovery_pin","insufficient_funds","missing_or_invalid_mfa","mfa_verification_max_attempts_reached","mfa_timeout","twilio_verification_failed"];class TS extends Error{constructor(e,t){super(t),this.type=e}}function Tx(e){let t=e.type;return"string"==typeof t&&TA.includes(t)}function TI(e){return Tx(e)&&"wallet_not_on_device"===e.type}function Tk(e){return Tx(e)&&("invalid_recovery_pin"===e.type||"invalid_request_arguments"===e.type)}function TT(e){return!!Tx(e)&&"mfa_timeout"===e.type}function TC(e){return!!Tx(e)&&"missing_or_invalid_mfa"===e.type}function TP(e){return!!Tx(e)&&"mfa_verification_max_attempts_reached"===e.type}function TO(e){return!(!Tx(e)||!e.message.includes("code 429"))}function TR(e){let t;return"string"==typeof(t=e.type)&&"client_error"===t&&"MFA canceled"===e.message}async function TN(e,t,r,i,n,s=!1){let a=s,o=async o=>{if(a&&t&&t.length>0){o===+!s?n("configureMfa","onMfaRequired",{mfaMethods:t}):i.current?.reject(new TS("missing_or_invalid_mfa","MFA verification failed, retry."));let a=await new Promise((e,t)=>{r.current={resolve:e,reject:t},setTimeout(()=>{let e=new TS("mfa_timeout","Timed out waiting for MFA code");i.current?.reject(e),t(e)},3e5)});return await e(a)}return await e()},l=null;for(let e=0;e<4;e++)try{l=await o(e),i.current?.resolve(void 0);break}catch(e){if("missing_or_invalid_mfa"!==e.type)throw i.current?.resolve(void 0),e;a=!0}if(null===l){let e=new TS("mfa_verification_max_attempts_reached","Max MFA verification attempts reached");throw i.current?.reject(e),e}return l}let TM=(CX=0,()=>"id-"+CX++);function TU(e){return void 0!==e.error}let TD=new class{enqueue(e,t){this.callbacks[e]=t}dequeue(e,t){let r=this.callbacks[t];if(!r)throw Error(`cannot dequeue ${e} event: no event found for id ${t}`);switch(delete this.callbacks[t],e){case"privy:iframe:ready":case"privy:user-signer:sign":case"privy:wallets:add":case"privy:wallets:import":case"privy:wallets:set-recovery":case"privy:wallets:connect":case"privy:wallets:recover":case"privy:wallets:rpc":case"privy:wallet:create":case"privy:mfa:verify":case"privy:mfa:init-enrollment":case"privy:mfa:submit-enrollment":case"privy:mfa:unenroll":case"privy:mfa:clear":case"privy:auth:unlink-passkey":case"privy:farcaster:init-signer":case"privy:farcaster:sign":case"privy:solana-wallet:create":case"privy:delegated-actions:consent":return r;default:throw Error(`invalid wallet event type ${e}`)}}constructor(){this.callbacks={}}},TL=new Map,Tj=(e,t)=>"bigint"==typeof t?t.toString():t;function TB(e,t,r,i){let n=r.contentWindow;if(!n)throw Error("iframe not initialized");let s=`${e}${JSON.stringify(t,Tj)}`;if("privy:wallet:create"===e){let e=TL.get(s);if(e)return e}let a=new Promise((r,s)=>{let a=TM();TD.enqueue(a,{resolve:r,reject:s}),n.postMessage({id:a,event:e,data:t},i)}).finally(()=>{TL.delete(s)});return TL.set(s,a),a}function TW(e){let t=(0,i8.c)(),r=(0,H.useRef)(null),i=(0,H.useRef)(e.mfaMethods),n=(0,st.a)(),[s,a]=(0,H.useState)(!1);return(0,H.useEffect)(()=>{i.current=e.mfaMethods},[e.mfaMethods]),(0,H.useEffect)(()=>{if(!s)return;let t=r.current;if(!t)return;function a(t){var r;t&&t.origin===e.origin&&"string"==typeof(r=t.data).event&&/^privy:.+/.test(r.event)&&function(e){switch(e.event){case"privy:iframe:ready":let t=TD.dequeue(e.event,e.id);return TU(e)?t.reject(new TS(e.error.type,e.error.message)):t.resolve(e.data);case"privy:user-signer:sign":{let t=TD.dequeue(e.event,e.id);return TU(e)?t.reject(new TS(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallets:add":{let t=TD.dequeue(e.event,e.id);return TU(e)?t.reject(new TS(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallets:set-recovery":{let t=TD.dequeue(e.event,e.id);return TU(e)?t.reject(new TS(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallets:connect":{let t=TD.dequeue(e.event,e.id);return TU(e)?t.reject(new TS(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallets:recover":{let t=TD.dequeue(e.event,e.id);return TU(e)?t.reject(new TS(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallets:rpc":{let t=TD.dequeue(e.event,e.id);return TU(e)?t.reject(new TS(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallet:create":let r=TD.dequeue(e.event,e.id);return TU(e)?r.reject(new TS(e.error.type,e.error.message)):r.resolve(e.data);case"privy:wallets:import":let i=TD.dequeue(e.event,e.id);return TU(e)?i.reject(new TS(e.error.type,e.error.message)):i.resolve(e.data);case"privy:mfa:verify":let n=TD.dequeue(e.event,e.id);return TU(e)?n.reject(new TS(e.error.type,e.error.message)):n.resolve(e.data);case"privy:mfa:init-enrollment":{let t=TD.dequeue(e.event,e.id);return TU(e)?t.reject(new TS(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:mfa:submit-enrollment":{let t=TD.dequeue(e.event,e.id);return TU(e)?t.reject(new TS(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:mfa:unenroll":{let t=TD.dequeue(e.event,e.id);return TU(e)?t.reject(new TS(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:mfa:clear":{let t=TD.dequeue(e.event,e.id);return TU(e)?t.reject(new TS(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:auth:unlink-passkey":{let t=TD.dequeue(e.event,e.id);return TU(e)?t.reject(new TS(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:solana-wallet:create":let s=TD.dequeue(e.event,e.id);return TU(e)?s.reject(new TS(e.error.type,e.error.message)):s.resolve(e.data);case"privy:farcaster:init-signer":{let t=TD.dequeue(e.event,e.id);return TU(e)?t.reject(new TS(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:farcaster:sign":{let t=TD.dequeue(e.event,e.id);return TU(e)?t.reject(new TS(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:delegated-actions:consent":{let t=TD.dequeue(e.event,e.id);return TU(e)?t.reject(new TS(e.error.type,e.error.message)):t.resolve(e.data)}default:console.warn("Unsupported wallet proxy method:",e)}}(t.data)}let o={signWithUserSigner:r=>TN(i=>TB("privy:user-signer:sign",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),addWallet:r=>TN(i=>TB("privy:wallets:add",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),setRecovery:r=>TN(i=>TB("privy:wallets:set-recovery",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),connect:r=>TN(i=>TB("privy:wallets:connect",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),recover:r=>TN(i=>TB("privy:wallets:recover",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n,!r.recoveryAccessToken&&!r.recoveryPassword&&!r.recoverySecretOverride),rpc:r=>TN(i=>TB("privy:wallets:rpc",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),create:r=>TB("privy:wallet:create",r,t,e.origin),importWallet:r=>TB("privy:wallets:import",r,t,e.origin),createSolana:r=>TN(i=>TB("privy:solana-wallet:create",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),createDelegatedAction:r=>TB("privy:delegated-actions:consent",r,t,e.origin),verifyMfa:r=>TN(i=>TB("privy:mfa:verify",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n,!0),initEnrollMfa:r=>TN(i=>TB("privy:mfa:init-enrollment",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),submitEnrollMfa:r=>TN(i=>TB("privy:mfa:submit-enrollment",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),unenrollMfa:r=>TN(i=>TB("privy:mfa:unenroll",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),clearMfa:r=>TB("privy:mfa:clear",r,t,e.origin),unlinkPasskeyAccount:r=>TN(i=>TB("privy:auth:unlink-passkey",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),initFarcasterSigner:r=>TB("privy:farcaster:init-signer",r,t,e.origin),signFarcasterMessage:r=>TB("privy:farcaster:sign",r,t,e.origin)};window.addEventListener("message",a);let l=new AbortController;return(0,tQ.i)(()=>TB("privy:iframe:ready",{},t,e.origin),{abortSignal:l.signal}).then(()=>e.onLoad(o),(...t)=>{console.warn("Privy iframe failed to load: ",...t),e.onLoadFailed()}),()=>{window.removeEventListener("message",a),l.abort()}},[s]),t?(0,F.jsx)("iframe",{ref:r,width:"0",height:"0",style:{display:"none",height:"0px",width:"0px"},onLoad:()=>a(!0),src:(0,_h.constructURL)({origin:e.origin,path:`/apps/${e.appId}/embedded-wallets`,query:{caid:e.clientAnalyticsId,client_id:e.appClientId}})}):null}let TF=e=>e.linkedAccounts.filter(e=>"wallet"===e.type&&"privy"===e.walletClientType&&e.delegated),TH="popup-privy-oauth",Tq="PRIVY_OAUTH_USE_BROADCAST_CHANNEL";class Tz{async authenticate(){if(!this.api)throw new t0.a("Auth flow has no API instance");try{return await this.api.post(nU,{authorization_code:this.meta.authorizationCode,state_code:this.meta.stateCode,code_verifier:this.meta.codeVerifier,provider:this.meta.provider})}catch(e){throw(0,t0.f)(e)}}async link(){if(!this.api)throw new t0.a("Auth flow has no API instance");try{return await this.api.post(nD,{authorization_code:this.meta.authorizationCode,state_code:this.meta.stateCode,code_verifier:this.meta.codeVerifier,provider:this.meta.provider})}catch(e){throw(0,t0.f)(e)}}constructor({authorizationCode:e,stateCode:t,codeVerifier:r,provider:i}){this.meta={authorizationCode:e,stateCode:t,codeVerifier:r,provider:i}}}async function T$({api:e,requesterAppId:t,providerAppId:r}){let i=(await e.get(`/api/v1/apps/${t}/cross-app/connections`)).connections.find(e=>e.provider_app_id===r);if(!i)throw new t0.a("Invalid connected app");return{name:i.provider_app_name,logoUrl:i.provider_app_icon_url||void 0,apiUrl:i.provider_app_custom_api_url,readOnly:i.read_only,customAuthAuthorizeUrl:i.provider_app_custom_auth_authorize_url,customAuthTransactUrl:i.provider_app_custom_auth_transact_url}}let TK=async({user:e,address:t,client:r,request:i,requesterAppId:n,reconnect:s})=>{r.createAnalyticsEvent({eventName:"cross_app_request_started",payload:{address:t,method:i.method}});let a=e?.linkedAccounts.find(e=>"cross_app"===e.type&&(e.embeddedWallets.some(e=>e.address===t)||e.smartWallets.some(e=>e.address===t)));if(!e||!a)throw r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"Cannot request a signature with this wallet address",address:t}}),new t0.a("Cannot request a signature with this wallet address");let o=r.getProviderAccessToken(a.providerApp.id),l=await T$({api:r.api,requesterAppId:n,providerAppId:a.providerApp.id});if(!o){if(l.readOnly)throw console.error("cannot transact against a read-only provider app"),new t0.a("Cannot transact against a read-only provider app");await s({appId:a.providerApp.id,action:"link"})&&(o=r.getProviderAccessToken(a.providerApp.id))}if(!o)throw r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"Transactions require a valid token",address:t}}),new t0.a("Transactions require a valid token");let c=new URL(l.customAuthTransactUrl||`${l.apiUrl}/oauth/transact`);c.searchParams.set("token",o||""),c.searchParams.set("request",TV(i));let d=(0,nr.trigger)({location:c.href});if(!d)throw r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"Missing token",address:t}}),new t0.a("Failed to initialize signature request");return new Promise((e,n)=>{let s=setTimeout(()=>{c(),n(new t0.a("Request timeout")),r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"Request timeout",address:t}})},12e4),o=setInterval(()=>{d.closed&&(c(),n(new t0.a("User rejected request")),r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"User rejected request",address:t}}))},300),l=s=>{s.data&&("set"===s.data.token?.action&&void 0!==s.data.token?.value?r.storeProviderAccessToken(a.providerApp.id,s.data.token.value):"clear"===s.data.token?.action&&r.storeProviderAccessToken(a.providerApp.id,null),"PRIVY_CROSS_APP_ACTION_RESPONSE"===s.data.type&&s.data.result&&(c(),e(s.data.result),r.createAnalyticsEvent({eventName:"cross_app_request_success",payload:{address:t,method:i.method}})),"PRIVY_CROSS_APP_ACTION_ERROR"===s.data.type&&s.data.error&&(c(),n(s.data.error),r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:s.data.error,address:t}})))};window.addEventListener("message",l);let c=()=>{d.close(),clearInterval(o),clearTimeout(s),window.removeEventListener("message",l)}})},TV=e=>JSON.stringify({content:{request:{request:TJ(e,i4.toHex)}},timestamp:Date.now(),callbackUrl:window.origin}),TJ=(e,t)=>"bigint"==typeof e?t(e):Array.isArray(e)?e.map(e=>TJ(e,t)):e&&"object"==typeof e?Object.fromEntries(Object.entries(e).map(([e,r])=>[e,TJ(r,t)])):e;function TZ({isCreatingWallet:e,skipSplashScreen:t}){return e?"EmbeddedWalletPasswordCreateScreen":t?"EmbeddedWalletPasswordUpdateScreen":"EmbeddedWalletPasswordUpdateSplashScreen"}function TG({walletAction:e,availableRecoveryMethods:t,legacySetWalletPasswordFlow:r,isResettingPassword:i,showAutomaticRecovery:n}){return n?"SetAutomaticRecoveryScreen":r||1===t.length?TZ({isCreatingWallet:"create"===e,skipSplashScreen:i}):"RecoverySelectionScreen"}function TY(e){switch(e){case"user-passcode":return"PasswordRecoveryScreen";case"google-drive":case"icloud":return"RecoveryOAuthScreen";default:throw Error("Recovery method not supported")}}function TQ(e,t,r,i,n,s,a){return{...e,funding:e?.funding?{...e.funding,fundingResult:{status:t,address:e.funding.address,fundingMethod:void 0,transactionHash:r,amount:e.funding.amount,assetType:n?s?.symbol||"ETH":a.nativeCurrency.symbol||"ETH",metadata:{walletClientType:i}}}:void 0,solanaFundingData:e?.solanaFundingData,sendTransaction:e?.sendTransaction}}let TX=new Map([["FundingMethodSelectionScreen",null],["TransferFromWalletScreen","external"],["FundingAmountEditScreen","external"],["ConnectOnlyLandingScreen","external"],["ConnectOnlyStatusScreen","external"],["AwaitingExternalEthereumTransferScreen","external"],["AwaitingEvmToSolBridgingScreen","external"],["AwaitingSolToEvmBridgingScreen","external"],["ManualTransferScreen","manual"],["MoonpayStatusScreen","moonpay"]]);function T0(e){let t=e.toLowerCase();return!!window?.webkit?.messageHandlers?.ReactNativeWebView||!!window?.ReactNativeWebView||["fbav","fban","instagram","snapchat","linkedinapp"].some(e=>t.includes(e))}async function T1({rpc:e,address:t}){return(await e.getBalance(t,{commitment:"confirmed"}).send()).value??0n}let T2={apple_oauth:"apple",custom_auth:"custom",discord_oauth:"discord",email:"email",farcaster:"farcaster",github_oauth:"github",google_oauth:"google",instagram_oauth:"instagram",linkedin_oauth:"linkedin",passkey:"passkey",phone:"sms",spotify_oauth:"spotify",telegram:"telegram",tiktok_oauth:"tiktok",line_oauth:"line",twitch_oauth:"twitch",twitter_oauth:"twitter",wallet:"siwe",smart_wallet:"siwe",cross_app:"privy:"},T3=e=>{if((0,tG.i)(e))return{displayName:e.replace("custom:",""),loginMethod:"custom"};let t=T2[e];return"wallet"===e||"phone"===e?{displayName:e,loginMethod:t}:{displayName:t,loginMethod:t}},T5=(e,t)=>!(0,tG.b)(e)&&("all-users"===t||"users-without-wallets"===t&&!T8(e).length),T8=e=>e.linkedAccounts.filter(e=>"wallet"===e.type&&"ethereum"===e.chainType),T6=(e,t)=>!(0,tG.c)(e)&&("all-users"===t||"users-without-wallets"===t&&!T4(e).length),T4=e=>e.linkedAccounts.filter(e=>"wallet"===e.type&&"solana"===e.chainType);async function T7(e,t,r,i){let n=(0,i5.toViemTransactionSerializable)(e),s=await (async()=>i?await i():await t.prepareTransactionRequest({...n,account:{address:r,type:"json-rpc"}}))();return{...s,type:i5.STRING_TO_NUMBER_TXN_TYPE[s.type]}}let T9=({disabled:e})=>{let{migrate:t}=(()=>{let e=(0,i8.u)(),{user:t}=(0,tG.u)(),{client:r,refreshSessionAndUser:i,walletProxy:n}=(0,t0.u)();return{migrate:(0,H.useCallback)(async()=>{if("legacy-embedded-wallets-only"===e.embeddedWallets.mode)return{success:!0};if(!t)throw new t0.a("User must be authenticated before migrating wallets",t0.b.MUST_BE_AUTHENTICATED);if(!n)throw new t0.a("Cannot connect to wallet proxy");let s=await r.getAccessToken();if(!s)throw new t0.a("User must be authenticated before migrating wallets",t0.b.MUST_BE_AUTHENTICATED);let a=t.linkedAccounts.filter(e=>"wallet"===e.type&&"privy"===e.walletClientType&&(0,t1.i)(e)&&!(0,tG.d)(e));if(0===a.length)return{success:!0};let o=a.filter(e=>e.imported),l=a.filter(e=>!e.imported);if(l.length>0){let e=l.find(e=>"ethereum"===e.chainType&&0===e.walletIndex)??l.find(e=>"solana"===e.chainType&&0===e.walletIndex)??null;if(!e)throw new t0.a("Primary wallet not found");let{entropyId:t,entropyIdVerifier:r}=(0,tX.t)(e);try{await n.connect({accessToken:s,entropyId:t,entropyIdVerifier:r})}catch(i){if(!TI(i)||"privy"!==e.recoveryMethod)throw i;await n.recover({accessToken:s,entropyId:t,entropyIdVerifier:r})}await n.createDelegatedAction({accessToken:s,rootWallet:{address:e.address,chainType:e.chainType,imported:!1},delegatedWallets:l.map(e=>({address:e.address,chainType:e.chainType,walletIndex:e.walletIndex??0}))})}for(let e of o){let{entropyId:t,entropyIdVerifier:r}=(0,tX.t)(e);try{await n.connect({accessToken:s,entropyId:t,entropyIdVerifier:r})}catch(i){if(!TI(i)||"privy"!==e.recoveryMethod)throw i;await n.recover({accessToken:s,entropyId:t,entropyIdVerifier:r})}await n.createDelegatedAction({accessToken:s,rootWallet:{address:e.address,chainType:e.chainType,imported:!0},delegatedWallets:[{address:e.address,chainType:e.chainType,walletIndex:e.walletIndex??0}]})}return await i(),{success:!0}},[e.embeddedWallets.mode,t,n,r,i])}})(),{user:r}=(0,tG.u)(),{walletProxy:i}=(0,t0.u)(),n=(0,H.useRef)(!1);return(0,H.useEffect)(()=>{!e&&!n.current&&r&&i&&(n.current=!0,t().catch(e=>{console.debug("Unable to migrate wallets: ",e)}).finally(()=>{n.current=!1}))},[r,i,e,t]),null},Ce=(0,sr.create)(()=>({ethereum:[]}));class Ct{async authenticate(){if(!this.api)throw new t0.a("Auth flow has no API instance");try{return await this.api.post(nX,{token:this.meta.token})}catch(e){throw(0,t0.f)(e)}}async link(){if(!this.api)throw new t0.a("Auth flow has no API instance");try{return await this.api.post(n0,{token:this.meta.token})}catch(e){throw(0,t0.f)(e)}}constructor(e){this.meta={token:e}}}let Cr=(0,sr.create)(()=>({jwtAuthFlowState:{status:"not-enabled"}}));function Ci({customAuth:e}){let{jwtAuthFlowState:t}=function({customAuth:e}){let t=(0,st.a)(),r=(0,H.useRef)(),i=(0,H.useCallback)(e=>(r.current=e,()=>{r.current=void 0}),[]),n=e?.getCustomAccessToken??(()=>Promise.resolve(void 0)),{state:s}=function({subscribe:e,getExternalJwt:t,enabled:r=!0,onAuthenticated:i,onUnauthenticated:n,onError:s}){let{client:a,onCustomAuthAuthenticated:o}=(0,t0.u)(),{logout:l,authenticated:c,ready:d}=(0,n9.u)();if(!a)throw new t0.a("`useSyncJwtBasedAuthState` must be used within a `PrivyProvider`");let[u,h]=(0,H.useState)({status:"initial"}),p=(0,H.useRef)(),f=(0,H.useRef)(!1),y=(0,H.useRef)(t);(0,H.useEffect)(()=>{y.current=t},[t]);let g=(0,H.useRef)(i);(0,H.useEffect)(()=>{g.current=i},[i]);let m=(0,H.useRef)(n);(0,H.useEffect)(()=>{m.current=n},[n]);let w=(0,H.useRef)(s);return(0,H.useEffect)(()=>{w.current=s},[s]),(0,H.useEffect)(()=>{if(!r||!d)return;let t=async()=>{if(!f.current){f.current=!0;try{h({status:"loading"});let e=await y.current();if(void 0!==p.current&&p.current===e)return void h({status:"done"});if(!e)return c&&(await l(),m.current?.()),p.current=e,void h({status:"done"});a.startAuthFlow(new Ct(e));let{user:t,isNewUser:r=!1}=await a.authenticate();if(!t)throw new t0.a("Failed to sync with custom auth provider");g.current?.({user:t,isNewUser:r}),o(t,r),p.current=e,h({status:"done"})}catch(e){if(console.warn(e),await l().catch(()=>{}),m.current?.(),e instanceof t0.e&&e.privyErrorCode===t0.b.LINKED_TO_ANOTHER_USER)return h({status:"initial"}),void setTimeout(()=>{t()},0);w.current?.(e),h({status:"error",error:e})}finally{f.current=!1}}};return t(),e(t)},[e,a,o,c,l,r,d]),r?{state:u}:{state:{status:"not-enabled"}}}({enabled:!0===e?.enabled,subscribe:i,getExternalJwt:n,onAuthenticated:({user:e,isNewUser:r})=>{t("login","onComplete",{user:e,isNewUser:r,wasAlreadyAuthenticated:!1,loginMethod:"custom",loginAccount:null}),t("customAuth","onAuthenticated",{user:e})},onUnauthenticated:()=>{t("customAuth","onUnauthenticated")},onError:e=>{t("login","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR)}});return(0,H.useEffect)(()=>{(async()=>{e&&!e.isLoading&&r.current?.()})()},[e?.enabled,e?.getCustomAccessToken,e?.isLoading]),{jwtAuthFlowState:s}}({customAuth:e});return(0,H.useEffect)(()=>{Cr.setState({jwtAuthFlowState:t})},[t]),null}let Cn=(0,H.createContext)(!1),Cs=t=>{let r=t.client,i=t.privy,n=(0,n9.a)(),d=(0,i8.u)();(0,tQ.d)((0,tQ.e)(d?.appearance.walletList??[]));let[u,h]=(0,H.useState)(!1),p=Tr(e=>e.inProgressMfaFlow),[f,y]=(0,H.useState)(!1),[g,m]=(0,H.useState)(null),w=Ce(e=>e.ethereum),[b,v]=(0,H.useState)(void 0),[E,_]=(0,H.useState)(!1),[A,S]=(0,H.useState)(null),[x,I]=(0,H.useState)(!1),[k,T]=(0,H.useState)({status:"disconnected",connectedWallet:null,connectError:null,connector:null,connectRetry:t0.n}),[C,P]=(0,H.useState)({status:"initial"}),[O,R]=(0,H.useState)({status:"initial"}),[N,M]=(0,H.useState)({status:"initial"}),[U,D]=(0,H.useState)({status:"initial"}),[L,j]=(0,H.useState)({status:"initial"}),[B,W]=(0,H.useState)({status:"initial"}),[q,z]=(0,H.useState)(null),K=(0,i8.c)(),[V,J]=(0,H.useState)({}),[Z,G]=(0,H.useState)(null),Y=(0,H.useRef)(null),[Q,X]=(0,H.useState)(!1),[ee,et]=(0,H.useState)(!1),er=(0,H.useRef)(null),ei=(0,H.useRef)(null),en=(0,H.useRef)(st.p),[es,ea]=(0,H.useState)(!1),[eo,el]=(0,H.useState)(!1),ec=(0,H.useCallback)(e=>{el(e),!e&&A&&Tt[A]().then(e=>{e.default.isUnauthenticatedScreem&&S(null)})},[A]);r.onStoreCustomerAccessToken=e=>{e&&(0,st.e)(en,"accessToken","onAccessTokenGranted",{accessToken:e})},r.onDeleteCustomerAccessToken=()=>{m(null),ec(!1),(0,st.e)(en,"accessToken","onAccessTokenRemoved")};let ed=(0,H.useRef)(null),eu=(0,H.useRef)(null),eh=(0,H.useRef)(!1),ep=({showWalletUIs:e})=>eh.current?eh.current:void 0!==e?!e:!d.embeddedWallets.showWalletUIs,ef=e=>{S(e),setTimeout(()=>{h(!0)},15)};(0,H.useEffect)(()=>{if(!g)return void r.connectors?.removeEmbeddedWalletConnectors();let e=(0,tG.b)(g),n=(0,tG.e)(g),s=(0,tG.f)(g);e&&n.length||r.connectors?.removeEmbeddedWalletConnectors(),s.length||r.connectors?.removeImportedWalletConnectors(),r.connectors?q?(e&&r.connectors.addEmbeddedWalletConnectors({walletProxy:q,user:g,embeddedWallets:n,defaultChain:d.defaultChain,appId:t.appId,privyClient:i}),s.forEach(e=>r.connectors?.addImportedWalletConnector(q,e.address,d.defaultChain,t.appId))):console.debug("Failed to add embedded wallet connector: Wallet proxy not initialized"):console.debug("Failed to add embedded wallet connector: Client connectors not initialized")},[q,g]),(0,H.useEffect)(()=>{q&&Y.current?.(q)},[q]);let ey=(0,H.useCallback)((e,t)=>{m(e),_(t),ec(!0),et(!0)},[]);(0,H.useEffect)(()=>{ee&&q&&g&&(async()=>{let e=T5(g,d.embeddedWallets.ethereum.createOnLogin),t=T6(g,d.embeddedWallets.solana.createOnLogin),r=await kS();if(r){if(e&&t){let e=await q.create({accessToken:r});return await q.createSolana({accessToken:r,ethereumAddress:e?.address}),void et(!1)}if(t)return await q.createSolana({accessToken:r,ethereumAddress:(0,tG.b)(g)?.address}),await eR.refreshSessionAndUser(),void et(!1);if(e)return await q.create({accessToken:r}),void et(!1)}})().catch(console.error)},[ee&&q&&g]),(0,H.useEffect)(()=>{if(d.externalWallets.solana.connectors)return d.externalWallets.solana.connectors.onMount(),()=>d.externalWallets.solana.connectors?.onUnmount()},[d.externalWallets.solana.connectors]),(0,H.useEffect)(()=>{!f&&K&&async function(){let e,t,i,n,s,a=eg(),o=em(),l=(e=new Set,t=[],n=(i=()=>(function(e){if("undefined"==typeof window)return;let t=t=>e(t.detail);return window.addEventListener("eip6963:announceProvider",t),window.dispatchEvent(new CustomEvent("eip6963:requestProvider")),()=>window.removeEventListener("eip6963:announceProvider",t)})(r=>{t.some(({info:e})=>e.uuid===r.info.uuid)||(t=[...t,r],e.forEach(e=>e(t,{added:[r]})))}))(),{_listeners:()=>e,clear(){e.forEach(e=>e([],{removed:[...t]})),t=[]},destroy(){this.clear(),e.clear(),n?.()},findProvider:({rdns:e})=>t.find(t=>t.info.rdns===e),getProviders:()=>t,reset(){this.clear(),n?.(),n=i()},subscribe:(r,{emitImmediately:i}={})=>(e.add(r),i&&r(t,{added:t}),()=>e.delete(r))});r.initializeConnectorManager({walletConnectCloudProjectId:d.walletConnectCloudProjectId,rpcConfig:d.rpcConfig,chains:d.chains,defaultChain:d.defaultChain,store:l,walletList:d.appearance.walletList,shouldEnforceDefaultChainOnConnect:d.shouldEnforceDefaultChainOnConnect,externalWalletConfig:d.externalWallets,appName:d.name??"Privy",walletChainType:d.appearance.walletChainType,setBaseAccountSdk:v}),r.connectors?.on("connectorInitialized",()=>{s&&clearTimeout(s);let e=r.connectors.walletConnectors.length,t=r.connectors.walletConnectors.reduce((e,t)=>e+ +!!t.initialized,0);t===e?ea(!0):s=setTimeout(()=>{console.debug({message:"Unable to initialize all expected connectors before timeout",initialized:t,expected:e}),ea(!0)},1500)}),r.connectors?.initialize().then(()=>{e_()});let c=await r.getAuthenticatedUser(),u=!!c;d.legal.requireUsersAcceptTerms&&c&&!c.hasAcceptedTerms?(await r.logout(),eR.setReadyToTrue(!0),(0,st.e)(en,"logout","onSuccess")):(d.customAuth?.enabled||(ec(!!c),c&&(0,st.e)(en,"login","onComplete",{user:c,isNewUser:!1,wasAlreadyAuthenticated:!0,loginMethod:null,loginAccount:null}),m(c)),a?eu.current=u?"link":"login":o&&!u?(eu.current="login",J({telegramAuthModalData:{seamlessAuth:!0}}),ef("TelegramAuthScreen")):eR.setReadyToTrue(!!c))}()},[r,Z,f,K]),(0,H.useEffect)(()=>{if(f){if(!g||!g.linkedAccounts.find(e=>"wallet"===e.type&&"privy"===e.walletClientType))return void X(!!q);if([...w].some(e=>"privy"===e.walletClientType))return void X(!0);X(!!q)}},[f,g,w,q]),(0,H.useEffect)(()=>{r.connectors?.setWalletList(d.appearance.walletList)},[d.appearance.walletList.join()]);let eg=()=>{let e=function(){let e=new URLSearchParams(window.location.search),t=e.get("privy_oauth_code"),r=e.get("privy_oauth_state"),i=e.get("privy_oauth_provider");if(!t||!r||!i)return{inProgress:!1};let n=!1;try{n=!!window.opener.location.origin}catch{}return{inProgress:!0,authorizationCode:t,stateCode:r,provider:i,withPrivyUi:!t1.u.get(i8.H),popupFlow:null!==window.opener&&n,disableSignup:!!t1.u.get(i8.O)}}();return e.inProgress&&e.popupFlow?window.opener.location.origin!==window.location.origin?void window.opener.postMessage({type:"PRIVY_OAUTH_ERROR",error:"Origins between parent and child windows do not match."}):"error"===e.authorizationCode?void window.opener.postMessage({type:"PRIVY_OAUTH_ERROR",error:"Something went wrong. Try again."}):void window.opener.postMessage({type:"PRIVY_OAUTH_RESPONSE",stateCode:e.stateCode,authorizationCode:e.authorizationCode}):(e.inProgress&&e.provider.startsWith("privy:")&&!e.popupFlow&&(new BroadcastChannel(TH).postMessage({type:"PRIVY_OAUTH_RESPONSE",stateCode:e.stateCode,authorizationCode:e.authorizationCode}),window.close()),!!e.inProgress&&!!e.withPrivyUi&&(r.startAuthFlow(new kK({...e,customOAuthRedirectUrl:d.customOAuthRedirectUrl})),ef("OAuthStatusScreen"),!0))},em=()=>{let e,t=(e=function(){let e=new URLSearchParams(window.location.search),t=Number(e.get("id")||""),r=e.get("hash"),i=Number(e.get("auth_date")||""),n=e.get("first_name");if(t&&n&&i&&r)return Object.fromEntries(e.entries())}())?(k4(),{flowType:"login-url",authData:e}):(e=function(){let e=window.location.hash;if(!e||!e.startsWith("#tgWebAppData"))return;let t=k6(e.replace("#tgWebAppData=","")),{user:r,auth_date:i,hash:n}=t;return r&&i&&n?t:void 0}())?(k4(),{flowType:"web-app",authData:e}):void 0;if(!t||!d.loginMethods.telegram||!d.loginConfig.telegramAuthConfiguration?.seamlessAuthEnabled)return;let i=new k5;return r.startAuthFlow(i),"login-url"===t.flowType&&(i.meta.telegramWebAppData=void 0,i.meta.telegramAuthResult=t.authData),"web-app"===t.flowType&&(i.meta.telegramAuthResult=void 0,i.meta.telegramWebAppData=t.authData),!0},ew=async(e,t,i,n)=>{if("solana_adapter"!==e)eb(await r.connectors?.createEthereumWalletConnector({connectorType:e,walletClientType:t})||null,t,i,n);else{let e=r.connectors?.findSolanaWalletConnector(t);if(!e)return;eb(e,t,i,n)}};async function eb(e,t,r,i){if(!e)return T({status:"disconnected",connectedWallet:null,connectError:new t0.P("Unable to connect to wallet."),connector:null,connectRetry:t0.n}),i?.(null,r);T({status:"disconnected",connectedWallet:null,connectError:null,connector:e,connectRetry:t0.n}),e instanceof T_&&t&&await e.resetConnection(t),T({connector:e,status:"connecting",connectedWallet:null,connectError:null,connectRetry:()=>eb(e,t,r,i)});try{let t=await e.connect({showPrompt:!0});if((!t||(0,tQ.f)(t))&&d.shouldEnforceDefaultChainOnConnect&&!d.chains.find(e=>e.id===Number(t?.chainId.replace("eip155:","")))&&("wallet_connect_v2"!==t?.connectorType||"metamask"!==t?.walletClientType)){T(t=>({...t,connector:e,status:"switching_to_supported_chain",connectedWallet:null,connectError:null,connectRetry:t0.n}));try{await t?.switchChain(d.defaultChain.id),t&&(t.chainId=(0,tQ.h)((0,i4.toHex)(d.defaultChain.id)))}catch{console.warn(`Unable to switch to default chain: ${d.defaultChain.id}`)}}return T(e=>({...e,status:"connected",connectedWallet:t,connectError:null,connectRetry:t0.n})),t&&(0,st.e)(en,"connectWallet","onSuccess",{wallet:t}),i?.(t,r)}catch(e){return e instanceof t0.c?(console.warn(e.cause?e.cause:e.message),(0,st.e)(en,"connectWallet","onError",e.privyErrorCode||t0.b.GENERIC_CONNECT_WALLET_ERROR)):(console.warn(e),(0,st.e)(en,"connectWallet","onError",t0.b.UNKNOWN_CONNECT_WALLET_ERROR)),T(t=>({...t,status:"disconnected",connectedWallet:null,connectError:e})),i?.(null,r)}}let ev=async(e,t,i)=>{if(null===e||!(0,tQ.f)(e))return;let n=new kG(r,e,t,i);r.startAuthFlow(n)},eE=async(e,t,i,s="plain")=>{let a=n(n9.b);if("transaction"===s&&!a)throw new t0.a("useSolanaLedger plugin hook must be mounted");if(null===e||!(0,tQ.l)(e))return;let o=new kY(e,r,t,i,s,a);r.startAuthFlow(o)},e_=async()=>{let e=new URLSearchParams(window.location.search),t=e.get("privy_connector"),i=e.get("privy_wallet_client"),n="true"===e.get("privy_connect_only");if(!t||!i)return;let s=(0,tQ.n)({connectorType:t,walletClientType:i});if(!s||!s.isInstalled)return ef("LoginFailedScreen");if(!r.connectors)throw new t0.a("Connector not initialized");await ef(n?"ConnectOnlyStatusScreen":"ConnectionStatusScreen");let a=new URL(window.location.href);a.searchParams.delete("privy_connector"),a.searchParams.delete("privy_wallet_client"),a.searchParams.delete("privy_connect_only"),window.history.pushState({},"",a),ew(t,i,void 0,n?void 0:"solana_adapter"===t?eE:ev)};(0,H.useEffect)(()=>{f&&eo&&null===g&&r.getAuthenticatedUser().then(m)},[f,eo,g,r]);let eA=e=>{if(!eo)throw(0,st.e)(en,"linkAccount","onError",t0.b.MUST_BE_AUTHENTICATED,{linkMethod:e}),new t0.a("User must be authenticated before linking an account.")},eS=()=>{Ce.setState(e=>{let t=r.connectors?.wallets.filter(tQ.f).map(e=>({...e,linked:(e=>{if(!eo||!g)return!1;if("privy"===e.walletClientType)return!0;for(let t of g.linkedAccounts)if("wallet"===t.type&&t.address===e.address&&"privy"!==t.walletClientType)return!0;return!1})(e),loginOrLink:async()=>{if(!await e.isConnected())throw new t0.a("Wallet is not connected");if("embedded"===e.connectorType&&"privy"===e.walletClientType)throw new t0.a("Cannot link or login with embedded wallet");(async e=>{let t;if(!r.connectors)throw new t0.a("Connector not initialized");t="ethereum"===e.type?r.connectors.findWalletConnector(e.connectorType,e.walletClientType)||null:r.connectors.findSolanaWalletConnector(e.walletClientType)||null,T(r=>({...r,connector:t,status:"connected",connectedWallet:e,connectError:null,connectRetry:t0.n})),d.captcha.enabled&&!eo?(J({captchaModalData:{callback:t=>(0,tQ.f)(e)?ev(e,t):eE(e,t),userIntentRequired:!1,onSuccessNavigateTo:"ConnectionStatusScreen",onErrorNavigateTo:"ErrorScreen"}}),await ef("CaptchaScreen")):((0,tQ.f)(e)?await ev(e):await eE(e),await ef("ConnectionStatusScreen"))})(e)},fund:async t=>{await eR.fundWallet(e.address,t)},unlink:async()=>{if(!eo)throw new t0.a("User is not authenticated.");if("embedded"===e.connectorType&&"privy"===e.walletClientType)throw new t0.a("Cannot unlink an embedded wallet");m(await r.unlinkEthereumWallet(e.address))}}))||[];return(0,tQ.j)(e.ethereum,t)?{}:{ethereum:t}})};(0,H.useEffect)(()=>{eS()},[g?.linkedAccounts,eo,f]),(0,H.useEffect)(()=>{if(f){if(!r.connectors)throw new t0.a("Connector not initialized");eS(),r.connectors.on("walletsUpdated",eS)}},[f]),(0,H.useEffect)(()=>{[...d.loginMethodsAndOrder?.primary??[],...d.loginMethodsAndOrder?.overflow??[]].filter(e=>e.startsWith("privy:")).forEach(e=>r.getCrossAppProviderDetails(e.replace("privy:","")))},[!!r]);let ex=({transaction:e,sponsor:n,uiOptions:s,fundWalletConfig:a,address:o,signOnly:l})=>new Promise(async(c,u)=>{let{requesterAppId:h}=s||{},p=l?"signTransaction":"sendTransaction",f=o?(0,tG.h)(g,o):(0,tG.b)(g);if(!f&&o){let t=(0,tG.k)(Ce.getState().ethereum,o);if(t){if(n)throw new t0.a("Cannot sponsor transactions for externally connected wallet.");try{let r=await t.getEthereumProvider(),i={...e,from:o,chainId:e.chainId||Number(t.chainId.replace("eip155:","")),value:void 0!==e.value?(0,i4.toHex)(e.value):void 0},n=await r.request({method:"sendTransaction"===p?"eth_sendTransaction":"eth_signTransaction",params:[i]});return(0,st.e)(en,p,"onSuccess",{hash:n}),void c({hash:n})}catch(e){return(0,st.e)(en,p,"onError",t0.b.TRANSACTION_FAILURE),void u(e??new t1.P("Unable to "+p+e))}}}if(!f)return(0,st.e)(en,p,"onError",t0.b.EMBEDDED_WALLET_NOT_FOUND),void u(new t0.a("No embedded or connected wallet found for address."));if(!eo||!g)return(0,st.e)(en,p,"onError",t0.b.MUST_BE_AUTHENTICATED),void u(Error("User must be authenticated before signing with a Privy wallet"));let y=f.address,m=f.walletIndex??0,{entropyId:w,entropyIdVerifier:b}=(0,tX.g)(g,f),v=eN.wallets.find(e=>"privy"===e.walletClientType&&(0,i9.getAddress)(e.address)===(0,i9.getAddress)(y));if(!v)return(0,st.e)(en,p,"onError",t0.b.EMBEDDED_WALLET_NOT_FOUND),void u(Error("Must have a Privy wallet before signing"));let E=await v.getEthereumProvider(),_=await E.request({method:"eth_chainId"}),A=e.chainId?Number(e.chainId):(0,t1.b)(_);if(!d.chains.map(e=>e.id).includes(A))throw new t0.P(`Chain ID ${A} is not supported. It must be added to the config.supportedChains property of the PrivyProvider.`,t0.b.UNSUPPORTED_CHAIN_ID);let S={...e,from:e.from??y,chainId:A},x=await kS();if(!x||!q)return(0,st.e)(en,p,"onError",t0.b.EMBEDDED_WALLET_NOT_FOUND),void u(Error("Must have valid access token and Privy wallet to send transaction"));let I=(0,_y.g)(S.chainId,d.chains,d.rpcConfig,{appId:t.appId}),k=(0,tG.d)(f),T=async({transactionRequest:e})=>{try{let t;if(!await eR.recoverEmbeddedWallet({address:y}))throw(0,st.e)(en,p,"onError",t0.b.UNKNOWN_CONNECT_WALLET_ERROR),u(Error("Unable to connect to wallet")),Error("Unable to connect to wallet");if(n){let t=await (async({transactionRequest:e})=>{if(!k)throw new t0.a("Sponsoring is only supported for wallets on the TEE stack");if(l)throw new t0.a("Cannot sponsor a sign transaction request");let t=e=>null==e?void 0:(0,i4.toHex)(e),r=await (0,$.rpc)(i,async({message:e})=>await q.signWithUserSigner({accessToken:x,requesterAppId:h,message:e}),{chain_type:"ethereum",method:"eth_sendTransaction",caip2:(0,tQ.h)((0,i4.toHex)(e.chainId)),sponsor:!0,params:{transaction:{from:e.from,to:e.to,chain_id:t(e.chainId),data:(0,ne.isHex)(e.data)?e.data?e.data:(0,i4.toHex)(Uint8Array.from(e.data)):void 0,value:t(e.value)}},wallet_id:f.id});if(r.data&&"hash"in r.data)return r.data.hash;throw new t1.P("Unable to sign transaction")})({transactionRequest:e});return(0,st.e)(en,"sendTransaction","onSuccess",{hash:t}),t}if(k){let r=e=>null==e?void 0:(0,i4.toHex)(e),n=await (0,$.rpc)(i,async({message:e})=>await q.signWithUserSigner({accessToken:x,requesterAppId:h,message:e}),{chain_type:"ethereum",method:"eth_signTransaction",params:{transaction:{from:e.from,to:e.to,nonce:r(e.nonce),chain_id:r(e.chainId),data:(0,ne.isHex)(e.data)?e.data?e.data:(0,i4.toHex)(Uint8Array.from(e.data)):void 0,value:r(e.value),type:e.type,gas_limit:r(e.gasLimit??e.gas),gas_price:r(e.gasPrice??e.gas),max_fee_per_gas:r(e.maxFeePerGas),max_priority_fee_per_gas:r(e.maxPriorityFeePerGas)}},wallet_id:f.id});if(!n.data||!("signed_transaction"in n.data))throw new t1.P("Unable to sign transaction");t=n.data.signed_transaction}else t=await async function({accessToken:e,entropyId:t,entropyIdVerifier:r,transactingWalletIndex:i,walletProxy:n,transactionRequest:s,requesterAppId:a}){return(await n.rpc({entropyId:t,entropyIdVerifier:r,hdWalletIndex:i??0,chainType:"ethereum",accessToken:e,requesterAppId:a,request:{method:"eth_signTransaction",params:[s]}})).response.data}({accessToken:x,entropyId:w,entropyIdVerifier:b,transactingWalletIndex:m,walletProxy:q,transactionRequest:e,requesterAppId:h});if(l)return(0,st.e)(en,"signTransaction","onSuccess",{signature:t}),t;{let e=await I.sendRawTransaction({serializedTransaction:t});return(0,st.e)(en,"sendTransaction","onSuccess",{hash:e}),e}}catch(e){throw(0,st.e)(en,p,"onError",t0.b.TRANSACTION_FAILURE),e}};if(ep({showWalletUIs:s?.showWalletUIs})){let e=l||n?S:await T7(S,I,S.from);try{let t=await T({transactionRequest:e});l?(0,st.e)(en,"signTransaction","onSuccess",{signature:t}):(0,st.e)(en,"sendTransaction","onSuccess",{hash:t}),c({hash:t})}catch(e){(0,st.e)(en,p,"onError",t0.b.TRANSACTION_FAILURE),u(e)}}else{let e={connectingWalletAddress:y,recoveryMethod:f.recoveryMethod,entropyId:w,entropyIdVerifier:b,onCompleteNavigateTo:"SendTransactionScreen",isUnifiedWallet:k,onFailure:e=>{(0,st.e)(en,p,"onError",t0.b.UNKNOWN_CONNECT_WALLET_ERROR),u(e)}},t=d.fundingConfig&&(0,t1.a)(d.fundingConfig.options).length>=1?(0,t1.p)({address:y,appConfig:d,fundWalletConfig:a,methodScreen:"FundingMethodSelectionScreen",chainIdOverride:S.chainId,comingFromSendTransactionScreen:!0}):void 0;J({connectWallet:e,sendTransaction:{transactionRequest:S,transactingWalletIndex:m,transactingWalletAddress:y,entropyId:w,entropyIdVerifier:b,signOnly:l,scanTransaction:async()=>{let e=await T7(S,I,S.from);return await r.scanTransaction({metadata:{domain:d.embeddedWallets.transactionScanning.domain},chain_id:e.chainId.toString(),request:{method:"eth_sendTransaction",params:[{from:e.from,to:e.to,value:e.value?.toString(),gas:e.gas?.toString(),gasPrice:e.gasPrice?.toString(),nonce:e.nonce?.toString(),data:e.data}]}})},getIsSponsored:async()=>!!n,onConfirm:({transactionRequest:e})=>T({transactionRequest:e}),onSuccess:e=>{l?(0,st.e)(en,"signTransaction","onSuccess",{signature:e.hash}):(0,st.e)(en,"sendTransaction","onSuccess",{hash:e.hash}),c(e)},onFailure:e=>{(0,st.e)(en,p,"onError",t0.b.TRANSACTION_FAILURE),u(e)},uiOptions:s||{},fundWalletConfig:a,requesterAppId:h},funding:t}),ef("EmbeddedWalletConnectingScreen")}});function eI(){return new Promise(async(e,t)=>{let r=await kS();if(!r||!q)throw Error("Must have valid access token to enroll in MFA");try{await q.verifyMfa({accessToken:r}),e()}catch(e){t(e)}})}let ek=e=>e?.linkedAccounts.filter(e=>null!==e.latestVerifiedAt&&("wallet"!==e.type||"privy"!==e.walletClientType)).sort((e,t)=>t.latestVerifiedAt.getTime()-e.latestVerifiedAt.getTime())[0],eT=e=>{let t=g?.linkedAccounts.filter(t=>t.type===e).length??0,{displayName:r,loginMethod:i}=T3(e);if("passkey"===e&&t>=5||"passkey"!==e&&t>=1)throw(0,st.e)(en,"linkAccount","onError",t0.b.CANNOT_LINK_MORE_OF_TYPE,{linkMethod:i}),new t0.a(`User already has an account of type ${r} linked.`)};async function eC({showAutomaticRecovery:e=!1,legacySetWalletPasswordFlow:t=!1}){S(null);let r=t?"setWalletPassword":"setWalletRecovery";if(!eo||!g)throw(0,st.e)(en,r,"onError",t0.b.MUST_BE_AUTHENTICATED),Error("User must be authenticated before adding recovery method to Privy wallet");let i=(0,tG.g)(g);if(!i||!q)throw(0,st.e)(en,r,"onError",t0.b.EMBEDDED_WALLET_NOT_FOUND),Error("Must have a Privy wallet to add a recovery method");let n=(0,tG.d)(i);if(n)throw(0,st.e)(en,r,"onError",t0.b.UNSUPPORTED_WALLET_TYPE),new t0.a("User owned wallet recovery is only supported for on-device execution and this app uses TEE execution. Learn more https://docs.privy.io/recipes/tee-wallet-migration-guide");try{await eI()}catch(e){throw(0,st.e)(en,r,"onError",t0.b.MISSING_MFA_CREDENTIALS),e}return new Promise((s,a)=>{let o="user-passcode"===i.recoveryMethod,l=TG({walletAction:"update",availableRecoveryMethods:d.embeddedWallets.userOwnedRecoveryOptions,legacySetWalletPasswordFlow:t,isResettingPassword:o,showAutomaticRecovery:e}),{entropyId:c,entropyIdVerifier:u}=(0,tX.g)(g),h={recoveryMethod:i.recoveryMethod,connectingWalletAddress:i.address,onCompleteNavigateTo:l,shouldForceMFA:!1,entropyId:c,isUnifiedWallet:n,entropyIdVerifier:u,onFailure:e=>{(0,st.e)(en,r,"onError",t0.b.UNKNOWN_CONNECT_WALLET_ERROR),a(e)}};J({setWalletPassword:{onSuccess:e=>{(0,st.e)(en,r,"onSuccess",{method:"user-passcode",wallet:e}),s(e)},onFailure:e=>{(0,st.e)(en,r,"onError",t0.b.USER_EXITED_SET_PASSWORD_FLOW),a(e)},callAuthOnSuccessOnClose:!1},recoverWallet:{entropyId:c,entropyIdVerifier:u,onFailure:a},connectWallet:h,recoverySelection:{isInAccountCreateFlow:!1,isResettingPassword:o,shouldCreateEth:!1,shouldCreateSol:!1}}),ef("EmbeddedWalletConnectingScreen")})}async function eP({appId:e,action:t}){let i=await kS();if("link"===t&&!i)throw(0,st.e)(en,"linkAccount","onError",t0.b.MUST_BE_AUTHENTICATED,{linkMethod:`privy:${e}`}),new t0.a("User must be authenticated before linking an account.");if("login"===t&&i)throw(0,st.e)(en,"login","onError",t0.b.UNKNOWN_AUTH_ERROR),new t0.a("Attempted to log in, but user is already logged in. Use a `link` helper instead.");ed.current=`privy:${e}`,eu.current=t;let n=(0,nr.trigger)();return r.createAnalyticsEvent({eventName:"cross_app_auth_started",payload:{providerAppId:e}}),new Promise(async(i,s)=>{let{name:a,logoUrl:o}=await T$({api:r.api,providerAppId:e,requesterAppId:d.id});J({crossAppAuth:{appId:e,name:a,logoUrl:o,action:t,popup:n,onSuccess:i,onError:s}}),ef("CrossAppAuthScreen")})}let eO={ready:f,authenticated:eo,user:g,walletConnectors:r.connectors||null,connectWallet:e=>{e&&"target"in e&&e&&(e=void 0),J({externalConnectWallet:{walletList:e?.walletList&&e?.walletList.length>0?e.walletList:void 0,walletChainType:e?.walletChainType,description:e?.description,hideHeader:e?.hideHeader}}),ef("ConnectOnlyLandingScreen")},linkWallet:e=>(e&&"target"in e&&e&&(e=void 0),eA("siwe"),ed.current="siwe",eu.current="link",J({...V,externalConnectWallet:{...V.externalConnectWallet,walletList:e?.walletList,walletChainType:e?.walletChainType,description:e?.description||`Link a wallet to your ${d?.name} account`}}),ef("AuthenticateWithWalletScreen")),startCrossAppAuthFlow:eP,linkEmail:()=>{eA("email"),eT("email"),ed.current="email",eu.current="link",ef("LinkEmailScreen")},linkPhone:()=>{eA("sms"),eT("phone"),ed.current="sms",eu.current="link",ef("LinkPhoneScreen")},linkGoogle:async()=>{eA("google"),eT("google_oauth"),eu.current="link",await eR.initLoginWithOAuth("google")},linkTwitter:async()=>{eA("twitter"),eT("twitter_oauth"),eu.current="link",await eR.initLoginWithOAuth("twitter")},linkTwitch:async()=>{eA("twitch"),eT("twitch_oauth"),eu.current="link",await eR.initLoginWithOAuth("twitch")},linkDiscord:async()=>{eA("discord"),eT("discord_oauth"),eu.current="link",await eR.initLoginWithOAuth("discord")},linkGithub:async()=>{eA("github"),eT("github_oauth"),eu.current="link",await eR.initLoginWithOAuth("github")},linkSpotify:async()=>{eA("spotify"),eT("spotify_oauth"),eu.current="link",await eR.initLoginWithOAuth("spotify")},linkInstagram:async()=>{eA("instagram"),eT("instagram_oauth"),eu.current="link",await eR.initLoginWithOAuth("instagram")},linkTiktok:async()=>{eA("tiktok"),eT("tiktok_oauth"),eu.current="link",await eR.initLoginWithOAuth("tiktok")},linkLine:async()=>{eA("line"),eT("line_oauth"),eu.current="link",await eR.initLoginWithOAuth("line")},linkLinkedIn:async()=>{eA("linkedin"),eT("linkedin_oauth"),eu.current="link",await eR.initLoginWithOAuth("linkedin")},linkApple:async()=>{eA("apple"),eT("apple_oauth"),eu.current="link",await eR.initLoginWithOAuth("apple")},linkPasskey:async()=>{eA("passkey"),eT("passkey"),await eR.initLinkWithPasskey(),ef("LinkPasskeyScreen")},linkTelegram:async e=>{if(eA("telegram"),eT("telegram"),eu.current="link",ed.current="telegram",e?.launchParams)if(e.launchParams.initDataRaw){let t=new k5;r.startAuthFlow(t),t.meta.telegramAuthResult=void 0,t.meta.telegramWebAppData=k6(e.launchParams.initDataRaw),J({telegramAuthModalData:{seamlessAuth:!0}}),ef("TelegramAuthScreen")}else(0,st.e)(en,"linkAccount","onError",t0.b.INVALID_DATA,{linkMethod:"telegram"});else await eR.initLoginWithTelegram();ef("TelegramAuthScreen")},linkFarcaster:async()=>{eA("farcaster"),eT("farcaster"),await eR.initLoginWithFarcaster(),eu.current="link",ed.current="farcaster",ef("FarcasterConnectStatusScreen")},updateEmail:()=>{if(eA("email"),!g?.email)throw new t0.a("User does not have an email linked to their account.");eu.current="update",ed.current="email",ef("UpdateEmailScreen")},updatePhone:()=>{if(eA("sms"),!g?.phone)throw new t0.a("User does not have a phone number linked to their account.");eu.current="update",ed.current="sms",ef("UpdatePhoneScreen")},login:async e=>{e&&"target"in e&&e&&(e=void 0);let t="Attempted to log in, but user is already logged in. Use a `link` helper instead.";if(!f){let e=await new Promise(e=>{G(t=>e.bind(t))});if(G(null),e)return void console.warn(t)}!g||g.isGuest?(eu.current="login",J({login:e}),ef("LandingScreen")):console.warn(t)},connectOrCreateWallet:async()=>{f||(await new Promise(e=>{G(()=>e)}),G(null)),eo?console.warn("User must be unauthenticated to `connectOrCreateWallet`"):(eu.current="connect-or-create",ef("ConnectOrCreateScreen"))},logout:async()=>{if(eu.current=null,ed.current=null,g&&r.clearProviderAcccessTokens(g),S(null),await r.logout(),g&&q)try{await q.clearMfa({userId:g.id})}catch(e){}m(null),ec(!1),R({status:"initial"}),M({status:"initial"}),P({status:"initial"}),D({status:"initial"}),j({status:"initial"}),W({status:"initial"}),(0,st.e)(en,"logout","onSuccess"),h(!1),t1.u.del(i8.d),t1.u.del((0,i8.g)(d.id))},getAccessToken:(0,H.useCallback)(async()=>{let e=await r.getCustomerAccessToken();return e&&!eo&&ec(!0),e},[r,eo]),unlinkWallet:async e=>{let t;return m(t=e.startsWith("0x")?await r.unlinkEthereumWallet(e):await r.unlinkSolanaWallet(e)),t},unlinkEmail:async e=>{let t=await r.unlinkEmail(e);return m(t),t},unlinkPhone:async e=>{let t=await r.unlinkPhone(e);return m(t),t},unlinkGoogle:async e=>{let t=await r.unlinkOAuth("google",e);return m(t),t},unlinkTwitter:async e=>{let t=await r.unlinkOAuth("twitter",e);return m(t),t},unlinkTwitch:async e=>{let t=await r.unlinkOAuth("twitch",e);return m(t),t},unlinkDiscord:async e=>{let t=await r.unlinkOAuth("discord",e);return m(t),t},unlinkGithub:async e=>{let t=await r.unlinkOAuth("github",e);return m(t),t},unlinkSpotify:async e=>{let t=await r.unlinkOAuth("spotify",e);return m(t),t},unlinkInstagram:async e=>{let t=await r.unlinkOAuth("instagram",e);return m(t),t},unlinkTiktok:async e=>{let t=await r.unlinkOAuth("tiktok",e);return m(t),t},unlinkLine:async e=>{let t=await r.unlinkOAuth("line",e);return m(t),t},unlinkLinkedIn:async e=>{let t=await r.unlinkOAuth("linkedin",e);return m(t),t},unlinkApple:async e=>{let t=await r.unlinkOAuth("apple",e);return m(t),t},unlinkFarcaster:async e=>{let t=await r.unlinkFarcaster(e);return m(t),t},unlinkTelegram:async e=>{let t=await r.unlinkTelegram(e);return m(t),t},unlinkPasskey:async e=>{let t=await kS();if(!t)throw Error("Must have valid access token to enroll in MFA");if(!q)throw Error("Wallet proxy not initialized.");let i=d.passkeys.shouldUnenrollMfaOnUnlink;await q.unlinkPasskeyAccount({credentialId:e,accessToken:t,removeAsMfa:i});let n=await r.getAuthenticatedUser();return m(n),n},unlinkCrossAppAccount:async({subject:e})=>{let t=g?.linkedAccounts.find(t=>"cross_app"===t.type&&t.subject===e)?.providerApp;if(!t)throw new t0.a("Invalid subject");r.storeProviderAccessToken(t.id,null);let i=await r.unlinkOAuth(`privy:${t.id}`,e);return m(i),i},setWalletRecovery:async e=>eC({legacySetWalletPasswordFlow:!1,showAutomaticRecovery:e?.showAutomaticRecovery??!1}),setWalletPassword:async()=>eC({legacySetWalletPasswordFlow:!0,showAutomaticRecovery:!1}),signMessage:(e,t)=>new Promise(async(n,s)=>{let{requesterAppId:a}=t?.uiOptions||{},o=e.message,l=t?.address?(0,tG.h)(g,t.address):(0,tG.b)(g);if(!l&&void 0!==t?.address){let e=(0,tG.k)(Ce.getState().ethereum,t.address);if(e)try{let t=await e.getEthereumProvider(),r=await t.request({method:"personal_sign",params:[o,e.address]});return(0,st.e)(en,"signMessage","onSuccess",{signature:r}),void n({signature:r})}catch(e){return(0,st.e)(en,"signMessage","onError",t0.b.UNABLE_TO_SIGN),void s(e??new t1.P("Unable to sign message"))}}if(!l)throw new t0.a("No embedded or connected wallet found for address.");if(!eo||!g)return(0,st.e)(en,"signMessage","onError",t0.b.MUST_BE_AUTHENTICATED),void s(Error("User must be authenticated before signing with a Privy wallet"));let c=l.address,d=l.walletIndex??0,{entropyId:u,entropyIdVerifier:h}=(0,tX.g)(g,l),p=(0,tG.d)(l);if("string"!=typeof o||o.length<1)return(0,st.e)(en,"signMessage","onError",t0.b.INVALID_MESSAGE),void s(Error("Message must be a non-empty string"));let f=async()=>{let t;if(!eo)throw Error("User must be authenticated before signing with a Privy wallet");let n=await kS();if(!q||!n||!await eR.recoverEmbeddedWallet({address:c}))throw Error("Unable to connect to wallet");if(r.createAnalyticsEvent({eventName:"embedded_wallet_sign_message_started",payload:{walletAddress:c,requesterAppId:a}}),p){let r=(0,ne.isHex)(e.message,{strict:!0}),s=await (0,$.rpc)(i,async({message:e})=>await q.signWithUserSigner({accessToken:n,requesterAppId:a,message:e}),{chain_type:"ethereum",method:"personal_sign",params:r?{message:o.slice(2),encoding:"hex"}:{message:o,encoding:"utf-8"},wallet_id:l.id});if(!s.data||!("signature"in s.data))throw new t1.P("Unable to sign message");t=s.data.signature}else{let{response:e}=await q.rpc({accessToken:n,entropyId:u,entropyIdVerifier:h,chainType:"ethereum",hdWalletIndex:d,requesterAppId:a,request:{method:"personal_sign",params:[o,c]}});t=e.data}return r.createAnalyticsEvent({eventName:"embedded_wallet_sign_message_completed",payload:{walletAddress:c,requesterAppId:a}}),t};if(ep({showWalletUIs:t?.uiOptions?.showWalletUIs}))try{let e=await f();(0,st.e)(en,"signMessage","onSuccess",{signature:e}),n({signature:e})}catch(e){(0,st.e)(en,"signMessage","onError",t0.b.UNABLE_TO_SIGN),s(e??new t1.P("Unable to sign message"))}else J({signMessage:{method:"personal_sign",data:o,confirmAndSign:f,onSuccess:e=>{(0,st.e)(en,"signMessage","onSuccess",{signature:e}),n({signature:e})},onFailure:e=>{(0,st.e)(en,"signMessage","onError",t0.b.UNABLE_TO_SIGN),s(e)},uiOptions:t?.uiOptions||{}},connectWallet:{recoveryMethod:l.recoveryMethod,connectingWalletAddress:c,entropyId:u,entropyIdVerifier:h,onCompleteNavigateTo:"SignRequestScreen",isUnifiedWallet:p,onFailure:e=>{(0,st.e)(en,"signMessage","onError",t0.b.UNKNOWN_CONNECT_WALLET_ERROR),s(e)}}}),ef("EmbeddedWalletConnectingScreen")}),signTypedData:(e,t)=>new Promise(async(n,s)=>{let{requesterAppId:a}=t?.uiOptions||{},o=t?.address?(0,tG.h)(g,t.address):(0,tG.b)(g);if(!o&&t?.address){let r=(0,tG.k)(Ce.getState().ethereum,t.address);if(r)try{let t=await r.getEthereumProvider(),i=(0,tQ.m)(e),s=await t.request({method:"eth_signTypedData_v4",params:[r.address,i]});return(0,st.e)(en,"signTypedData","onSuccess",{signature:s}),void n({signature:s})}catch(e){return(0,st.e)(en,"signTypedData","onError",t0.b.UNABLE_TO_SIGN),void s(e??new t1.P("Unable to sign typed data "+e))}}if(!o)throw new t0.a("No embedded or connected wallet found for address.");if(!eo||!g)return(0,st.e)(en,"signTypedData","onError",t0.b.MUST_BE_AUTHENTICATED),void s(Error("User must be authenticated before signing with a Privy wallet"));let l=o.address,c=o.walletIndex??0,{entropyId:d,entropyIdVerifier:u}=(0,tX.g)(g,o),h=(0,tG.d)(o),p=(0,tQ.m)(e),f=async()=>{let e;if(!eo)throw Error("User must be authenticated before signing with a Privy wallet");let t=await kS();if(!q||!t||!await eR.recoverEmbeddedWallet({address:l}))throw Error("Unable to connect to wallet");if(r.createAnalyticsEvent({eventName:"embedded_wallet_sign_typed_data_started",payload:{walletAddress:l,requesterAppId:a}}),h){let{domain:r,types:n,primaryType:s,message:l}=p,c=await (0,$.rpc)(i,async({message:e})=>await q.signWithUserSigner({accessToken:t,requesterAppId:a,message:e}),{chain_type:"ethereum",method:"eth_signTypedData_v4",params:{typed_data:{domain:r,types:n,primary_type:s,message:l}},wallet_id:o.id});if(!c.data||!("signature"in c.data))throw new t1.P("Unable to sign message");e=c.data.signature}else{let{response:r}=await q.rpc({accessToken:t,entropyId:d,entropyIdVerifier:u,chainType:"ethereum",hdWalletIndex:c,requesterAppId:a,request:{method:"eth_signTypedData_v4",params:[l,p]}});e=r.data}return r.createAnalyticsEvent({eventName:"embedded_wallet_sign_typed_data_completed",payload:{walletAddress:l,requesterAppId:a}}),e};if(ep({showWalletUIs:t?.uiOptions?.showWalletUIs}))try{let e=await f();(0,st.e)(en,"signTypedData","onSuccess",{signature:e}),n({signature:e})}catch(e){(0,st.e)(en,"signTypedData","onError",t0.b.UNABLE_TO_SIGN),s(e??new t1.P("Unable to sign message"))}else J({signMessage:{method:"eth_signTypedData_v4",data:p,confirmAndSign:f,onSuccess:e=>{(0,st.e)(en,"signTypedData","onSuccess",{signature:e}),n({signature:e})},onFailure:e=>{(0,st.e)(en,"signTypedData","onError",t0.b.UNABLE_TO_SIGN),s(e)},uiOptions:t?.uiOptions||{}},connectWallet:{recoveryMethod:o.recoveryMethod,connectingWalletAddress:o.address,entropyId:d,isUnifiedWallet:h,entropyIdVerifier:u,onCompleteNavigateTo:"SignRequestScreen",onFailure:e=>{(0,st.e)(en,"signMessage","onError",t0.b.UNKNOWN_CONNECT_WALLET_ERROR),s(e)}}}),ef("EmbeddedWalletConnectingScreen")}),sendTransaction:async(e,t)=>await ex({transaction:e,sponsor:t?.sponsor,uiOptions:t?.uiOptions,fundWalletConfig:t?.fundWalletConfig,address:t?.address,signOnly:!1}),signTransaction:async(e,t)=>({signature:(await ex({transaction:e,uiOptions:t?.uiOptions,address:t?.address,signOnly:!0})).hash}),exportWallet:e=>new Promise(async(i,n)=>{if(!eo||!g)return void n(Error("User must be authenticated before exporting their Privy wallet"));e&&"target"in e&&e&&(e=void 0);let s=e?.address?(0,tG.h)(g,e.address):(0,tG.b)(g);if(!s)return void n(new t0.a("User must have an embedded wallet."));let a=s.address,{entropyId:o,entropyIdVerifier:l}=(0,tX.g)(g,s),c=(0,tG.d)(s);if(!a)return void n(Error("User does not have an HD Ethereum wallet. To export an imported wallet, pass the `address` of the wallet to `exportWallet`."));if(!(0,i7.isAddress)(a))return void n(Error("Must provide a valid Ethereum address."));let d={recoveryMethod:s.recoveryMethod,connectingWalletAddress:s.address,isUnifiedWallet:c,entropyId:o,entropyIdVerifier:l,onCompleteNavigateTo:"EmbeddedWalletKeyExportScreen",onFailure:n,shouldForceMFA:!0};J(V),await kS()&&q?q?(0,t1.i)(s)?(J({keyExport:{appId:t.appId,appClientId:t.clientId,origin:r.apiUrl,address:s.address,entropyId:o,entropyIdVerifier:l,hdWalletIndex:s.walletIndex,chainType:s.chainType,walletId:s.id,isUnifiedWallet:c,imported:s.imported,onSuccess:i,onFailure:n},connectWallet:d}),ef("EmbeddedWalletConnectingScreen")):n(Error(`Export is not supported for ${s.chainType} wallets`)):n(Error("Must have a Privy wallet before exporting")):n(Error("Must have valid access token to enroll in MFA"))}),promptMfa:eI,async init(e){switch(e){case"sms":return void await r.initMfaSmsVerification();case"passkey":return await r.initMfaPasskeyVerification();case"totp":return;default:throw Error(`Unsupported MFA method: ${e}`)}},async submit(t,r){switch(t){case"totp":case"sms":if("string"!=typeof r)throw new t0.a("Invalid MFA code");er.current?.resolve({mfaMethod:t,mfaCode:r,relyingParty:window.origin}),await new Promise((e,t)=>{ei.current={resolve:e,reject:t}});break;case"passkey":let i;if("string"==typeof r)throw new t0.a("Invalid authenticator response");let n=await e.A(20190),s={id:(i=await n.startAuthentication({optionsJSON:r})).id,raw_id:i.rawId,response:{client_data_json:i.response.clientDataJSON,authenticator_data:i.response.authenticatorData,signature:i.response.signature,user_handle:i.response.userHandle},authenticator_attachment:i.authenticatorAttachment,client_extension_results:{app_id:i.clientExtensionResults.appid,cred_props:i.clientExtensionResults.credProps,hmac_create_secret:i.clientExtensionResults.hmacCreateSecret},type:i.type};er.current?.resolve({mfaMethod:t,mfaCode:s,relyingParty:window.origin}),await new Promise((e,t)=>{ei.current={resolve:e,reject:t}});break;default:throw er.current?.reject(new t0.a("Unsupported MFA method")),new t0.a(`Unsupported MFA method: ${t}`)}},cancel(){er.current?.reject(new t0.a("MFA canceled"))},async initEnrollmentWithSms(e){let t=await kS();if(!t||!q)throw Error("Must have valid access token to enroll in MFA");await q.initEnrollMfa({method:"sms",accessToken:t,phoneNumber:e.phoneNumber})},enrollInMfa:e=>new Promise((t,r)=>{e?(d.mfa.noPromptOnMfaRequired&&console.warn("[Privy Warning] Triggering the 'showMfaEnrollmentModal' function when 'noPromptOnMfaRequired' is set to true is unexpected. If this is intentional, ensure that you are building custom UIs for MFA verification."),J({mfaEnrollmentFlow:{mfaMethods:d.mfa.methods,shouldUnlinkOnUnenrollMfa:d.passkeys.shouldUnlinkOnUnenrollMfa,onSuccess:t,onFailure:r}}),ef("MfaEnrollmentFlowScreen")):(eR.closePrivyModal(),t())}),async initEnrollmentWithTotp(){let e=await kS();if(!e||!q)throw Error("Must have valid access token to enroll in MFA");let t=await q.initEnrollMfa({method:"totp",accessToken:e});return{secret:t.secret,authUrl:t.authUrl}},async submitEnrollmentWithSms(e){let t=await kS();if(!t||!q)throw Error("Must have valid access token to enroll in MFA");await q.submitEnrollMfa({method:"sms",accessToken:t,phoneNumber:e.phoneNumber,code:e.mfaCode}),m(await r.getAuthenticatedUser())},async submitEnrollmentWithTotp(e){let t=await kS();if(!t||!q)throw Error("Must have valid access token to enroll in MFA");await q.submitEnrollMfa({method:"totp",accessToken:t,code:e.mfaCode}),m(await r.getAuthenticatedUser())},async initEnrollmentWithPasskey(){},async submitEnrollmentWithPasskey({credentialIds:e},t={}){let i=await kS();if(!i||!q)throw Error("Must have valid access token to enroll in MFA");await q.submitEnrollMfa({method:"passkey",accessToken:i,credentialIds:e,removeForLogin:t.removeForLogin}),m(await r.getAuthenticatedUser())},async unenroll(e,t={}){let i=await kS();if(!i||!q)throw Error("Must have valid access token to remove MFA");"passkey"===e?await q.submitEnrollMfa({method:"passkey",accessToken:i,credentialIds:[],removeForLogin:t.removeForLogin}):await q.unenrollMfa({method:e,accessToken:i}),m(await r.getAuthenticatedUser())},requestFarcasterSignerFromWarpcast:async()=>{let e=await kS(),t=g?.linkedAccounts.find(e=>"wallet"===e.type&&"privy"===e.walletClientType);if(!e)throw Error("Must have valid access token to connect with Farcaster");if(!q||!t)throw Error("Must have an embedded wallet to use Farcaster signers");if((0,tG.d)(t))throw new t0.a("Farcaster signers are only supported for on-device execution and this app uses TEE execution. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");if(!g?.farcaster?.fid)throw Error("Must have Farcaster account to use Farcaster signers");if(!await eR.recoverEmbeddedWallet({address:t.address}))throw Error("Unable to connect to wallet");let i=await q.initFarcasterSigner({address:t.address,hdWalletIndex:null,accessToken:e,mfaCode:null,mfaMethod:null,relyingParty:window.origin});"approved"===i.status&&m(await r.getAuthenticatedUser()||g||null),J({farcasterSigner:i}),ef("FarcasterSignerStatusScreen")},getFarcasterSignerPublicKey:async()=>{let e,t=await kS(),r=g?.linkedAccounts.find(e=>"wallet"===e.type&&"privy"===e.walletClientType);if(!t)throw Error("Must have valid access token to connect with Farcaster");if(!q||!r)throw Error("Must have an embedded wallet to use Farcaster signers");if((0,tG.d)(r))throw new t0.a("Farcaster signers are only supported for on-device execution and this app uses TEE execution. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");if(!g?.farcaster?.fid)throw Error("Must have Farcaster account to use Farcaster signers");if(!await eR.recoverEmbeddedWallet({address:r.address}))throw Error("Unable to connect to wallet");if(!g.farcaster?.signerPublicKey)throw Error("Must have a Farcaster signer public key to sign");return e=g.farcaster.signerPublicKey.slice(2),Uint8Array.from(e.match(/.{1,2}/g).map(e=>parseInt(e,16)))},signFarcasterMessage:async t=>{let r=await kS(),i=g?.linkedAccounts.find(e=>"wallet"===e.type&&"privy"===e.walletClientType);if(!r)throw Error("Must have valid access token to connect with Farcaster");if(!q||!i)throw Error("Must have an embedded wallet to use Farcaster signers");if((0,tG.d)(i))throw new t0.a("Farcaster signers are only supported for on-device execution and this app uses TEE execution. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");if(!g?.farcaster?.fid)throw Error("Must have Farcaster account to use Farcaster signers");if(!await eR.recoverEmbeddedWallet({address:i.address}))throw Error("Unable to connect to wallet");if(!g.farcaster?.signerPublicKey)throw Error("Must have a Farcaster signer public key to sign");let n=await e.A(20190),s=await q.signFarcasterMessage({address:i.address,hdWalletIndex:null,accessToken:r,mfaCode:null,mfaMethod:null,payload:{hash:n.bufferToBase64URLString(t)},fid:BigInt(g.farcaster.fid),relyingParty:window.origin});return new Uint8Array(n.base64URLStringToBuffer(s.signature))},signMessageWithCrossAppWallet(e,{address:t,chainId:i}){let n=g?.linkedAccounts.some(e=>"cross_app"===e.type&&e.smartWallets.some(e=>e.address===t));return TK({user:g,client:r,address:t,requesterAppId:d.id,request:{method:n?"privy_signSmartWalletMessage":"personal_sign",params:[e,t],chainId:i},reconnect:eP})},signTypedDataWithCrossAppWallet(e,{address:t,chainId:i}){let n=g?.linkedAccounts.some(e=>"cross_app"===e.type&&e.smartWallets.some(e=>e.address===t)),s=(0,tQ.m)(e);return TK({user:g,client:r,address:t,requesterAppId:d.id,request:{method:n?"privy_signSmartWalletTypedData":"eth_signTypedData_v4",params:[t,s],chainId:i},reconnect:eP})},sendTransactionWithCrossAppWallet(e,{address:t}){let i=g?.linkedAccounts.some(e=>"cross_app"===e.type&&e.smartWallets.some(e=>e.address===t));return TK({user:g,client:r,address:t,requesterAppId:d.id,request:{method:i?"privy_sendSmartWalletTx":"eth_sendTransaction",params:[e],chainId:e.chainId},reconnect:eP})},signTransactionWithCrossAppWallet(e,{address:t}){let i=g?.linkedAccounts.some(e=>"cross_app"===e.type&&e.smartWallets.some(e=>e.address===t));return TK({user:g,client:r,address:t,requesterAppId:d.id,request:{method:i?"privy_signSmartWalletTx":"eth_signTransaction",params:[e],chainId:e.chainId},reconnect:eP})},isModalOpen:u||!!p,mfaMethods:d.mfa.methods};s=eO.signMessage,a=eO.signTypedData,l=async(e,t)=>await ex({transaction:e,...t,signOnly:!1}),o=async(e,t)=>({signature:(await ex({transaction:e,...t,signOnly:!0})).hash});let eR={privy:i,setAuthenticated:ec,setUser:m,setIsNewUser:_,isNewUserThisSession:E,pendingTransaction:null,walletConnectionStatus:k,setWalletConnectionStatus:T,connectors:r.connectors?.walletConnectors??[],rpcConfig:d.rpcConfig,chains:d.chains,appId:t.appId,showFiatPrices:"native-token"!==d.embeddedWallets.priceDisplay.primary,clientAnalyticsId:r.clientAnalyticsId,onCustomAuthAuthenticated:ey,hideWalletUIs:eh,isHeadlessSigning:(0,H.useCallback)(ep,[d.embeddedWallets.showWalletUIs]),emailOtpState:O,setEmailOtpState:R,smsOtpState:N,setSmsOtpState:M,oAuthState:L,setOAuthState:j,telegramAuthState:B,setTelegramAuthState:W,siweState:U,setSiweState:D,isHeadlessOAuthLoading:x,baseAccountSdk:b,setBaseAccountSdk:v,nativeTokenSymbolForChainId:e=>d.chains.find(t=>t.id===Number(e))?.nativeCurrency.symbol,initializeWalletProxy:async e=>{if(q)return q;let t=new Promise(e=>{Y.current=e}),r=new Promise(t=>setTimeout(()=>t(null),e)),i=await Promise.race([t,r]);return Y.current=null,i},getAuthFlow:()=>r.authFlow,getAuthMeta:()=>r.authFlow?.meta,client:r,closePrivyModal:async(e={shouldCallAuthOnSuccess:!0,isSuccess:!1})=>{let i,s=f&&eo&&g;if(s&&ed.current&&(i=ek(g)),"login"===eu.current)e.shouldCallAuthOnSuccess&&s&&ed.current?(0,st.e)(en,"login","onComplete",{user:g,isNewUser:E,wasAlreadyAuthenticated:!1,loginMethod:ed.current,loginAccount:i??null}):(0,st.e)(en,"login","onError",t0.b.USER_EXITED_AUTH_FLOW);else if("link"===eu.current&&i)e.isSuccess&&s&&ed.current?(0,st.e)(en,"linkAccount","onSuccess",{user:g,linkMethod:ed.current,linkedAccount:i}):ed.current&&(0,st.e)(en,"linkAccount","onError",t0.b.USER_EXITED_LINK_FLOW,{linkMethod:ed.current});else if("update"===eu.current&&i)e.isSuccess&&s&&ed.current?(0,st.e)(en,"update","onSuccess",{user:g,updateMethod:ed.current,updatedAccount:i}):ed.current&&(0,st.e)(en,"update","onError",t0.b.USER_EXITED_UPDATE_FLOW,{linkMethod:ed.current});else if("connect-or-create"===eu.current){let e=Ce.getState().ethereum;e[0]?(0,st.e)(en,"connectOrCreateWallet","onSuccess",{wallet:e[0]}):(0,st.e)(en,"connectOrCreateWallet","onError",t0.b.USER_EXITED_AUTH_FLOW)}let a=A&&TX.has(A),o="ErrorScreen"===A&&V.errorModalData&&TX.has(V.errorModalData.previousScreen);if((a||o)&&V.funding){let e,r=TX.get(A)??null;if(o&&V.funding?.onError){let e=V.errorModalData?.error,t=e?.privyErrorCode||t0.b.UNKNOWN_FUNDING_ERROR,r=new t0.a(e?.message||"Funding failed",e,t);V.funding?.onError?.(r)}if("solana"===V.funding.chainType){let t=d.solanaRpcs[V.funding.chain];if(!t)return void console.warn("Unable to load solana rpc, skipping balance");if(n(n9.S))try{e=await T1({rpc:t.rpc,address:V.funding.address})}catch{console.error("Unable to pull wallet balance")}else console.warn("Unable to load solana plugin, skipping balance");(0,st.e)(en,"fundSolanaWallet","onUserExited",{address:V.funding.address,fundingMethod:r,chain:V.funding.chain,balance:e})}else{let i=(0,_y.g)(V.funding.chain.id,d.chains,d.rpcConfig,{appId:t.appId});try{e=await i.getBalance({address:V.funding.address})}catch{console.error("Unable to pull wallet balance")}(0,st.e)(en,"fundWallet","onUserExited",{address:V.funding.address,chain:V.funding.chain,fundingMethod:r,balance:e}),function(e,t){if(e.onComplete)switch(t){case"external":e.fundingResult?e.onComplete({...e.fundingResult,fundingMethod:t}):e.onComplete({status:"cancelled",address:e.address,fundingMethod:t,amount:e.amount});break;case null:e.onComplete({status:"cancelled",address:e.address,fundingMethod:void 0,amount:e.amount});break;default:e.onComplete({status:"completed",address:e.address,fundingMethod:t,amount:e.amount})}}(V.funding,r)}}J(e=>({...e,externalConnectWallet:{}})),eu.current=null,ed.current=null,_(!1),h(!1),T({status:"disconnected",connectedWallet:null,connector:null,connectError:null,connectRetry:()=>{}}),setTimeout(()=>{r.authFlow=void 0},200)},openPrivyModal:ef,connectWallet:eb,initLoginWithWallet:async(e,t,r,i)=>{(0,tQ.f)(e)?(ed.current="siwe",ev(e,t,r)):(ed.current="siws",eE(e,t,r,i))},loginWithWallet:async()=>{let e,t,i;if(!f)throw new t0.g;if(r.authFlow instanceof kG?e="siwe":r.authFlow instanceof kY&&(e="siws"),!e)throw new t0.a("Must initialize SIWE/SIWS flow first.");if(null!==await r.getAccessToken())try{({user:t}=await r.link()),ed.current=e}catch(t){throw(0,st.e)(en,"linkAccount","onError",t.privyErrorCode||t0.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:e}),t}else try{({user:t,isNewUser:i}=await r.authenticate()),ed.current=e}catch(e){throw(0,st.e)(en,"login","onError",e.privyErrorCode||t0.b.GENERIC_CONNECT_WALLET_ERROR),e}m(t||g||null),_(i||!1),ec(!0)},delegateWallet:async({address:e,chainType:t,showDelegationUIs:r})=>new Promise(async(i,n)=>{let s=await kS();if(!eo||!g||!s)throw new t0.a("User must be authenticated and have an embedded wallet to delegate actions.");if("solana"!==t&&"ethereum"!==t)throw new t0.a("Only Solana and Ethereum embedded wallets are supported for delegation and revocation.");let a=eR.walletProxy??await eR.initializeWalletProxy(15e3);if(!a)throw new t0.a("Wallet proxy not initialized.");if((({address:e,user:t})=>!!TF(t).find(t=>t.address===e))({address:e,user:g}))return i();let o=(0,tG.h)(g,e);if(!o)throw new t0.a("Address to delegate is not associated with current user.");if((0,tG.d)(o))throw new t0.a("useDelegatedActions is only supported for on-device execution and this app uses TEE execution. Use the useSessionSigners hook to provision server side access on behalf of your users. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");let l=(({address:e,user:t})=>{let r=t.linkedAccounts.find(t=>"wallet"===t.type&&"privy"===t.walletClientType&&t.address===e);if(!r)throw new t0.a("Address to delegate is not associated with current user.");if(!(0,t1.i)(r))throw new t0.a(`useDelegatedActions is not supported for ${r.chainType} wallets. Use the useSessionSigners hook to provision server side access on behalf of your users.`);return{address:r.address,chainType:r.chainType,walletIndex:r.walletIndex??0}})({address:e,user:g}),c=(({address:e,user:t})=>{let r=t.linkedAccounts.find(t=>"wallet"===t.type&&"privy"===t.walletClientType&&t.address===e);if(!r)throw new t0.a("Address to delegate is not associated with current user.");let i=r.imported?r:(0,tG.g)(t);if(!i)throw new t0.a("Unable to determine root address for delegated address.");if(!(0,t1.i)(i))throw new t0.a(`useDelegatedActions is not supported for ${i.chainType} wallets. Use the useSessionSigners hook to provision server side access on behalf of your users.`);return{address:i.address,chainType:i.chainType,imported:i.imported}})({address:e,user:g}),d=async()=>{await a.createDelegatedAction({accessToken:s,rootWallet:c,delegatedWallets:[l]}),await eR.refreshSessionAndUser()};if(await eR.recoverEmbeddedWallet({address:e}),r)J({delegatedActions:{consent:{address:e,onDelegate:d,onSuccess:async()=>{i()},onError:async e=>{n(e)}}}}),ef("DelegatedActionsConsentScreen");else try{await d(),i()}catch(e){n(e)}}),revokeDelegatedWallets:async({showDelegationUIs:e})=>new Promise(async(t,i)=>{if(!eo||!g)throw new t0.a("User must be authenticated and have an embedded wallet to revoke a delegated wallet.");let n=TF(g);if(0===n.length)throw new t0.a("User has no delegated wallets to revoke.");if(n.some(tG.d))throw new t0.a("useDelegatedActions is only supported for on-device execution and this app uses TEE execution. Use the useSessionSigners hook to provision server side access on behalf of your users. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");let s=async()=>{await r.revokeDelegatedWallet(),await eR.refreshSessionAndUser()};if(e)J({delegatedActions:{revoke:{onRevoke:s,onSuccess:async()=>{t()},onError:async e=>{i(e)}}}}),ef("DelegatedActionsRevokeScreen");else try{await s(),t()}catch(e){i(e)}}),initLoginWithFarcaster:async(e,t)=>{let i=new kL(e,t);r.startAuthFlow(i);try{ed.current="farcaster",await i.initializeFarcasterConnect()}catch(e){throw"login"===eu.current?(0,st.e)(en,"login","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR):"link"===eu.current&&(0,st.e)(en,"linkAccount","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR,{linkMethod:"farcaster"}),e}},loginWithFarcaster:async()=>{let e,t;if(!f)throw new t0.g;if(!(r.authFlow instanceof kL))throw new t0.a("Must initialize Farcaster flow first.");if(null!==await r.getAccessToken())try{({user:e}=await r.link()),ed.current="farcaster"}catch(e){throw(0,st.e)(en,"linkAccount","onError",e.privyErrorCode||t0.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"farcaster"}),e}else try{({user:e,isNewUser:t}=await r.authenticate()),ed.current="farcaster"}catch(e){throw(0,st.e)(en,"login","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR),e}m(e||null),_(t||!1),ec(!0)},async crossAppAuthFlow({appId:e,popup:t,action:i}){let n=`privy:${e}`;ed.current=n;let{url:s,stateCode:a,codeVerifier:o}=await async function({api:e,appId:t}){let r=kq(),i=kz(),n=await k$(r);try{let{url:s}=await e.post(nM,{provider:`privy:${t}`,redirect_to:window.location.href,code_challenge:n,state_code:i});return{url:s,stateCode:i,codeVerifier:r}}catch(e){throw(0,t0.f)(e)}}({api:r.api,appId:e});if(!s)throw r.createAnalyticsEvent({eventName:"cross_app_auth_error",payload:{error:"Unable to open cross-app auth popup",appId:e}}),new t0.a("No authorization URL returned for cross-app auth.");try{let l=await async function({url:e,popup:t}){return t.location=e,new Promise((e,r)=>{let i,n=setTimeout(()=>{r(new t0.a("Authorization request timed out after 2 minutes.")),s()},12e4);function s(){t?.close(),window.removeEventListener("message",o)}let a=setInterval(()=>{t?.closed&&!i&&(s(),clearInterval(a),clearTimeout(n),r(new t0.a("User rejected request")))},300);function o(t){t.data&&("PRIVY_OAUTH_RESPONSE"===t.data.type&&t.data.stateCode&&t.data.authorizationCode&&(clearTimeout(n),e(t.data),s()),"PRIVY_OAUTH_ERROR"===t.data.type&&(clearTimeout(n),r(new t0.a(t.data.error)),s()),t.data.type===Tq&&((i=new BroadcastChannel(TH)).onmessage=o))}window.addEventListener("message",o)})}({url:s,popup:t,provider:n}),c=l.stateCode,d=l.authorizationCode;if(c!==a)throw r.createAnalyticsEvent({eventName:"possible_phishing_attempt",payload:{provider:n,storedStateCode:a??"",returnedStateCode:c??""}}),new t0.a("Unexpected auth flow. This may be a phishing attempt.",void 0,t0.b.OAUTH_UNEXPECTED);let u=await async function({appId:e,stateCode:t,codeVerifier:r,authorizationCode:i,action:n,client:s}){if(!i||!t)throw new t0.a("[Cross-App AuthFlow] Authorization and state codes code must be set prior to calling authenicate.");if("undefined"===i)throw new t0.a("User denied confirmation during cross-app auth flow");try{let a=new Tz({authorizationCode:i,stateCode:t,codeVerifier:r,provider:`privy:${e}`});s.startAuthFlow(a);let o="link"===n?await s.link():await s.authenticate(),l=o.oAuthTokens?.accessToken;return console.debug(),l}catch(t){let e=(0,t0.f)(t);if(e.privyErrorCode===t0.b.ACCOUNT_TRANSFER_REQUIRED)throw e;if(e.privyErrorCode)throw new t0.a(e.message||"Invalid code during cross-app auth flow.",void 0,e.privyErrorCode);if("User denied confirmation during cross-app auth flow"===e.message)throw new t0.a("Invalid code during cross-app auth flow.",void 0,t0.b.OAUTH_USER_DENIED);throw new t0.a("Invalid code during cross-app auth flow.",void 0,t0.b.UNKNOWN_AUTH_ERROR)}}({appId:e,codeVerifier:o,stateCode:c,authorizationCode:d,action:i,client:r});u&&r.storeProviderAccessToken(e,u);let h=await eR.refreshSessionAndUser();if(!h)throw new t0.a("Unable to update user");return r.createAnalyticsEvent({eventName:"cross_app_auth_completed",payload:{providerAppId:e}}),h}catch(e){throw r.createAnalyticsEvent({eventName:"cross_app_auth_error",payload:{error:e.toString(),provider:n}}),e}},async initLoginWithOAuth(e,t,i){if(ed.current=e,!(0,t1.e)()||"google"===e&&!d.allowOAuthInEmbeddedBrowsers&&T0(window.navigator.userAgent))return void ef("InAppBrowserLoginNotPossible");"twitter"===e&&window.opener&&window.opener.postMessage({type:Tq},"*"),t1.u.del(i8.H),t1.u.del(i8.O);let n=new kK({provider:e,disableSignup:!!i,withPrivyUi:!0,customOAuthRedirectUrl:d.customOAuthRedirectUrl});t&&n.addCaptchaToken(t),r.startAuthFlow(n);let s=await r.authFlow.getAuthorizationUrl();if(s&&s.url)if("twitter"===e&&i6.isAndroid&&(s.url=s.url.replace("x.com","twitter.com")),"chrome-extension:"===window.location.protocol&&kW())try{let{privyOAuthCode:e,privyOAuthState:t}=await kF(s.url);ef("OAuthStatusScreen"),n.meta.stateCode=t,n.meta.authorizationCode=e}catch(e){throw console.error("OAuth in chrome extension flow failed:",e),e}else window.location.assign(s.url)},async initLoginWithTelegram(e,t){if(!f)throw new t0.g;ed.current="telegram";let i=new k5(e,t);r.startAuthFlow(i),W({status:"loading"}),i.meta.telegramWebAppData=void 0,i.meta.telegramAuthResult=await new Promise((e,t)=>d.loginConfig.telegramAuthConfiguration?window.Telegram?void window.Telegram.Login.auth({bot_id:d.loginConfig.telegramAuthConfiguration.botId,request_access:!0},r=>r?e(r):("link"===eu.current?(0,st.e)(en,"linkAccount","onError",t0.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"telegram"}):"login"===eu.current?(0,st.e)(en,"login","onError",t0.b.INVALID_CREDENTIALS):"update"===eu.current&&(0,st.e)(en,"login","onError",t0.b.FAILED_TO_UPDATE_ACCOUNT),t(new t0.a("Telegram auth failed or was canceled by the client")))):t(new t0.a("Telegram was not initialized")):t(new t0.a("Telegram Auth configuration is not loaded")))},async loginWithTelegram(e){let t,i;if(!(r.authFlow instanceof k5))throw new t0.a("Must initialize Telegram flow before calling loginWithTelegram");r.authFlow.meta.captchaToken||=e?.captchaToken;let n=await kS(),s=e?.intent||eu.current;if("login"===s)try{let e=await r.authenticate();t=e.user,i=e.isNewUser,ed.current="telegram"}catch(e){throw(0,st.e)(en,"login","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR),e}else{if("link"!==s)throw new t0.a("Unknown auth intent");try{t=(await r.link()).user,ed.current="telegram"}catch(e){throw(0,st.e)(en,"linkAccount","onError",e.privyErrorCode||t0.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"telegram"}),e}}m(t),_(i||!1),ec(!0),W({status:"done"});let a=t?.linkedAccounts.find(({type:e})=>"telegram"===e)||null;return{user:t,isNewUser:i||!1,wasAlreadyAuthenticated:!!n,loginAccount:a}},async loginWithOAuth(e){let t,i,n;if(!(r.authFlow instanceof kK))throw new t0.a("Must initialize OAuth flow before calling loginWithOAuth");let s=t1.u.get(i8.S),a=r.authFlow.meta.stateCode;if(s!==a)throw r.createAnalyticsEvent({eventName:"possible_phishing_attempt",payload:{provider:e,storedStateCode:s??"",returnedStateCode:a??""}}),new t0.a("Unexpected auth flow. This may be a phishing attempt.",void 0,t0.b.OAUTH_UNEXPECTED);if(null!==await r.getAccessToken())try{let i=await r.link();t=i.user,n=i.oAuthTokens,ed.current=e}catch(t){throw(0,st.e)(en,"linkAccount","onError",t.privyErrorCode||t0.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:e}),t}else try{let s=await r.authenticate();t=s.user,i=s.isNewUser,n=s.oAuthTokens,ed.current=e}catch(t){throw"login"===eu.current?(0,st.e)(en,"login","onError",t.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR):"link"===eu.current&&(0,st.e)(en,"linkAccount","onError",t.privyErrorCode||t0.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:e}),t}return m(t),_(i||!1),ec(!0),n&&t&&(0,st.e)(en,"oAuthAuthorization","onOAuthTokenGrant",{oAuthTokens:n,user:t}),n},passkeyAuthState:C,setPasskeyAuthState:P,async initSignupWithPasskey({captchaToken:e,withPrivyUi:t}){let i=new kJ({captchaToken:e,setPasskeyAuthState:P,hints:d.passkeys.registration?.hints});r.startAuthFlow(i),eu.current="login";try{ed.current="passkey",P({status:"generating-challenge"}),await i.initRegisterFlow(t),P({status:"awaiting-passkey"})}catch(e){throw P({status:"error",error:e}),(0,st.e)(en,"login","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR),e}},async signupWithPasskey(){let e,t;if(!f)throw new t0.g;if(!(r.authFlow instanceof kJ))throw new t0.a("Must initialize Passkey flow first.");if("passkey"!==ed.current){let e=new t0.a("Must init login with Passkey flow first.");throw P({status:"error",error:e}),e}let i=await kS();try{ed.current="passkey",P({status:"awaiting-passkey"}),{user:e,isNewUser:t}=await r.authenticate()}catch(e){throw P({status:"error",error:e}),(0,st.e)(en,"login","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR),e}m(e),_(t||!1),ec(!0),P({status:"done"});let n=e?.linkedAccounts.find(({type:e})=>"passkey"===e)||null;return{user:e,isNewUser:t||!1,wasAlreadyAuthenticated:!!i,loginAccount:n}},async initLoginWithPasskey({captchaToken:e,withPrivyUi:t}){let i=new kJ({captchaToken:e,setPasskeyAuthState:P,hints:void 0});r.startAuthFlow(i),eu.current="login";try{ed.current="passkey",P({status:"generating-challenge"}),await i.initAuthenticationFlow(t),P({status:"awaiting-passkey"})}catch(e){throw P({status:"error",error:e}),(0,st.e)(en,"login","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR),e}},async loginWithPasskey(e){let t,i;if(!f)throw new t0.g;if(!(r.authFlow instanceof kJ))throw new t0.a("Must initialize Passkey flow first.");if(e?.credentialIds&&(r.authFlow.meta.allowedCredentialsIds=e.credentialIds),"passkey"!==ed.current){let e=new t0.a("Must init login with Passkey flow first.");throw P({status:"error",error:e}),e}let n=await kS();try{ed.current="passkey",P({status:"awaiting-passkey"}),{user:t,isNewUser:i}=await r.authenticate()}catch(e){throw P({status:"error",error:e}),(0,st.e)(en,"login","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR),e}m(t),_(i||!1),ec(!0),P({status:"done"});let s=t?.linkedAccounts.find(({type:e})=>"passkey"===e)||null;return{user:t,isNewUser:i||!1,wasAlreadyAuthenticated:!!n,loginAccount:s}},async initLinkWithPasskey(e){let t=new kJ({captchaToken:e,hints:d.passkeys.registration?.hints});r.startAuthFlow(t),eu.current="link",ed.current="passkey",P({status:"generating-challenge"});try{await t.initLinkFlow(),P({status:"awaiting-passkey"})}catch(e){throw(0,st.e)(en,"linkAccount","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR,{linkMethod:"passkey"}),P({status:"error",error:e}),e}},async linkWithPasskey(){let e;if(!f)throw new t0.g;if(!(r.authFlow instanceof kJ))throw new t0.a("Must initialize Passkey flow first.");if("passkey"!==ed.current)throw new t0.a("Must init login with Passkey flow first.");try{ed.current="passkey",{user:e}=await r.link()}catch(e){throw(0,st.e)(en,"linkAccount","onError",e.privyErrorCode||t0.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"passkey"}),e}return m(e||g||null),P({status:"done"}),e},async initLoginWithHeadlessOAuth(e,t,i){if(!(0,t1.e)()||"google"===e&&!d.allowOAuthInEmbeddedBrowsers&&T0(window.navigator.userAgent))throw Error("It looks like you're using an in-app browser.  To log in, please try again using an external browser.");let n=new kK({provider:e,withPrivyUi:!1,disableSignup:i??!1,customOAuthRedirectUrl:d.customOAuthRedirectUrl});t&&n.addCaptchaToken(t),j({status:"loading"});let s=await r.startAuthFlow(n).getAuthorizationUrl();if(s?.url)if("chrome-extension:"===window.location.protocol&&kW())try{let{privyOAuthCode:e,privyOAuthState:t}=await kF(s.url);n.meta.stateCode=t,n.meta.authorizationCode=e,await this.loginWithHeadlessOAuth(n.meta)}catch(e){throw j({status:"error",error:e}),e}else window.location.assign(s.url)},async loginWithHeadlessOAuth(e){let t,i,n;I(!0),j({status:"loading"}),r.startAuthFlow(new kK({...e,customOAuthRedirectUrl:d.customOAuthRedirectUrl}));let s=t1.u.get(i8.S),a=e.stateCode;if(s!==a)throw r.createAnalyticsEvent({eventName:"possible_phishing_attempt",payload:{provider:e.provider,storedStateCode:s??"",returnedStateCode:a??""}}),I(!1),new t0.a("Unexpected auth flow. This may be a phishing attempt.",void 0,t0.b.OAUTH_UNEXPECTED);if(null!==await r.getAccessToken())try{({user:t,oAuthTokens:n}=await r.link()),ed.current=e.provider;let i=ek(t);t&&i&&(0,st.e)(en,"linkAccount","onSuccess",{user:t,linkMethod:ed.current,linkedAccount:i})}catch(t){throw I(!1),(0,st.e)(en,"linkAccount","onError",t.privyErrorCode||t0.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:e.provider}),t}else try{({user:t,isNewUser:i,oAuthTokens:n}=await r.authenticate()),ed.current=e.provider;let s=ek(t);t&&s&&void 0!==i&&(0,st.e)(en,"login","onComplete",{user:t,isNewUser:i,wasAlreadyAuthenticated:!1,loginMethod:ed.current,loginAccount:s})}catch(e){throw I(!1),j({status:"error",error:e}),(0,st.e)(en,"login","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR),e}return m(t),_(i||!1),ec(!0),I(!1),j({status:"done"}),n&&t&&(0,st.e)(en,"oAuthAuthorization","onOAuthTokenGrant",{oAuthTokens:n,user:t}),t??void 0},initLoginWithEmail:async({email:e,captchaToken:t,disableSignup:i,withPrivyUi:n})=>{let s=new kk({email:e,captchaToken:t,disableSignup:i});r.startAuthFlow(s);try{ed.current="email",R({status:"sending-code"});let e=await s.sendCodeEmail({withPrivyUi:n});if(e?.ssoRedirectUrl)return window.location.href=e.ssoRedirectUrl,void await (0,tQ.k)(1e4);R({status:"awaiting-code-input"})}catch(e){throw R({status:"error",error:e}),"login"===eu.current?(0,st.e)(en,"login","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR):"link"===eu.current&&(0,st.e)(en,"linkAccount","onError",e.privyErrorCode||t0.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"email"}),e}},initUpdateEmail:async({oldAddress:e,newAddress:t,captchaToken:i})=>{let n=new kT(e,t,i);r.startAuthFlow(n);try{await n.sendCodeEmail({withPrivyUi:!0})}catch(e){throw(0,st.e)(en,"update","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR,{linkMethod:ed.current}),e}},initUpdatePhone:async(e,t,i)=>{let n=new kX(e,t,i);r.startAuthFlow(n);try{await n.sendSmsCode({withPrivyUi:!0})}catch(e){(0,st.e)(en,"update","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR,{linkMethod:ed.current})}},initLoginWithSms:async({phoneNumber:e,captchaToken:t,disableSignup:i,withPrivyUi:n})=>{M({status:"sending-code"});let s=new kQ({phoneNumber:e,captchaToken:t,disableSignup:i});r.startAuthFlow(s);try{ed.current="sms",await s.sendSmsCode({withPrivyUi:n}),M({status:"awaiting-code-input"})}catch(e){throw M({status:"error",error:e}),"login"===eu.current?(0,st.e)(en,"login","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR):"link"===eu.current&&(0,st.e)(en,"linkAccount","onError",e.privyErrorCode||t0.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"sms"}),e}},resendEmailCode:async()=>{await r.authFlow?.sendCodeEmail({withPrivyUi:!0})},resendSmsCode:async()=>{await r.authFlow?.sendSmsCode({withPrivyUi:!0})},loginWithCode:async e=>{let t,i;function n(e){r.authFlow instanceof kk?R(e):r.authFlow instanceof kQ&&M(e)}if(n({status:"submitting-code"}),!f){let e=new t0.g;throw n({status:"error",error:e}),e}if(r.authFlow instanceof kk)r.authFlow.meta.emailCode=e.trim();else{if(!(r.authFlow instanceof kQ)){let e=new t0.a("Must initialize a passwordless code flow first");throw n({status:"error",error:e}),e}r.authFlow.meta.smsCode=e.trim()}let s=await kS();if("link"===eu.current)try{({user:t}=await r.link())}catch(e){throw n({status:"error",error:e}),(0,st.e)(en,"linkAccount","onError",e.privyErrorCode||t0.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:ed.current}),e}else if("update"===eu.current)try{({user:t}=await r.link())}catch(e){throw n({status:"error",error:e}),(0,st.e)(en,"update","onError",e.privyErrorCode||t0.b.FAILED_TO_UPDATE_ACCOUNT,{linkMethod:ed.current}),e}else try{({user:t,isNewUser:i}=await r.authenticate())}catch(e){throw n({status:"error",error:e}),(0,st.e)(en,"login","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR),e}let a=t||g;m(a||null),_(i||!1),ec(!0),n({status:"done"});let o=null;return r.authFlow instanceof kk?o=a?.linkedAccounts.find(({type:e})=>"email"===e)||null:r.authFlow instanceof kQ&&(o=a?.linkedAccounts.find(({type:e})=>"phone"===e)||null),{user:a,isNewUser:i||!1,wasAlreadyAuthenticated:!!s,linkedAccount:o}},generateSiweMessage:async({address:e,chainId:t,captchaToken:i})=>{eu.current=eo?"link":"login",ed.current="siwe",D({status:"generating-message"});let n=await r.generateSiweNonce({address:e,captchaToken:i});return D({status:"awaiting-signature"}),kZ({address:e,chainId:t.replace("eip155:",""),nonce:n})},generateSiweMessageForSmartWallet:async({address:e,chainId:t})=>{let i=await r.generateSiweNonce({address:e});return kZ({address:e,chainId:t.replace("eip155:",""),nonce:i})},linkSmartWallet:async({message:e,signature:t,smartWalletType:i,smartWalletVersion:n})=>{let s;s=await r.linkSmartWallet({message:e,signature:t,smartWalletType:i,smartWalletVersion:n}),m((s=await eR.refreshSessionAndUser()??s)||g||null)},loginWithSiwe:async({message:e,signature:t,captchaToken:i,disableSignup:n,walletClientType:s,connectorType:a})=>{let o,l=null;try{if(g)throw Error("User already authenticated");let c=new kG(r,void 0,i,n,{message:e,signature:t,walletClientType:s,connectorType:a});r.startAuthFlow(c),ed.current="siwe",eu.current="login",D({status:"submitting-signature"});let d=await r.authenticate();if({user:l,isNewUser:o}=d,!l)throw Error("Authentication failed - no user returned")}catch(e){throw(0,st.e)(en,"login","onError",e.privyErrorCode||t0.b.UNKNOWN_AUTH_ERROR),D({status:"error",error:e}),e}return m(l),_(o||!1),ec(!0),D({status:"done"}),eu.current=null,ed.current=null,{user:l,isNewUser:o||!1}},linkWithSiwe:async({message:e,signature:t,chainId:i,walletClientType:n,connectorType:s})=>{let a;eA("siwe");let o=null;try{D({status:"submitting-signature"}),a=await r.linkWithSiwe({message:e,signature:t,chainId:i,walletClientType:n,connectorType:s}),a=await eR.refreshSessionAndUser()??a,D({status:"done"}),(o=ek(a)||null)&&(0,st.e)(en,"linkAccount","onSuccess",{user:a,linkMethod:"siwe",linkedAccount:o})}catch(e){throw(0,st.e)(en,"linkAccount","onError",e.privyErrorCode||t0.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"siwe"}),eu.current=null,ed.current=null,D({status:"error",error:e}),e}let l=a||g;return m(l||null),eu.current=null,ed.current=null,{user:l,linkedAccount:o}},refreshSessionAndUser:async()=>{let e=await r.getAuthenticatedUser();return ec(!!e),m(e),e},walletProxy:q,createAnalyticsEvent:({eventName:e,payload:t,timestamp:i})=>r.createAnalyticsEvent({eventName:e,payload:t,timestamp:i}),acceptTerms:async()=>{let e=await r.acceptTerms();return m(e),e},getUsdTokenPrice:e=>r.getUsdTokenPrice(e),getUsdPriceForSol:()=>r.getUsdPriceForSol(),getSplTokenMetadata:e=>r.getSplTokenMetadata(e),recoverEmbeddedWallet:async e=>new Promise(async(t,i)=>{if(!g)return void t(!0);let n=e?.address?(0,tG.h)(g,e.address):(0,tG.g)(g)||(0,tG.f)(g).at(0)||(0,tG.j)(g).at(0);if(!n||(0,tG.d)(n))return void t(!0);let s=await kS();if(!s||!q||!n)return void i(Error("Must have valid access token and Privy wallet to recover wallet"));let{entropyId:a,entropyIdVerifier:o}=(0,tX.g)(g,n);try{await q.connect({accessToken:s,entropyId:a,entropyIdVerifier:o}),t(!0)}catch(e){if(TI(e)&&"privy"===n.recoveryMethod){let e;r.createAnalyticsEvent({eventName:"embedded_wallet_pinless_recovery_started",payload:{walletAddress:n.address}});try{e=await q.recover({entropyId:a,entropyIdVerifier:o,accessToken:s})}catch(e){return void i(e)}e.entropyId||i(Error("Unable to recover wallet")),r.createAnalyticsEvent({eventName:"embedded_wallet_recovery_completed",payload:{walletAddress:n.address}}),t(!0)}else TI(e)&&"privy"!==n.recoveryMethod&&"privy-v2"!==n.recoveryMethod?(J({recoverWallet:{entropyId:a,entropyIdVerifier:o,onFailure:i,onSuccess:()=>t(!0)},recoveryOAuthStatus:{provider:n.recoveryMethod,action:"recover",shouldCreateEth:!1,shouldCreateSol:!1}}),ef(TY(n.recoveryMethod))):i(e)}}),setReadyToTrue:e=>{y(!0),Z?.(e)},updateWallets:()=>eS(),fundWallet:async(e,t)=>{let r="FundingMethodSelectionScreen";return new Promise((i,n)=>{J({funding:{...(0,t1.p)({address:e,appConfig:d,fundWalletConfig:t,methodScreen:r,onComplete:i,onError:n})}}),ef(r)})},openModal:ef,requestFarcasterSignerStatus:async e=>{let t=await kS(),i=g?.linkedAccounts.find(e=>"wallet"===e.type&&"privy"===e.walletClientType);if(!t)throw Error("Must have valid access token to connect with Farcaster");if(!q||!i)throw Error("Must have an embedded wallet to use Farcaster signers");if(!g?.farcaster?.fid)throw Error("Must have Farcaster account to use Farcaster signers");let n=await r.requestFarcasterSignerStatus(e);return"approved"===n.status&&m(await r.getAuthenticatedUser()||g||null),n},connectCoinbaseSmartWallet:async()=>{d.externalWallets.coinbaseWallet.config.preference={...d.externalWallets.coinbaseWallet.config.preference,options:"smartWalletOnly"};let e=r.connectors?.findWalletConnector("coinbase_wallet","coinbase_smart_wallet")||r.connectors?.findWalletConnector("coinbase_wallet","coinbase_wallet");if(e)return e.updateConnectionPreference("smartWalletOnly"),eb(e);await ew("coinbase_wallet","coinbase_smart_wallet")},connectBaseAccount:async()=>{let e=r.connectors?.findWalletConnector("base_account","base_account");if(e)return eb(e);await ew("base_account","base_account")},initiateAccountTransfer:async({nonce:e,account:t,accountType:i,externalWalletMetadata:n,telegramAuthResult:s,telegramWebAppData:a,farcasterEmbeddedAddress:o,oAuthUserInfo:l})=>{let c=await r.sendAccountTransferRequest({nonce:e,account:t,accountType:i,externalWalletMetadata:n,telegramAuthResult:s,telegramWebAppData:a,farcasterEmbeddedAddress:o,oAuthUserInfo:l});return m(c),c},inProgressAuthFlowRef:eu,inProgressLoginOrLinkMethodRef:ed};c=eR.recoverEmbeddedWallet,eR.recoverEmbeddedWallet;let eN=(0,H.useMemo)(()=>({wallets:w,ready:Q&&es}),[w,Q,es]),eM=r.authFlow instanceof k5,{enabled:eU,siteKey:eD,provider:eL}=d.captcha,ej=!d.headless&&eU&&!eo&&(f||eM);return(0,F.jsx)(Cn.Provider,{value:!0,children:(0,F.jsx)(tG.P.Provider,{value:eO,children:(0,F.jsx)(st.P.Provider,{value:en,children:(0,F.jsx)(tX.U.Provider,{value:eN,children:(0,F.jsx)(k2,{appId:d.id,captchaEnabled:eU,captchaSiteKey:eD,captchaProvider:eL,children:(0,F.jsxs)(t0.I.Provider,{value:eR,children:[(0,F.jsx)(tQ.R,{children:(0,F.jsxs)(tG.M,{data:V,setModalData:J,setInitialScreen:S,initialScreen:A,authenticated:eo,open:u,children:[t.children,(0,F.jsx)(Ci,{customAuth:d.customAuth}),ej&&(0,F.jsx)(Te,{delayedExecution:!1}),(0,F.jsx)(TE,{}),(0,F.jsx)(T9,{disabled:d.embeddedWallets.disableAutomaticMigration}),(0,F.jsx)(Ti,{palette:d.appearance.palette||{}}),!d.render.standalone&&(0,F.jsx)(Tg,{open:u})]})}),(0,F.jsx)(TW,{appId:t.appId,appClientId:t.clientId,clientAnalyticsId:r.clientAnalyticsId,origin:r.apiUrl,mfaMethods:g?.mfaMethods,mfaPromise:er,mfaSubmitPromise:ei,onLoad:z,onLoadFailed:()=>null}),d.loginConfig.telegramAuthConfiguration&&(0,F.jsx)(tQ.H,{$if:!0,children:(0,F.jsx)(Tv,{scriptHost:t.apiUrl||i8.D,botUsername:d.loginConfig.telegramAuthConfiguration.botName})})]})})})})})})};class Ca extends Error{constructor(e,t,r){super(e),this.code=t,this.data=r}}class Co extends tY.default{async handleSendTransaction(e){let t;if(!e.params||!Array.isArray(e.params))throw new Ca(`Invalid params for ${e.method}`,4200);let r=e.params[0];if(!await kS()||!this.address)throw new Ca("Disconnected",4900);let{hash:i}=await (t={address:this.address},l(r,t));return i}async handleSignTransaction(e){let t;if(!e.params||!Array.isArray(e.params))throw new Ca(`Invalid params for ${e.method}`,4200);let r=e.params[0];if(!await kS()||!this.address)throw new Ca("Disconnected",4900);let{signature:i}=await (t={address:this.address},o(r,t));return i}handleSwitchEthereumChain(e){let t;if(!e.params||!Array.isArray(e.params))throw new Ca(`Invalid params for ${e.method}`,4200);if("string"==typeof e.params[0])t=e.params[0];else{if(!("chainId"in e.params[0])||"string"!=typeof e.params[0].chainId)throw new Ca(`Invalid params for ${e.method}`,4200);t=e.params[0].chainId}this.chainId=Number(t),this.publicClient=(0,_y.g)(this.chainId,this.chains,this.rpcConfig,{appId:this.appId}),this.emit("chainChanged",t)}async handlePersonalSign(e){if(!e.params||!Array.isArray(e.params))throw Error("Invalid params for personal_sign");let t=e.params[0],r=e.params[1],{signature:i}=await s({message:t},{address:r});return i}async handleSignedTypedData(e){let t;if(!e.params||!Array.isArray(e.params))throw Error("Invalid params for eth_signTypedData_v4");let r=e.params[0],i="string"==typeof e.params[1]?JSON.parse(e.params[1]):e.params[1],{signature:n}=await (t=(0,tQ.m)(i),a(t,{address:r}));return n}async handleEstimateGas(e){if(!e.params||!Array.isArray(e.params))throw Error("Invalid params for eth_estimateGas");delete e.params[0].gasPrice,delete e.params[0].maxFeePerGas,delete e.params[0].maxPriorityFeePerGas;let t={...e.params[0],chainId:(0,tQ.t)(this.chainId)};return await this.publicClient.estimateGas({account:t.from??this.address,...(0,i5.toViemTransactionSerializable)(t)})}async request(e){let t;switch(console.debug("Embedded1193Provider.request() called with args",e),e.method){case"eth_accounts":case"eth_requestAccounts":return this.address?[this.address]:[];case"eth_chainId":return(0,tQ.t)(this.chainId);case"eth_estimateGas":return this.handleEstimateGas(e);case"eth_sendTransaction":return this.handleSendTransaction(e);case"eth_signTransaction":return this.handleSignTransaction(e);case"wallet_switchEthereumChain":return this.handleSwitchEthereumChain(e);case"personal_sign":return this.handlePersonalSign(e);case"eth_signTypedData_v4":return this.handleSignedTypedData(e)}if(t=e.method,!kx.includes(t))return this.publicClient.request({method:e.method,params:e.params});{let t,r=await kS();if(await (t={address:this.address},c(t)),!r||!this.address)throw new Ca("Disconnected",4900);try{let t={method:e.method,params:e.params},i=this.walletAccount;return i&&(0,tG.d)(i)?this.handleWalletApiRequest(t,i,r):(await this.walletProxy.rpc({accessToken:r,entropyId:this.entropyId,entropyIdVerifier:this.entropyIdVerifier,chainType:"ethereum",hdWalletIndex:this.walletIndex,request:t})).response.data}catch(e){throw console.error(e),new Ca("Disconnected",4900)}}}async handleWalletApiRequest(e,t,r){let i=this.privyClient;if(!i)throw new Ca("Disconnected",4900);if("secp256k1_sign"===e.method){let n=await (0,$.rpc)(i,async({message:e})=>this.walletProxy.signWithUserSigner({accessToken:r,message:e}),{chain_type:"ethereum",method:"secp256k1_sign",wallet_id:t.id,params:{hash:e.params[0]}});if("secp256k1_sign"!==n.method)throw new Ca(`Invalid params for ${e.method}`,4200);return n.data.signature}throw new Ca(`Method not supported: ${e.method}`,4200)}constructor({walletProxy:e,address:t,entropyId:r,entropyIdVerifier:i,rpcConfig:n,chains:s,appId:a,chainId:o=1,walletIndex:l,privyClient:c,walletAccount:d}){super(),this.walletProxy=e,this.address=t,this.entropyId=r,this.entropyIdVerifier=i,this.chainId=o,this.rpcConfig=n,this.chains=s,this.publicClient=(0,_y.g)(o,this.chains,n,{appId:a}),this.rpcTimeoutDuration=(0,tQ.c)(n,"privy"),this.appId=a,this.walletIndex=l,this.privyClient=c,this.walletAccount=d}}let Cl=({style:e,...t})=>(0,F.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",style:{...e},...t,children:(0,F.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25m18 0A2.25 2.25 0 0018.75 3H5.25A2.25 2.25 0 003 5.25m18 0V12a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 12V5.25"})}),Cc=({style:e,...t})=>(0,F.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"108",height:"108",viewBox:"0 0 108 108",fill:"none",style:{height:"28px",width:"28px",...e},...t,children:[(0,F.jsx)("rect",{width:"108",height:"108",rx:"23",fill:"#AB9FF2"}),(0,F.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M46.5267 69.9229C42.0054 76.8509 34.4292 85.6182 24.348 85.6182C19.5824 85.6182 15 83.6563 15 75.1342C15 53.4305 44.6326 19.8327 72.1268 19.8327C87.768 19.8327 94 30.6846 94 43.0079C94 58.8258 83.7355 76.9122 73.5321 76.9122C70.2939 76.9122 68.7053 75.1342 68.7053 72.314C68.7053 71.5783 68.8275 70.7812 69.0719 69.9229C65.5893 75.8699 58.8685 81.3878 52.5754 81.3878C47.993 81.3878 45.6713 78.5063 45.6713 74.4598C45.6713 72.9884 45.9768 71.4556 46.5267 69.9229ZM83.6761 42.5794C83.6761 46.1704 81.5575 47.9658 79.1875 47.9658C76.7816 47.9658 74.6989 46.1704 74.6989 42.5794C74.6989 38.9885 76.7816 37.1931 79.1875 37.1931C81.5575 37.1931 83.6761 38.9885 83.6761 42.5794ZM70.2103 42.5795C70.2103 46.1704 68.0916 47.9658 65.7216 47.9658C63.3157 47.9658 61.233 46.1704 61.233 42.5795C61.233 38.9885 63.3157 37.1931 65.7216 37.1931C68.0916 37.1931 70.2103 38.9885 70.2103 42.5795Z",fill:"#FFFDF8"})]});function Cd(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}var Cu=0;class Ch extends tQ.E{async initialize(){await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(e){return e.showPrompt&&await this.promptConnection(),await this.isConnected()?this.getConnectedWallet():null}get walletBranding(){return{name:this.providerDetail.info.name,icon:this.providerDetail.info.icon,id:this.providerDetail.info.rdns}}disconnect(){console.warn(`Programmatic disconnect with ${this.providerDetail.info.name} is not yet supported.`)}async promptConnection(){try{let e=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!e||0===e.length||!e[0])throw new t0.P("Unable to retrieve accounts");await this.syncAccounts([e[0]])}catch(e){throw(0,t1.f)(e)}}constructor(e,t,r,i,n){super(n||"unknown",e,t,r),this.connectorType="injected",this.proxyProvider=new tQ.P(void 0,this.rpcTimeoutDuration),this.subscribeListeners(),this.providerDetail=i;let s=i.provider;this.proxyProvider.setWalletProvider(s)}}var Cp="__private_"+Cu+++"__walletBranding";class Cf extends tQ.E{async initialize(){await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(e){return e.showPrompt&&await this.promptConnection(),await this.isConnected()?this.getConnectedWallet():null}get walletBranding(){return Cd(this,Cp)[Cp]??{name:"Browser Extension",icon:Cl,id:"extension"}}disconnect(){console.warn("Programmatic disconnect with browser wallets is not yet supported.")}async promptConnection(){try{let e=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!e||0===e.length||!e[0])throw new t0.P("Unable to retrieve accounts");await this.syncAccounts([e[0]])}catch(e){throw(0,t1.f)(e)}}constructor(e,t,r,i,n){super(n??"unknown",e,t,r),Object.defineProperty(this,Cp,{writable:!0,value:void 0}),this.connectorType="injected",this.proxyProvider=new tQ.P(void 0,this.rpcTimeoutDuration),this.subscribeListeners(),this.proxyProvider.setWalletProvider(i),"metamask"===n?Cd(this,Cp)[Cp]={name:"MetaMask",icon:tQ.M,id:"io.metamask"}:"phantom"===n&&(Cd(this,Cp)[Cp]={name:"Phantom",icon:Cc,id:"phantom"})}}class Cy extends Ch{disconnect(){console.warn("MetaMask does not support programmatic disconnect.")}async promptConnection(){try{i6.isMobile||await this.proxyProvider.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]});let e=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!e||0===e.length||!e[0])throw new t0.P("Unable to retrieve accounts");await this.syncAccounts([e[0]])}catch(e){throw(0,t1.f)(e)}}}class Cg extends tY.default{get wallets(){let e=new Set;return this.walletConnectors.flatMap(e=>e.wallets).sort((e,t)=>e.connectedAt&&t.connectedAt?t.connectedAt-e.connectedAt:0).filter(t=>{let r=`${t.address}${t.walletClientType}${t.connectorType}${t.meta.id}`;return!e.has(r)&&(e.add(r),!0)})}async initialize(e){if(this.initialized&&!e||(e&&this.removeAllConnectors(),this.externalWalletConfig.disableAllExternalWallets))return;let t=(0,tQ.o)({store:this.store,walletList:this.walletList,externalWalletConfig:this.externalWalletConfig,walletChainType:this.walletChainType}).then(e=>{e.forEach(({type:e,eip6963InjectedProvider:t,legacyInjectedProvider:r})=>{this.createEthereumWalletConnector({connectorType:"injected",walletClientType:e,providers:{eip6963InjectedProvider:t,legacyInjectedProvider:r}})})});for(let e of(this.walletList.includes("coinbase_wallet")&&this.createEthereumWalletConnector({connectorType:"coinbase_wallet",walletClientType:"coinbase_wallet"}),this.walletList.includes("base_account")&&this.createEthereumWalletConnector({connectorType:"base_account",walletClientType:"base_account"}),Object.values(tQ.q)))!e.isInstalled&&this.walletList.includes(e.client)&&(["ethereum-only","ethereum-and-solana"].includes(this.walletChainType)&&e.chainTypes.includes("ethereum")&&this.createEthereumWalletConnector({connectorType:"null",walletClientType:e.client,walletConfig:e}),["ethereum-and-solana","solana-only"].includes(this.walletChainType)&&e.chainTypes.includes("solana")&&this.addSolanaWalletConnector(new tQ.S({id:e.client,name:e.name})));this.externalWalletConfig.walletConnect.enabled&&(this.walletList.includes("wallet_connect_qr")||(0,tQ.e)(this.walletList))&&"solana-only"!==this.walletChainType&&this.createEthereumWalletConnector({connectorType:"wallet_connect_v2",walletClientType:"unknown"});let r=this.walletList.includes("wallet_connect_qr_solana"),i=this.externalWalletConfig.solana.connectors?.get()||[],n=async e=>{if(!r)return;let t=e.find(e=>"walletconnect_solana"===e.walletBranding?.id);t&&t.wallet&&await t.wallet.initialize({walletConnectCloudProjectId:this.walletConnectCloudProjectId,privyAppName:this.privyAppName})};n(i),i.filter(e=>r||"walletconnect_solana"!==e.walletBranding?.id).forEach(this.addSolanaWalletConnector),this.externalWalletConfig.solana.connectors?._setOnConnectorsUpdated?.(e=>{n(e),e?.filter(e=>r||"walletconnect_solana"!==e.walletBranding?.id).forEach(this.addSolanaWalletConnector)}),await t,this.initialized=!0}findWalletConnector(e,t,r){return"wallet_connect_v2"===e?this.walletConnectors.filter(tQ.r).find(t=>t.connectorType===e&&(!r||t.wallets.some(e=>e.address===r)))??null:this.walletConnectors.filter(tQ.r).find(i=>i.connectorType===e&&i.walletClientType===t&&(!r||i.wallets.some(e=>e.address===r)))??null}findSolanaWalletConnector(e){return this.walletConnectors.filter(tQ.v).find(t=>"unknown"===t.walletClientType?t.walletBranding.id===e:t.walletClientType===e)??null}findEmbeddedWalletConnectors(){return this.walletConnectors.filter(e=>"embedded"===e.connectorType)}findImportedWalletConnectors(){return this.walletConnectors.filter(e=>"embedded_imported"===e.connectorType)}onInitialized(e){e.wallets.forEach(e=>{let t=this.storedConnections.find(t=>t.address===e.address&&t.connectorType===e.connectorType&&("solana"===e.type&&"unknown"===t.walletClientType&&"unknown"===e.walletClientType?e.meta.id===t.id:t.walletClientType===e.walletClientType));t&&(e.connectedAt=t.connectedAt)}),this.emit("walletsUpdated"),this.emit("connectorInitialized")}onWalletsUpdated(e){e.initialized&&this.emit("walletsUpdated")}addEmbeddedWalletConnectors({walletProxy:e,user:t,embeddedWallets:r,defaultChain:i,appId:n,privyClient:s}){let{entropyId:a,entropyIdVerifier:o}=(0,tX.g)(t);for(let t of r){let r=this.findEmbeddedWalletConnectors().find(e=>e.walletIndex===t.walletIndex);if(r&&(0,tQ.r)(r))r.proxyProvider.walletProxy=e;else{let r=new kA({provider:new Co({walletProxy:e,address:t.address,entropyId:a,entropyIdVerifier:o,rpcConfig:this.rpcConfig,chains:this.chains,appId:n,chainId:i.id,walletIndex:t.walletIndex,privyClient:s,walletAccount:t}),chains:this.chains,defaultChain:i,rpcConfig:this.rpcConfig,imported:!1,walletIndex:t.walletIndex});this.addWalletConnector(r)}}}addImportedWalletConnector(e,t,r,i){let n=this.findWalletConnector("embedded_imported","privy",t);if(n&&(0,tQ.r)(n))n.proxyProvider.walletProxy=e;else{let n=new kA({provider:new Co({walletProxy:e,address:t,entropyId:t,entropyIdVerifier:"ethereum-address-verifier",walletIndex:0,rpcConfig:this.rpcConfig,chains:this.chains,appId:i,chainId:r.id}),chains:this.chains,walletIndex:0,defaultChain:r,rpcConfig:this.rpcConfig,imported:!0});this.addWalletConnector(n)}}removeEmbeddedWalletConnectors(){this.walletConnectors=this.walletConnectors.filter(e=>"embedded"!==e.connectorType),this.storedConnections=(0,t1.l)(),this.emit("walletsUpdated")}removeImportedWalletConnectors(){let e=this.findImportedWalletConnectors();e.length&&(e.forEach(e=>{let t=this.walletConnectors.indexOf(e);this.walletConnectors.splice(t,1)}),this.storedConnections=(0,t1.l)(),this.emit("walletsUpdated"))}async createEthereumWalletConnector({connectorType:e,walletClientType:t,providers:r,walletConfig:i}){let n=this.findWalletConnector(e,t);if(n&&(0,tQ.r)(n))return n instanceof T_&&n.resetConnection(t),n;let s="injected"!==e?"coinbase_wallet"===e?new kE(this.chains,this.defaultChain,this.rpcConfig,this.externalWalletConfig.coinbaseWallet.config):"base_account"===e?new kb(this.chains,this.defaultChain,this.rpcConfig,this.externalWalletConfig.baseAccount.config,this.setBaseAccountSdk):"null"!==e?new T_({walletConnectCloudProjectId:this.walletConnectCloudProjectId,rpcConfig:this.rpcConfig,chains:this.chains,defaultChain:this.defaultChain,shouldEnforceDefaultChainOnConnect:this.shouldEnforceDefaultChainOnConnect,privyAppId:this.privyAppId,privyAppName:this.privyAppName,walletClientType:t}):i?new tQ.w({id:i.client,name:i.name,defaultChain:this.defaultChain,walletClientType:i.client}):null:"metamask"===t&&r?.eip6963InjectedProvider?new Cy(this.chains,this.defaultChain,this.rpcConfig,r?.eip6963InjectedProvider,"metamask"):"metamask"===t&&r?.legacyInjectedProvider?new Cf(this.chains,this.defaultChain,this.rpcConfig,r?.legacyInjectedProvider,"metamask"):"phantom"===t&&r?.legacyInjectedProvider?new Cf(this.chains,this.defaultChain,this.rpcConfig,r?.legacyInjectedProvider,"phantom"):r?.legacyInjectedProvider&&"unknown_browser_extension"===t?new Cf(this.chains,this.defaultChain,this.rpcConfig,r?.legacyInjectedProvider):r?.eip6963InjectedProvider?new Ch(this.chains,this.defaultChain,this.rpcConfig,r?.eip6963InjectedProvider,t):void 0;return s&&this.addWalletConnector(s),s||null}addWalletConnector(e){this.walletConnectors.push(e),e.on("initialized",()=>this.onInitialized(e)),e.on("walletsUpdated",()=>this.onWalletsUpdated(e)),e.initialize().catch(e=>{console.debug("Failed to initialize connector",e)})}setWalletList(e){this.walletList=e,this.initialized&&this.initialize(!0).catch(console.error)}removeAllConnectors(){for(let e of this.walletConnectors)e.removeAllListeners();this.walletConnectors=[]}constructor(e,t,r,i,n,s,a,o,l,c,d,u){super(),this.addSolanaWalletConnector=async e=>{let t=this.findSolanaWalletConnector(e.walletClientType);if(!t||"null"===t.connectorType){if("null"===t?.connectorType){let e=this.walletConnectors.indexOf(t);this.walletConnectors.splice(e,1)}this.addWalletConnector(e)}},this.privyAppId=e,this.walletConnectCloudProjectId=t,this.rpcConfig=r,this.chains=i,this.defaultChain=n,this.walletConnectors=[],this.initialized=!1,this.store=s,this.walletList=a,this.shouldEnforceDefaultChainOnConnect=o,this.externalWalletConfig=l,this.privyAppName=c,this.walletChainType=u||"ethereum-only",this.setBaseAccountSdk=d,this.storedConnections=(0,t1.l)()}}let Cm=(0,sr.create)(()=>({identityToken:null})),Cw=[ni,nn,nQ];class Cb{async get(e,t){try{return await this.baseFetch(e,t)}catch(e){throw(0,t0.f)(e)}}async post(e,t,r){try{return await this.baseFetch(e,{method:"POST",...t?{body:t}:{},...r})}catch(e){throw(0,t0.f)(e)}}async delete(e,t){try{return await this.baseFetch(e,{method:"DELETE",...t})}catch(e){throw(0,t0.f)(e)}}constructor({appId:e,appClientId:t,client:r,defaults:i}){this.appId=e,this.appClientId=t,this.clientAnalyticsId=r.clientAnalyticsId,this.sdkVersion=i8.V,this.client=r,this.defaults=i,this.fallbackApiUrl=r.fallbackApiUrl,this.baseFetch=_g.ofetch.create({baseURL:this.defaults.baseURL,timeout:this.defaults.timeout,retry:3,retryDelay:500,retryStatusCodes:[408,409,425,500,502,503,504],credentials:"include",onRequest:async({request:e,options:t})=>{let r=new Headers(t.headers);r.set("privy-app-id",this.appId),this.appClientId&&r.set("privy-client-id",this.appClientId),r.set("privy-ca-id",this.clientAnalyticsId||""),r.set("privy-client",`react-auth:${this.sdkVersion}`);let i=Cw.includes(e.toString());if(!r.has("authorization")){let e=await this.client.getAccessToken({disableAutoRefresh:i});null!==e&&r.set("authorization",`Bearer ${e}`)}t.headers=r,t.retryDelay&&"number"==typeof t.retryDelay&&(t.retryDelay=3*t.retryDelay)},onRequestError:({error:e})=>{if(e instanceof DOMException&&"AbortError"===e.name)throw new t0.h}})}}class Cv{getOrCreateGuestCredential(e){let t=(0,i8.g)(e);if((0,t1.e)()){if(t1.u.get(t))return t1.u.get(t);{let e=tZ.base64url.encode(kH(32));return t1.u.put(t,e),e}}return tZ.base64url.encode(kH(32))}async authenticate(){if(!this.api)throw new t0.a("Auth flow has no API instance");try{return await this.api.post(n1,{guest_credential:this.meta.guestCredential})}catch(e){throw(0,t0.f)(e)}}async link(){throw Error("Linking is not supported for the guest flow")}constructor(e){this.meta={guestCredential:this.getOrCreateGuestCredential(e)}}}function CE(){return!(i6.isSafari&&window.location.origin.startsWith("http://localhost"))}var C_,CA,CS,Cx,CI,Ck,CT,CC,CP,CO,CR,CN,CM,CU,CD,CL,Cj,CB,CW,CF,CH,Cq,Cz,C$,CK,CV,CJ,CZ,CG,CY,CQ,CX,C0,C1=((C0={}).PRIVY="privy_access_token",C0.CUSTOMER="customer_access_token",C0);class C2{get token(){return this.privyAccessToken||this.customerAccessToken}getToken(e){return"privy_access_token"===e?this.privyAccessToken:this.customerAccessToken}get customerAccessToken(){return this._getToken(i8.C)}get privyAccessToken(){return this._getToken(i8.P)}_getToken(e){try{let t=t1.u.get(e);return"string"==typeof t?kf.throwIfNotWellFormedJwt(t):null}catch(e){return console.error(e),this.destroyLocalState(),null}}get refreshToken(){try{let e=t1.u.get(i8.R);return"string"==typeof e?e:null}catch(e){return console.error(e),this.destroyLocalState(),null}}getProviderAccessToken(e){try{let t=t1.u.get((0,i8.e)(e));if("string"!=typeof t)return null;{let r=new kf(t);return r.isExpired()?(t1.u.del((0,i8.e)(e)),null):r.value}}catch(e){return console.error(e),null}}get mightHaveServerCookies(){try{let e=_m.default.get(i8.f);return void 0!==e&&e.length>0}catch(e){console.error(e)}return!1}hasRefreshCredentials(e="privy_access_token"){let t="string"==typeof this.getToken(e),r="string"==typeof this.refreshToken&&this.refreshToken!==i8.h;return this.mightHaveServerCookies||t&&r}hasActiveAccessToken(e){let t=kf.parse(this.getToken(e));return null!==t&&!t.isExpired(30)}authenticate(e){return this.authenticateOnce.execute(e)}link(e){return this.linkOnce.execute(e)}refresh(){return this.refreshOnce.execute()}destroy(){return this.destroyOnce.execute()}storeProviderAccessToken(e,t){"string"==typeof t?t1.u.put((0,i8.e)(e),t):t1.u.del((0,i8.e)(e))}updateIdentityToken(e){"string"==typeof e?this.storeIdentityToken(e):this.clearIdentityToken()}async _authenticate(e){try{let t=await e.authenticate(),{user:r,is_new_user:i,oauth_tokens:n}=t;this.handleTokenResponse(t);let s=n?{provider:n.provider,accessToken:n.access_token,accessTokenExpiresInSeconds:n.access_token_expires_in_seconds,refreshToken:n.refresh_token,refreshTokenExpiresInSeconds:n.refresh_token_expires_in_seconds,scopes:n.scopes}:void 0;return this._trackAuthenticateEvents(e,i),{user:(0,tG.l)(r),isNewUser:i,oAuthTokens:s}}catch(e){throw console.warn("Error authenticating session"),(0,t0.i)(e)}}_trackAuthenticateEvents(e,t){let r=e instanceof kk?"email":e instanceof kQ?"sms":e instanceof kG?"siwe":e instanceof Cv?"guest":e instanceof Ct?"custom_auth":e instanceof kK?e.meta.provider:null;r&&this.client&&this.client.createAnalyticsEvent({eventName:"sdk_authenticate",payload:{method:r,isNewUser:t}}),"siwe"===r&&this.client&&this.client.createAnalyticsEvent({eventName:"sdk_authenticate_siwe",payload:{connectorType:e.meta.connectorType,walletClientType:e.meta.walletClientType}})}async _link(e){try{let t=await e.link(),r=t.oauth_tokens,i=r?{provider:r.provider,accessToken:r.access_token,accessTokenExpiresInSeconds:r.access_token_expires_in_seconds,refreshToken:r.refresh_token,refreshTokenExpiresInSeconds:r.refresh_token_expires_in_seconds,scopes:r.scopes}:void 0;return{user:(0,tG.l)(t),oAuthTokens:i}}catch(e){throw console.warn("Error linking account"),(0,t0.i)(e)}}async _refresh(){if(!this.api)throw new t0.a("Session has no API instance");if(!this.client)throw new t0.a("Session has no PrivyClient instance");await this.client.getAccessToken({disableAutoRefresh:!0});let e=this.token,t=this.refreshToken;if(this.client.useServerCookies&&!this.mightHaveServerCookies&&this.token&&window.location.origin===this.client.apiUrl)return this.destroyLocalState(),null;try{let r;if(!(e&&t||this.mightHaveServerCookies))return null;{let i={};e&&(i.authorization=`Bearer ${e}`),r=await this.api.post(ni,t?{refresh_token:t}:{},{headers:i})}return this.handleTokenResponse(r),(0,tG.l)(r.user)}catch(e){if(e instanceof t0.e&&e.privyErrorCode===t0.b.MISSING_OR_INVALID_TOKEN)return console.warn("Unable to refresh tokens - token is missing or no longer valid"),this.destroyLocalState(),null;throw(0,t0.i)(e)}}handleTokenResponse(e){e.session_update_action&&"set"!==e.session_update_action?"clear"===e.session_update_action?this.destroyLocalState():"ignore"===e.session_update_action&&(e.token&&(this.storeCustomerAccessToken(e.token),this.storePrivyAccessToken(e.privy_access_token)),e.identity_token&&this.storeIdentityToken(e.identity_token)):this._storeAllTokens(e)}_storeAllTokens(e){this.storeRefreshToken(e.refresh_token),this.storeCustomerAccessToken(e.token),this.storePrivyAccessToken(e.privy_access_token),e.identity_token&&this.storeIdentityToken(e.identity_token)}async _destroy(){try{await this.api?.post(nn,{refresh_token:this.refreshToken})}catch(e){console.warn("Error destroying session")}this.destroyLocalState()}destroyLocalState(){this.storeRefreshToken(null),this.storeCustomerAccessToken(null),this.storePrivyAccessToken(null),this.clearIdentityToken()}storeCustomerAccessToken(e){if("string"==typeof e){let t=t1.u.get(i8.C);if(t1.u.put(i8.C,e),!this.client?.useServerCookies){let t=kf.parse(e)?.expiration;_m.default.set(i8.i,e,{sameSite:"Strict",secure:CE(),expires:t?new Date(1e3*t):void 0})}t!==e&&this.client?.onStoreCustomerAccessToken?.(e)}else t1.u.del(i8.C),_m.default.remove(i8.i),this.client?.onDeleteCustomerAccessToken?.()}storeRefreshToken(e){"string"==typeof e?(t1.u.put(i8.R,e),this.client?.useServerCookies||_m.default.set(i8.f,"t",{sameSite:"Strict",secure:CE(),expires:30})):(t1.u.del(i8.R),_m.default.remove(i8.j),_m.default.remove(i8.f))}storePrivyAccessToken(e){"string"==typeof e?t1.u.put(i8.P,e):t1.u.del(i8.P)}storeIdentityToken(e){if(Cm.setState({identityToken:e}),this.client?.useServerCookies)return;t1.u.put(i8.I,e);let t=kf.parse(e)?.expiration;_m.default.set(i8.k,e,{sameSite:"Strict",secure:CE(),expires:t?new Date(1e3*t):void 0})}clearIdentityToken(){t1.u.del(i8.I),Cm.setState({identityToken:null}),_m.default.remove(i8.k)}constructor(){this.authenticateOnce=new kD(async e=>this._authenticate(e)),this.linkOnce=new kD(async e=>this._link(e)),this.refreshOnce=new kD(this._refresh.bind(this)),this.destroyOnce=new kD(this._destroy.bind(this))}}var C3=0,C5="__private_"+C3+++"__getOrGenerateClientAnalyticsId";class C8{getAppId(){return this.appId}initializeConnectorManager({walletConnectCloudProjectId:e,rpcConfig:t,chains:r,defaultChain:i,store:n,walletList:s,shouldEnforceDefaultChainOnConnect:a,externalWalletConfig:o,appName:l,walletChainType:c,setBaseAccountSdk:d}){this.connectors||(this.connectors=new Cg(this.appId,e,t,r,i,n,s,a,o,l,d,c))}generateApi(){let e=new Cb({appId:this.appId,appClientId:this.appClientId,client:this,defaults:{baseURL:this.apiUrl,timeout:this.timeout}});return this.session.api=e,e}updateApiUrl(e){this.apiUrl=e||this.fallbackApiUrl,this.api=this.generateApi(),e&&(this.useServerCookies=!0)}authenticate(){if(!this.authFlow)throw new t0.a("No auth flow in progress.");return this.session.authenticate(this.authFlow)}async link(){if(!this.authFlow)throw new t0.a("No auth flow in progress.");let{oAuthTokens:e}=await this.session.link(this.authFlow);return{user:await this.getAuthenticatedUser(),oAuthTokens:e}}storeProviderAccessToken(e,t){this.session.storeProviderAccessToken(e,t)}getProviderAccessToken(e){return this.session.getProviderAccessToken(e)}async logout(){await this.session.destroy(),this.authFlow=void 0}clearProviderAcccessTokens(e){e.linkedAccounts.filter(e=>"cross_app"===e.type).forEach(e=>{this.storeProviderAccessToken(e.providerApp.id,null)})}startAuthFlow(e){return e.api=this.api,this.authFlow=e,this.authFlow}async initMfaSmsVerification(){try{await this.api.post(nZ,{action:"verify"})}catch(e){throw(0,t0.f)(e)}}async initMfaPasskeyVerification(){try{let e,t=await this.api.post(nG,{});return{rpId:(e=t.options).rp_id,challenge:e.challenge,allowCredentials:e.allow_credentials?.map(e=>({id:e.id,type:e.type,transports:e.transports}))||[],timeout:e.timeout,extensions:{appid:e.extensions?.app_id,credProps:e.extensions?.cred_props,hmacCreateSecret:e.extensions?.hmac_create_secret},userVerification:e.user_verification}}catch(e){throw(0,t0.f)(e)}}async getCrossAppProviderDetails(e){try{return this._cachedProviderAppDetails[e]||(this._cachedProviderAppDetails[e]=await this.api.get(`/api/v1/apps/${e}/cross-app/details`)),this._cachedProviderAppDetails[e]}catch(e){console.error("Error fetching cross app provider details",e)}}async acceptTerms(){try{let e=await this.api.post(nY,{});return(0,tG.l)(e)}catch(e){throw(0,t0.i)(e)}}async unlinkEmail(e){try{let t=await this.api.post(nx,{address:e});return await this.getAuthenticatedUser()??(0,tG.l)(t)}catch(e){throw(0,t0.i)(e)}}async unlinkPhone(e){try{let t=await this.api.post(nP,{phoneNumber:e});return await this.getAuthenticatedUser()??(0,tG.l)(t)}catch(e){throw(0,t0.i)(e)}}async unlinkEthereumWallet(e){try{let t=await this.api.post(nc,{address:e});return await this.getAuthenticatedUser()??(0,tG.l)(t)}catch(e){throw(0,t0.i)(e)}}async unlinkSolanaWallet(e){try{let t=await this.api.post(nf,{address:e});return await this.getAuthenticatedUser()??(0,tG.l)(t)}catch(e){throw(0,t0.i)(e)}}async unlinkOAuth(e,t){try{let r=await this.api.post(nL,{provider:e,subject:t});return await this.getAuthenticatedUser()??(0,tG.l)(r)}catch(e){throw(0,t0.i)(e)}}async unlinkFarcaster(e){try{let t=await this.api.post(nv,{fid:e});return await this.getAuthenticatedUser()??(0,tG.l)(t)}catch(e){throw(0,t0.i)(e)}}async unlinkTelegram(e){try{let t=await this.api.post(nV,{telegram_user_id:e});return await this.getAuthenticatedUser()??(0,tG.l)(t)}catch(e){throw(0,t0.i)(e)}}async revokeDelegatedWallet(){try{await this.api.post(n8,{})}catch(e){throw(0,t0.i)(e)}}async createAnalyticsEvent({eventName:e,payload:t,timestamp:r,options:i}){if("undefined"!=typeof window)try{this.clientAnalyticsId||console.warn("No client analytics id set, refusing to send analytics event"),await this.api.post(nQ,{event_name:e,client_id:this.clientAnalyticsId,payload:{...t||{},clientTimestamp:r?r.toISOString():(new Date).toISOString()}},{retry:-1,keepalive:i?.keepAlive??!1})}catch(e){console.log("Unable to submit event. This is not an issue.")}}async signMoonpayOnRampUrl(e){try{return this.api.post(n2,e)}catch(e){throw(0,t0.i)(e)}}async initCoinbaseOnRamp(e){try{return this.api.post(n3,e)}catch(e){throw(0,t0.i)(e)}}async getCoinbaseOnRampStatus({partnerUserId:e}){try{return this.api.get(`${n5}?partnerUserId=${e}`)}catch(e){throw(0,t0.i)(e)}}async getAuthenticatedUser(){return this.session.hasRefreshCredentials()?this.session.refresh():null}async getAccessToken(e){return await this.getPrivyAccessToken(e)||await this.getCustomerAccessToken(e)}async getCustomerAccessToken(e){return await this._getToken(C1.CUSTOMER,e)}async getPrivyAccessToken(e){return await this._getToken(C1.PRIVY,e)}async _getToken(e,t){return this.session.getToken(e)?this.session.hasActiveAccessToken(e)?this.session.hasRefreshCredentials(e)?ky.parse(this.session.getToken(e))?.appId!==this.appId?(await this.logout(),null):this.session.getToken(e):(this.session.destroyLocalState(),null):!t?.disableAutoRefresh&&this.session.hasRefreshCredentials(e)?(await this.session.refresh(),this.session.getToken(e)):null:null}async getUsdTokenPrice(e){try{return(await this.api.get(`/api/v1/token_price?chainId=${e.id}&tokenSymbol=${e.nativeCurrency.symbol}`)).usd}catch(t){return void console.error(`Unable to fetch token price for chain with id ${e.id}`)}}async getUsdPriceForSol(){try{return(await this.api.get("/api/v1/token_price?chainId=0&tokenSymbol=SOL")).usd}catch(e){return void console.error("Unable to fetch token price for SOL")}}async getSplTokenMetadata({mintAddress:e,cluster:t}){try{return await this.api.get(`/api/v1/spl_token_info?mint_address=${e}&cluster=${t}`)}catch(r){return void console.error(`Unable to fetch token metadata for ${t}:${e}`)}}async requestFarcasterSignerStatus(e){try{return await this.api.post("/api/v1/farcaster/signer/status",{ed25519_public_key:e})}catch(e){throw console.error("Unable to fetch Farcaster signer status"),e}}async generateSiweNonce({address:e,captchaToken:t}){try{return(await this.api.post(ns,{address:e,token:t})).nonce}catch(e){throw(0,t0.i)(e)}}async authenticateWithSiweInternal({message:e,signature:t,chainId:r,walletClientType:i,connectorType:n,mode:s}){return await this.api.post(na,{message:e,signature:t,chainId:r,walletClientType:i,connectorType:n,mode:s})}async linkWithSiweInternal({message:e,signature:t,chainId:r,walletClientType:i,connectorType:n}){return await this.api.post(no,{message:e,signature:t,chainId:r,walletClientType:i,connectorType:n})}async linkSmartWallet({message:e,signature:t,smartWalletType:r,smartWalletVersion:i}){try{let n=await this.api.post(nl,{message:e,signature:t,smart_wallet_type:r,smart_wallet_version:i});return(0,tG.l)(n)}catch(e){throw(0,t0.i)(e)}}async linkWithSiwe({message:e,signature:t,chainId:r,walletClientType:i,connectorType:n}){try{let s=await this.linkWithSiweInternal({message:e,signature:t,chainId:r,walletClientType:i,connectorType:n});return(0,tG.l)(s)}catch(e){throw(0,t0.i)(e)}}async generateSiwsNonce({address:e,captchaToken:t}){try{return(await this.api.post(nu,{address:e,token:t})).nonce}catch(e){throw(0,t0.i)(e)}}async authenticateWithSiwsInternal({message:e,signature:t,walletClientType:r,connectorType:i,mode:n,messageType:s="plain"}){return await this.api.post(nh,{message:e,signature:t,walletClientType:r,connectorType:i,mode:n,message_type:s})}async authenticateWithSiws({message:e,signature:t,walletClientType:r,connectorType:i,mode:n,messageType:s="plain"}){let a=await this.authenticateWithSiwsInternal({message:e,signature:t,walletClientType:r,connectorType:i,mode:n,messageType:s});this.session.handleTokenResponse(a);let o=(0,tG.l)(a.user);if(!o)throw Error("Authentication failed - no user returned");return{user:o,isNewUser:a.is_new_user||!1}}async sendAccountTransferRequest({nonce:e,account:t,accountType:r,externalWalletMetadata:i,telegramAuthResult:n,telegramWebAppData:s,farcasterEmbeddedAddress:a,oAuthUserInfo:o}){try{let l,c;switch(r){case"email":l=nk,c={nonce:e,email:t};break;case"sms":l=nN,c={nonce:e,phoneNumber:t};break;case"siwe":if(l=nd,!i)throw Error("Wallet parameters must be defined");c={nonce:e,address:t,...i};break;case"farcaster":l=nE,c={nonce:e,farcaster_id:t,farcaster_embedded_address:a};break;case"telegram":l=nJ,c={nonce:e,telegram_auth_result:n,telegram_web_app_data:s};break;case"siws":l=ny,c={nonce:e,address:t,...i};break;case"custom":case"guest":case"passkey":throw Error("Invalid transfer account type");default:l=nj,c={nonce:e,userInfo:o}}let d=await this.api.post(l,c);return await this.getAuthenticatedUser()??(0,tG.l)(d)}catch(e){throw(0,t0.i)(e)}}async linkWithSiwsInternal({message:e,signature:t,walletClientType:r,connectorType:i,messageType:n="plain"}){return await this.api.post(np,{message:e,signature:t,walletClientType:r,connectorType:i,message_type:n})}async linkWithSiws({message:e,signature:t,walletClientType:r,connectorType:i,messageType:n="plain"}){try{let s=await this.linkWithSiwsInternal({message:e,signature:t,walletClientType:r,connectorType:i,messageType:n});return(0,tG.l)(s)}catch(e){throw(0,t0.i)(e)}}async updateUserAndIdToken(){try{let e=await this.api.get(n6);return this.session.updateIdentityToken(e.identity_token),(0,tG.l)(e.user)}catch(e){throw(0,t0.i)(e)}}async scanTransaction(e){try{return await this.api.post(n4,e)}catch(e){throw(0,t0.i)(e)}}constructor({apiUrl:e=i8.D,appId:t,appClientId:r,timeout:i=i8.l}){Object.defineProperty(this,C5,{value:C6}),this._cachedProviderAppDetails={},this.apiUrl=e,this.fallbackApiUrl=this.apiUrl,this.useServerCookies=e!==i8.D&&e.startsWith("https://privy."),this.timeout=i,this.appId=t,this.appClientId=r,this.clientAnalyticsId=(function(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e})(this,C5)[C5](),d||(d=new C2),this.session=d,this.api=this.generateApi(),this.session.client=this}}function C6(){if("undefined"==typeof window)return null;try{let e=t1.u.get(i8.d);if("string"==typeof e&&e.length>0)return e}catch(e){}let e=(0,K.v4)();try{return t1.u.put(i8.d,e),e}catch(t){return e}}function C4(){if(!u)throw new t0.a("No global PrivyClient instance found. Please ensure you have initialized the PrivyProvider.");return u}let C7=({config:e,...t})=>{(()=>{if((0,H.useContext)(Cn))throw new t0.a("Multiple PrivyProvider instances found","Found multiple instances of PrivyProvider, ensure there is only one mounted in your application tree.")})(),function(){if("undefined"==typeof window)return;let e=["localhost","127.0.0.1"].includes(window.location.hostname),t="https:"===window.location.protocol||"chrome-extension:"===window.location.protocol;if(!e&&!t)throw new t0.a("Embedded wallet is only available over HTTPS")}(),function(e){if("string"!=typeof e||25!==e.length)throw new t0.a("Cannot initialize the Privy provider with an invalid Privy app ID")}(t.appId),u||(u=new C8({appId:t.appId,appClientId:t.clientId,apiUrl:t.apiUrl}));let r=(0,H.useMemo)(()=>new q.default({appId:t.appId,clientId:t.clientId,storage:t1.u,baseUrl:t.apiUrl,sdkVersion:"react-auth:3.8.1"}),[]),i=C4(),n=Object.assign({},e);return(0,F.jsx)(i8.m,{client:r,legacyClient:i,appClientId:t.clientId,clientConfig:n,children:(0,F.jsx)(n9.P,{children:(0,F.jsx)(Cs,{...t,client:i,privy:r})})})};function C9(){let{promptMfa:e,init:t,submit:r,cancel:i,mfaMethods:n}=(0,H.useContext)(tG.P);return{promptMfa:e,init:t,submit:r,cancel:i,mfaMethods:n}}function Pe(){let{initEnrollmentWithSms:e,initEnrollmentWithTotp:t,initEnrollmentWithPasskey:r,submitEnrollmentWithSms:i,submitEnrollmentWithTotp:n,submitEnrollmentWithPasskey:s,unenroll:a,enrollInMfa:o}=(0,H.useContext)(tG.P);return{initEnrollmentWithSms:e,initEnrollmentWithTotp:t,initEnrollmentWithPasskey:r,submitEnrollmentWithSms:i,submitEnrollmentWithTotp:n,submitEnrollmentWithPasskey:s,unenrollWithSms:()=>a("sms"),unenrollWithTotp:()=>a("totp"),unenrollWithPasskey:e=>a("passkey",e),showMfaEnrollmentModal:()=>o(!0),closeMfaEnrollmentModal:()=>o(!1)}}e.s(["A",()=>TQ,"B",()=>Cl,"C",()=>k1,"D",()=>k_,"E",()=>TG,"F",()=>Cc,"G",()=>kg,"H",()=>C7,"P",()=>TS,"R",()=>kD,"S",()=>kY,"W",()=>T_,"a",()=>k3,"b",()=>kG,"c",()=>TY,"d",()=>Pe,"e",()=>TI,"f",()=>TO,"g",()=>TC,"h",()=>TT,"i",()=>TR,"j",()=>TP,"k",()=>T6,"l",()=>T0,"m",()=>km,"n",()=>kw,"o",()=>kV,"p",()=>T7,"q",()=>k8,"r",()=>Tk,"s",()=>T5,"t",()=>T3,"u",()=>C9,"v",()=>kq,"w",()=>kz,"x",()=>k$,"y",()=>TZ,"z",()=>T1],968399)}]);